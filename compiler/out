yarn run v1.22.22
$ yarn workspace babel-plugin-react-compiler run snap
$ node ../snap/dist/main.js
[32m[7m[1m PASS [22m[27m[39m [2mwhile-with-assignment-in-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mwhile-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2mwhile-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2mwhile-conditional-continue[22m
[31m[7m[1m FAIL [22m[27m[39m [2mwhile-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mvalue-block-mutates-outer-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mvalidate-no-set-state-in-render-unconditional-lambda-which-conditionally-sets-state-ok[22m
[31m[7m[1m FAIL [22m[27m[39m [2mvalidate-no-set-state-in-render-uncalled-function-with-mutable-range-is-valid[22m
[31m[7m[1m FAIL [22m[27m[39m [2muserspace-use-memo-cache[22m
[31m[7m[1m FAIL [22m[27m[39m [2museState-unpruned-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2museState-pruned-dependency-change-detect[22m
[31m[7m[1m FAIL [22m[27m[39m [2museState-and-other-hook-unpruned-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2museReducer-returned-dispatcher-is-non-reactive[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-switch-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-switch-no-fallthrough[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-simple[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-simple-preserved[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-simple-preserved-nomemo[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-return-empty[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-nested-ifs[22m
[32m[7m[1m PASS [22m[27m[39m [2museMemo-named-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-multiple-if-else[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-maybe-modified-later-preserve-memoization-guarantees[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-maybe-modified-later-dont-preserve-memoization-guarantees[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-mabye-modified-free-variable-preserve-memoization-guarantees[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-mabye-modified-free-variable-dont-preserve-memoization-guarantees[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-labeled-statement-unconditional-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-inverted-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-inlining-block-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-independently-memoizeable[22m
[31m[7m[1m FAIL [22m[27m[39m [2museMemo-if-else-multiple-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-snap-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-nested-lambdas[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-namespace-pruned[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-method-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-global-pruned[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-external-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2museEffect-arg-memoized[22m
[31m[7m[1m FAIL [22m[27m[39m [2museContext-read-context-in-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2museContext-read-context-in-callback-if-condition[22m
[31m[7m[1m FAIL [22m[27m[39m [2museContext-maybe-mutate-context-in-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-set-ref-value-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-set-ref-value-dont-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-set-ref-nested-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-set-ref-nested-property-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-set-ref-nested-property-dont-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-multiple-callbacks-modifying-same-ref-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-maybe-modify-free-variable-preserve-memoization-guarantee[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-maybe-modify-free-variable-dont-preserve-memoization-guarantee[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-call-second-function-which-captures-maybe-mutable-value-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museCallback-call-second-function-which-captures-maybe-mutable-value-dont-preserve-memoization[22m
[31m[7m[1m FAIL [22m[27m[39m [2museActionState-dispatch-considered-as-non-reactive[22m
[31m[7m[1m FAIL [22m[27m[39m [2muse-operator-method-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2muse-operator-conditional[22m
[31m[7m[1m FAIL [22m[27m[39m [2muse-operator-call-expression[22m
[32m[7m[1m PASS [22m[27m[39m [2muse-no-memo-simple[22m
[32m[7m[1m PASS [22m[27m[39m [2muse-no-memo-module-level[22m
[32m[7m[1m PASS [22m[27m[39m [2muse-no-forget-with-eslint-suppression[22m
[32m[7m[1m PASS [22m[27m[39m [2muse-no-forget-multiple-with-eslint-suppression[22m
[32m[7m[1m PASS [22m[27m[39m [2muse-no-forget-module-level[22m
[31m[7m[1m FAIL [22m[27m[39m [2muse-memo-simple[22m
[31m[7m[1m FAIL [22m[27m[39m [2muse-callback-simple[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-global-in-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-expression-on-function-parameter-4[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-expression-on-function-parameter-3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-expression-on-function-parameter-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-expression-on-function-parameter-1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mupdate-expression-in-sequence[22m
[32m[7m[1m PASS [22m[27m[39m [2mupdate-expression-constant-propagation[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-ternary-assigned-to-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-optional-method-assigned-to-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-object-element[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-object-element-with-rest[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-logical-assigned-to-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-conditional[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-array-rest-element[22m
[31m[7m[1m FAIL [22m[27m[39m [2munused-array-middle-element[22m
[31m[7m[1m FAIL [22m[27m[39m [2munmemoized-nonreactive-dependency-is-pruned-as-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2munlabeled-break-within-label-switch[22m
[31m[7m[1m FAIL [22m[27m[39m [2munlabeled-break-within-label-loop[22m
[31m[7m[1m FAIL [22m[27m[39m [2munknown-hooks-do-not-assert[22m
[31m[7m[1m FAIL [22m[27m[39m [2muninitialized-declaration-in-reactive-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2munconditional-break-label[22m
[31m[7m[1m FAIL [22m[27m[39m [2munary-expr[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-test-return-type-inference[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-test-primitive[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-test-polymorphic[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-test-field-store[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-test-field-load-binary-op[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-field-load[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-cast-expression.flow[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-binary-operator[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-args-test-binary-operator[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-alias.flow[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-alias-used-as-variable-annotation_.flow[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-alias-used-as-variable-annotation[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-alias-used-as-annotation_.flow[22m
[32m[7m[1m PASS [22m[27m[39m [2mtype-alias-used-as-annotation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-alias-declaration[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-within-object-method[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-within-object-method-returns-caught-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-within-mutable-range[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-within-function-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-within-function-expression-returns-caught-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-with-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-with-catch-param[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-try-value-modified-in-catch[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-try-value-modified-in-catch-escaping[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-try-immediately-throws-after-constant-propagation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-try-immediately-returns[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-mutate-outer-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-in-nested-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-empty-try[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtry-catch-alias-try-values[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtrivial[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtransitive-freeze-function-expressions[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtransitive-freeze-array[22m
[32m[7m[1m PASS [22m[27m[39m [2mtransitive-alias-fields[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtodo.unnecessary-lambda-memoization[22m
[32m[7m[1m PASS [22m[27m[39m [2mtodo.error.object-pattern-computed-key[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtodo-function-expression-captures-value-later-frozen[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtimers[22m
[31m[7m[1m FAIL [22m[27m[39m [2mternary-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mternary-assignment-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtemporary-property-load-accessed-outside-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtemporary-at-start-of-value-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtemporary-accessed-outside-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtemplate-literal[22m
[32m[7m[1m PASS [22m[27m[39m [2mtagged-template-literal[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtagged-template-in-hook[22m
[31m[7m[1m FAIL [22m[27m[39m [2mswitch[22m
[31m[7m[1m FAIL [22m[27m[39m [2mswitch-with-only-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mswitch-with-fallthrough[22m
[31m[7m[1m FAIL [22m[27m[39m [2mswitch-non-final-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mswitch-global-propertyload-case-test[22m
[32m[7m[1m PASS [22m[27m[39m [2mstore-via-new[22m
[32m[7m[1m PASS [22m[27m[39m [2mstore-via-call[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-while[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-while-no-reassign[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-throw[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-switch[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-single-if[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-simple[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-simple-phi[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-sibling-phis[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-shadowing[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-with-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-via-destructuring[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-via-destructuring-with-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-unconditional-with-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-unconditional-ternary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-unconditional-ternary-with-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-ternary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-ternary-with-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-ternary-destruction[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-renaming-ternary-destruction-with-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-reassign[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-reassign-in-rval[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-property[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-property-mutate[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-property-mutate-alias[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-property-mutate-2[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-property-call[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-property-alias-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-property-alias-mutate-inside-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-property-alias-mutate-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-property-alias-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-property-alias-alias-mutate-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-objectexpression[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-objectexpression-phi[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-non-empty-initializer[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-newexpression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-nested-partial-reassignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-nested-partial-phi[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-nested-loops-no-reassign[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-multiple-phis[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-leave-case[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-if-else[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-for[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-for-trivial-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-for-of[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-complex-single-if[22m
[32m[7m[1m PASS [22m[27m[39m [2mssa-complex-multiple-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-cascading-eliminated-phis[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-call-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-call-jsx-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mssa-arrayexpression[22m
[32m[7m[1m PASS [22m[27m[39m [2mskip-useMemoCache[22m
[31m[7m[1m FAIL [22m[27m[39m [2msimple[22m
[31m[7m[1m FAIL [22m[27m[39m [2msimple-scope[22m
[32m[7m[1m PASS [22m[27m[39m [2msimple-function-1[22m
[32m[7m[1m PASS [22m[27m[39m [2msimple-alias[22m
[32m[7m[1m PASS [22m[27m[39m [2mshould-bailout-without-compilation-infer-mode[22m
[32m[7m[1m PASS [22m[27m[39m [2mshould-bailout-without-compilation-annotation-mode[22m
[32m[7m[1m PASS [22m[27m[39m [2msequentially-constant-progagatable-if-test-conditions[22m
[31m[7m[1m FAIL [22m[27m[39m [2msequential-destructuring-both-mixed-local-and-scope-declaration[22m
[31m[7m[1m FAIL [22m[27m[39m [2msequential-destructuring-assignment-to-scope-declarations[22m
[31m[7m[1m FAIL [22m[27m[39m [2msequence-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2msame-variable-as-dep-and-redeclare[22m
[31m[7m[1m FAIL [22m[27m[39m [2msame-variable-as-dep-and-redeclare-maybe-frozen[22m
[32m[7m[1m PASS [22m[27m[39m [2mrewrite-phis-in-lambda-capture-context[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreverse-postorder[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreturn-undefined[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreturn-conditional[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrest-param-with-object-spread-pattern[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrest-param-with-identifier[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrest-param-with-array-pattern[22m
[31m[7m[1m FAIL [22m[27m[39m [2mresolve-react-hooks-based-on-import-name[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-unreachable-code-early-return-in-useMemo[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-unmerged-fbt-call-merge-overlapping-reactive-scopes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-undefined-expression-of-jsxexpressioncontainer[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-slow-validate-preserve-memo[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-separate-scopes-for-divs[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-scope-missing-mutable-range[22m
[32m[7m[1m PASS [22m[27m[39m [2mrepro-retain-source-when-bailout[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-renaming-conflicting-decls[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-ref-mutable-range[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-reassign-to-variable-without-mutable-range[22m
[32m[7m[1m PASS [22m[27m[39m [2mrepro-preds-undefined-try-catch-return-primitive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-object-pattern[22m
[32m[7m[1m PASS [22m[27m[39m [2mrepro-non-identifier-object-keys[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-no-value-for-temporary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-no-value-for-temporary-reactive-scope-with-early-return[22m
[32m[7m[1m PASS [22m[27m[39m [2mrepro-no-gating-import-without-compiled-functions[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-no-declarations-in-reactive-scope-with-early-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-mutable-range-extending-into-ternary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-missing-dependency-if-within-while[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-memoize-array-with-immutable-map-after-hook[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-invalid-scope-merging-value-blocks[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-invalid-reactivity-value-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-invalid-pruned-scope-leaks-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-invalid-pruned-scope-leaks-value-via-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-instruction-part-of-already-closed-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-independently-memoized-property-load-for-method-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-hoisting[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-hoisting-variable-collision[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-duplicate-type-import[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-duplicate-instruction-from-merge-consecutive-scopes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-duplicate-import-specifier[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-dont-memoize-array-with-mutable-map-after-hook[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-dont-memoize-array-with-capturing-map-after-hook[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-dce-circular-reference[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrepro-allocating-ternary-test-instruction-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreordering-across-blocks[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrenaming-jsx-tag-lowercase[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrename-source-variables[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrename-source-variables-nested-object-method[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrename-source-variables-nested-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2mregexp-literal[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-parameter-mutate-in-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-like-name-in-useCallback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-like-name-in-useCallback-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-like-name-in-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-in-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-write-not-added-to-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-optional-field-no-added-to-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-not-added-to-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-not-added-to-dep-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-field-write-not-added-to-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-field-not-added-to-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-aliased-not-added-to-dep-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mref-current-aliased-no-added-to-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-cond-deps-return-in-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-cond-deps-cfg-nested-testifelse[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-cond-deps-break-in-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrecursive-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassignment-separate-scopes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassignment-conditional[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassigned-phi-in-returned-function-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassign-primitive-in-context[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassign-object-in-context[22m
[32m[7m[1m PASS [22m[27m[39m [2mreassign-in-while-loop-condition[22m
[32m[7m[1m PASS [22m[27m[39m [2mreassign-global-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreassign-global-hook-arg[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreanimated-no-memo-arg[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreadonly-object-method-calls[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreadonly-object-method-calls-mutable-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-via-readonly-alias-of-mutable-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-via-aliased-mutation-through-property-load[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-via-aliased-mutation-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-via-aliased-mutation-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-analysis-reactive-via-mutation-of-property-load[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-analysis-reactive-via-mutation-of-computed-load[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactivity-analysis-interleaved-reactivity[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-scopes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-scopes-if[22m
[32m[7m[1m PASS [22m[27m[39m [2mreactive-scope-grouping[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-dependency-object-captured-with-reactive-mutated[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-dependency-nonreactive-captured-with-reactive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-dependency-fixpoint[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-dependencies-non-optional-properties-inside-optional-chain[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-while-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-via-mutation-switch[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-via-mutation-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-switch-condition[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-switch-case-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-reactive-after-fixpoint[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-phi-setState-type[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-on-context-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-while[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-switch[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-for-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-for-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-for-of[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-for-init[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-for-in[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-from-interleaved-reactivity-do-while[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-forof-collection[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-forin-collection[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-for-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-for-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-for-init[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-do-while-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreactive-control-dependency-do-while-indirect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreact-namespace[22m
[31m[7m[1m FAIL [22m[27m[39m [2mquoted-strings-jsx-attribute-escaped-constant-propagation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mquoted-strings-in-jsx-attribute[22m
[31m[7m[1m FAIL [22m[27m[39m [2mquoted-strings-in-jsx-attribute-escaped[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprune-scopes-whose-deps-may-invalidate-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprune-scopes-whose-deps-invalidate-object[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprune-scopes-whose-deps-invalidate-new[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprune-scopes-whose-deps-invalidate-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprune-scopes-whose-deps-invalidate-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mproperty-call-spread[22m
[32m[7m[1m PASS [22m[27m[39m [2mproperty-call-evaluation-order[22m
[31m[7m[1m FAIL [22m[27m[39m [2mproperty-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprop-capturing-function-1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprimitive-reassigned-loop-force-scopes-enabled[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprimitive-as-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprimitive-as-dep-nested-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mprimitive-alias-mutate[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-jsxtext-stringliteral-distinction[22m
[31m[7m[1m FAIL [22m[27m[39m [2mphi-type-inference-property-store[22m
[31m[7m[1m FAIL [22m[27m[39m [2mphi-type-inference-array-push[22m
[31m[7m[1m FAIL [22m[27m[39m [2mphi-reference-effects[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpartial-early-return-within-reactive-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2moverlapping-scopes-within-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2moverlapping-scopes-while[22m
[31m[7m[1m FAIL [22m[27m[39m [2moverlapping-scopes-shadowing-within-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2moverlapping-scopes-shadowed[22m
[31m[7m[1m FAIL [22m[27m[39m [2moverlapping-scopes-interleaved[22m
[31m[7m[1m FAIL [22m[27m[39m [2moverlapping-scopes-interleaved-by-terminal[22m
[31m[7m[1m FAIL [22m[27m[39m [2moutlining-in-react-memo[22m
[31m[7m[1m FAIL [22m[27m[39m [2moutlining-in-func-expr[22m
[31m[7m[1m FAIL [22m[27m[39m [2moutlined-helper[22m
[31m[7m[1m FAIL [22m[27m[39m [2moutlined-destructured-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-receiver-optional-method[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-receiver-method-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-method-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-member-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-member-expression-with-optional-member-expr-as-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-member-expression-chain[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-member-expression-call-as-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-computed-member-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-computed-load-static[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-call-with-optional-property-load[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-call-with-independently-memoizable-arg[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-call-simple[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-call-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2moptional-call-chained[22m
[31m[7m[1m FAIL [22m[27m[39m [2moption-enable-change-variable-codegen[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-shorthand-method-nested[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-shorthand-method-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-shorthand-method-1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-properties[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-pattern-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-mutated-in-consequent-alternate-both-return[22m
[32m[7m[1m PASS [22m[27m[39m [2mobject-method-shorthand[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-method-shorthand-mutated-after[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-method-shorthand-hook-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-method-shorthand-derived-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-method-shorthand-aliased-mutate-after[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-method-shorthand-3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-method-maybe-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-literal-spread-element[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-literal-method-in-ternary-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-literal-method-in-ternary-consequent[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-literal-method-derived-in-ternary-consequent[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-literal-method-call-in-ternary-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-expression-string-literal-key[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-expression-computed-key[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-expression-computed-key-object-mutated-later[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-expression-computed-key-non-reactive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-expression-computed-key-constant-string[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-expression-computed-key-constant-number[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobject-computed-access-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobj-mutated-after-nested-if-else-with-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobj-mutated-after-if-else[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobj-mutated-after-if-else-with-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobj-literal-mutated-after-if-else[22m
[31m[7m[1m FAIL [22m[27m[39m [2mobj-literal-cached-in-if-else[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnonreactive-noescaping-dependency-can-inline-into-consuming-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnonoptional-load-from-optional-memberexpr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnonmutating-capture-in-unsplittable-memo-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnon-null-assertion[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnoAlias-filter-on-array-prop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mno-flow-bailout-unrelated[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnew-spread[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnew-does-not-mutate-class[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnested-scopes-hook-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnested-scopes-begin-same-instr-valueblock[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnested-optional-member-expr[22m
[32m[7m[1m PASS [22m[27m[39m [2mnested-function-with-param-as-captured-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mnested-function-shadowed-identifiers[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutation-within-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutation-within-jsx-and-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutation-within-capture-and-mutablerange[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutation-during-jsx-construction[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutate-outer-scope-within-value-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutable-liverange-loop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutable-lifetime-with-aliasing[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmutable-lifetime-loops[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmultiple-calls-to-hoisted-callback-from-other-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmulti-directive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmulti-arrow-expr-gating-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmulti-arrow-expr-export-gating-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmulti-arrow-expr-export-default-gating-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmodule-scoped-bindings[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmethod-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmethod-call-fn-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmethod-call-computed[22m
[32m[7m[1m PASS [22m[27m[39m [2mmeta-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerged-scopes-are-valid-effect-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-scopes-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-nested-scopes-with-same-inputs[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-consecutive-scopes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-consecutive-scopes-reordering[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-consecutive-scopes-objects[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-consecutive-scopes-no-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-consecutive-scopes-deps-subset-of-decls[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmerge-consecutive-nested-scopes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmemoize-value-block-value-sequence[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmemoize-value-block-value-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmemoize-value-block-value-logical-no-sequence[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmemoize-value-block-value-conditional[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmemoization-comments[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmege-consecutive-scopes-dont-merge-with-different-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmaybe-mutate-object-in-callback[22m
[32m[7m[1m PASS [22m[27m[39m [2mloop-unused-let[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlogical-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlogical-expression-object[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlog-pruned-memoization[22m
[32m[7m[1m PASS [22m[27m[39m [2mlambda-return-expression[22m
[32m[7m[1m PASS [22m[27m[39m [2mlambda-reassign-shadowed-primitive[22m
[32m[7m[1m PASS [22m[27m[39m [2mlambda-reassign-primitive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlambda-mutated-ref-non-reactive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlambda-mutated-non-reactive-to-reactive[22m
[32m[7m[1m PASS [22m[27m[39m [2mlambda-mutate-shadowed-object[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlambda-capture-returned-alias[22m
[32m[7m[1m PASS [22m[27m[39m [2mlambda-array-access-member-expr-param[22m
[32m[7m[1m PASS [22m[27m[39m [2mlambda-array-access-member-expr-captured[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlabeled-break-within-label-switch[22m
[31m[7m[1m FAIL [22m[27m[39m [2mlabeled-break-within-label-loop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-ternary-local-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-tag-evaluation-order[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-tag-evaluation-order-non-global[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-string-attribute-non-ascii[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-string-attribute-expression-container[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-spread[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-reactive-local-variable-member-expr[22m
[32m[7m[1m PASS [22m[27m[39m [2mjsx-preserve-whitespace[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-namespaced-name[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-memberexpr-tag-in-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-member-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-member-expression-tag-grouping[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-local-tag-in-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-local-memberexpr-tag[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-local-memberexpr-tag-conditional[22m
[32m[7m[1m PASS [22m[27m[39m [2mjsx-html-entity[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-freeze[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-fragment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-empty-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-attribute-with-jsx-fragment-value.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-attribute-with-jsx-element-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mjsx-attribute-default-to-true[22m
[31m[7m[1m FAIL [22m[27m[39m [2missue933-disjoint-set-infinite-loop[22m
[31m[7m[1m FAIL [22m[27m[39m [2missue852[22m
[31m[7m[1m FAIL [22m[27m[39m [2minverted-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2minverted-if-else[22m
[31m[7m[1m FAIL [22m[27m[39m [2minterdependent[22m
[31m[7m[1m FAIL [22m[27m[39m [2minterdependent-across-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2minner-memo-value-not-promoted-to-outer-scope-static[22m
[31m[7m[1m FAIL [22m[27m[39m [2minner-memo-value-not-promoted-to-outer-scope-dynamic[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-types-through-type-cast.flow[22m
[32m[7m[1m PASS [22m[27m[39m [2minfer-skip-components-without-hooks-or-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-property-delete[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-phi-primitive[22m
[32m[7m[1m PASS [22m[27m[39m [2minfer-no-component-obj-return[22m
[32m[7m[1m PASS [22m[27m[39m [2minfer-no-component-nested-jsx[22m
[32m[7m[1m PASS [22m[27m[39m [2minfer-no-component-annot[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-global-object[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-functions-hook-with-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-functions-hook-with-hook-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-functions-component-with-ref-arg[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-functions-component-with-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-functions-component-with-hook-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-function-forwardRef[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-function-expression-component[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-function-expression-React-memo-gating[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-function-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-function-React-memo[22m
[32m[7m[1m PASS [22m[27m[39m [2minfer-dont-compile-components-with-multiple-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-computed-delete[22m
[31m[7m[1m FAIL [22m[27m[39m [2minfer-compile-hooks-with-multiple-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2mindependently-memoize-object-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2mindependent[22m
[31m[7m[1m FAIL [22m[27m[39m [2mindependent-across-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2mincompatible-destructuring-kinds[22m
[31m[7m[1m FAIL [22m[27m[39m [2minadvertent-mutability-readonly-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2minadvertent-mutability-readonly-class[22m
[31m[7m[1m FAIL [22m[27m[39m [2mimmutable-hooks[22m
[31m[7m[1m FAIL [22m[27m[39m [2miife-return-modified-later[22m
[31m[7m[1m FAIL [22m[27m[39m [2miife-return-modified-later-phi[22m
[31m[7m[1m FAIL [22m[27m[39m [2mignore-use-no-forget[22m
[32m[7m[1m PASS [22m[27m[39m [2mignore-inner-interface-types[22m
[31m[7m[1m FAIL [22m[27m[39m [2midx-no-outlining[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhooks-with-prefix[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhooks-with-React-namespace[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhooks-freeze-possibly-mutable-arguments[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhooks-freeze-arguments[22m
[32m[7m[1m PASS [22m[27m[39m [2mhook-property-load-local[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhook-noAlias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhook-inside-logical-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhook-declaration-basic.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhook-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mholey-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mholey-array-pattern-dce[22m
[31m[7m[1m FAIL [22m[27m[39m [2mholey-array-pattern-dce-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mholey-array-expr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-within-lambda[22m
[32m[7m[1m PASS [22m[27m[39m [2mhoisting-simple-function-expression[22m
[32m[7m[1m PASS [22m[27m[39m [2mhoisting-simple-const-declaration[22m
[32m[7m[1m PASS [22m[27m[39m [2mhoisting-repro-variable-used-in-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-recursive-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-recursive-call-within-lambda[22m
[32m[7m[1m PASS [22m[27m[39m [2mhoisting-object-method[22m
[32m[7m[1m PASS [22m[27m[39m [2mhoisting-nested-const-declaration[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-nested-const-declaration-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-nested-block-statements[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-member-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisting-computed-member-expression[22m
[31m[7m[1m FAIL [22m[27m[39m [2mhoisted-declaration-with-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mglobals-dont-resolve-local-useState[22m
[31m[7m[1m FAIL [22m[27m[39m [2mglobals-String[22m
[31m[7m[1m FAIL [22m[27m[39m [2mglobals-Number[22m
[31m[7m[1m FAIL [22m[27m[39m [2mglobals-Boolean[22m
[31m[7m[1m FAIL [22m[27m[39m [2mglobal-jsx-tag-lowered-between-mutations[22m
[31m[7m[1m FAIL [22m[27m[39m [2mgating-with-hoisted-type-reference.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mgating-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mgating-test-export-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2mgating-test-export-function-and-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mgating-test-export-default-function[22m
[32m[7m[1m PASS [22m[27m[39m [2mgating-preserves-function-properties[22m
[32m[7m[1m PASS [22m[27m[39m [2mgating-access-function-name-in-component[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunctionexpr–conditional-access[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-param-assignment-pattern[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-expression-with-store-to-parameter[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-expression-prototype-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-expression-prototype-call-mutating[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-expression-maybe-mutates-hook-return-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-expression-captures-value-later-frozen-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-expr-directive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfunction-declaration-simple[22m
[32m[7m[1m PASS [22m[27m[39m [2mfunction-declaration-redeclare[22m
[32m[7m[1m PASS [22m[27m[39m [2mfunction-declaration-reassign[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfrozen-after-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-with-assignment-as-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-return[22m
[32m[7m[1m PASS [22m[27m[39m [2mfor-of-simple[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-nonmutating-loop-local-collection[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-mutate-item-of-local-collection[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-iterator-of-immutable-collection[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-immutable-collection[22m
[32m[7m[1m PASS [22m[27m[39m [2mfor-of-destructure[22m
[32m[7m[1m PASS [22m[27m[39m [2mfor-of-continue[22m
[32m[7m[1m PASS [22m[27m[39m [2mfor-of-conditional-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-capture-item-of-local-collection-mutate-later[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-of-capture-item-of-local-collection-mutate-later-value-initially-null[22m
[32m[7m[1m PASS [22m[27m[39m [2mfor-of-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-multiple-variable-declarations-in-initializer[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-loop-with-value-block-initializer[22m
[32m[7m[1m PASS [22m[27m[39m [2mfor-loop-let-undefined-decl[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-in-statement[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-in-statement-type-inference[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-in-statement-empty-body[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-in-statement-continue[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-in-statement-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-in-statement-body-always-returns[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-empty-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfor-empty-update-with-continue[22m
[31m[7m[1m FAIL [22m[27m[39m [2mflatten-scopes-with-methodcall-hook[22m
[31m[7m[1m FAIL [22m[27m[39m [2mflag-enable-emit-hook-guards[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfast-refresh-reloading[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfast-refresh-refresh-on-const-changes-dev[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfast-refresh-dont-refresh-const-changes-prod[22m
[31m[7m[1m FAIL [22m[27m[39m [2mextend-scopes-if[22m
[32m[7m[1m PASS [22m[27m[39m [2mexpression-with-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mexpression-with-assignment-dynamic[22m
[31m[7m[1m FAIL [22m[27m[39m [2mexisting-variables-with-c-name[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-not-switch-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-not-switch-case[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-not-if-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-not-conditional-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-non-escaping-interleaved-primitive-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-non-escaping-interleaved-allocating-nested-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-non-escaping-interleaved-allocating-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-jsx-child[22m
[31m[7m[1m FAIL [22m[27m[39m [2mescape-analysis-destructured-rest-element[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.validate-mutate-ref-arg-in-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.validate-memoized-effect-deps-invalidated-dep-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.useMemo-non-literal-depslist[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.useMemo-callback-generator[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.update-global-should-bailout[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.unconditional-set-state-nested-function-expressions[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.unconditional-set-state-lambda[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.unconditional-set-state-in-render-with-loop-throw[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.unconditional-set-state-in-render-after-loop[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.unconditional-set-state-in-render-after-loop-break[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo.try-catch-with-throw[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-useMemo-with-optional[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-useCallback-set-ref-nested-property-ref-modified-later-preserve-memoization[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-useCallback-accesses-ref-mutated-later-via-function-preserve-memoization[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-repro-unmemoized-callback-captured-in-context-variable[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-repro-named-function-with-shadowed-local-same-name[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-repro-declaration-for-all-identifiers[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-recursive-function-expression[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-reassign-const[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-optional-call-chain-in-ternary[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-optional-call-chain-in-optional[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-optional-call-chain-in-logical-expr[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-object-expression-set-syntax[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-object-expression-get-syntax[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-object-expression-computed-key-mutate-key-while-constructing-object[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-object-expression-computed-key-modified-during-after-construction[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-object-expression-computed-key-modified-during-after-construction-sequence-expr[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-new-target-meta-property[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-nested-method-calls-lower-property-load-into-temporary[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-logical-expression-within-try-catch[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-kitchensink[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-hoisting-simple-var-declaration[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-hoisted-function-in-unreachable-code[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-hoist-function-decls[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-handle-update-context-identifiers[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-function-expression-references-variable-its-assigned-to[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-function-expression-references-later-variable-declaration[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-for-of-loop-with-context-variable-iterator[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-for-loop-with-context-variable-iterator[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-for-in-loop-with-context-variable-iterator[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.todo-for-await-loops[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.store-property-in-global[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.sketchy-code-rules-of-hooks[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.sketchy-code-exhaustive-deps[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.ref-like-name-not-a-ref[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.ref-like-name-not-Ref[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.reassignment-to-global[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.reassignment-to-global-indirect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.reassign-global-fn-arg[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.propertyload-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.object-capture-global-mutation[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.not-useEffect-external-mutate[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.nomemo-and-change-detect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutate-props[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutate-property-from-global[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutate-hook-argument[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutate-global-increment-op-invalid-react[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutate-function-property[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutate-captured-arg-separately[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.mutable-range-shared-inner-outer-function[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.modify-useReducer-state[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.modify-state[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.modify-state-2[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-write-ref-prop-in-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-write-but-dont-read-ref-in-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-useMemo-callback-args[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-useMemo-async-callback[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-useLayoutEffect-dep-not-memoized[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-useInsertionEffect-dep-not-memoized[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-useEffect-dep-not-memoized[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-useEffect-dep-not-memoized-bc-range-overlaps-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-use-ref-added-to-dep-without-type-info[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-unconditional-set-state-in-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-unclosed-eslint-suppression[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-ternary-with-hook-values[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-sketchy-code-use-forget[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-setState-in-useMemo[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-setState-in-useMemo-indirect-useCallback[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-set-and-read-ref-nested-property-during-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-set-and-read-ref-during-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-ref-value-as-props[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-ref-in-callback-invoked-during-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-reassign-local-variable-in-jsx-callback[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-reassign-local-variable-in-hook-argument[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-reassign-local-variable-in-effect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-reassign-local-variable-in-async-callback[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-reassign-local-in-hook-return-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-reassign-const[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-read-ref-prop-in-render-property-load[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-read-ref-prop-in-render-destructure[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-props-mutation-in-effect-indirect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-property-store-to-frozen-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-prop-mutation-indirect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-pass-ref-to-function[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-pass-hook-as-prop[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-pass-hook-as-call-arg[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-nested-function-reassign-local-variable-in-effect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutation-of-possible-props-phi-indirect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutation-in-closure[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutate-props-via-for-of-iterator[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutate-props-in-effect-fixpoint[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutate-context[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutate-context-in-callback[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutate-after-freeze[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-mutate-after-aliased-freeze[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-global-reassignment-indirect[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-function-expression-mutates-immutable-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-disallow-mutating-refs-in-render-transitive[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-disallow-mutating-ref-in-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-destructure-to-local-global-variables[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-destructure-assignment-to-global[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-delete-property-of-frozen-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-delete-computed-property-of-frozen-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-conditional-setState-in-useMemo[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-conditional-call-non-hook-imported-as-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-conditional-call-aliased-react-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-conditional-call-aliased-hook-import[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-computed-store-to-frozen-value[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-assign-hook-to-local[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-array-push-frozen[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-aliased-ref-in-callback-invoked-during-render-[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-access-ref-during-render[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.invalid-ReactUseMemo-async-callback[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.hook-property-load-local-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.hoisting-simple-function-declaration[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.hoisted-function-declaration[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.handle-unexpected-exception-pipeline[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.gating-use-before-decl[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.gating-hoisting[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.dont-hoist-inline-reference[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.default-param-accesses-local[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.declare-reassign-variable-in-function-declaration[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.context-variable-only-chained-assign[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.conditional-hooks-as-method-call[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.conditional-hook-unknown-hook-react-namespace[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.component-syntax-ref-gating.flow[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.codegen-error-on-conflicting-imports[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.capitalized-method-call[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.capitalized-function-call[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.capitalized-function-call-aliased[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.call-args-destructuring-asignment-complex[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.bailout-on-suppression-of-custom-rule[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.bailout-on-flow-suppression[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.assign-global-in-jsx-spread-attribute[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.assign-global-in-jsx-children[22m
[32m[7m[1m PASS [22m[27m[39m [2merror.assign-global-in-component-tag-function[22m
[32m[7m[1m PASS [22m[27m[39m [2merror._todo.computed-lval-in-destructure[22m
[32m[7m[1m PASS [22m[27m[39m [2mempty-catch-statement[22m
[31m[7m[1m FAIL [22m[27m[39m [2mearly-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2mearly-return-within-reactive-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mearly-return-no-declarations-reassignments-dependencies[22m
[31m[7m[1m FAIL [22m[27m[39m [2mearly-return-nested-early-return-within-reactive-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdrop-methodcall-usememo[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdrop-methodcall-usecallback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdont-merge-overlapping-scopes-with-intermediate-reassignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdont-merge-overlapping-scopes-store-const-used-later[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdont-merge-if-dep-is-inner-declaration-of-previous-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdominator[22m
[32m[7m[1m PASS [22m[27m[39m [2mdo-while-simple[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdo-while-early-unconditional-break[22m
[32m[7m[1m PASS [22m[27m[39m [2mdo-while-continue[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdo-while-conditional-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdo-while-compound-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdo-while-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-with-typecast-as-default-value.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-with-conditional-as-default-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-same-property-identifier-names[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-property-inference[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-object-pattern-within-rest[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-object-param-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-object-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-mixed-scope-declarations-and-locals[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-mixed-scope-and-local-variables-with-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-default-past-end-of-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-default-at-explicit-undefined[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-default-at-explicit-null[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-default-at-array-hole[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-assignment-array-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-array-param-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructuring-array-default[22m
[32m[7m[1m PASS [22m[27m[39m [2mdestructure-string-literal-property-key[22m
[32m[7m[1m PASS [22m[27m[39m [2mdestructure-string-literal-invalid-identifier-property-key[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-param-string-literal-key[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-param-string-literal-key-invalid-identifier[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-object-declaration-to-context-var[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-object-assignment-to-context-var[22m
[32m[7m[1m PASS [22m[27m[39m [2mdestructure-mixed-property-key-types[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-in-branch-ssa[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-direct-reassignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-default-array-with-unary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-capture-global[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-array-declaration-to-context-var[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdestructure-array-assignment-to-context-var[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdependencies[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdependencies-outputs[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdelete-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdelete-computed-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdefault-param-with-reorderable-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdefault-param-with-empty-callback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdefault-param-calls-global-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdefault-param-array-with-unary[22m
[32m[7m[1m PASS [22m[27m[39m [2mdeeply-nested-function-expressions-with-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdeclare-reassign-variable-in-closure[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdebugger[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdebugger-memoized[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdce-unused-prefix-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdce-unused-postfix-update[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdce-unused-const[22m
[31m[7m[1m FAIL [22m[27m[39m [2mdce-loop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcreateElement-freeze[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontrolled-input[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-reassigned-two-lambdas[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-reassigned-reactive-capture[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-reassigned-outside-of-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-reassigned-objectmethod[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-reactive-implicit-control-flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-reactive-explicit-control-flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcontext-variable-as-jsx-element-tag[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstructor[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-propagation[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-propagation-while[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-propagation-unary[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-propagation-string-concat[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-propagation-phi[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-propagation-into-function-expressions[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-propagation-for[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-propagation-bit-ops[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-propagate-global-phis[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-propagate-global-phis-constant[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-prop-to-object-method[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-prop-colliding-identifier[22m
[32m[7m[1m PASS [22m[27m[39m [2mconstant-prop-across-objectmethod-def[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconstant-computed[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconst-propagation-phi-nodes[22m
[32m[7m[1m PASS [22m[27m[39m [2mconst-propagation-into-function-expression-primitive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconst-propagation-into-function-expression-global[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconsole-readonly[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconsecutive-use-memo[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconflicting-dollar-sign-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconditional-set-state-in-render[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconditional-on-mutable[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconditional-early-return[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconditional-break-labeled[22m
[31m[7m[1m FAIL [22m[27m[39m [2mconcise-arrow-expr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomputed-store-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomputed-load-primitive-as-dependency[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomputed-call-spread[22m
[32m[7m[1m PASS [22m[27m[39m [2mcomputed-call-evaluation-order[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomponent[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomponent-inner-function-with-many-args[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomponent-declaration-basic.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcomplex-while[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcodegen-instrument-forget-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcodegen-instrument-forget-gating-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcodegen-emit-make-read-only[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcodegen-emit-imports-same-source[22m
[32m[7m[1m PASS [22m[27m[39m [2mclass-component-with-render-helper[22m
[31m[7m[1m FAIL [22m[27m[39m [2mchange-detect-reassign[22m
[32m[7m[1m PASS [22m[27m[39m [2mchained-assignment-expressions[22m
[32m[7m[1m PASS [22m[27m[39m [2mchained-assignment-context-variable[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-variable-in-nested-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-variable-in-nested-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-reference-changes-type[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-nested-member-expr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-nested-member-expr-in-nested-func[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-nested-member-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-member-expr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-within-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-skip-computed-path[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-shadow-captured[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-runs-inference[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-renamed-ref[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-member-expr-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-member-expr-arguments[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-decl[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-conditional-capture-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-capture-ref-before-rename[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-4[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-4-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-3-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-alias-computed-load-2-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-function-1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-simple-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-simple-alias-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-mutate-nested[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-mutate-3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-mutate-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-receiver-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-receiver-mutate-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-receiver-computed-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-receiver-computed-mutate-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-mutate-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-computed-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-computed-mutate-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-captured-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-captured-mutate-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-captured-mutate-arr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-func-alias-captured-mutate-arr-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-fun-alias-captured-mutate-arr-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-fun-alias-captured-mutate-arr-2-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-fun-alias-captured-mutate-2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-fun-alias-captured-mutate-2-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapturing-arrow-function-1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapture_mutate-across-fns[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapture_mutate-across-fns-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapture-ref-for-later-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapture-param-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapture-indirect-mutate-alias[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapture-indirect-mutate-alias-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcapitalized-function-allowlist[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcall[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcall-with-independently-memoizable-arg[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcall-spread[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcall-args-destructuring-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mcall-args-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mbuiltin-jsx-tag-lowered-between-mutations[22m
[31m[7m[1m FAIL [22m[27m[39m [2mbug-invalid-hoisting-functionexpr[22m
[32m[7m[1m PASS [22m[27m[39m [2mbug-codegen-inline-iife[22m
[31m[7m[1m FAIL [22m[27m[39m [2mblock-scoping-switch-variable-scoping[22m
[31m[7m[1m FAIL [22m[27m[39m [2mblock-scoping-switch-dead-code[22m
[31m[7m[1m FAIL [22m[27m[39m [2mbabel-existing-react-namespace-import[22m
[31m[7m[1m FAIL [22m[27m[39m [2mbabel-existing-react-kitchensink-import[22m
[31m[7m[1m FAIL [22m[27m[39m [2mbabel-existing-react-import[22m
[31m[7m[1m FAIL [22m[27m[39m [2mawait[22m
[31m[7m[1m FAIL [22m[27m[39m [2mawait-side-effecting-promise[22m
[32m[7m[1m PASS [22m[27m[39m [2massignment-variations[22m
[32m[7m[1m PASS [22m[27m[39m [2massignment-variations-complex-lvalue[22m
[32m[7m[1m PASS [22m[27m[39m [2massignment-variations-complex-lvalue-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2massignment-in-nested-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2massignment-expression-nested-path[22m
[31m[7m[1m FAIL [22m[27m[39m [2massignment-expression-computed[22m
[32m[7m[1m PASS [22m[27m[39m [2marrow-function-one-line-directive[22m
[31m[7m[1m FAIL [22m[27m[39m [2marrow-function-expr-gating-test[22m
[31m[7m[1m FAIL [22m[27m[39m [2marrow-expr-directive[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-push-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-property-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-properties[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-pattern-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-noAlias-escaping-function[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-mutable-array-non-mutating-lambda-mutated-result[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-mutable-array-mutating-lambda[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-mutable-array-mutating-lambda-noAlias[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-frozen-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-frozen-array-noAlias[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-map-captures-receiver-noAlias[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-join[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-expression-spread[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-concat-should-capture[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-at-mutate-after-capture[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-at-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-at-closure[22m
[31m[7m[1m FAIL [22m[27m[39m [2marray-access-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-ref-access-in-unused-callback-nested[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-ref-access-in-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-ref-access-in-effect-indirect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-reassignment-to-global-function-jsx-prop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-passing-refs-as-props[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-mutating-ref-property-in-callback-passed-to-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-mutating-ref-property-in-callback-passed-to-jsx-indirect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-mutating-ref-in-callback-passed-to-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-mutating-ref-in-callback-passed-to-jsx-indirect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-mutate-global-in-effect-fixpoint[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-modify-global-in-callback-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-global-reassignment-in-effect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-global-reassignment-in-effect-indirect[22m
[32m[7m[1m PASS [22m[27m[39m [2mallow-global-mutation-unused-usecallback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-global-mutation-in-effect-indirect[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallow-global-mutation-in-effect-indirect-usecallback[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallocating-primitive-as-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallocating-primitive-as-dep-nested-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mallocating-logical-expression-instruction-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scopes-within-nested-valueblock-in-array[22m
[32m[7m[1m PASS [22m[27m[39m [2malign-scopes-trycatch-nested-overlapping-range[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scopes-reactive-scope-overlaps-try[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scopes-reactive-scope-overlaps-label[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scopes-reactive-scope-overlaps-if[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scopes-nested-block-structure[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scopes-iife-return-modified-later-logical[22m
[31m[7m[1m FAIL [22m[27m[39m [2malign-scope-starts-within-cond[22m
[31m[7m[1m FAIL [22m[27m[39m [2malias-while[22m
[32m[7m[1m PASS [22m[27m[39m [2malias-nested-member-path[22m
[32m[7m[1m PASS [22m[27m[39m [2malias-nested-member-path-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2malias-computed-load[22m
[32m[7m[1m PASS [22m[27m[39m [2malias-capture-in-method-receiver[22m
[32m[7m[1m PASS [22m[27m[39m [2malias-capture-in-method-receiver-and-mutate[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/type-annotation-var-array_.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/type-annotation-var-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/type-annotation-as-number_.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/type-annotation-as-number[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/type-annotation-as-array_.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/type-annotation-as-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2mtype-annotations/todo_type-annotations-props[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-e69ffce323c3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-e675f0a672d8[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-ddeca9708b63[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-c59788ef5676[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-acb56658fe7e[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-a63fd4f9dcc0[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-9c79feec4b9b[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-99b5c750d1d1[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-8303403b8e4c[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-5a7ac9a6e8fa[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-2c51251df67a[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-28a7111f56a7[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-206e2811c87c[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.invalid.invalid-rules-of-hooks-191029ac48c8[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.error.rules-of-hooks-e29c874aa913[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.error.rules-of-hooks-d0935abedc42[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.error.rules-of-hooks-27c18dc8dad2[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.error.invalid-rules-of-hooks-a0058f0b446d[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.error.invalid-rules-of-hooks-8566f9a360e2[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/todo.error.invalid-rules-of-hooks-368024110a58[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.bail.rules-of-hooks-fadd52c1e460[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.bail.rules-of-hooks-e9f9bac89f8f[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.bail.rules-of-hooks-e0a5db3ae21e[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.bail.rules-of-hooks-6949b255e7eb[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.bail.rules-of-hooks-28a78701970c[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/todo.bail.rules-of-hooks-279ac76f53af[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-fe6042f7628b[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-eacfcaa6ef89[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-e66a744cffbe[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-e5dd6caf4084[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-dfde14171fcd[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-df4d750736f3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-cfdfe5572fc7[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-c5d1f3143c4c[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-c1e8c7f4c191[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-9d7879272ff6[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-9a47e97b5d13[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-93dc5d5e538a[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-8f1c2c3f71c9[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-844a496db20b[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-7e52f5eec669[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-69521d94fa03[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-4f6c78a14bf7[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-485bf041f55f[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-347b0dae66f1[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-33a6e23edac1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-2e405c78cb80[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-2bec02ac982b[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-23dc7fffde57[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-1ff6c3fbbc94[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-0e2214abc294[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/rules-of-hooks-0592bd574811[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid.invalid-rules-of-hooks-d952b82c2597[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid.invalid-rules-of-hooks-d842d36db450[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid.invalid-rules-of-hooks-76a74b4666e9[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid.invalid-rules-of-hooks-449a37146a83[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid.invalid-rules-of-hooks-0de1224ce64b[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid.invalid-rules-of-hooks-0a1dbff27ba0[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-f69800950ff0[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-f3d6c5e9c83d[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-ea7c2fb545a9[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-d85c144bdf40[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-d740d54e9c21[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-c906cace44e9[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-b4dcda3d60ed[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-9bf17c174134[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-9718e30b856c[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-79128a755612[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-49d341e5d68f[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-2aabd222fc6a[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-rules-of-hooks-1b9527f967f3[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-reassigned-in-conditional[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-optionalcall[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-optional-property[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-optional-methodcall[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-in-nested-object-method[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-in-nested-function-expression-object-expression[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-if-consequent[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-if-alternate[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-from-property-of-other-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-from-hook-return[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-for[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-as-prop[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-as-conditional-test[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-hook-after-early-return[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-dynamic-hook-via-hooklike-local[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-condtionally-call-hooklike-property-of-local[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-conditionally-methodcall-hooklike-property-of-local[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-conditionally-call-prop-named-like-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-conditionally-call-local-named-like-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.invalid-call-phi-possibly-hook[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.bail.rules-of-hooks-8503ca76d6f8[22m
[32m[7m[1m PASS [22m[27m[39m [2mrules-of-hooks/error.bail.rules-of-hooks-3d692676194b[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/allow-props-named-like-hooks[22m
[31m[7m[1m FAIL [22m[27m[39m [2mrules-of-hooks/allow-locals-named-like-hooks[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-subpath-order3[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-subpath-order2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-subpath-order1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-overlap-direct[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-overlap-descendant[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-nonoverlap-direct[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/uncond-nonoverlap-descendant[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/superpath-order2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/superpath-order1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/subpath-order2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/subpath-order1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/reduce-if-exhaustive-poisoned-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/promote-uncond[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/no-uncond[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/memberexpr-join-optional-chain2[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/memberexpr-join-optional-chain[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/join-uncond-scopes-cond-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/conditional-member-expr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cond-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-switch-missing-default[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-switch-missing-case[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-switch-exhaustive[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-nested-ifelse[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-nested-ifelse-missing[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-ifelse[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/cfg-condexpr[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/throw-before-scope-starts[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/return-before-scope-starts[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/reduce-if-exhaustive-nonpoisoned-deps1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/reduce-if-exhaustive-nonpoisoned-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/jump-target-within-scope-loop-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/jump-target-within-scope-label[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-unpoisoned/else-branch-scope-unpoisoned[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/return-poisons-outer-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/return-in-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/reduce-if-nonexhaustive-poisoned-deps1[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/reduce-if-nonexhaustive-poisoned-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/loop-break-in-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/break-poisons-outer-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mreduce-reactive-deps/jump-poisoned/break-in-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-with-refs.flow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-with-no-depslist[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-reordering-depslist-controlflow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-reordering-depslist-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-invoke-prop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-inner-decl[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/useMemo-infer-scope-global[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-infer-nonallocating[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-infer-more-specific[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-infer-fewer-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-in-other-reactive-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-dropped-infer-always-invalidating[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-constant-prop[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-conditional-access-own-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-conditional-access-noAlloc[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-conditional-access-alloc[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useMemo-alias-property-load-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-with-no-depslist[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-reordering-depslist-assignment[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-reordering-deplist-controlflow[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-nonescaping[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-nonescaping-invoked-callback-escaping-return[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/useCallback-infer-scope-global[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/useCallback-infer-read-dep[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-infer-more-specific[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-infer-fewer-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-infer-conditional-value-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-in-other-reactive-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-conditional-access-own-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-captures-reassigned-context[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-captures-reassigned-context-property[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/useCallback-alias-property-load-dep[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/todo-ensure-constant-prop-decls-get-removed[22m
[31m[7m[1m FAIL [22m[27m[39m [2mpreserve-memo-validation/maybe-invalid-useMemo-no-memoblock-sideeffect[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.validate-useMemo-named-function[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-unrelated-mutation-in-depslist[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-property-call-dep[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-property-call-chained-object[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-infer-less-specific-conditional-value-block[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-infer-less-specific-conditional-access[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-dep-not-recognized[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useMemo-aliased-var[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useCallback-property-call-dep[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useCallback-infer-less-specific-conditional-access[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useCallback-conditional-access-noAlloc[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.useCallback-aliased-var[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.todo-useCallback-captures-invalidating-value[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.maybe-invalid-useMemo-read-maybeRef[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.maybe-invalid-useCallback-read-maybeRef[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.invalid-useCallback-captures-reassigned-context[22m
[32m[7m[1m PASS [22m[27m[39m [2mpreserve-memo-validation/error.false-positive-useMemo-infer-mutate-deps[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/repro-allocating-ternary-test-instruction-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/mutation-within-jsx[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/mutation-within-jsx-and-break[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/mutation-within-capture-and-mutablerange[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/mutate-outer-scope-within-value-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/invalid-align-scopes-within-nested-valueblock-in-array[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/capture-ref-for-later-mutation[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/bug-nonmutating-capture-in-unsplittable-memo-block[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/bug-hoisted-declaration-with-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2moriginal-reactive-scopes-fork/allocating-logical-expression-instruction-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmeta-isms/repro-cx-namespace-nesting[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmeta-isms/repro-cx-namespace-assigned-to-temporary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mmeta-isms/repro-cx-assigned-to-temporary[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/repro-macro-property-not-handled[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/lambda-with-fbt[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbtparam-with-jsx-fragment-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbtparam-with-jsx-element-content[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbtparam-text-must-use-expression-container[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-whitespace-within-text[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-whitespace-around-param-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-to-string[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-template-string-same-scope[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-single-space-btw-param-and-text[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-preserve-whitespace[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-preserve-whitespace-two-subtrees[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-preserve-whitespace-subtree[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-preserve-jsxtext[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-params[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-params-complex-param-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-param-with-unicode[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-param-with-trailing-whitespace[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-param-with-quotes[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-param-with-newline[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-param-with-leading-whitespace[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-no-whitespace-btw-text-and-param[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-call[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbt-call-complex-param-value[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/fbs-params[22m
[32m[7m[1m PASS [22m[27m[39m [2mfbt/error.todo-multiple-fbt-plural[22m
[32m[7m[1m PASS [22m[27m[39m [2mfbt/error.todo-locally-require-fbt[22m
[32m[7m[1m PASS [22m[27m[39m [2mfbt/error.todo-fbt-unknown-enum-value[22m
[32m[7m[1m PASS [22m[27m[39m [2mfbt/error.todo-fbt-as-local[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/bug-fbt-plural-multiple-mixed-call-tag[22m
[31m[7m[1m FAIL [22m[27m[39m [2mfbt/bug-fbt-plural-multiple-function-calls[22m

[31m[1mFailures:[22m[39m

[31m[1mFAIL:[22m[39m while-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    let x = 0;[22m
[2m    while (a.b.c) {[22m
[2m      x += b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let x = 0;[22m
[2m    while (a.b.c) {[22m
[2m      x = x + b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m while-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = 0;[22m
[2m    while (x > props.min && x < props.max) {[22m
[2m      x *= 2;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    while (x > props.min && x < props.max) {[22m
[2m      x = x * 2;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m while-conditional-continue
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    while (a) {[22m
[2m      if (b) {[22m
[2m        continue;[22m
[2m      }[22m
[2m      c();[22m
[2m      continue;[22m
[2m    }[22m
[2m    d();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    while (a) {[22m
[2m      if (b) {[22m
[2m        continue;[22m
[2m      }[22m

[2m      c();[22m
[2m    }[22m

[2m    d();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m while-break
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    while (a) {[22m
[2m      break;[22m
[2m    }[22m
[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    while (a) {[22m
[2m      break;[22m
[2m    }[22m
[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m value-block-mutates-outer-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeArray, useHook} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Here, the cond ? [...] : defaultList value block produces two[22m
[2m   * new values (each with its own scope):[22m
[2m   *   $0 = ["text"][22m
[2m   *   $1 = { text: $0 }[22m
[2m   * The same value block also mutates customList, so it must be[22m
[2m   * merged with the scope producing customList[22m
[2m   */[22m
[2m  function Foo({defaultList, cond}) {[22m
[2m    const comparator = (a, b) => a - b;[22m
[2m    useHook();[22m
[2m    const customList = makeArray(1, 5, 2);[22m
[2m    useHook();[22m
[2m    const result = cond[22m
[2m      ? [...customList.sort(comparator), {text: ['text']}][22m
[2m      : defaultList;[22m

[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{defaultList: [2, 4], cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { makeArray, useHook } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Here, the cond ? [...] : defaultList value block produces two[22m
[2m   * new values (each with its own scope):[22m
[2m   *   $0 = ["text"][22m
[2m   *   $1 = { text: $0 }[22m
[2m   * The same value block also mutates customList, so it must be[22m
[2m   * merged with the scope producing customList[22m
[2m   */[22m
[2m  function Foo(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { defaultList, cond } = t0;[22m
[2m    const comparator = _temp;[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const customList = makeArray(1, 5, 2);[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const result = cond[22m
[2m      ? [...customList.sort(comparator), { text: ["text"] }][22m
[2m      : defaultList;[22m
[2m    return result;[22m
[2m  }[22m
[2m  function _temp(a, b) {[22m
[2m    return a - b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ defaultList: [2, 4], cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1,2,5,{"text":["text"]}][22m

[31m[1mFAIL:[22m[39m validate-no-set-state-in-render-unconditional-lambda-which-conditionally-sets-state-ok
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateNoSetStateInRender[22m
[2m  import {useState} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const [x, setX] = useState(0);[22m

[2m    const foo = () => {[22m
[2m      setX(1);[22m
[2m    };[22m

[2m    const bar = () => {[22m
[2m      if (props.cond) {[22m
[2m        // This call is now conditional, so this should pass validation[22m
[2m        foo();[22m
[2m      }[22m
[2m    };[22m

[2m    const baz = () => {[22m
[2m      bar();[22m
[2m    };[22m
[2m    baz();[22m

[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: false}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateNoSetStateInRender[22m
[2m  import { useState } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const [x, setX] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x, setX] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const foo = () => {[22m
[2m      setX(1);[22m
[2m    };[22m

[2m    const bar = () => {[22m
[2m      if (props.cond) {[22m
[2m        foo();[22m
[2m      }[22m
[2m    };[22m

[2m    const baz = () => {[22m
[2m      bar();[22m
[2m    };[22m

[2m    baz();[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: false }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [0][22m

[31m[1mFAIL:[22m[39m validate-no-set-state-in-render-uncalled-function-with-mutable-range-is-valid
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateNoSetStateInRender @enableAssumeHooksFollowRulesOfReact[22m
[2m  function Component(props) {[22m
[2m    const logEvent = useLogging(props.appId);[22m
[2m    const [currentStep, setCurrentStep] = useState(0);[22m

[2m    // onSubmit gets the same mutable range as `logEvent`, since that is called[22m
[2m    // later. however, our validation uses direct aliasing to track function[22m
[2m    // expressions which are invoked, and understands that this function isn't[22m
[2m    // called during render:[22m
[2m    const onSubmit = errorEvent => {[22m
[2m      logEvent(errorEvent);[22m
[2m      setCurrentStep(1);[22m
[2m    };[22m

[2m    switch (currentStep) {[22m
[2m      case 0:[22m
[2m        return <OtherComponent data={{foo: 'bar'}} />;[22m
[2m      case 1:[22m
[2m        return <OtherComponent data={{foo: 'joe'}} onSubmit={onSubmit} />;[22m
[2m      default:[22m
[2m        // 1. logEvent's mutable range is extended to this instruction[22m
[2m        logEvent('Invalid step');[22m
[2m        return <OtherComponent data={null} />;[22m
[2m    }[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateNoSetStateInRender @enableAssumeHooksFollowRulesOfReact[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[32m-   const logEvent = useLogging(props.appId);[39m
[32m-   const [currentStep, setCurrentStep] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const logEvent = (function () {[39m
[31m+     const $res$ = useLogging(Object.freeze(props.appId));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const [currentStep, setCurrentStep] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== logEvent) {[22m
[2m      t0 = (errorEvent) => {[22m
[2m        logEvent(errorEvent);[22m
[2m        setCurrentStep(1);[22m
[2m      };[22m
[2m      $[0] = logEvent;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onSubmit = t0;[22m
[2m    switch (currentStep) {[22m
[2m      case 0: {[22m
[2m        let t1;[22m
[2m        if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-         t1 = <OtherComponent data={{ foo: "bar" }} />;[39m
[31m+         t1 = ([39m
[31m+           <OtherComponent[39m
[31m+             data={function () {[39m
[31m+               const $res$ = { foo: "bar" };[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[2] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[2];[22m
[2m        }[22m
[2m        return t1;[22m
[2m      }[22m
[2m      case 1: {[22m
[2m        let t1;[22m
[2m        if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t1 = { foo: "joe" };[22m
[2m          $[3] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[3];[22m
[2m        }[22m
[2m        let t2;[22m
[2m        if ($[4] !== onSubmit) {[22m
[32m-         t2 = <OtherComponent data={t1} onSubmit={onSubmit} />;[39m
[31m+         t2 = ([39m
[31m+           <OtherComponent[39m
[31m+             data={function () {[39m
[31m+               const $res$ = t1;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+             onSubmit={function () {[39m
[31m+               const $res$ = onSubmit;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[4] = onSubmit;[22m
[2m          $[5] = t2;[22m
[2m        } else {[22m
[2m          t2 = $[5];[22m
[2m        }[22m
[2m        return t2;[22m
[2m      }[22m
[2m      default: {[22m
[2m        logEvent("Invalid step");[22m
[2m        let t1;[22m
[2m        if ($[6] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-         t1 = <OtherComponent data={null} />;[39m
[31m+         t1 = ([39m
[31m+           <OtherComponent[39m
[31m+             data={function () {[39m
[31m+               const $res$ = null;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[6] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[6];[22m
[2m        }[22m
[2m        return t1;[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m userspace-use-memo-cache
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @runtimeModule="react-forget-runtime"[22m
[2m  function Component(props) {[22m
[2m    const [x, setX] = useState(1);[22m
[2m    let y;[22m
[2m    if (props.cond) {[22m
[2m      y = x * 2;[22m
[2m    }[22m
[2m    return ([22m
[2m      <Button[22m
[2m        onClick={() => {[22m
[2m          setX(10 * y);[22m
[2m        }}></Button>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [true],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react-forget-runtime"; // @runtimeModule="react-forget-runtime"[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[32m-   const [x, setX] = useState(1);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x, setX] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let y;[22m
[2m    if ($[0] !== props.cond || $[1] !== x) {[22m
[2m      if (props.cond) {[22m
[2m        y = x * 2;[22m
[2m      }[22m
[2m      $[0] = props.cond;[22m
[2m      $[1] = x;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m

[2m    const t0 = y;[22m
[2m    let t1;[22m
[2m    if ($[3] !== t0) {[22m
[2m      t1 = ([22m
[2m        <Button[22m
[32m-         onClick={() => {[39m
[32m-           setX(10 * y);[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = () => {[39m
[31m+             setX(10 * y);[39m
[31m+           };[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[2m          }}[22m
[2m        />[22m
[2m      );[22m
[2m      $[3] = t0;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [true],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useState-unpruned-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react'; // @enableChangeDetectionForDebugging[22m

[2m  function Component(props) {[22m
[2m    const w = f(props.x);[22m
[2m    const [x, _] = useState(w);[22m
[2m    return ([22m
[2m      <div>[22m
[2m        {x}[22m
[2m        {w}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  function f(x) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 42}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { $structuralCheck } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react"; // @enableChangeDetectionForDebugging[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    {[22m
[2m      t0 = f(props.x);[22m
[2m      let condition = $[0] !== props.x;[22m
[2m      if (!condition) {[22m
[2m        let old$t0 = $[1];[22m
[2m        $structuralCheck(old$t0, t0, "t0", "Component", "cached", "(4:4)");[22m
[2m      }[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = t0;[22m
[2m      if (condition) {[22m
[2m        t0 = f(props.x);[22m
[2m        $structuralCheck($[1], t0, "t0", "Component", "recomputed", "(4:4)");[22m
[2m        t0 = $[1];[22m
[2m      }[22m
[2m    }[22m
[2m    const w = t0;[22m
[32m-   const [x] = useState(w);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(w));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          {x}[22m
[2m          {w}[22m
[2m        </div>[22m
[2m      );[22m
[2m      let condition = $[2] !== x || $[3] !== w;[22m
[2m      if (!condition) {[22m
[2m        let old$t1 = $[4];[22m
[2m        $structuralCheck(old$t1, t1, "t1", "Component", "cached", "(7:10)");[22m
[2m      }[22m
[2m      $[2] = x;[22m
[2m      $[3] = w;[22m
[2m      $[4] = t1;[22m
[2m      if (condition) {[22m
[2m        t1 = ([22m
[2m          <div>[22m
[2m            {x}[22m
[2m            {w}[22m
[2m          </div>[22m
[2m        );[22m
[2m        $structuralCheck($[4], t1, "t1", "Component", "recomputed", "(7:10)");[22m
[2m        t1 = $[4];[22m
[2m      }[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  function f(x) {[22m
[31m+   Object.freeze(x);[39m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 42 }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useState-pruned-dependency-change-detect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableChangeDetectionForDebugging[22m
[2m  import {useState} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const [x, _] = useState(f(props.x));[22m
[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { $structuralCheck } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableChangeDetectionForDebugging[22m
[2m  import { useState } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = f(props.x);[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   const [x] = useState(t0);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    {[22m
[2m      t1 = <div>{x}</div>;[22m
[2m      let condition = $[1] !== x;[22m
[2m      if (!condition) {[22m
[2m        let old$t1 = $[2];[22m
[2m        $structuralCheck(old$t1, t1, "t1", "Component", "cached", "(6:6)");[22m
[2m      }[22m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m      if (condition) {[22m
[2m        t1 = <div>{x}</div>;[22m
[2m        $structuralCheck($[2], t1, "t1", "Component", "recomputed", "(6:6)");[22m
[2m        t1 = $[2];[22m
[2m      }[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useState-and-other-hook-unpruned-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react'; // @enableChangeDetectionForDebugging[22m

[2m  function useOther(x) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  function Component(props) {[22m
[2m    const w = f(props.x);[22m
[2m    const z = useOther(w);[22m
[2m    const [x, _] = useState(z);[22m
[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  function f(x) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 42}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { $structuralCheck } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react"; // @enableChangeDetectionForDebugging[22m

[2m  function useOther(x) {[22m
[31m+   Object.freeze(x);[39m
[2m    return x;[22m
[2m  }[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    {[22m
[2m      t0 = f(props.x);[22m
[2m      let condition = $[0] !== props.x;[22m
[2m      if (!condition) {[22m
[2m        let old$t0 = $[1];[22m
[2m        $structuralCheck(old$t0, t0, "t0", "Component", "cached", "(8:8)");[22m
[2m      }[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = t0;[22m
[2m      if (condition) {[22m
[2m        t0 = f(props.x);[22m
[2m        $structuralCheck($[1], t0, "t0", "Component", "recomputed", "(8:8)");[22m
[2m        t0 = $[1];[22m
[2m      }[22m
[2m    }[22m
[2m    const w = t0;[22m
[32m-   const z = useOther(w);[39m
[32m-   const [x] = useState(z);[39m
[31m+   const z = (function () {[39m
[31m+     const $res$ = useOther(Object.freeze(w));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(z));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    {[22m
[2m      t1 = <div>{x}</div>;[22m
[2m      let condition = $[2] !== x;[22m
[2m      if (!condition) {[22m
[2m        let old$t1 = $[3];[22m
[2m        $structuralCheck(old$t1, t1, "t1", "Component", "cached", "(11:11)");[22m
[2m      }[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m      if (condition) {[22m
[2m        t1 = <div>{x}</div>;[22m
[2m        $structuralCheck($[3], t1, "t1", "Component", "recomputed", "(11:11)");[22m
[2m        t1 = $[3];[22m
[2m      }[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  function f(x) {[22m
[31m+   Object.freeze(x);[39m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 42 }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useReducer-returned-dispatcher-is-non-reactive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useReducer} from 'react';[22m

[2m  function f() {[22m
[2m    const [state, dispatch] = useReducer();[22m

[2m    const onClick = () => {[22m
[2m      dispatch();[22m
[2m    };[22m

[2m    return <div onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useReducer } from "react";[22m

[2m  function f() {[22m
[2m    const $ = _c(1);[22m
[32m-   const [state, dispatch] = useReducer();[39m
[31m+   const [state, dispatch] = (function () {[39m
[31m+     const $res$ = useReducer();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const onClick = () => {[22m
[2m        dispatch();[22m
[2m      };[22m

[32m-     t0 = <div onClick={onClick} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m useMemo-switch-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      let y;[22m
[2m      switch (props.switch) {[22m
[2m        case 'foo': {[22m
[2m          return 'foo';[22m
[2m        }[22m
[2m        case 'bar': {[22m
[2m          y = 'bar';[22m
[2m          break;[22m
[2m        }[22m
[2m        default: {[22m
[2m          y = props.y;[22m
[2m        }[22m
[2m      }[22m
[2m      return y;[22m
[2m    });[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    bb0: {[22m
[2m      let y;[22m
[2m      bb1: switch (props.switch) {[22m
[2m        case "foo": {[22m
[2m          t0 = "foo";[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case "bar": {[22m
[2m          y = "bar";[22m
[2m          break bb1;[22m
[2m        }[22m
[2m        default: {[22m
[2m          y = props.y;[22m
[2m        }[22m
[2m      }[22m

[2m      t0 = y;[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-switch-no-fallthrough
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      switch (props.key) {[22m
[2m        case 'key': {[22m
[2m          return props.value;[22m
[2m        }[22m
[2m        default: {[22m
[2m          return props.defaultValue;[22m
[2m        }[22m
[2m      }[22m
[2m    });[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    bb0: switch (props.key) {[22m
[2m      case "key": {[22m
[2m        t0 = props.value;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      default: {[22m
[2m        t0 = props.defaultValue;[22m
[2m      }[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-simple
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = useMemo(() => [a], [a]);[22m
[2m    return <Foo x={x}></Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = [a];[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const x = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] !== x) {[22m
[32m-     t2 = <Foo x={x} />;[39m
[31m+     t2 = ([39m
[31m+       <Foo[39m
[31m+         x={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = x;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-simple-preserved
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingManualUseMemo[22m
[2m  import {useMemo} from 'react';[22m

[2m  function Component({a}) {[22m
[2m    let x = useMemo(() => [a], []);[22m
[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 42}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingManualUseMemo[22m
[2m  import { useMemo } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = () => [a];[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = [];[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[32m-   const x = useMemo(t1, t2);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useMemo(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t3;[22m
[2m    if ($[3] !== x) {[22m
[2m      t3 = <div>{x}</div>;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[4];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 42 }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>42</div>[22m

[31m[1mFAIL:[22m[39m useMemo-simple-preserved-nomemo
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @disableMemoizationForDebugging[22m
[2m  import {useMemo} from 'react';[22m

[2m  function Component({a}) {[22m
[2m    let x = useMemo(() => [a], []);[22m
[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 42}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @disableMemoizationForDebugging[22m
[2m  import { useMemo } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a || true) {[22m
[2m      t1 = () => [a];[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel") || true) {[22m
[2m      t2 = [];[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[32m-   const x = useMemo(t1, t2);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useMemo(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t3;[22m
[2m    if ($[3] !== x || true) {[22m
[2m      t3 = <div>{x}</div>;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[4];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 42 }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>42</div>[22m

[31m[1mFAIL:[22m[39m useMemo-return-empty
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = useMemo(() => {[22m
[2m      mutate(a);[22m
[2m    }, []);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m

[2m    mutate(a);[22m
[2m    t0 = undefined;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-nested-ifs
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      if (props.cond) {[22m
[2m        if (props.cond) {[22m
[2m        }[22m
[2m      }[22m
[2m    }, [props.cond]);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if (props.cond) {[22m
[2m      if (props.cond) {[22m
[2m      }[22m
[2m    }[22m
[2m    t0 = undefined;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-multiple-if-else
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useMemo} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      let y = [];[22m
[2m      if (props.cond) {[22m
[2m        y.push(props.a);[22m
[2m      }[22m
[2m      if (props.cond2) {[22m
[2m        return y;[22m
[2m      }[22m
[2m      y.push(props.b);[22m
[2m      return y;[22m
[2m    });[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1, b: 2, cond2: false}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useMemo } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    bb0: {[22m
[2m      let y;[22m
[2m      if ($[0] !== props) {[22m
[2m        y = [];[22m
[2m        if (props.cond) {[22m
[2m          y.push(props.a);[22m
[2m        }[22m
[2m        if (props.cond2) {[22m
[2m          t0 = y;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        y.push(props.b);[22m
[2m        $[0] = props;[22m
[2m        $[1] = y;[22m
[2m        $[2] = t0;[22m
[2m      } else {[22m
[2m        y = $[1];[22m
[2m        t0 = $[2];[22m
[2m      }[22m
[2m      t0 = y;[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 1, b: 2, cond2: false }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m

[31m[1mFAIL:[22m[39m useMemo-maybe-modified-later-preserve-memoization-guarantees
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity, makeObject_Primitives, mutate} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const object = useMemo(() => makeObject_Primitives(), []);[22m
[2m    identity(object);[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m
[2m  import { identity, makeObject_Primitives, mutate } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = makeObject_Primitives();[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const object = t0;[22m
[2m    identity(object);[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":0,"b":"value1","c":true}[22m

[31m[1mFAIL:[22m[39m useMemo-maybe-modified-later-dont-preserve-memoization-guarantees
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees:false[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity, makeObject_Primitives, mutate} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const object = useMemo(() => makeObject_Primitives(), []);[22m
[2m    identity(object);[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees:false[22m
[2m  import { useMemo } from "react";[22m
[2m  import { identity, makeObject_Primitives, mutate } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let object;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = makeObject_Primitives();[22m
[2m      object = t0;[22m
[2m      identity(object);[22m
[2m      $[0] = object;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      object = $[0];[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":0,"b":"value1","c":true}[22m

[31m[1mFAIL:[22m[39m useMemo-mabye-modified-free-variable-preserve-memoization-guarantees
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity, makeObject_Primitives, mutate, useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    // With the feature enabled these variables are inferred as frozen as of[22m
[2m    // the useMemo call[22m
[2m    const free = makeObject_Primitives();[22m
[2m    const free2 = makeObject_Primitives();[22m
[2m    const part = free2.part;[22m

[2m    // Thus their mutable range ends prior to this hook call, and both the above[22m
[2m    // values and the useMemo block value can be memoized[22m
[2m    useHook();[22m

[2m    const object = useMemo(() => {[22m
[2m      const x = makeObject_Primitives();[22m
[2m      x.value = props.value;[22m
[2m      mutate(x, free, part);[22m
[2m      return x;[22m
[2m    }, [props.value, free, part]);[22m

[2m    // These calls should be inferred as non-mutating due to the above freeze inference[22m
[2m    identity(free);[22m
[2m    identity(part);[22m

[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m
[2m  import {[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    mutate,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = makeObject_Primitives();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const free = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = makeObject_Primitives();[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const free2 = t1;[22m
[2m    const part = free2.part;[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    let x;[22m
[2m    if ($[2] !== props.value) {[22m
[2m      x = makeObject_Primitives();[22m
[2m      x.value = props.value;[22m
[2m      mutate(x, free, part);[22m
[2m      $[2] = props.value;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    t2 = x;[22m
[2m    const object = t2;[22m

[2m    identity(free);[22m
[2m    identity(part);[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":0,"b":"value1","c":true,"value":42,"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m useMemo-mabye-modified-free-variable-dont-preserve-memoization-guarantees
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees:false[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity, makeObject_Primitives, mutate, useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    // With the feature disabled these variables are inferred as being mutated inside the useMemo block[22m
[2m    const free = makeObject_Primitives();[22m
[2m    const free2 = makeObject_Primitives();[22m
[2m    const part = free2.part;[22m

[2m    // This causes their range to extend to include this hook call, and in turn for the memoization to be pruned[22m
[2m    useHook();[22m
[2m    const object = useMemo(() => {[22m
[2m      const x = makeObject_Primitives();[22m
[2m      x.value = props.value;[22m
[2m      mutate(x, free, part);[22m
[2m      return x;[22m
[2m    }, [props.value]);[22m

[2m    identity(free);[22m
[2m    identity(part);[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees:false[22m
[2m  import { useMemo } from "react";[22m
[2m  import {[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    mutate,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const free = makeObject_Primitives();[22m
[2m    const free2 = makeObject_Primitives();[22m
[2m    const part = free2.part;[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m

[2m    const x = makeObject_Primitives();[22m
[2m    x.value = props.value;[22m
[2m    mutate(x, free, part);[22m
[2m    t0 = x;[22m
[2m    const object = t0;[22m

[2m    identity(free);[22m
[2m    identity(part);[22m
[2m    return object;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":0,"b":"value1","c":true,"value":42,"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m useMemo-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => props.a && props.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    t0 = props.a && props.b;[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-labeled-statement-unconditional-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      label: {[22m
[2m        return props.value;[22m
[2m      }[22m
[2m    });[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m

[2m    t0 = props.value;[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-inverted-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      label: {[22m
[2m        if (props.cond) {[22m
[2m          break label;[22m
[2m        }[22m
[2m        return props.a;[22m
[2m      }[22m
[2m      return props.b;[22m
[2m    });[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    bb0: {[22m
[2m      bb1: {[22m
[2m        if (props.cond) {[22m
[2m          break bb1;[22m
[2m        }[22m

[2m        t0 = props.a;[22m
[2m        break bb0;[22m
[2m      }[22m

[2m      t0 = props.b;[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-inlining-block-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let x = useMemo(() => {[22m
[2m      if (a) {[22m
[2m        return {b};[22m
[2m      }[22m
[2m    }, [a, b]);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    bb0: {[22m
[2m      if (a) {[22m
[2m        let t1;[22m
[2m        if ($[0] !== b) {[22m
[2m          t1 = { b };[22m
[2m          $[0] = b;[22m
[2m          $[1] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[1];[22m
[2m        }[22m
[2m        t0 = t1;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      t0 = undefined;[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-independently-memoizeable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [a, b] = useMemo(() => {[22m
[2m      const items = [];[22m
[2m      const a = makeObject(props.a);[22m
[2m      const b = makeObject(props.b);[22m
[2m      return [a, b];[22m
[2m    });[22m
[2m    return [a, b];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(10);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t1 = makeObject(props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const a = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== props.b) {[22m
[2m      t2 = makeObject(props.b);[22m
[2m      $[2] = props.b;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const b = t2;[22m
[2m    let t3;[22m
[2m    if ($[4] !== a || $[5] !== b) {[22m
[2m      t3 = [a, b];[22m
[2m      $[4] = a;[22m
[2m      $[5] = b;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    t0 = t3;[22m
[2m    const [a_0, b_0] = t0;[22m
[2m    let t4;[22m
[2m    if ($[7] !== a_0 || $[8] !== b_0) {[22m
[2m      t4 = [a_0, b_0];[22m
[2m      $[7] = a_0;[22m
[2m      $[8] = b_0;[22m
[2m      $[9] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[9];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useMemo-if-else-multiple-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = useMemo(() => {[22m
[2m      if (props.cond) {[22m
[2m        return makeObject(props.a);[22m
[2m      }[22m
[2m      return makeObject(props.b);[22m
[2m    });[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    bb0: {[22m
[2m      if (props.cond) {[22m
[2m        let t1;[22m
[2m        if ($[0] !== props.a) {[22m
[2m          t1 = makeObject(props.a);[22m
[2m          $[0] = props.a;[22m
[2m          $[1] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[1];[22m
[2m        }[22m
[2m        t0 = t1;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      let t1;[22m
[2m      if ($[2] !== props.b) {[22m
[2m        t1 = makeObject(props.b);[22m
[2m        $[2] = props.b;[22m
[2m        $[3] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[3];[22m
[2m      }[22m
[2m      t0 = t1;[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useEffect-snap-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect, useState} from 'react';[22m

[2m  function Component() {[22m
[2m    const [state, setState] = useState('hello');[22m
[2m    useEffect(() => {[22m
[2m      setState('goodbye');[22m
[2m    }, []);[22m

[2m    return <div>{state}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect, useState } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(4);[22m
[32m-   const [state, setState] = useState("hello");[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze("hello"));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        setState("goodbye");[22m
[2m      };[22m
[2m      t1 = [];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[32m-   useEffect(t0, t1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t0), Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[2] !== state) {[22m
[2m      t2 = <div>{state}</div>;[22m
[2m      $[2] = state;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>goodbye</div>[22m

[31m[1mFAIL:[22m[39m useEffect-nested-lambdas
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableTransitivelyFreezeFunctionExpressions:false[22m

[2m  function Component(props) {[22m
[2m    const item = useMutable(props.itemId);[22m
[2m    const dispatch = useDispatch();[22m
[2m    useFreeze(dispatch);[22m

[2m    const exit = useCallback(() => {[22m
[2m      dispatch(createExitAction());[22m
[2m    }, [dispatch]);[22m

[2m    useEffect(() => {[22m
[2m      const cleanup = GlobalEventEmitter.addListener('onInput', () => {[22m
[2m        if (item.value) {[22m
[2m          exit();[22m
[2m        }[22m
[2m      });[22m
[2m      return () => cleanup.remove();[22m
[2m    }, [exit, item]);[22m

[2m    maybeMutate(item);[22m

[2m    return <div />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableTransitivelyFreezeFunctionExpressions:false[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(9);[22m
[32m-   const item = useMutable(props.itemId);[39m
[32m-   const dispatch = useDispatch();[39m
[32m-   useFreeze(dispatch);[39m
[31m+   Object.freeze(props);[39m
[31m+   const item = (function () {[39m
[31m+     const $res$ = useMutable(Object.freeze(props.itemId));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const dispatch = (function () {[39m
[31m+     const $res$ = useDispatch();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(dispatch));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== dispatch) {[22m
[2m      t0 = () => {[22m
[2m        dispatch(createExitAction());[22m
[2m      };[22m
[2m      $[0] = dispatch;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const exit = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== item.value || $[3] !== exit) {[22m
[2m      t1 = () => {[22m
[2m        const cleanup = GlobalEventEmitter.addListener("onInput", () => {[22m
[2m          if (item.value) {[22m
[2m            exit();[22m
[2m          }[22m
[2m        });[22m
[2m        return () => cleanup.remove();[22m
[2m      };[22m
[2m      $[2] = item.value;[22m
[2m      $[3] = exit;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[5] !== exit || $[6] !== item) {[22m
[2m      t2 = [exit, item];[22m
[2m      $[5] = exit;[22m
[2m      $[6] = item;[22m
[2m      $[7] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[7];[22m
[2m    }[22m
[32m-   useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    maybeMutate(item);[22m
[2m    let t3;[22m
[2m    if ($[8] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t3 = <div />;[22m
[2m      $[8] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[8];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useEffect-namespace-pruned
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as React from 'react';[22m

[2m  function someGlobal() {}[22m
[2m  function useFoo() {[22m
[2m    const fn = React.useMemo([22m
[2m      () =>[22m
[2m        function () {[22m
[2m          someGlobal();[22m
[2m        },[22m
[2m      [][22m
[2m    );[22m
[2m    React.useEffect(() => {[22m
[2m      fn();[22m
[2m    }, [fn]);[22m

[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as React from "react";[22m

[2m  function someGlobal() {}[22m
[2m  function useFoo() {[22m
[2m    const $ = _c(2);[22m
[2m    let t0;[22m
[2m    t0 = _temp;[22m
[2m    const fn = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = () => {[22m
[2m        fn();[22m
[2m      };[22m
[2m      t2 = [fn];[22m
[2m      $[0] = t1;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[32m-   React.useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = React.useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return null;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    someGlobal();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m useEffect-method-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  let x = {};[22m
[2m  function Component() {[22m
[2m    React.useEffect(() => {[22m
[2m      x.foo = 1;[22m
[2m    });[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  let x = {};[22m
[2m  function Component() {[22m
[32m-   React.useEffect(_temp);[39m
[31m+   (function () {[39m
[31m+     const $res$ = React.useEffect(Object.freeze(_temp));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {[22m
[2m    x.foo = 1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m useEffect-global-pruned
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect} from 'react';[22m

[2m  function someGlobal() {}[22m
[2m  function useFoo() {[22m
[2m    const fn = React.useMemo([22m
[2m      () =>[22m
[2m        function () {[22m
[2m          someGlobal();[22m
[2m        },[22m
[2m      [][22m
[2m    );[22m
[2m    useEffect(() => {[22m
[2m      fn();[22m
[2m    }, [fn]);[22m

[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect } from "react";[22m

[2m  function someGlobal() {}[22m
[2m  function useFoo() {[22m
[2m    const $ = _c(2);[22m
[2m    let t0;[22m
[2m    t0 = _temp;[22m
[2m    const fn = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = () => {[22m
[2m        fn();[22m
[2m      };[22m
[2m      t2 = [fn];[22m
[2m      $[0] = t1;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[32m-   useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return null;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    someGlobal();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m useEffect-external-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect} from 'react';[22m

[2m  let x = {a: 42};[22m

[2m  function Component(props) {[22m
[2m    useEffect(() => {[22m
[2m      x.a = 10;[22m
[2m    });[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { useEffect } from "react";[22m

[2m  let x = { a: 42 };[22m

[2m  function Component(props) {[22m
[32m-   useEffect(_temp);[39m
[31m+   Object.freeze(props);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(_temp));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {[22m
[2m    x.a = 10;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m useEffect-arg-memoized
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const dispatch = useDispatch();[22m
[2m    useFreeze(dispatch);[22m

[2m    // onUpdate should be memoized even though it doesn't[22m
[2m    // flow into the return value[22m
[2m    const onUpdate = () => {[22m
[2m      dispatch({kind: 'update'});[22m
[2m    };[22m

[2m    useEffect(() => {[22m
[2m      onUpdate();[22m
[2m    }, [onUpdate]);[22m

[2m    return <div />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[32m-   const dispatch = useDispatch();[39m
[32m-   useFreeze(dispatch);[39m
[31m+   Object.freeze(props);[39m
[31m+   const dispatch = (function () {[39m
[31m+     const $res$ = useDispatch();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(dispatch));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== dispatch) {[22m
[2m      t0 = () => {[22m
[2m        dispatch({ kind: "update" });[22m
[2m      };[22m
[2m      $[0] = dispatch;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onUpdate = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== onUpdate) {[22m
[2m      t1 = () => {[22m
[2m        onUpdate();[22m
[2m      };[22m
[2m      t2 = [onUpdate];[22m
[2m      $[2] = onUpdate;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[32m-   useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t3;[22m
[2m    if ($[5] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t3 = <div />;[22m
[2m      $[5] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[5];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m useContext-read-context-in-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createContext, useContext} from 'react';[22m

[2m  const FooContext = createContext({current: null});[22m

[2m  function Component(props) {[22m
[2m    const foo = useContext(FooContext);[22m
[2m    // This function should be memoized since it is only reading the context value[22m
[2m    const onClick = () => {[22m
[2m      console.log(foo.current);[22m
[2m    };[22m
[2m    return <div onClick={onClick}>{props.children}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{children: <div>Hello</div>}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createContext, useContext } from "react";[22m

[2m  const FooContext = createContext({ current: null });[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[32m-   const foo = useContext(FooContext);[39m
[31m+   Object.freeze(props);[39m
[31m+   const foo = (function () {[39m
[31m+     const $res$ = useContext(Object.freeze(FooContext));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== foo.current) {[22m
[2m      t0 = () => {[22m
[2m        console.log(foo.current);[22m
[2m      };[22m
[2m      $[0] = foo.current;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== onClick || $[3] !== props.children) {[22m
[32m-     t1 = <div onClick={onClick}>{props.children}</div>;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {props.children}[39m
[31m+       </div>[39m
[31m+     );[39m
[2m      $[2] = onClick;[22m
[2m      $[3] = props.children;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ children: <div>Hello</div> }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>Hello</div></div>[22m

[31m[1mFAIL:[22m[39m useContext-read-context-in-callback-if-condition
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m useContext-maybe-mutate-context-in-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as React from 'react';[22m
[2m  import {useContext} from 'react';[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  const FooContext = React.createContext({current: null});[22m

[2m  function Component(props) {[22m
[2m    const Foo = useContext(FooContext);[22m
[2m    // This callback can be memoized because we aren't 100% positive that[22m
[2m    // `mutate()` actually mutates, so we optimistically assume it doesn't[22m
[2m    // Its range doesn't get entagled w the useContext call so we're able[22m
[2m    // to create a reactive scope and memoize it.[22m
[2m    const onClick = () => {[22m
[2m      mutate(Foo.current);[22m
[2m    };[22m
[2m    return <div onClick={onClick}>{props.children}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{children: <div>Hello</div>}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as React from "react";[22m
[2m  import { useContext } from "react";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  const FooContext = React.createContext({ current: null });[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[32m-   const Foo = useContext(FooContext);[39m
[31m+   Object.freeze(props);[39m
[31m+   const Foo = (function () {[39m
[31m+     const $res$ = useContext(Object.freeze(FooContext));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== Foo.current) {[22m
[2m      t0 = () => {[22m
[2m        mutate(Foo.current);[22m
[2m      };[22m
[2m      $[0] = Foo.current;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== onClick || $[3] !== props.children) {[22m
[32m-     t1 = <div onClick={onClick}>{props.children}</div>;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {props.children}[39m
[31m+       </div>[39m
[31m+     );[39m
[2m      $[2] = onClick;[22m
[2m      $[3] = props.children;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ children: <div>Hello</div> }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>Hello</div></div>[22m

[31m[1mFAIL:[22m[39m useCallback-set-ref-value-preserve-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback, useRef} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const ref = useRef(null);[22m

[2m    const onChange = useCallback(event => {[22m
[2m      // The ref should still be mutable here even though function deps are frozen in[22m
[2m      // @enablePreserveExistingMemoizationGuarantees mode[22m
[2m      ref.current = event.target.value;[22m
[2m    });[22m

[2m    return <input onChange={onChange} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback, useRef } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = (event) => {[22m
[2m        ref.current = event.target.value;[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onChange = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== onChange) {[22m
[32m-     t1 = <input onChange={onChange} />;[39m
[31m+     t1 = ([39m
[31m+       <input[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = onChange;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input>[22m

[31m[1mFAIL:[22m[39m useCallback-set-ref-value-dont-preserve-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback, useRef} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const ref = useRef(null);[22m

[2m    const onChange = useCallback(event => {[22m
[2m      // The ref should still be mutable here even though function deps are frozen in[22m
[2m      // @enablePreserveExistingMemoizationGuarantees mode[22m
[2m      ref.current = event.target.value;[22m
[2m    });[22m

[2m    return <input onChange={onChange} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback, useRef } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = (event) => {[22m
[2m        ref.current = event.target.value;[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onChange = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== onChange) {[22m
[32m-     t1 = <input onChange={onChange} />;[39m
[31m+     t1 = ([39m
[31m+       <input[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = onChange;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input>[22m

[31m[1mFAIL:[22m[39m useCallback-set-ref-nested-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useCallback, useRef} from 'react';[22m

[2m  // Identical to useCallback-set-ref-nested-property-preserve-memoization,[22m
[2m  // but with a different set of compiler flags[22m
[2m  function Component({}) {[22m
[2m    const ref = useRef({inner: null});[22m

[2m    const onChange = useCallback(event => {[22m
[2m      // The ref should still be mutable here even though function deps are frozen in[22m
[2m      // @enablePreserveExistingMemoizationGuarantees mode[22m
[2m      ref.current.inner = event.target.value;[22m
[2m    });[22m

[2m    return <input onChange={onChange} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useCallback, useRef } from "react";[22m

[2m  // Identical to useCallback-set-ref-nested-property-preserve-memoization,[22m
[2m  // but with a different set of compiler flags[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = { inner: null };[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[32m-   const ref = useRef(t1);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = (event) => {[22m
[2m        ref.current.inner = event.target.value;[22m
[2m      };[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[2m    const onChange = t2;[22m
[2m    let t3;[22m
[2m    if ($[2] !== onChange) {[22m
[32m-     t3 = <input onChange={onChange} />;[39m
[31m+     t3 = ([39m
[31m+       <input[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = onChange;[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input>[22m

[31m[1mFAIL:[22m[39m useCallback-set-ref-nested-property-preserve-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback, useRef} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const ref = useRef({inner: null});[22m

[2m    const onChange = useCallback(event => {[22m
[2m      // The ref should still be mutable here even though function deps are frozen in[22m
[2m      // @enablePreserveExistingMemoizationGuarantees mode[22m
[2m      ref.current.inner = event.target.value;[22m
[2m    });[22m

[2m    return <input onChange={onChange} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback, useRef } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { inner: null };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   const ref = useRef(t0);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = (event) => {[22m
[2m        ref.current.inner = event.target.value;[22m
[2m      };[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const onChange = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== onChange) {[22m
[32m-     t2 = <input onChange={onChange} />;[39m
[31m+     t2 = ([39m
[31m+       <input[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = onChange;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input>[22m

[31m[1mFAIL:[22m[39m useCallback-set-ref-nested-property-dont-preserve-memoization
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <input>
Forget:
(kind: exception) Cannot assign to read only property 'inner' of object '#<Object>'

[31m[1mFAIL:[22m[39m useCallback-multiple-callbacks-modifying-same-ref-preserve-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback, useRef} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const ref = useRef({inner: null});[22m

[2m    const onChange = useCallback(event => {[22m
[2m      // The ref should still be mutable here even though function deps are frozen in[22m
[2m      // @enablePreserveExistingMemoizationGuarantees mode[22m
[2m      ref.current.inner = event.target.value;[22m
[2m    });[22m

[2m    const onReset = useCallback(() => {[22m
[2m      ref.current.inner = null;[22m
[2m    });[22m

[2m    return <input onChange={onChange} onReset={onReset} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback, useRef } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { inner: null };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   const ref = useRef(t0);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = (event) => {[22m
[2m        ref.current.inner = event.target.value;[22m
[2m      };[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const onChange = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = () => {[22m
[2m        ref.current.inner = null;[22m
[2m      };[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    const onReset = t2;[22m
[2m    let t3;[22m
[2m    if ($[3] !== onChange || $[4] !== onReset) {[22m
[32m-     t3 = <input onChange={onChange} onReset={onReset} />;[39m
[31m+     t3 = ([39m
[31m+       <input[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         onReset={function () {[39m
[31m+           const $res$ = onReset;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = onChange;[22m
[2m      $[4] = onReset;[22m
[2m      $[5] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[5];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input>[22m

[31m[1mFAIL:[22m[39m useCallback-maybe-modify-free-variable-preserve-memoization-guarantee
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback} from 'react';[22m
[2m  import {identity, makeObject_Primitives, mutate, useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const free = makeObject_Primitives();[22m
[2m    const free2 = makeObject_Primitives();[22m
[2m    const part = free2.part;[22m
[2m    useHook();[22m
[2m    const callback = useCallback(() => {[22m
[2m      const x = makeObject_Primitives();[22m
[2m      x.value = props.value;[22m
[2m      mutate(x, free, part);[22m
[2m    }, [props.value]);[22m
[2m    mutate(free, part);[22m
[2m    return callback;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback } from "react";[22m
[2m  import {[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    mutate,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = makeObject_Primitives();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const free = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = makeObject_Primitives();[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const free2 = t1;[22m
[2m    const part = free2.part;[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[2] !== props.value) {[22m
[2m      t2 = () => {[22m
[2m        const x = makeObject_Primitives();[22m
[2m        x.value = props.value;[22m
[2m        mutate(x, free, part);[22m
[2m      };[22m
[2m      $[2] = props.value;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const callback = t2;[22m

[2m    mutate(free, part);[22m
[2m    return callback;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m useCallback-maybe-modify-free-variable-dont-preserve-memoization-guarantee
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees:false[22m
[2m  import {useCallback} from 'react';[22m
[2m  import {identity, makeObject_Primitives, mutate, useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const free = makeObject_Primitives();[22m
[2m    const free2 = makeObject_Primitives();[22m
[2m    const part = free2.part;[22m
[2m    useHook();[22m
[2m    const callback = useCallback(() => {[22m
[2m      const x = makeObject_Primitives();[22m
[2m      x.value = props.value;[22m
[2m      mutate(x, free, part);[22m
[2m    }, [props.value]);[22m

[2m    mutate(free, part);[22m
[2m    return callback;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees:false[22m
[2m  import { useCallback } from "react";[22m
[2m  import {[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    mutate,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const free = makeObject_Primitives();[22m
[2m    const free2 = makeObject_Primitives();[22m
[2m    const part = free2.part;[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const callback = () => {[22m
[2m      const x = makeObject_Primitives();[22m
[2m      x.value = props.value;[22m
[2m      mutate(x, free, part);[22m
[2m    };[22m

[2m    mutate(free, part);[22m
[2m    return callback;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m useCallback-call-second-function-which-captures-maybe-mutable-value-preserve-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback} from 'react';[22m
[2m  import {[22m
[2m    identity,[22m
[2m    logValue,[22m
[2m    makeObject_Primitives,[22m
[2m    useHook,[22m
[2m  } from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const object = makeObject_Primitives();[22m

[2m    useHook();[22m

[2m    const log = () => {[22m
[2m      logValue(object);[22m
[2m    };[22m

[2m    const onClick = useCallback(() => {[22m
[2m      log();[22m
[2m    }, [log]);[22m

[2m    identity(object);[22m

[2m    return <div onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback } from "react";[22m
[2m  import {[22m
[2m    identity,[22m
[2m    logValue,[22m
[2m    makeObject_Primitives,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = makeObject_Primitives();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const object = t0;[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = () => {[22m
[2m        logValue(object);[22m
[2m      };[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const log = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = () => {[22m
[2m        log();[22m
[2m      };[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    const onClick = t2;[22m

[2m    identity(object);[22m
[2m    let t3;[22m
[2m    if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t3 = <div onClick={onClick} />;[39m
[31m+     t3 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m useCallback-call-second-function-which-captures-maybe-mutable-value-dont-preserve-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees:false @enableTransitivelyFreezeFunctionExpressions:false[22m
[2m  import {useCallback} from 'react';[22m
[2m  import {[22m
[2m    identity,[22m
[2m    logValue,[22m
[2m    makeObject_Primitives,[22m
[2m    useHook,[22m
[2m  } from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const object = makeObject_Primitives();[22m

[2m    useHook();[22m

[2m    const log = () => {[22m
[2m      logValue(object);[22m
[2m    };[22m

[2m    const onClick = useCallback(() => {[22m
[2m      log();[22m
[2m    }, [log]);[22m

[2m    identity(object);[22m

[2m    return <div onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees:false @enableTransitivelyFreezeFunctionExpressions:false[22m
[2m  import { useCallback } from "react";[22m
[2m  import {[22m
[2m    identity,[22m
[2m    logValue,[22m
[2m    makeObject_Primitives,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const object = makeObject_Primitives();[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const log = () => {[22m
[2m      logValue(object);[22m
[2m    };[22m

[2m    const onClick = () => {[22m
[2m      log();[22m
[2m    };[22m

[2m    identity(object);[22m
[2m    let t0;[22m
[2m    if ($[0] !== onClick) {[22m
[32m-     t0 = <div onClick={onClick} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = onClick;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m useActionState-dispatch-considered-as-non-reactive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useActionState} from 'react';[22m

[2m  function Component() {[22m
[2m    const [actionState, dispatchAction] = useActionState();[22m
[2m    const onSubmitAction = () => {[22m
[2m      dispatchAction();[22m
[2m    };[22m
[2m    return <Foo onSubmitAction={onSubmitAction} />;[22m
[2m  }[22m

[2m  function Foo() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useActionState } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(1);[22m
[32m-   const [actionState, dispatchAction] = useActionState();[39m
[31m+   const [actionState, dispatchAction] = (function () {[39m
[31m+     const $res$ = useActionState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const onSubmitAction = () => {[22m
[2m        dispatchAction();[22m
[2m      };[22m

[32m-     t0 = <Foo onSubmitAction={onSubmitAction} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         onSubmitAction={function () {[39m
[31m+           const $res$ = onSubmitAction;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  function Foo() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m use-operator-method-call
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m use-operator-conditional
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m use-operator-call-expression
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
<div>{"inputs":[42],"output":[42]}</div>
<div>{"inputs":[null],"output":["[[ cyclic ref *2 ]]"]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m use-memo-simple
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div x="1">"foo"</div>
Forget:
(kind: ok) <div>"foo"</div>
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`x`','div','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m use-callback-simple
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component() {[22m
[2m    const [count, setCount] = useState(0);[22m
[2m    const increment = useCallback(() => setCount(count + 1));[22m

[2m    return <Foo onClick={increment}></Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component() {[22m
[2m    const $ = _c(4);[22m
[32m-   const [count, setCount] = useState(0);[39m
[31m+   const [count, setCount] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== count) {[22m
[2m      t0 = () => setCount(count + 1);[22m
[2m      $[0] = count;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const increment = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== increment) {[22m
[32m-     t1 = <Foo onClick={increment} />;[39m
[31m+     t1 = ([39m
[31m+       <Foo[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = increment;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = increment;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m update-global-in-callback
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"cb":{"kind":"Function","result":1},"shouldInvokeFns":true}</div>
Forget:
(kind: ok) <div>{"cb":{"kind":"Function","result":{"kind":"Function","result":1}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>

[31m[1mFAIL:[22m[39m update-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props: {x: number}) {[22m
[2m    let x = props.x;[22m
[2m    let y = x++;[22m
[2m    let z = x--;[22m
[2m    return {x, y, z};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{x: 1}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = props.x;[22m
[2m    const y = x++;[22m
[2m    const z = x--;[22m
[2m    let t0;[22m
[2m    if ($[0] !== x || $[1] !== y || $[2] !== z) {[22m
[2m      t0 = { x, y, z };[22m
[2m      $[0] = x;[22m
[2m      $[1] = y;[22m
[2m      $[2] = z;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{ x: 1 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":1,"y":1,"z":2}[22m

[31m[1mFAIL:[22m[39m update-expression-on-function-parameter-4
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component([b]) {[22m
[2m    let f = b--;[22m
[2m    let g = --b;[22m
[2m    return [b, f, g];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[3]],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    let [b] = t0;[22m
[2m    const f = b--;[22m
[2m    const g = --b;[22m
[2m    let t1;[22m
[2m    if ($[0] !== b || $[1] !== f || $[2] !== g) {[22m
[2m      t1 = [b, f, g];[22m
[2m      $[0] = b;[22m
[2m      $[1] = f;[22m
[2m      $[2] = g;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[3]],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1,3,1][22m

[31m[1mFAIL:[22m[39m update-expression-on-function-parameter-3
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component({c}) {[22m
[2m    let h = c++;[22m
[2m    let i = --c;[22m
[2m    return [c, h, i];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{c: 4}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    let { c } = t0;[22m
[2m    const h = c++;[22m
[2m    const i = --c;[22m
[2m    let t1;[22m
[2m    if ($[0] !== c || $[1] !== h || $[2] !== i) {[22m
[2m      t1 = [c, h, i];[22m
[2m      $[0] = c;[22m
[2m      $[1] = h;[22m
[2m      $[2] = i;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ c: 4 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4,4,4][22m

[31m[1mFAIL:[22m[39m update-expression-on-function-parameter-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(a) {[22m
[2m    let d = a++;[22m
[2m    let e = ++a;[22m
[2m    return [a, d, e];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [2],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    const d = a++;[22m
[2m    const e = ++a;[22m
[2m    let t0;[22m
[2m    if ($[0] !== a || $[1] !== d || $[2] !== e) {[22m
[2m      t0 = [a, d, e];[22m
[2m      $[0] = a;[22m
[2m      $[1] = d;[22m
[2m      $[2] = e;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [2],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4,2,4][22m

[31m[1mFAIL:[22m[39m update-expression-on-function-parameter-1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component({a: a, b: [b], c: {c}}) {[22m
[2m    let d = a++;[22m
[2m    let e = ++a;[22m
[2m    let f = b--;[22m
[2m    let g = --b;[22m
[2m    let h = c++;[22m
[2m    let i = --c;[22m
[2m    return [a, b, c, d, e, f, g, h, i];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 2, b: [3], c: {c: 4}}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(10);[22m
[31m+   Object.freeze(t0);[39m
[2m    let { a, b: t1, c: t2 } = t0;[22m
[2m    let [b] = t1;[22m
[2m    let { c } = t2;[22m
[2m    const d = a++;[22m
[2m    const e = ++a;[22m
[2m    const f = b--;[22m
[2m    const g = --b;[22m
[2m    const h = c++;[22m
[2m    const i = --c;[22m
[2m    let t3;[22m
[2m    if ([22m
[2m      $[0] !== a ||[22m
[2m      $[1] !== b ||[22m
[2m      $[2] !== c ||[22m
[2m      $[3] !== d ||[22m
[2m      $[4] !== e ||[22m
[2m      $[5] !== f ||[22m
[2m      $[6] !== g ||[22m
[2m      $[7] !== h ||[22m
[2m      $[8] !== i[22m
[2m    ) {[22m
[2m      t3 = [a, b, c, d, e, f, g, h, i];[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = d;[22m
[2m      $[4] = e;[22m
[2m      $[5] = f;[22m
[2m      $[6] = g;[22m
[2m      $[7] = h;[22m
[2m      $[8] = i;[22m
[2m      $[9] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[9];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 2, b: [3], c: { c: 4 } }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4,1,4,2,4,3,1,4,4][22m

[31m[1mFAIL:[22m[39m update-expression-in-sequence
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let a = props.x;[22m
[2m    let b;[22m
[2m    let c;[22m
[2m    let d;[22m
[2m    if (props.cond) {[22m
[2m      d = ((b = a), a++, (c = a), ++a);[22m
[2m    }[22m
[2m    return [a, b, c, d];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 2, cond: true}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let a = props.x;[22m
[2m    let b;[22m
[2m    let c;[22m
[2m    let d;[22m
[2m    if (props.cond) {[22m
[2m      d = ((b = a), a++, (c = a), ++a);[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c || $[3] !== d) {[22m
[2m      t0 = [a, b, c, d];[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = d;[22m
[2m      $[4] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[4];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 2, cond: true }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4,2,3,4][22m

[31m[1mFAIL:[22m[39m unused-ternary-assigned-to-variable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // unused![22m
[2m    const obj = makeObject();[22m
[2m    const _ = obj.a ? props.b : props.c;[22m
[2m    return null;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const obj = makeObject();[22m
[2m    obj.a ? props.b : props.c;[22m
[2m    return null;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-optional-method-assigned-to-variable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // unused![22m
[2m    const obj = makeObject();[22m
[2m    const _ = obj.a?.b?.(props.c);[22m
[2m    return null;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const obj = makeObject();[22m
[2m    obj.a?.b?.(props.c);[22m
[2m    return null;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-object-element
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    const {x, y, ...z} = props.a;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const { x } = props.a;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-object-element-with-rest
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    // can't remove `unused` since it affects which properties are copied into `rest`[22m
[2m    const {unused, ...rest} = props.a;[22m
[2m    return rest;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let rest;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      const { unused, ...t0 } = props.a;[22m
[2m      rest = t0;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = rest;[22m
[2m    } else {[22m
[2m      rest = $[1];[22m
[2m    }[22m
[2m    return rest;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    props.cond ? (x = 1) : (x = 2);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    props.cond ? (x = 1) : (x = 2);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-logical-assigned-to-variable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // unused![22m
[2m    const obj = makeObject();[22m
[2m    const obj2 = makeObject();[22m
[2m    const _ = (obj.a ?? obj2.b) || props.c;[22m
[2m    return null;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const obj = makeObject();[22m
[2m    const obj2 = makeObject();[22m
[2m    (obj.a ?? obj2.b) || props.c;[22m
[2m    return null;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-conditional
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    (x = 1) && (x = 2);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    ((x = 1), 1) && (x = 2);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-array-rest-element
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    const [x, y, ...z] = props.a;[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const [x, y] = props.a;[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unused-array-middle-element
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    const [x, unused, y] = props.a;[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const [x, unused, y] = props.a;[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unmemoized-nonreactive-dependency-is-pruned-as-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate, useNoAlias} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    // Here `x` cannot be memoized bc its mutable range spans a hook call:[22m
[2m    const x = [];[22m
[2m    useNoAlias();[22m
[2m    mutate(x);[22m

[2m    // However, `x` is non-reactive. It cannot semantically change, so we[22m
[2m    // exclude it as a dependency of the JSX element:[22m
[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { mutate, useNoAlias } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const x = [];[22m
[32m-   useNoAlias();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useNoAlias();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    mutate(x);[22m
[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m unlabeled-break-within-label-switch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {CONST_STRING0} from 'shared-runtime';[22m

[2m  function useHook(cond) {[22m
[2m    const log = [];[22m
[2m    switch (CONST_STRING0) {[22m
[2m      case CONST_STRING0:[22m
[2m        log.push(`@A`);[22m
[2m        bb0: {[22m
[2m          if (cond) {[22m
[2m            break;[22m
[2m          }[22m
[2m          log.push(`@B`);[22m
[2m        }[22m
[2m        log.push(`@C`);[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { CONST_STRING0 } from "shared-runtime";[22m

[2m  function useHook(cond) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(cond);[39m
[2m    let log;[22m
[2m    if ($[0] !== cond) {[22m
[2m      log = [];[22m
[2m      bb0: switch (CONST_STRING0) {[22m
[2m        case CONST_STRING0: {[22m
[2m          log.push(`@A`);[22m
[2m          if (cond) {[22m
[2m            break bb0;[22m
[2m          }[22m

[2m          log.push(`@B`);[22m

[2m          log.push(`@C`);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = log;[22m
[2m    } else {[22m
[2m      log = $[1];[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["@A"][22m

[31m[1mFAIL:[22m[39m unlabeled-break-within-label-loop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useHook(end) {[22m
[2m    const log = [];[22m
[2m    for (let i = 0; i < end + 1; i++) {[22m
[2m      log.push(`${i} @A`);[22m
[2m      bb0: {[22m
[2m        if (i === end) {[22m
[2m          break;[22m
[2m        }[22m
[2m        log.push(`${i} @B`);[22m
[2m      }[22m
[2m      log.push(`${i} @C`);[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [1],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useHook(end) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(end);[39m
[2m    let log;[22m
[2m    if ($[0] !== end) {[22m
[2m      log = [];[22m
[2m      for (let i = 0; i < end + 1; i++) {[22m
[2m        log.push(`${i} @A`);[22m
[2m        if (i === end) {[22m
[2m          break;[22m
[2m        }[22m

[2m        log.push(`${i} @B`);[22m

[2m        log.push(`${i} @C`);[22m
[2m      }[22m
[2m      $[0] = end;[22m
[2m      $[1] = log;[22m
[2m    } else {[22m
[2m      log = $[1];[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [1],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["0 @A","0 @B","0 @C","1 @A"][22m

[31m[1mFAIL:[22m[39m unknown-hooks-do-not-assert
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Forget currently bails out when it detects a potential mutation (Effect.Mutate)[22m
[2m  // to an immutable value. This should not apply to unknown / untyped hooks.[22m
[2m  function Component(props) {[22m
[2m    const x = useUnknownHook1(props);[22m
[2m    const y = useUnknownHook2(x);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Forget currently bails out when it detects a potential mutation (Effect.Mutate)[22m
[2m  // to an immutable value. This should not apply to unknown / untyped hooks.[22m
[2m  function Component(props) {[22m
[32m-   const x = useUnknownHook1(props);[39m
[32m-   const y = useUnknownHook2(x);[39m
[31m+   Object.freeze(props);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useUnknownHook1(Object.freeze(props));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const y = (function () {[39m
[31m+     const $res$ = useUnknownHook2(Object.freeze(x));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m uninitialized-declaration-in-reactive-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = mutate();[22m
[2m    let y;[22m
[2m    foo(x);[22m
[2m    return [y, x];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const x = mutate();[22m
[2m      let y;[22m
[2m      foo(x);[22m
[2m      t0 = [y, x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unconditional-break-label
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[2m    let x = 0;[22m
[2m    bar: {[22m
[2m      x = 1;[22m
[2m      break bar;[22m
[2m    }[22m
[2m    return a + x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[31m+   Object.freeze(a);[39m
[2m    return a + 1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m unary-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let t = {t: a};[22m
[2m    let z = +t.t;[22m
[2m    let q = -t.t;[22m
[2m    let p = void t.t;[22m
[2m    let n = delete t.t;[22m
[2m    let m = !t.t;[22m
[2m    let e = ~t.t;[22m
[2m    let f = typeof t.t;[22m
[2m    return {z, p, q, n, m, e, f};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(a);[39m
[2m    const t = { t: a };[22m
[2m    const z = +t.t;[22m
[2m    const q = -t.t;[22m
[2m    const p = void t.t;[22m
[2m    const n = delete t.t;[22m
[2m    const m = !t.t;[22m
[2m    const e = ~t.t;[22m
[2m    const f = typeof t.t;[22m
[2m    let t0;[22m
[2m    if ([22m
[2m      $[0] !== z ||[22m
[2m      $[1] !== p ||[22m
[2m      $[2] !== q ||[22m
[2m      $[3] !== n ||[22m
[2m      $[4] !== m ||[22m
[2m      $[5] !== e ||[22m
[2m      $[6] !== f[22m
[2m    ) {[22m
[2m      t0 = { z, p, q, n, m, e, f };[22m
[2m      $[0] = z;[22m
[2m      $[1] = p;[22m
[2m      $[2] = q;[22m
[2m      $[3] = n;[22m
[2m      $[4] = m;[22m
[2m      $[5] = e;[22m
[2m      $[6] = f;[22m
[2m      $[7] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[7];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m type-cast-expression.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow[22m
[2m  type Foo = {bar: string};[22m
[2m  function Component(props) {[22m
[2m    const x = {bar: props.bar};[22m
[2m    const y = (x: Foo);[22m
[2m    y.bar = 'hello';[22m
[2m    const z = (y: Foo);[22m
[2m    return z;[22m
[2m  }[22m
[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  type Foo = { bar: string };[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      const x = { bar: props.bar };[22m
[2m      y = (x: Foo);[22m
[2m      y.bar = "hello";[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    const z = (y: Foo);[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m type-args-test-binary-operator
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    if (a > b) {[22m
[2m      let m = {};[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    if (a > b) {[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m type-alias.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow[22m
[2m  function Component(props) {[22m
[2m    type User = {name: string};[22m
[2m    const user: User = {name: props.name};[22m
[2m    return user;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Mofei'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = { name: props.name };[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const user = t0;[22m
[2m    return user;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Mofei" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"name":"Mofei"}[22m

[31m[1mFAIL:[22m[39m type-alias-declaration
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    type User = {name: string};[22m
[2m    const user: User = {name: props.name};[22m
[2m    return user;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Mofei'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = { name: props.name };[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const user = t0;[22m
[2m    return user;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Mofei" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"name":"Mofei"}[22m

[31m[1mFAIL:[22m[39m try-catch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {throwErrorWithMessage} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    try {[22m
[2m      x = throwErrorWithMessage('oops');[22m
[2m    } catch {[22m
[2m      x = null;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { throwErrorWithMessage } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    try {[22m
[2m      let t0;[22m
[2m      if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t0 = throwErrorWithMessage("oops");[22m
[2m        $[0] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[0];[22m
[2m      }[22m
[2m      x = t0;[22m
[2m    } catch {[22m
[2m      x = null;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m try-catch-within-object-method
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const object = {[22m
[2m      foo() {[22m
[2m        try {[22m
[2m          return [];[22m
[2m        } catch (e) {[22m
[2m          return;[22m
[2m        }[22m
[2m      },[22m
[2m    };[22m
[2m    return object.foo();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const object = {[22m
[2m        foo() {[22m
[2m          try {[22m
[2m            return [];[22m
[2m          } catch (t1) {[22m
[2m            return;[22m
[2m          }[22m
[2m        },[22m
[2m      };[22m

[2m      t0 = object.foo();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m try-catch-within-object-method-returns-caught-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {throwInput} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const object = {[22m
[2m      foo() {[22m
[2m        try {[22m
[2m          throwInput([props.value]);[22m
[2m        } catch (e) {[22m
[2m          return e;[22m
[2m        }[22m
[2m      },[22m
[2m    };[22m
[2m    return object.foo();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { throwInput } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      const object = {[22m
[2m        foo() {[22m
[2m          try {[22m
[2m            throwInput([props.value]);[22m
[2m          } catch (t1) {[22m
[2m            const e = t1;[22m
[2m            return e;[22m
[2m          }[22m
[2m        },[22m
[2m      };[22m

[2m      t0 = object.foo();[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m

[31m[1mFAIL:[22m[39m try-catch-within-mutable-range
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {throwErrorWithMessage, shallowCopy} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    try {[22m
[2m      x.push(throwErrorWithMessage('oops'));[22m
[2m    } catch {[22m
[2m      x.push(shallowCopy({}));[22m
[2m    }[22m
[2m    x.push(props.value); // extend the mutable range to include the try/catch[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { throwErrorWithMessage, shallowCopy } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      x = [];[22m
[2m      try {[22m
[2m        let t0;[22m
[2m        if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = throwErrorWithMessage("oops");[22m
[2m          $[2] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[2];[22m
[2m        }[22m
[2m        x.push(t0);[22m
[2m      } catch {[22m
[2m        let t0;[22m
[2m        if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = shallowCopy({});[22m
[2m          $[3] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[3];[22m
[2m        }[22m
[2m        x.push(t0);[22m
[2m      }[22m

[2m      x.push(props.value);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{},null][22m

[31m[1mFAIL:[22m[39m try-catch-within-function-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const callback = () => {[22m
[2m      try {[22m
[2m        return [];[22m
[2m      } catch (e) {[22m
[2m        return;[22m
[2m      }[22m
[2m    };[22m
[2m    return callback();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    const callback = _temp;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = callback();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    try {[22m
[2m      return [];[22m
[2m    } catch (t0) {[22m
[2m      return;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m try-catch-within-function-expression-returns-caught-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {throwInput} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const callback = () => {[22m
[2m      try {[22m
[2m        throwInput([props.value]);[22m
[2m      } catch (e) {[22m
[2m        return e;[22m
[2m      }[22m
[2m    };[22m
[2m    return callback();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { throwInput } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = () => {[22m
[2m        try {[22m
[2m          throwInput([props.value]);[22m
[2m        } catch (t1) {[22m
[2m          const e = t1;[22m
[2m          return e;[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const callback = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== callback) {[22m
[2m      t1 = callback();[22m
[2m      $[2] = callback;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m

[31m[1mFAIL:[22m[39m try-catch-with-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {shallowCopy, throwInput} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    try {[22m
[2m      const y = shallowCopy({});[22m
[2m      if (y == null) {[22m
[2m        return;[22m
[2m      }[22m
[2m      x.push(throwInput(y));[22m
[2m    } catch {[22m
[2m      return null;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { shallowCopy, throwInput } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        try {[22m
[2m          const y = shallowCopy({});[22m
[2m          if (y == null) {[22m
[2m            t0 = undefined;[22m
[2m            break bb0;[22m
[2m          }[22m

[2m          x.push(throwInput(y));[22m
[2m        } catch {[22m
[2m          t0 = null;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m try-catch-with-catch-param
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {throwInput} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    try {[22m
[2m      // foo could throw its argument...[22m
[2m      throwInput(x);[22m
[2m    } catch (e) {[22m
[2m      // ... in which case this could be mutating `x`![22m
[2m      e.push(null);[22m
[2m      return e;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { throwInput } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        try {[22m
[2m          throwInput(x);[22m
[2m        } catch (t1) {[22m
[2m          const e = t1;[22m
[2m          e.push(null);[22m
[2m          t0 = e;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null][22m

[31m[1mFAIL:[22m[39m try-catch-try-value-modified-in-catch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {throwInput} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    try {[22m
[2m      const y = [];[22m
[2m      y.push(props.y);[22m
[2m      throwInput(y);[22m
[2m    } catch (e) {[22m
[2m      e.push(props.e);[22m
[2m      return e;[22m
[2m    }[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{y: 'foo', e: 'bar'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { throwInput } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.y || $[1] !== props.e) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        try {[22m
[2m          const y = [];[22m
[2m          y.push(props.y);[22m
[2m          throwInput(y);[22m
[2m        } catch (t1) {[22m
[2m          const e = t1;[22m
[2m          e.push(props.e);[22m
[2m          t0 = e;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = props.y;[22m
[2m      $[1] = props.e;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ y: "foo", e: "bar" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["foo","bar"][22m

[31m[1mFAIL:[22m[39m try-catch-try-value-modified-in-catch-escaping
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {throwInput} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    try {[22m
[2m      const y = [];[22m
[2m      y.push(props.y);[22m
[2m      throwInput(y);[22m
[2m    } catch (e) {[22m
[2m      e.push(props.e);[22m
[2m      x = e;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{y: 'foo', e: 'bar'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { throwInput } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.y || $[1] !== props.e) {[22m
[2m      try {[22m
[2m        const y = [];[22m
[2m        y.push(props.y);[22m
[2m        throwInput(y);[22m
[2m      } catch (t0) {[22m
[2m        const e = t0;[22m
[2m        e.push(props.e);[22m
[2m        x = e;[22m
[2m      }[22m
[2m      $[0] = props.y;[22m
[2m      $[1] = props.e;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ y: "foo", e: "bar" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["foo","bar"][22m

[31m[1mFAIL:[22m[39m try-catch-try-immediately-throws-after-constant-propagation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = props.default;[22m
[2m    const y = 42;[22m
[2m    try {[22m
[2m      // note: this constant propagates so that we know[22m
[2m      // the handler is unreachable[22m
[2m      return y;[22m
[2m    } catch (e) {[22m
[2m      x = e;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{default: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    return 42;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ default: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m try-catch-try-immediately-returns
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = props.default;[22m
[2m    try {[22m
[2m      // note: has to be a primitive, we want an instruction that cannot throw[22m
[2m      // to ensure there is no maybe-throw terminal[22m
[2m      const y = 42;[22m
[2m      return y;[22m
[2m    } catch (e) {[22m
[2m      x = e;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{default: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    return 42;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ default: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m try-catch-mutate-outer-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {shallowCopy, throwErrorWithMessage} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    try {[22m
[2m      x.push(throwErrorWithMessage('oops'));[22m
[2m    } catch {[22m
[2m      x.push(shallowCopy({a: props.a}));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { shallowCopy, throwErrorWithMessage } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = [];[22m
[2m      try {[22m
[2m        let t0;[22m
[2m        if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = throwErrorWithMessage("oops");[22m
[2m          $[2] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[2];[22m
[2m        }[22m
[2m        x.push(t0);[22m
[2m      } catch {[22m
[2m        x.push(shallowCopy({ a: props.a }));[22m
[2m      }[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 1 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":1}][22m

[31m[1mFAIL:[22m[39m try-catch-in-nested-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate, setProperty, throwErrorWithMessageIf} from 'shared-runtime';[22m

[2m  function useFoo({value, cond}) {[22m
[2m    let y = [value];[22m
[2m    let x = {cond};[22m

[2m    try {[22m
[2m      mutate(x);[22m
[2m      throwErrorWithMessageIf(x.cond, 'error');[22m
[2m    } catch {[22m
[2m      setProperty(x, 'henderson');[22m
[2m      return x;[22m
[2m    }[22m
[2m    setProperty(x, 'nevada');[22m
[2m    y.push(x);[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{value: 4, cond: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {value: 4, cond: true},[22m
[2m      {value: 5, cond: true},[22m
[2m      {value: 5, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate, setProperty, throwErrorWithMessageIf } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value, cond } = t0;[22m
[2m    let y;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value || $[1] !== cond) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        y = [value];[22m
[2m        let x;[22m
[2m        if ($[4] !== cond) {[22m
[2m          x = { cond };[22m
[2m          try {[22m
[2m            mutate(x);[22m
[2m            throwErrorWithMessageIf(x.cond, "error");[22m
[2m          } catch {[22m
[2m            setProperty(x, "henderson");[22m
[2m            t1 = x;[22m
[2m            break bb0;[22m
[2m          }[22m

[2m          setProperty(x, "nevada");[22m
[2m          $[4] = cond;[22m
[2m          $[5] = x;[22m
[2m        } else {[22m
[2m          x = $[5];[22m
[2m        }[22m
[2m        y.push(x);[22m
[2m      }[22m
[2m      $[0] = value;[22m
[2m      $[1] = cond;[22m
[2m      $[2] = y;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ value: 4, cond: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { value: 4, cond: true },[22m
[2m      { value: 5, cond: true },[22m
[2m      { value: 5, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"cond":true,"wat0":"joe","wat1":"henderson"}[22m
[2m  {"cond":true,"wat0":"joe","wat1":"henderson"}[22m
[2m  [5,{"cond":false,"wat0":"joe","wat1":"nevada"}][22m

[31m[1mFAIL:[22m[39m try-catch-empty-try
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = props.default;[22m
[2m    try {[22m
[2m    } catch (e) {[22m
[2m      x = e;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{default: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = props.default;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ default: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m try-catch-alias-try-values
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {throwInput} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let y;[22m
[2m    let x = [];[22m
[2m    try {[22m
[2m      // throws x[22m
[2m      throwInput(x);[22m
[2m    } catch (e) {[22m
[2m      // e = x[22m
[2m      y = e; // y = x[22m
[2m    }[22m
[2m    y.push(null);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { throwInput } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      let y;[22m
[2m      x = [];[22m
[2m      try {[22m
[2m        throwInput(x);[22m
[2m      } catch (t0) {[22m
[2m        const e = t0;[22m

[2m        y = e;[22m
[2m      }[22m

[2m      y.push(null);[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null][22m

[31m[1mFAIL:[22m[39m trivial
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(x) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(x) {[22m
[31m+   Object.freeze(x);[39m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m transitive-freeze-function-expressions
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableTransitivelyFreezeFunctionExpressions[22m
[2m  function Component(props) {[22m
[2m    const {data, loadNext, isLoadingNext} =[22m
[2m      usePaginationFragment(props.key).items ?? [];[22m

[2m    const loadMoreWithTiming = () => {[22m
[2m      if (data.length === 0) {[22m
[2m        return;[22m
[2m      }[22m
[2m      loadNext();[22m
[2m    };[22m

[2m    useEffect(() => {[22m
[2m      if (isLoadingNext) {[22m
[2m        return;[22m
[2m      }[22m
[2m      loadMoreWithTiming();[22m
[2m    }, [isLoadingNext, loadMoreWithTiming]);[22m

[2m    const items = data.map(x => x);[22m

[2m    return items;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableTransitivelyFreezeFunctionExpressions[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(props);[39m
[2m    const { data, loadNext, isLoadingNext } =[22m
[32m-     usePaginationFragment(props.key).items ?? [];[39m
[31m+     (function () {[39m
[31m+       const $res$ = usePaginationFragment(Object.freeze(props.key));[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })().items ?? [];[39m
[2m    let t0;[22m
[2m    if ($[0] !== data.length || $[1] !== loadNext) {[22m
[2m      t0 = () => {[22m
[2m        if (data.length === 0) {[22m
[2m          return;[22m
[2m        }[22m

[2m        loadNext();[22m
[2m      };[22m
[2m      $[0] = data.length;[22m
[2m      $[1] = loadNext;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const loadMoreWithTiming = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[3] !== isLoadingNext || $[4] !== loadMoreWithTiming) {[22m
[2m      t1 = () => {[22m
[2m        if (isLoadingNext) {[22m
[2m          return;[22m
[2m        }[22m

[2m        loadMoreWithTiming();[22m
[2m      };[22m
[2m      t2 = [isLoadingNext, loadMoreWithTiming];[22m
[2m      $[3] = isLoadingNext;[22m
[2m      $[4] = loadMoreWithTiming;[22m
[2m      $[5] = t1;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t1 = $[5];[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[32m-   useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t3;[22m
[2m    if ($[7] !== data) {[22m
[2m      t3 = data.map(_temp);[22m
[2m      $[7] = data;[22m
[2m      $[8] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[8];[22m
[2m    }[22m
[2m    const items = t3;[22m
[2m    return items;[22m
[2m  }[22m
[2m  function _temp(x) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m transitive-freeze-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enablePreserveExistingMemoizationGuarantees[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = {};[22m
[2m    const items = [x, y];[22m
[2m    items.pop();[22m
[2m    <div>{items}</div>; // note: enablePreserveExistingMemoizationGuarantees only visits function expressions, not arrays, so this doesn't freeze x/y[22m
[2m    mutate(y); // ok! not part of `items` anymore bc of items.pop()[22m
[2m    return [x, y, items];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enablePreserveExistingMemoizationGuarantees[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const x = {};[22m
[2m      const y = {};[22m
[2m      const items = [x, y];[22m
[2m      items.pop();[22m

[2m      mutate(y);[22m
[2m      t0 = [x, y, items];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{},{"wat0":"joe"},["[[ cyclic ref *1 ]]"]][22m

[31m[1mFAIL:[22m[39m todo.unnecessary-lambda-memoization
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const data = useFreeze(); // assume this returns {items: Array<{...}>}[22m
[2m    // In this call `data` and `data.items` have a read effect *and* the lambda itself[22m
[2m    // is readonly (it doesn't capture ony mutable references). Further, we ca[22m
[2m    // theoretically determine that the lambda doesn't need to be memoized, since[22m
[2m    // data.items is an Array and Array.prototype.map does not capture its input (callback)[22m
[2m    // in the return value.[22m
[2m    // An observation is that even without knowing the exact type of `data`, if we know[22m
[2m    // that it is a plain, readonly javascript object, then we can infer that any `.map()`[22m
[2m    // calls *must* be Array.prototype.map (or else they are a runtime error), since no[22m
[2m    // other builtin has a .map() function.[22m
[2m    const items = data.items.map(item => <Item item={item} />);[22m
[2m    return <div>{items}</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const data = useFreeze();[39m
[31m+   Object.freeze(props);[39m
[31m+   const data = (function () {[39m
[31m+     const $res$ = useFreeze();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== data.items) {[22m
[2m      t0 = data.items.map(_temp);[22m
[2m      $[0] = data.items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const items = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== items) {[22m
[2m      t1 = <div>{items}</div>;[22m
[2m      $[2] = items;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[32m-   return <Item item={item} />;[39m
[31m+   return ([39m
[31m+     <Item[39m
[31m+       item={function () {[39m
[31m+         const $res$ = item;[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[31m+       }}[39m
[31m+     />[39m
[31m+   );[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m todo-function-expression-captures-value-later-frozen
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = {};[22m
[2m    // onChange should be inferred as immutable, because the value[22m
[2m    // it captures (`x`) is frozen by the time the function is referenced[22m
[2m    const onChange = e => {[22m
[2m      maybeMutate(x, e.target.value);[22m
[2m    };[22m
[2m    if (props.cond) {[22m
[2m      <div>{x}</div>;[22m
[2m    }[22m
[2m    // ideally this call would be outside the memoization block for `x`[22m
[2m    onChange();[22m
[2m    return <Foo value={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.cond) {[22m
[2m      const x = {};[22m

[2m      const onChange = (e) => {[22m
[2m        maybeMutate(x, e.target.value);[22m
[2m      };[22m
[2m      if (props.cond) {[22m
[2m      }[22m

[2m      onChange();[22m
[32m-     t0 = <Foo value={x} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         value={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props.cond;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m timers
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const start = performance.now();[22m
[2m    const now = Date.now();[22m
[2m    const time = performance.now() - start;[22m
[2m    return ([22m
[2m      <div>[22m
[2m        rendering took {time} at {now}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const start = performance.now();[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = Date.now();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const now = t0;[22m
[2m    const time = performance.now() - start;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          rendering took[22m
[2m          {time} at {now}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ternary-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function ternary(props) {[22m
[2m    const a = props.a && props.b ? props.c || props.d : props.e ?? props.f;[22m
[2m    const b = props.a ? (props.b && props.c ? props.d : props.e) : props.f;[22m
[2m    return a ? b : null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: ternary,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function ternary(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const a = props.a && props.b ? props.c || props.d : (props.e ?? props.f);[22m
[2m    const b = props.a ? (props.b && props.c ? props.d : props.e) : props.f;[22m
[2m    return a ? b : null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: ternary,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ternary-assignment-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function ternary(props) {[22m
[2m    let x = 0;[22m
[2m    const y = props.a ? (x = 1) : (x = 2);[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: ternary,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function ternary(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    const y = props.a ? (x = 1) : (x = 2);[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: ternary,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m temporary-property-load-accessed-outside-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const maybeMutable = new MaybeMutable();[22m
[2m    let x = props.value;[22m
[2m    return [x, maybeMutate(maybeMutable)];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      const maybeMutable = new MaybeMutable();[22m
[2m      const x = props.value;[22m
[2m      t0 = x;[22m
[2m      t1 = maybeMutate(maybeMutable);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== t0 || $[4] !== t1) {[22m
[2m      t2 = [t0, t1];[22m
[2m      $[3] = t0;[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m temporary-at-start-of-value-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(props) {[22m
[2m    // NOTE: the temporary for the leading space was previously dropped[22m
[2m    const x = isMenuShown ? <Bar> {props.a ? props.b : props.c}</Bar> : null;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = isMenuShown ? <Bar> {props.a ? props.b : props.c}</Bar> : null;[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m temporary-accessed-outside-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const maybeMutable = new MaybeMutable();[22m
[2m    let x = props;[22m
[2m    return [x, maybeMutate(maybeMutable)];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== props) {[22m
[2m      const maybeMutable = new MaybeMutable();[22m
[2m      const x = props;[22m
[2m      t0 = x;[22m
[2m      t1 = maybeMutate(maybeMutable);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== t0 || $[4] !== t1) {[22m
[2m      t2 = [t0, t1];[22m
[2m      $[3] = t0;[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m template-literal
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function componentA(props) {[22m
[2m    let t = `hello ${props.a}, ${props.b}!`;[22m
[2m    t += ``;[22m
[2m    return t;[22m
[2m  }[22m

[2m  function componentB(props) {[22m
[2m    let x = useFoo(`hello ${props.a}`);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function componentA(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let t = `hello ${props.a}, ${props.b}!`;[22m
[2m    t = t + ``;[22m
[2m    return t;[22m
[2m  }[22m

[2m  function componentB(props) {[22m
[32m-   const x = useFoo(`hello ${props.a}`);[39m
[31m+   Object.freeze(props);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useFoo(Object.freeze(`hello ${props.a}`));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m tagged-template-in-hook
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const user = useFragment([22m
[2m      graphql`[22m
[2m        fragment F on User {[22m
[2m          name[22m
[2m        }[22m
[2m      `,[22m
[2m      props.user[22m
[2m    );[22m
[2m    return user.name;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[32m-   const user = useFragment([39m
[32m-     graphql`[39m
[32m-       fragment F on User {[39m
[32m-         name[39m
[32m-       }[39m
[32m-     `,[39m
[32m-     props.user,[39m
[32m-   );[39m
[31m+   Object.freeze(props);[39m
[31m+   const user = (function () {[39m
[31m+     const $res$ = useFragment([39m
[31m+       Object.freeze(graphql`[39m
[31m+         fragment F on User {[39m
[31m+           name[39m
[31m+         }[39m
[31m+       `),[39m
[31m+       Object.freeze(props.user),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return user.name;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m switch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    let y;[22m
[2m    switch (props.p0) {[22m
[2m      case true: {[22m
[2m        x.push(props.p2);[22m
[2m        x.push(props.p3);[22m
[2m        y = [];[22m
[2m      }[22m
[2m      case false: {[22m
[2m        y = x;[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    const child = <Component data={x} />;[22m
[2m    y.push(props.p4);[22m
[2m    return <Component data={y}>{child}</Component>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = [];[22m
[2m      switch (props.p0) {[22m
[2m        case true: {[22m
[2m          x.push(props.p2);[22m
[2m          x.push(props.p3);[22m
[2m        }[22m
[2m        case false: {[22m
[2m          y = x;[22m
[2m        }[22m
[2m      }[22m

[32m-     t0 = <Component data={x} />;[39m
[31m+     t0 = ([39m
[31m+       <Component[39m
[31m+         data={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = y;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const child = t0;[22m
[2m    y.push(props.p4);[22m
[2m    let t1;[22m
[2m    if ($[3] !== y || $[4] !== child) {[22m
[32m-     t1 = <Component data={y}>{child}</Component>;[39m
[31m+     t1 = ([39m
[31m+       <Component[39m
[31m+         data={function () {[39m
[31m+           const $res$ = y;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {child}[39m
[31m+       </Component>[39m
[31m+     );[39m
[2m      $[3] = y;[22m
[2m      $[4] = child;[22m
[2m      $[5] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[5];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m switch-with-only-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  function Component({kind, ...props}) {[22m
[2m    switch (kind) {[22m
[2m      default:[22m
[2m        return <Stringify {...props} />;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{kind: 'foo', a: 1, b: true, c: 'sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    let kind;[22m
[2m    let props;[22m
[2m    if ($[0] !== t0) {[22m
[2m      ({ kind, ...props } = t0);[22m
[2m      $[0] = t0;[22m
[2m      $[1] = kind;[22m
[2m      $[2] = props;[22m
[2m    } else {[22m
[2m      kind = $[1];[22m
[2m      props = $[2];[22m
[2m    }[22m
[2m    switch (kind) {[22m
[2m      default: {[22m
[2m        let t1;[22m
[2m        if ($[3] !== props) {[22m
[2m          t1 = <Stringify {...props} />;[22m
[2m          $[3] = props;[22m
[2m          $[4] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[4];[22m
[2m        }[22m
[2m        return t1;[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ kind: "foo", a: 1, b: true, c: "sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"a":1,"b":true,"c":"sathya"}</div>[22m

[31m[1mFAIL:[22m[39m switch-with-fallthrough
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(x) {[22m
[2m    let y;[22m
[2m    switch (x) {[22m
[2m      case 0: {[22m
[2m        y = 0;[22m
[2m      }[22m
[2m      case 1: {[22m
[2m        y = 1;[22m
[2m      }[22m
[2m      case 2: {[22m
[2m        break;[22m
[2m      }[22m
[2m      case 3: {[22m
[2m        y = 3;[22m
[2m        break;[22m
[2m      }[22m
[2m      case 4: {[22m
[2m        y = 4;[22m
[2m      }[22m
[2m      case 5: {[22m
[2m        y = 5;[22m
[2m      }[22m
[2m      default: {[22m
[2m        y = 0;[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(x) {[22m
[31m+   Object.freeze(x);[39m
[2m    bb0: switch (x) {[22m
[2m      case 0: {[22m
[2m      }[22m
[2m      case 1: {[22m
[2m      }[22m
[2m      case 2: {[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      case 3: {[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      case 4: {[22m
[2m      }[22m
[2m      case 5: {[22m
[2m      }[22m
[2m      default: {[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m switch-non-final-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    let y;[22m
[2m    switch (props.p0) {[22m
[2m      case 1: {[22m
[2m        break;[22m
[2m      }[22m
[2m      case true: {[22m
[2m        x.push(props.p2);[22m
[2m        y = [];[22m
[2m      }[22m
[2m      default: {[22m
[2m        break;[22m
[2m      }[22m
[2m      case false: {[22m
[2m        y = x;[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    const child = <Component data={x} />;[22m
[2m    y.push(props.p4);[22m
[2m    return <Component data={y}>{child}</Component>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = [];[22m
[2m      bb0: switch (props.p0) {[22m
[2m        case 1: {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case true: {[22m
[2m          x.push(props.p2);[22m
[2m          let t1;[22m
[2m          if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m            t1 = [];[22m
[2m            $[3] = t1;[22m
[2m          } else {[22m
[2m            t1 = $[3];[22m
[2m          }[22m
[2m          y = t1;[22m
[2m        }[22m
[2m        default: {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case false: {[22m
[2m          y = x;[22m
[2m        }[22m
[2m      }[22m

[32m-     t0 = <Component data={x} />;[39m
[31m+     t0 = ([39m
[31m+       <Component[39m
[31m+         data={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = y;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const child = t0;[22m
[2m    y.push(props.p4);[22m
[2m    let t1;[22m
[2m    if ($[4] !== y || $[5] !== child) {[22m
[32m-     t1 = <Component data={y}>{child}</Component>;[39m
[31m+     t1 = ([39m
[31m+       <Component[39m
[31m+         data={function () {[39m
[31m+           const $res$ = y;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {child}[39m
[31m+       </Component>[39m
[31m+     );[39m
[2m      $[4] = y;[22m
[2m      $[5] = child;[22m
[2m      $[6] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[6];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m switch-global-propertyload-case-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    switch (props.value) {[22m
[2m      case Global.Property: {[22m
[2m        return true;[22m
[2m      }[22m
[2m      default: {[22m
[2m        return false;[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    switch (props.value) {[22m
[2m      case Global.Property: {[22m
[2m        return true;[22m
[2m      }[22m
[2m      default: {[22m
[2m        return false;[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-sibling-phis
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = 0;[22m
[2m    if (true) {[22m
[2m      if (true) {[22m
[2m        x = a;[22m
[2m      } else {[22m
[2m        x = b;[22m
[2m      }[22m
[2m      x;[22m
[2m    } else {[22m
[2m      if (true) {[22m
[2m        x = c;[22m
[2m      } else {[22m
[2m        x = d;[22m
[2m      }[22m
[2m      x;[22m
[2m    }[22m
[2m    // note: intentionally no phi here so that there are two distinct phis above[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[32m- function foo(a, b, c, d) {}[39m
[31m+ function foo(a, b, c, d) {[39m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[31m+ }[39m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-shadowing
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function log() {}[22m

[2m  function Foo(cond) {[22m
[2m    let str = '';[22m
[2m    if (cond) {[22m
[2m      let str = 'other test';[22m
[2m      log(str);[22m
[2m    } else {[22m
[2m      str = 'fallthrough test';[22m
[2m    }[22m
[2m    log(str);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function log() {}[22m

[2m  function Foo(cond) {[22m
[31m+   Object.freeze(cond);[39m
[2m    let str = "";[22m
[2m    if (cond) {[22m
[2m      log("other test");[22m
[2m    } else {[22m
[2m      str = "fallthrough test";[22m
[2m    }[22m

[2m    log(str);[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    if (props.cond) {[22m
[2m      x = {};[22m
[2m      x = [];[22m
[2m      x.push(props.foo);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    if (props.cond) {[22m
[2m      if ($[2] !== props.foo) {[22m
[2m        x = [];[22m
[2m        x.push(props.foo);[22m
[2m        $[2] = props.foo;[22m
[2m        $[3] = x;[22m
[2m      } else {[22m
[2m        x = $[3];[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-with-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    if (props.cond) {[22m
[2m      x = {};[22m
[2m      x = [];[22m
[2m      x.push(props.foo);[22m
[2m    }[22m
[2m    mut(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      if (props.cond) {[22m
[2m        x = [];[22m
[2m        x.push(props.foo);[22m
[2m      }[22m

[2m      mut(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-via-destructuring
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let {x} = {x: []};[22m
[2m    x.push(props.bar);[22m
[2m    if (props.cond) {[22m
[2m      ({x} = {x: {}});[22m
[2m      ({x} = {x: []});[22m
[2m      x.push(props.foo);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      ({ x } = { x: [] });[22m
[2m      x.push(props.bar);[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    if (props.cond) {[22m
[2m      if ($[2] !== props.foo) {[22m
[2m        ({ x } = { x: [] });[22m
[2m        x.push(props.foo);[22m
[2m        $[2] = props.foo;[22m
[2m        $[3] = x;[22m
[2m      } else {[22m
[2m        x = $[3];[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-via-destructuring-with-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let {x} = {x: []};[22m
[2m    x.push(props.bar);[22m
[2m    if (props.cond) {[22m
[2m      ({x} = {x: {}});[22m
[2m      ({x} = {x: []});[22m
[2m      x.push(props.foo);[22m
[2m    }[22m
[2m    mut(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      ({ x } = { x: [] });[22m
[2m      x.push(props.bar);[22m
[2m      if (props.cond) {[22m
[2m        ({ x } = { x: [] });[22m
[2m        x.push(props.foo);[22m
[2m      }[22m

[2m      mut(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-unconditional-with-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    if (props.cond) {[22m
[2m      x = {};[22m
[2m      x = [];[22m
[2m      x.push(props.foo);[22m
[2m    } else {[22m
[2m      x = [];[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m    }[22m
[2m    mut(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      if (props.cond) {[22m
[2m        x = [];[22m
[2m        x.push(props.foo);[22m
[2m      } else {[22m
[2m        x = [];[22m
[2m        x.push(props.bar);[22m
[2m      }[22m

[2m      mut(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-unconditional-ternary
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    props.cond[22m
[2m      ? ((x = {}), (x = []), x.push(props.foo))[22m
[2m      : ((x = []), (x = []), x.push(props.bar));[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    if ($[2] !== props) {[22m
[2m      props.cond ? ((x = []), x.push(props.foo)) : ((x = []), x.push(props.bar));[22m
[2m      $[2] = props;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-unconditional-ternary-with-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {arrayPush} from 'shared-runtime';[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    props.cond[22m
[2m      ? ((x = {}), (x = []), x.push(props.foo))[22m
[2m      : ((x = []), (x = []), x.push(props.bar));[22m
[2m    arrayPush(x, 4);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{cond: false, foo: 2, bar: 55}],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: false, foo: 2, bar: 55},[22m
[2m      {cond: false, foo: 3, bar: 55},[22m
[2m      {cond: true, foo: 3, bar: 55},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { arrayPush } from "shared-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      props.cond ? ((x = []), x.push(props.foo)) : ((x = []), x.push(props.bar));[22m
[2m      arrayPush(x, 4);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{ cond: false, foo: 2, bar: 55 }],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: false, foo: 2, bar: 55 },[22m
[2m      { cond: false, foo: 3, bar: 55 },[22m
[2m      { cond: true, foo: 3, bar: 55 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [55,4][22m
[2m  [55,4][22m
[2m  [3,4][22m

[31m[1mFAIL:[22m[39m ssa-renaming-ternary
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    props.cond ? ((x = {}), (x = []), x.push(props.foo)) : null;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    if ($[2] !== props) {[22m
[2m      props.cond ? ((x = []), x.push(props.foo)) : null;[22m
[2m      $[2] = props;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-ternary-with-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    props.cond ? ((x = {}), (x = []), x.push(props.foo)) : null;[22m
[2m    mut(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      props.cond ? ((x = []), x.push(props.foo)) : null;[22m
[2m      mut(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-ternary-destruction
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    props.cond ? (({x} = {x: {}}), ([x] = [[]]), x.push(props.foo)) : null;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    if ($[2] !== props) {[22m
[2m      props.cond ? (([x] = [[]]), x.push(props.foo)) : null;[22m
[2m      $[2] = props;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-renaming-ternary-destruction-with-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.bar);[22m
[2m    props.cond ? (({x} = {x: {}}), ([x] = [[]]), x.push(props.foo)) : null;[22m
[2m    mut(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [];[22m
[2m      x.push(props.bar);[22m
[2m      props.cond ? (([x] = [[]]), x.push(props.foo)) : null;[22m
[2m      mut(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-reassign
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = 0;[22m
[2m    x = a;[22m
[2m    x = b;[22m
[2m    x = c;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m

[2m    x = c;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-property-alias-mutate-inside-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[2m    const x = {};[22m
[2m    if (a) {[22m
[2m      let y = {};[22m
[2m      x.y = y;[22m
[2m      mutate(y); // aliases x & y, but not z[22m
[2m    } else {[22m
[2m      let z = {};[22m
[2m      x.z = z;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = {};[22m
[2m      if (a) {[22m
[2m        const y = {};[22m
[2m        x.y = y;[22m
[2m        mutate(y);[22m
[2m      } else {[22m
[2m        let t0;[22m
[2m        if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = {};[22m
[2m          $[2] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[2];[22m
[2m        }[22m
[2m        const z = t0;[22m
[2m        x.z = z;[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-property-alias-mutate-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[2m    const x = {};[22m
[2m    if (a) {[22m
[2m      let y = {};[22m
[2m      x.y = y;[22m
[2m    } else {[22m
[2m      let z = {};[22m
[2m      x.z = z;[22m
[2m    }[22m
[2m    mutate(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = {};[22m
[2m      if (a) {[22m
[2m        const y = {};[22m
[2m        x.y = y;[22m
[2m      } else {[22m
[2m        const z = {};[22m
[2m        x.z = z;[22m
[2m      }[22m

[2m      mutate(x);[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-property-alias-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[2m    const x = {};[22m
[2m    if (a) {[22m
[2m      let y = {};[22m
[2m      x.y = y;[22m
[2m    } else {[22m
[2m      let z = {};[22m
[2m      x.z = z;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = {};[22m
[2m      if (a) {[22m
[2m        let t0;[22m
[2m        if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = {};[22m
[2m          $[2] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[2];[22m
[2m        }[22m
[2m        const y = t0;[22m
[2m        x.y = y;[22m
[2m      } else {[22m
[2m        let t0;[22m
[2m        if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = {};[22m
[2m          $[3] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[3];[22m
[2m        }[22m
[2m        const z = t0;[22m
[2m        x.z = z;[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-property-alias-alias-mutate-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[2m    const b = {};[22m
[2m    const x = b;[22m
[2m    if (a) {[22m
[2m      let y = {};[22m
[2m      x.y = y;[22m
[2m    } else {[22m
[2m      let z = {};[22m
[2m      x.z = z;[22m
[2m    }[22m
[2m    mutate(b); // aliases x, y & z[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      const b = {};[22m
[2m      x = b;[22m
[2m      if (a) {[22m
[2m        const y = {};[22m
[2m        x.y = y;[22m
[2m      } else {[22m
[2m        const z = {};[22m
[2m        x.z = z;[22m
[2m      }[22m

[2m      mutate(b);[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-objectexpression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = 1;[22m
[2m    const b = 2;[22m
[2m    const x = {a: a, b: b};[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { a: 1, b: 2 };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-non-empty-initializer
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    let x = [];[22m
[2m    if (a) {[22m
[2m      x = 1;[22m
[2m    }[22m

[2m    let y = x;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let x = t0;[22m
[2m    if (a) {[22m
[2m      x = 1;[22m
[2m    }[22m

[2m    const y = x;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-newexpression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo() {}[22m

[2m  function Component(props) {[22m
[2m    const a = [];[22m
[2m    const b = {};[22m
[2m    let c = new Foo(a, b);[22m
[2m    return c;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo() {}[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = [];[22m
[2m      const b = {};[22m
[2m      t0 = new Foo(a, b);[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const c = t0;[22m
[2m    return c;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-nested-partial-reassignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d, e) {[22m
[2m    let x = null;[22m
[2m    if (a) {[22m
[2m      x = b;[22m
[2m    } else {[22m
[2m      if (c) {[22m
[2m        x = d;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d, e) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[31m+   Object.freeze(e);[39m
[2m    let x = null;[22m
[2m    if (a) {[22m
[2m      x = b;[22m
[2m    } else {[22m
[2m      if (c) {[22m
[2m        x = d;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-nested-partial-phi
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = a;[22m
[2m    if (b) {[22m
[2m      if (c) {[22m
[2m        x = c;[22m
[2m      }[22m
[2m      // TODO: move the return to the end of the function[22m
[2m      return x;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x = a;[22m
[2m    if (b) {[22m
[2m      if (c) {[22m
[2m        x = c;[22m
[2m      }[22m
[2m      return x;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-nested-loops-no-reassign
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @xonly[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = 0;[22m
[2m    while (a) {[22m
[2m      while (b) {[22m
[2m        while (c) {[22m
[2m          x + 1;[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @xonly[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    while (a) {[22m
[2m      while (b) {[22m
[2m        while (c) {}[22m
[2m      }[22m
[2m    }[22m
[2m    return 0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-multiple-phis
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = 0;[22m
[2m    if (true) {[22m
[2m      if (true) {[22m
[2m        x = a;[22m
[2m      } else {[22m
[2m        x = b;[22m
[2m      }[22m
[2m      x;[22m
[2m    } else {[22m
[2m      if (true) {[22m
[2m        x = c;[22m
[2m      } else {[22m
[2m        x = d;[22m
[2m      }[22m
[2m      x;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    let x;[22m

[2m    x = a;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-leave-case
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    let y;[22m
[2m    if (props.p0) {[22m
[2m      x.push(props.p1);[22m
[2m      y = x;[22m
[2m    }[22m
[2m    return ([22m
[2m      <Component>[22m
[2m        {x}[22m
[2m        {y}[22m
[2m      </Component>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = [];[22m
[2m      let y;[22m
[2m      if (props.p0) {[22m
[2m        x.push(props.p1);[22m
[2m        y = x;[22m
[2m      }[22m

[2m      t0 = ([22m
[2m        <Component>[22m
[2m          {x}[22m
[2m          {y}[22m
[2m        </Component>[22m
[2m      );[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-for-of
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(cond) {[22m
[2m    let items = [];[22m
[2m    for (const item of items) {[22m
[2m      let y = 0;[22m
[2m      if (cond) {[22m
[2m        y = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(cond) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(cond);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const items = t0;[22m
[2m    for (const item of items) {[22m
[2m      if (cond) {[22m
[2m      }[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-cascading-eliminated-phis
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    const values = [];[22m
[2m    const y = props.a || props.b;[22m
[2m    values.push(y);[22m
[2m    if (props.c) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    values.push(x);[22m
[2m    if (props.d) {[22m
[2m      x = 2;[22m
[2m    }[22m
[2m    values.push(x);[22m
[2m    return values;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    let values;[22m
[2m    if ($[0] !== props || $[1] !== x) {[22m
[2m      values = [];[22m
[2m      const y = props.a || props.b;[22m
[2m      values.push(y);[22m
[2m      if (props.c) {[22m
[2m        x = 1;[22m
[2m      }[22m

[2m      values.push(x);[22m
[2m      if (props.d) {[22m
[2m        x = 2;[22m
[2m      }[22m

[2m      values.push(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m      $[2] = values;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      values = $[2];[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return values;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-call-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const a = [];[22m
[2m    const b = {};[22m
[2m    foo(a, b);[22m
[2m    let _ = <div a={a} />;[22m
[2m    foo(a, b);[22m
[2m    return <div a={a} b={b} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = [];[22m
[2m      const b = {};[22m
[2m      foo(a, b);[22m

[2m      foo(a, b);[22m
[32m-     t0 = <div a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-call-jsx-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @Pass runMutableRangeAnalysis[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const a = [];[22m
[2m    const b = {};[22m
[2m    foo(a, b);[22m
[2m    if (foo()) {[22m
[2m      let _ = <div a={a} />;[22m
[2m    }[22m
[2m    foo(a, b);[22m
[2m    return <div a={a} b={b} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @Pass runMutableRangeAnalysis[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = [];[22m
[2m      const b = {};[22m
[2m      foo(a, b);[22m
[2m      if (foo()) {[22m
[2m      }[22m

[2m      foo(a, b);[22m
[32m-     t0 = <div a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ssa-arrayexpression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = 1;[22m
[2m    const b = 2;[22m
[2m    const x = [a, b];[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [1, 2];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m simple
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  export default function foo(x, y) {[22m
[2m    if (x) {[22m
[2m      return foo(false, y);[22m
[2m    }[22m
[2m    return [y * 10];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  export default function foo(x, y) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(x);[39m
[31m+   Object.freeze(y);[39m
[2m    if (x) {[22m
[2m      let t0;[22m
[2m      if ($[0] !== y) {[22m
[2m        t0 = foo(false, y);[22m
[2m        $[0] = y;[22m
[2m        $[1] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[1];[22m
[2m      }[22m
[2m      return t0;[22m
[2m    }[22m

[2m    const t0 = y * 10;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m simple-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a) {[22m
[2m    const x = [a.b];[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a.b) {[22m
[2m      t0 = [a.b];[22m
[2m      $[0] = a.b;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m sequential-destructuring-both-mixed-local-and-scope-declaration
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div class="#657b83"><span class="comic-sans">Sathya!</span></div>
Forget:
(kind: ok) <div><span>Sathya!</span></div>
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`className`','span','\n' +
  '    at span\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m sequential-destructuring-assignment-to-scope-declarations
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div class="#eee8d5"><span class="#657b83">Mofei!</span></div>
Forget:
(kind: ok) <div><span>Mofei!</span></div>
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`className`','span','\n' +
  '    at span\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m sequence-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function sequence(props) {[22m
[2m    let x = (null, Math.max(1, 2), foo());[22m
[2m    while ((foo(), true)) {[22m
[2m      x = (foo(), 2);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  function foo() {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function sequence(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = (Math.max(1, 2), foo());[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let x = t0;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      while ((foo(), true)) {[22m
[2m        x = (foo(), 2);[22m
[2m      }[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  function foo() {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m same-variable-as-dep-and-redeclare
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // note: comments are for the ideal scopes, not what is currently[22m
[2m  // emitted[22m
[2m  function foo(props) {[22m
[2m    // scope 0: deps=[props.a] decl=[x] reassign=none[22m
[2m    let x = [];[22m
[2m    x.push(props.a);[22m

[2m    // scope 1: deps=[x] decl=[header] reassign=none[22m
[2m    const header = <div>{x}</div>;[22m

[2m    // scope 2:[22m
[2m    // deps=[x, props.b, props.c][22m
[2m    // decl=none[22m
[2m    // reassign=[x][22m
[2m    const y = [x]; // y depends on the earlier x[22m
[2m    x = []; // x reassigned[22m
[2m    y.push(props.b); // interleaved mutation of x/y[22m
[2m    x.push(props.c); // interleaved mutation[22m

[2m    // scope 3 ...[22m
[2m    const content = ([22m
[2m      <div>[22m
[2m        {x}[22m
[2m        {y}[22m
[2m      </div>[22m
[2m    );[22m

[2m    // scope 4 ...[22m
[2m    return ([22m
[2m      <>[22m
[2m        {header}[22m
[2m        {content}[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // note: comments are for the ideal scopes, not what is currently[22m
[2m  // emitted[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(14);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = [];[22m
[2m      x.push(props.a);[22m

[2m      t0 = <div>{x}</div>;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const header = t0;[22m
[2m    let y;[22m
[2m    if ($[3] !== x || $[4] !== props.b || $[5] !== props.c) {[22m
[2m      y = [x];[22m
[2m      x = [];[22m
[2m      y.push(props.b);[22m
[2m      x.push(props.c);[22m
[2m      $[3] = x;[22m
[2m      $[4] = props.b;[22m
[2m      $[5] = props.c;[22m
[2m      $[6] = y;[22m
[2m      $[7] = x;[22m
[2m    } else {[22m
[2m      y = $[6];[22m
[2m      x = $[7];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[8] !== x || $[9] !== y) {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          {x}[22m
[2m          {y}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[8] = x;[22m
[2m      $[9] = y;[22m
[2m      $[10] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[10];[22m
[2m    }[22m
[2m    const content = t1;[22m
[2m    let t2;[22m
[2m    if ($[11] !== header || $[12] !== content) {[22m
[2m      t2 = ([22m
[2m        <>[22m
[2m          {header}[22m
[2m          {content}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[11] = header;[22m
[2m      $[12] = content;[22m
[2m      $[13] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[13];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m same-variable-as-dep-and-redeclare-maybe-frozen
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // note: comments are for the ideal scopes, not what is currently[22m
[2m  // emitted[22m
[2m  function foo(props) {[22m
[2m    // scope 0: deps=[props.a] decl=[x] reassign=none[22m
[2m    let x = [];[22m
[2m    x.push(props.a);[22m

[2m    // scope 1: deps=[x] decl=[header] reassign=none[22m
[2m    const header = props.showHeader ? <div>{x}</div> : null;[22m

[2m    // scope 2:[22m
[2m    // deps=[x, props.b, props.c][22m
[2m    // decl=none[22m
[2m    // reassign=[x][22m
[2m    const y = [x]; // y depends on the earlier x[22m
[2m    x = []; // x reassigned[22m
[2m    y.push(props.b); // interleaved mutation of x/y[22m
[2m    x.push(props.c); // interleaved mutation[22m

[2m    // scope 3 ...[22m
[2m    const content = ([22m
[2m      <div>[22m
[2m        {x}[22m
[2m        {y}[22m
[2m      </div>[22m
[2m    );[22m

[2m    // scope 4 ...[22m
[2m    return ([22m
[2m      <>[22m
[2m        {header}[22m
[2m        {content}[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // note: comments are for the ideal scopes, not what is currently[22m
[2m  // emitted[22m
[2m  function foo(props) {[22m
[2m    const $ = _c(16);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = [];[22m
[2m      x.push(props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[2] !== props.showHeader || $[3] !== x) {[22m
[2m      t0 = props.showHeader ? <div>{x}</div> : null;[22m
[2m      $[2] = props.showHeader;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[4];[22m
[2m    }[22m
[2m    const header = t0;[22m
[2m    let y;[22m
[2m    if ($[5] !== x || $[6] !== props.b || $[7] !== props.c) {[22m
[2m      y = [x];[22m
[2m      x = [];[22m
[2m      y.push(props.b);[22m
[2m      x.push(props.c);[22m
[2m      $[5] = x;[22m
[2m      $[6] = props.b;[22m
[2m      $[7] = props.c;[22m
[2m      $[8] = y;[22m
[2m      $[9] = x;[22m
[2m    } else {[22m
[2m      y = $[8];[22m
[2m      x = $[9];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[10] !== x || $[11] !== y) {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          {x}[22m
[2m          {y}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[10] = x;[22m
[2m      $[11] = y;[22m
[2m      $[12] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[12];[22m
[2m    }[22m
[2m    const content = t1;[22m
[2m    let t2;[22m
[2m    if ($[13] !== header || $[14] !== content) {[22m
[2m      t2 = ([22m
[2m        <>[22m
[2m          {header}[22m
[2m          {content}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[13] = header;[22m
[2m      $[14] = content;[22m
[2m      $[15] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[15];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reverse-postorder
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    if (props.cond) {[22m
[2m      switch (props.test) {[22m
[2m        case 0: {[22m
[2m          x = props.v0;[22m
[2m          break;[22m
[2m        }[22m
[2m        case 1: {[22m
[2m          x = props.v1;[22m
[2m          break;[22m
[2m        }[22m
[2m        case 2: {[22m
[2m        }[22m
[2m        default: {[22m
[2m          x = props.v2;[22m
[2m        }[22m
[2m      }[22m
[2m    } else {[22m
[2m      if (props.cond2) {[22m
[2m        x = props.b;[22m
[2m      } else {[22m
[2m        x = props.c;[22m
[2m      }[22m
[2m    }[22m
[2m    x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    if (props.cond) {[22m
[2m      bb0: switch (props.test) {[22m
[2m        case 0: {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case 1: {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case 2: {[22m
[2m        }[22m
[2m        default: {[22m
[2m        }[22m
[2m      }[22m
[2m    } else {[22m
[2m      if (props.cond2) {[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m return-undefined
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    if (props.cond) {[22m
[2m      return undefined;[22m
[2m    }[22m
[2m    return props.value;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    if (props.cond) {[22m
[2m      return;[22m
[2m    }[22m
[2m    return props.value;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m return-conditional
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    if (a == null) {[22m
[2m      return null;[22m
[2m    } else {[22m
[2m      return b;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    if (a == null) {[22m
[2m      return null;[22m
[2m    } else {[22m
[2m      return b;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rest-param-with-object-spread-pattern
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(foo, ...{bar}) {[22m
[2m    return [foo, bar];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['foo', {bar: 'bar'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(foo, ...t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(t0);[39m
[2m    const { bar } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      t1 = [foo, bar];[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["foo", { bar: "bar" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["foo",null][22m

[31m[1mFAIL:[22m[39m rest-param-with-identifier
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(foo, ...bar) {[22m
[2m    return [foo, bar];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['foo', 'bar', 'baz'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(foo, ...t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(t0);[39m
[2m    const bar = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      t1 = [foo, bar];[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["foo", "bar", "baz"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["foo",["bar","baz"]][22m

[31m[1mFAIL:[22m[39m rest-param-with-array-pattern
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(foo, ...[bar]) {[22m
[2m    return [foo, bar];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['foo', ['bar', 'baz']],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(foo, ...t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(t0);[39m
[2m    const [bar] = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      t1 = [foo, bar];[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["foo", ["bar", "baz"]],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["foo",["bar","baz"]][22m

[31m[1mFAIL:[22m[39m resolve-react-hooks-based-on-import-name
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState as useReactState} from 'react';[22m

[2m  function Component() {[22m
[2m    const [state, setState] = useReactState(0);[22m

[2m    const onClick = () => {[22m
[2m      setState(s => s + 1);[22m
[2m    };[22m

[2m    return ([22m
[2m      <>[22m
[2m        Count {state}[22m
[2m        <button onClick={onClick}>Increment</button>[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState as useReactState } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(4);[22m
[32m-   const [state, setState] = useReactState(0);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useReactState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        setState((s) => s + 1);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t1 = <button onClick={onClick}>Increment</button>;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         Increment[39m
[31m+       </button>[39m
[31m+     );[39m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] !== state) {[22m
[2m      t2 = ([22m
[2m        <>[22m
[2m          Count {state}[22m
[2m          {t1}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[2] = state;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Count 0<button>Increment</button>[22m

[31m[1mFAIL:[22m[39m repro
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const item = props.item;[22m
[2m    const thumbnails = [];[22m
[2m    const baseVideos = getBaseVideos(item);[22m
[2m    useMemo(() => {[22m
[2m      baseVideos.forEach(video => {[22m
[2m        const baseVideo = video.hasBaseVideo;[22m
[2m        if (Boolean(baseVideo)) {[22m
[2m          thumbnails.push({extraVideo: true});[22m
[2m        }[22m
[2m      });[22m
[2m    });[22m
[2m    return <FlatList baseVideos={baseVideos} items={thumbnails} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    const item = props.item;[22m
[2m    let t0;[22m
[2m    let baseVideos;[22m
[2m    let thumbnails;[22m
[2m    if ($[0] !== item) {[22m
[2m      thumbnails = [];[22m
[2m      baseVideos = getBaseVideos(item);[22m

[2m      baseVideos.forEach((video) => {[22m
[2m        const baseVideo = video.hasBaseVideo;[22m
[2m        if (Boolean(baseVideo)) {[22m
[2m          thumbnails.push({ extraVideo: true });[22m
[2m        }[22m
[2m      });[22m
[2m      $[0] = item;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = baseVideos;[22m
[2m      $[3] = thumbnails;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      baseVideos = $[2];[22m
[2m      thumbnails = $[3];[22m
[2m    }[22m
[2m    t0 = undefined;[22m
[2m    let t1;[22m
[2m    if ($[4] !== baseVideos || $[5] !== thumbnails) {[22m
[32m-     t1 = <FlatList baseVideos={baseVideos} items={thumbnails} />;[39m
[31m+     t1 = ([39m
[31m+       <FlatList[39m
[31m+         baseVideos={function () {[39m
[31m+           const $res$ = baseVideos;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         items={function () {[39m
[31m+           const $res$ = thumbnails;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = baseVideos;[22m
[2m      $[5] = thumbnails;[22m
[2m      $[6] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[6];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m repro-unreachable-code-early-return-in-useMemo
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[null],"output":"[[ cyclic ref *2 ]]"}</div>
<div>{"inputs":[null],"output":"[[ cyclic ref *2 ]]"}</div>
<div>{"inputs":[42],"output":{"value":42}}</div>
<div>{"inputs":[42],"output":{"value":42}}</div>
<div>{"inputs":[null],"output":"[[ cyclic ref *2 ]]"}</div>
<div>{"inputs":[42],"output":{"value":42}}</div>
<div>{"inputs":[null],"output":"[[ cyclic ref *2 ]]"}</div>
<div>{"inputs":[42],"output":{"value":42}}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m repro-unmerged-fbt-call-merge-overlapping-reactive-scopes
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"description":"Text here","label":"3 bars"}</div>
Forget:
(kind: ok) <div>{"description":"[[ function params=0 ]]","label":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m repro-undefined-expression-of-jsxexpressioncontainer
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>StaticText1<div>{"type":"submit","children":["Submit!"],"style":{"left":true}}</div><div>{"type":"button","children":["Reset"],"style":{"right":true}}</div></div>
Forget:
(kind: ok) <div>StaticText1<div>{"type":"submit","children":["Submit!"],"style":"[[ function params=0 ]]"}</div><div>{"type":"button","children":["Reset"],"style":"[[ function params=0 ]]"}</div></div>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '      const $res$ = `button-${i}`;\n' +
  '      Object.freeze($res$);\n' +
  '      return $res$;\n' +
  '    }','\n' +
  '    at div\n' +
  '    at StaticText1 (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/shared-runtime.js:187:76)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m repro-slow-validate-preserve-memo
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {Builder} from 'shared-runtime';[22m
[2m  function useTest({isNull, data}: {isNull: boolean; data: string}) {[22m
[2m    const result = Builder.makeBuilder(isNull, 'hello world')[22m
[2m      ?.push('1', 2)[22m
[2m      ?.push(3, {[22m
[2m        a: 4,[22m
[2m        b: 5,[22m
[2m        c: data,[22m
[2m      })[22m
[2m      ?.push(6, data)[22m
[2m      ?.push(7, '8')[22m
[2m      ?.push('8', Builder.makeBuilder(!isNull)?.push(9).vals)?.vals;[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useTest,[22m
[2m    params: [{isNull: false, data: 'param'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { Builder } from "shared-runtime";[22m
[2m  function useTest(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { isNull, data } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== isNull || $[1] !== data) {[22m
[2m      t1 = Builder.makeBuilder(isNull, "hello world")[22m
[2m        ?.push("1", 2)[22m
[2m        ?.push(3, { a: 4, b: 5, c: data })[22m
[2m        ?.push([22m
[2m          6,[22m

[2m          data,[22m
[2m        )[22m
[2m        ?.push(7, "8")[22m
[2m        ?.push("8", Builder.makeBuilder(!isNull)?.push(9).vals)?.vals;[22m
[2m      $[0] = isNull;[22m
[2m      $[1] = data;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const result = t1;[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useTest,[22m
[2m    params: [{ isNull: false, data: "param" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["hello world","1",2,3,{"a":4,"b":5,"c":"param"},6,"param",7,"8","8",null][22m

[31m[1mFAIL:[22m[39m repro-separate-scopes-for-divs
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div class="a"></div><div class="c"></div>
<div class="a"></div>
<div class="a"></div>
Forget:
(kind: ok) <div></div><div></div>
<div></div>
<div></div>
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`className`','div','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)']

[31m[1mFAIL:[22m[39m repro-scope-missing-mutable-range
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function HomeDiscoStoreItemTileRating(props) {[22m
[2m    const item = useFragment();[22m
[2m    let count = 0;[22m
[2m    const aggregates = item?.aggregates || [];[22m
[2m    aggregates.forEach(aggregate => {[22m
[2m      count += aggregate.count || 0;[22m
[2m    });[22m

[2m    return <Text>{count}</Text>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function HomeDiscoStoreItemTileRating(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const item = useFragment();[39m
[31m+   Object.freeze(props);[39m
[31m+   const item = (function () {[39m
[31m+     const $res$ = useFragment();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let count;[22m
[2m    if ($[0] !== item) {[22m
[2m      count = 0;[22m
[2m      const aggregates = item?.aggregates || [];[22m
[2m      aggregates.forEach((aggregate) => {[22m
[2m        count = count + (aggregate.count || 0);[22m
[2m        count;[22m
[2m      });[22m
[2m      $[0] = item;[22m
[2m      $[1] = count;[22m
[2m    } else {[22m
[2m      count = $[1];[22m
[2m    }[22m

[2m    const t0 = count;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = <Text>{t0}</Text>;[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m repro-renaming-conflicting-decls
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"link":{"url":"{\"val\":2}"},"val1":[1],"val2":[2],"val3":[3],"val4":[4],"val5":[5],"children":[{},2]}</div>
Forget:
(kind: ok) <div>{"link":"[[ function params=0 ]]","val1":"[[ function params=0 ]]","val2":"[[ function params=0 ]]","val3":"[[ function params=0 ]]","val4":"[[ function params=0 ]]","val5":"[[ function params=0 ]]","children":[{},2]}</div>

[31m[1mFAIL:[22m[39m repro-ref-mutable-range
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"ref":{"current":"fake-ref-object"}}</div>
Forget:
(kind: ok) <div>{"ref":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m repro-reassign-to-variable-without-mutable-range
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @debug[22m
[2m  function Component(a, b) {[22m
[2m    let x = [];[22m
[2m    let y = [];[22m
[2m    let z = foo(a);[22m
[2m    if (FLAG) {[22m
[2m      x = bar(z);[22m
[2m      y = baz(b);[22m
[2m    }[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @debug[22m
[2m  function Component(a, b) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = [];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let y = t1;[22m
[2m    if ($[2] !== a || $[3] !== b) {[22m
[2m      const z = foo(a);[22m
[2m      if (FLAG) {[22m
[2m        x = bar(z);[22m
[2m        let t2;[22m
[2m        if ($[6] !== b) {[22m
[2m          t2 = baz(b);[22m
[2m          $[6] = b;[22m
[2m          $[7] = t2;[22m
[2m        } else {[22m
[2m          t2 = $[7];[22m
[2m        }[22m
[2m        y = t2;[22m
[2m      }[22m
[2m      $[2] = a;[22m
[2m      $[3] = b;[22m
[2m      $[4] = x;[22m
[2m      $[5] = y;[22m
[2m    } else {[22m
[2m      x = $[4];[22m
[2m      y = $[5];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[8] !== x || $[9] !== y) {[22m
[2m      t2 = [x, y];[22m
[2m      $[8] = x;[22m
[2m      $[9] = y;[22m
[2m      $[10] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[10];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m repro-object-pattern
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(t) {[22m
[2m    let {a} = t;[22m
[2m    let y = {a};[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [{a: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(t) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t);[39m
[2m    const { a } = t;[22m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [{ a: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":42}[22m

[31m[1mFAIL:[22m[39m repro-no-value-for-temporary
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  function Component(listItem, thread) {[22m
[2m    const isFoo = isFooThread(thread.threadType);[22m
[2m    const body = useBar(listItem, [getBadgeText(listItem, isFoo)]);[22m

[2m    return body;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(listItem, thread) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(listItem);[39m
[31m+   Object.freeze(thread);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== thread.threadType || $[1] !== listItem) {[22m
[2m      const isFoo = isFooThread(thread.threadType);[22m
[2m      t1 = useBar;[22m
[2m      t2 = listItem;[22m
[2m      t0 = getBadgeText(listItem, isFoo);[22m
[2m      $[0] = thread.threadType;[22m
[2m      $[1] = listItem;[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m      t1 = $[3];[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== t0) {[22m
[2m      t3 = [t0];[22m
[2m      $[5] = t0;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[32m-   const body = t1(t2, t3);[39m
[31m+   const body = (function () {[39m
[31m+     const $res$ = t1(Object.freeze(t2), Object.freeze(t3));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return body;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Fixture not implemented[22m

[31m[1mFAIL:[22m[39m repro-no-value-for-temporary-reactive-scope-with-early-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  import {identity, makeObject_Primitives} from 'shared-runtime';[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    const object = makeObject_Primitives();[22m
[2m    const cond = makeObject_Primitives();[22m
[2m    if (!cond) {[22m
[2m      return null;[22m
[2m    }[22m

[2m    return ([22m
[2m      <div className="foo">[22m
[2m        {fbt([22m
[2m          'Lorum ipsum' + fbt.param('thing', object.b) + ' blah blah blah',[22m
[2m          'More text'[22m
[2m        )}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, makeObject_Primitives } from "shared-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        const object = makeObject_Primitives();[22m
[2m        const cond = makeObject_Primitives();[22m
[2m        if (!cond) {[22m
[2m          t1 = null;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        t0 = ([22m
[2m          <div className="foo">[22m
[2m            {fbt._([22m
[2m              "Lorum ipsum{thing} blah blah blah",[22m
[2m              [fbt._param("thing", object.b)],[22m
[2m              { hk: "lwmuH" },[22m
[2m            )}[22m
[2m          </div>[22m
[2m        );[22m
[2m      }[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div class="foo">Lorum ipsumvalue1 blah blah blah</div>[22m

[31m[1mFAIL:[22m[39m repro-no-declarations-in-reactive-scope-with-early-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  function Component() {[22m
[2m    const items = useItems();[22m
[2m    const filteredItems = useMemo([22m
[2m      () =>[22m
[2m        items.filter(([item]) => {[22m
[2m          return item.name != null;[22m
[2m        }),[22m
[2m      [item][22m
[2m    );[22m

[2m    if (filteredItems.length === 0) {[22m
[2m      // note: this must return nested JSX to create the right scope[22m
[2m      // shape that causes no declarations to be emitted[22m
[2m      return ([22m
[2m        <div>[22m
[2m          <span />[22m
[2m        </div>[22m
[2m      );[22m
[2m    }[22m

[2m    return ([22m
[2m      <>[22m
[2m        {filteredItems.map(([item]) => ([22m
[2m          <Stringify item={item} />[22m
[2m        ))}[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  function Component() {[22m
[2m    const $ = _c(8);[22m
[32m-   const items = useItems();[39m
[31m+   const items = (function () {[39m
[31m+     const $res$ = useItems();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== items) {[22m
[2m      t2 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        let t3;[22m
[2m        if ($[4] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t3 = (t4) => {[22m
[2m            const [item] = t4;[22m
[2m            return item.name != null;[22m
[2m          };[22m
[2m          $[4] = t3;[22m
[2m        } else {[22m
[2m          t3 = $[4];[22m
[2m        }[22m
[2m        t0 = items.filter(t3);[22m
[2m        const filteredItems = t0;[22m
[2m        if (filteredItems.length === 0) {[22m
[2m          let t4;[22m
[2m          if ($[5] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m            t4 = ([22m
[2m              <div>[22m
[2m                <span />[22m
[2m              </div>[22m
[2m            );[22m
[2m            $[5] = t4;[22m
[2m          } else {[22m
[2m            t4 = $[5];[22m
[2m          }[22m
[2m          t2 = t4;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        t1 = filteredItems.map(_temp);[22m
[2m      }[22m
[2m      $[0] = items;[22m
[2m      $[1] = t1;[22m
[2m      $[2] = t2;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m      t2 = $[2];[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    if (t2 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t2;[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[6] !== t1) {[22m
[2m      t3 = <>{t1}</>;[22m
[2m      $[6] = t1;[22m
[2m      $[7] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[7];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m
[2m  function _temp(t0) {[22m
[2m    const [item_0] = t0;[22m
[32m-   return <Stringify item={item_0} />;[39m
[31m+   return ([39m
[31m+     <Stringify[39m
[31m+       item={function () {[39m
[31m+         const $res$ = item_0;[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[31m+       }}[39m
[31m+     />[39m
[31m+   );[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Fixture not implemented[22m

[31m[1mFAIL:[22m[39m repro-mutable-range-extending-into-ternary
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>Alice</div></div>
<div><div>Alice</div><div>Bob</div></div>
<div></div>
<div><div>Bob</div><div>Claire</div></div>
Forget:
(kind: ok) <div><div>Alice</div></div>
<div><div>Alice</div><div>Bob</div></div>
<div></div>
<div><div>Bob</div><div>Claire</div></div>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '      const $res$ = item.id;\n' +
  '      Object.freeze($res$);\n' +
  '      return $res$;\n' +
  '    }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '      const $res$ = item.id;\n' +
  '      Object.freeze($res$);\n' +
  '      return $res$;\n' +
  '    }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)']

[31m[1mFAIL:[22m[39m repro-missing-dependency-if-within-while
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
<div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
<div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
Forget:
(kind: ok) <div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
<div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
<div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div><div>0</div>
<div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div><div>42</div>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '            const $res$ = i;\n' +
  '            Object.freeze($res$);\n' +
  '            return $res$;\n' +
  '          }','\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)']

[31m[1mFAIL:[22m[39m repro-memoize-array-with-immutable-map-after-hook
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect, useState} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const x = [props.value];[22m
[2m    useEffect(() => {}, []);[22m
[2m    const onClick = () => {[22m
[2m      console.log(x.length);[22m
[2m    };[22m
[2m    return ([22m
[2m      <div onClick={onClick}>[22m
[2m        {x.map(item => {[22m
[2m          return <span key={item}>{item}</span>;[22m
[2m        })}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect, useState } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(10);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = [props.value];[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = [];[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[32m-   useEffect(_temp, t1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(_temp), Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[3] !== x.length) {[22m
[2m      t2 = () => {[22m
[2m        console.log(x.length);[22m
[2m      };[22m
[2m      $[3] = x.length;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    const onClick = t2;[22m
[2m    let t3;[22m
[2m    if ($[5] !== x) {[22m
[2m      t3 = x.map(_temp2);[22m
[2m      $[5] = x;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[7] !== onClick || $[8] !== t3) {[22m
[32m-     t4 = <div onClick={onClick}>{t3}</div>;[39m
[31m+     t4 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {t3}[39m
[31m+       </div>[39m
[31m+     );[39m
[2m      $[7] = onClick;[22m
[2m      $[8] = t3;[22m
[2m      $[9] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[9];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m
[2m  function _temp2(item) {[22m
[32m-   return <span key={item}>{item}</span>;[39m
[31m+   return ([39m
[31m+     <span[39m
[31m+       key={function () {[39m
[31m+         const $res$ = item;[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[31m+       }}[39m
[31m+     >[39m
[31m+       {item}[39m
[31m+     </span>[39m
[31m+   );[39m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><span>42</span></div>[22m

[31m[1mFAIL:[22m[39m repro-invalid-scope-merging-value-blocks
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    CONST_TRUE,[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    mutateAndReturn,[22m
[2m    useHook,[22m
[2m  } from 'shared-runtime';[22m

[2m  /**[22m
[2m   * value and `mutateAndReturn(value)` should end up in the same reactive scope.[22m
[2m   * (1) `value = makeObject` and `(temporary) = mutateAndReturn(value)` should be assigned[22m
[2m   * the same scope id (on their identifiers)[22m
[2m   * (2) alignScopesToBlockScopes should expand the scopes of both `(temporary) = identity(1)`[22m
[2m   * and `(temporary) = mutateAndReturn(value)` to the outermost value block boundaries[22m
[2m   * (3) mergeOverlappingScopes should merge the scopes of the above two instructions[22m
[2m   */[22m
[2m  function Component({}) {[22m
[2m    const value = makeObject_Primitives();[22m
[2m    useHook();[22m
[2m    const mutatedValue =[22m
[2m      identity(1) && CONST_TRUE ? mutateAndReturn(value) : null;[22m
[2m    const result = [];[22m
[2m    useHook();[22m
[2m    result.push(value, mutatedValue);[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}, {}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    CONST_TRUE,[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    mutateAndReturn,[22m
[2m    useHook,[22m
[2m  } from "shared-runtime";[22m

[2m  /**[22m
[2m   * value and `mutateAndReturn(value)` should end up in the same reactive scope.[22m
[2m   * (1) `value = makeObject` and `(temporary) = mutateAndReturn(value)` should be assigned[22m
[2m   * the same scope id (on their identifiers)[22m
[2m   * (2) alignScopesToBlockScopes should expand the scopes of both `(temporary) = identity(1)`[22m
[2m   * and `(temporary) = mutateAndReturn(value)` to the outermost value block boundaries[22m
[2m   * (3) mergeOverlappingScopes should merge the scopes of the above two instructions[22m
[2m   */[22m
[2m  function Component(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const value = makeObject_Primitives();[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const mutatedValue =[22m
[2m      identity(1) && CONST_TRUE ? mutateAndReturn(value) : null;[22m
[2m    const result = [];[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    result.push(value, mutatedValue);[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}, {}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":0,"b":"value1","c":true,"wat0":"joe"},"[[ cyclic ref *1 ]]"][22m
[2m  [{"a":0,"b":"value1","c":true,"wat0":"joe"},"[[ cyclic ref *1 ]]"][22m
[2m  [{"a":0,"b":"value1","c":true,"wat0":"joe"},"[[ cyclic ref *1 ]]"][22m

[31m[1mFAIL:[22m[39m repro-invalid-reactivity-value-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    CONST_TRUE,[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    useNoAlias,[22m
[2m  } from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Here the scope for `obj` is pruned because it spans the `useNoAlias()` hook call.[22m
[2m   * Because `obj` is non-reactive, it would by default be excluded as dependency for[22m
[2m   * `result = [...identity(obj)..., obj]`, but this could then cause the values in[22m
[2m   * `result` to be out of sync with `obj`.[22m
[2m   *[22m
[2m   * The fix is to consider pruned memo block outputs as reactive, since they will[22m
[2m   * recreate on every render. This means `thing` depends on both y and z.[22m
[2m   */[22m
[2m  function Foo() {[22m
[2m    const obj = makeObject_Primitives();[22m
[2m    // hook calls keeps the next two lines as its own reactive scope[22m
[2m    useNoAlias();[22m

[2m    const shouldCaptureObj = obj != null && CONST_TRUE;[22m
[2m    const result = [shouldCaptureObj ? identity(obj) : null, obj];[22m

[2m    useNoAlias(result, obj);[22m

[2m    if (shouldCaptureObj && result[0] !== obj) {[22m
[2m      throw new Error('Unexpected');[22m
[2m    }[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import {[22m
[2m    CONST_TRUE,[22m
[2m    identity,[22m
[2m    makeObject_Primitives,[22m
[2m    useNoAlias,[22m
[2m  } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Here the scope for `obj` is pruned because it spans the `useNoAlias()` hook call.[22m
[2m   * Because `obj` is non-reactive, it would by default be excluded as dependency for[22m
[2m   * `result = [...identity(obj)..., obj]`, but this could then cause the values in[22m
[2m   * `result` to be out of sync with `obj`.[22m
[2m   *[22m
[2m   * The fix is to consider pruned memo block outputs as reactive, since they will[22m
[2m   * recreate on every render. This means `thing` depends on both y and z.[22m
[2m   */[22m
[2m  function Foo() {[22m
[2m    const $ = _c(3);[22m
[2m    const obj = makeObject_Primitives();[22m
[32m-[39m
[32m-   useNoAlias();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useNoAlias();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const shouldCaptureObj = obj != null && CONST_TRUE;[22m
[2m    const t0 = shouldCaptureObj ? identity(obj) : null;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0 || $[1] !== obj) {[22m
[2m      t1 = [t0, obj];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = obj;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const result = t1;[22m
[32m-[39m
[32m-   useNoAlias(result, obj);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useNoAlias(Object.freeze(result), Object.freeze(obj));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    if (shouldCaptureObj && result[0] !== obj) {[22m
[2m      throw new Error("Unexpected");[22m
[2m    }[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":0,"b":"value1","c":true},"[[ cyclic ref *1 ]]"][22m
[2m  [{"a":0,"b":"value1","c":true},"[[ cyclic ref *1 ]]"][22m

[31m[1mFAIL:[22m[39m repro-invalid-pruned-scope-leaks-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import invariant from 'invariant';[22m
[2m  import {makeObject_Primitives, mutate, sum, useIdentity} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Here, `z`'s original memo block is removed due to the inner hook call.[22m
[2m   * However, we also infer that `z` is non-reactive, so by default we would create[22m
[2m   * the memo block for `thing = [y, z]` as only depending on `y`.[22m
[2m   *[22m
[2m   * This could then mean that `thing[1]` and `z` may not refer to the same value,[22m
[2m   * since z recreates every time but `thing` doesn't correspondingly invalidate.[22m
[2m   *[22m
[2m   * The fix is to consider pruned memo block outputs as reactive, since they will[22m
[2m   * recreate on every render. This means `thing` depends on both y and z.[22m
[2m   */[22m
[2m  function MyApp({count}) {[22m
[2m    const z = makeObject_Primitives();[22m
[2m    const x = useIdentity(2);[22m
[2m    const y = sum(x, count);[22m
[2m    mutate(z);[22m
[2m    const thing = [y, z];[22m
[2m    if (thing[1] !== z) {[22m
[2m      invariant(false, 'oh no!');[22m
[2m    }[22m
[2m    return thing;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [{count: 2}],[22m
[2m    sequentialRenders: [{count: 2}, {count: 2}, {count: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import invariant from "invariant";[22m
[2m  import {[22m
[2m    makeObject_Primitives,[22m
[2m    mutate,[22m
[2m    sum,[22m
[2m    useIdentity,[22m
[2m  } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Here, `z`'s original memo block is removed due to the inner hook call.[22m
[2m   * However, we also infer that `z` is non-reactive, so by default we would create[22m
[2m   * the memo block for `thing = [y, z]` as only depending on `y`.[22m
[2m   *[22m
[2m   * This could then mean that `thing[1]` and `z` may not refer to the same value,[22m
[2m   * since z recreates every time but `thing` doesn't correspondingly invalidate.[22m
[2m   *[22m
[2m   * The fix is to consider pruned memo block outputs as reactive, since they will[22m
[2m   * recreate on every render. This means `thing` depends on both y and z.[22m
[2m   */[22m
[2m  function MyApp(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { count } = t0;[22m
[2m    const z = makeObject_Primitives();[22m
[32m-   const x = useIdentity(2);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useIdentity(Object.freeze(2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[0] !== x || $[1] !== count) {[22m
[2m      t1 = sum(x, count);[22m
[2m      $[0] = x;[22m
[2m      $[1] = count;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    mutate(z);[22m
[2m    let t2;[22m
[2m    if ($[3] !== y || $[4] !== z) {[22m
[2m      t2 = [y, z];[22m
[2m      $[3] = y;[22m
[2m      $[4] = z;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    const thing = t2;[22m
[2m    if (thing[1] !== z) {[22m
[2m      invariant(false, "oh no!");[22m
[2m    }[22m
[2m    return thing;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [{ count: 2 }],[22m
[2m    sequentialRenders: [{ count: 2 }, { count: 2 }, { count: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4,{"a":0,"b":"value1","c":true,"wat0":"joe"}][22m
[2m  [4,{"a":0,"b":"value1","c":true,"wat0":"joe"}][22m
[2m  [5,{"a":0,"b":"value1","c":true,"wat0":"joe"}][22m

[31m[1mFAIL:[22m[39m repro-invalid-pruned-scope-leaks-value-via-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import invariant from 'invariant';[22m
[2m  import {makeObject_Primitives, mutate, sum, useIdentity} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Here, `z`'s original memo block is removed due to the inner hook call.[22m
[2m   * However, we also infer that `z` is non-reactive, so by default we would create[22m
[2m   * the memo block for `thing = [y, z]` as only depending on `y`.[22m
[2m   *[22m
[2m   * This could then mean that `thing[1]` and `z` may not refer to the same value,[22m
[2m   * since z recreates every time but `thing` doesn't correspondingly invalidate.[22m
[2m   *[22m
[2m   * The fix is to consider pruned memo block outputs as reactive, since they will[22m
[2m   * recreate on every render. This means `thing` depends on both y and z.[22m
[2m   */[22m
[2m  function MyApp({count}) {[22m
[2m    const z = makeObject_Primitives();[22m
[2m    const x = useIdentity(2);[22m
[2m    const y = sum(x, count);[22m
[2m    mutate(z);[22m
[2m    const z2 = z;[22m
[2m    const thing = [y, z2];[22m
[2m    if (thing[1] !== z) {[22m
[2m      invariant(false, 'oh no!');[22m
[2m    }[22m
[2m    return thing;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [{count: 2}],[22m
[2m    sequentialRenders: [{count: 2}, {count: 2}, {count: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import invariant from "invariant";[22m
[2m  import {[22m
[2m    makeObject_Primitives,[22m
[2m    mutate,[22m
[2m    sum,[22m
[2m    useIdentity,[22m
[2m  } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Here, `z`'s original memo block is removed due to the inner hook call.[22m
[2m   * However, we also infer that `z` is non-reactive, so by default we would create[22m
[2m   * the memo block for `thing = [y, z]` as only depending on `y`.[22m
[2m   *[22m
[2m   * This could then mean that `thing[1]` and `z` may not refer to the same value,[22m
[2m   * since z recreates every time but `thing` doesn't correspondingly invalidate.[22m
[2m   *[22m
[2m   * The fix is to consider pruned memo block outputs as reactive, since they will[22m
[2m   * recreate on every render. This means `thing` depends on both y and z.[22m
[2m   */[22m
[2m  function MyApp(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { count } = t0;[22m
[2m    const z = makeObject_Primitives();[22m
[32m-   const x = useIdentity(2);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useIdentity(Object.freeze(2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[0] !== x || $[1] !== count) {[22m
[2m      t1 = sum(x, count);[22m
[2m      $[0] = x;[22m
[2m      $[1] = count;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    mutate(z);[22m
[2m    const z2 = z;[22m
[2m    let t2;[22m
[2m    if ($[3] !== y || $[4] !== z2) {[22m
[2m      t2 = [y, z2];[22m
[2m      $[3] = y;[22m
[2m      $[4] = z2;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    const thing = t2;[22m
[2m    if (thing[1] !== z) {[22m
[2m      invariant(false, "oh no!");[22m
[2m    }[22m
[2m    return thing;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [{ count: 2 }],[22m
[2m    sequentialRenders: [{ count: 2 }, { count: 2 }, { count: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4,{"a":0,"b":"value1","c":true,"wat0":"joe"}][22m
[2m  [4,{"a":0,"b":"value1","c":true,"wat0":"joe"}][22m
[2m  [5,{"a":0,"b":"value1","c":true,"wat0":"joe"}][22m

[31m[1mFAIL:[22m[39m repro-instruction-part-of-already-closed-scope
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>{"value":{"a":0,"b":"value1","c":true}}</div><div>{"value":{"a":0,"b":"value1","c":true}}</div><div>{"value":{"a":0,"b":"value1","c":true}}</div></div>
Forget:
(kind: ok) <div><div>{"value":"[[ function params=0 ]]"}</div><div>{"value":"[[ function params=0 ]]"}</div><div>{"value":"[[ function params=0 ]]"}</div></div>

[31m[1mFAIL:[22m[39m repro-independently-memoized-property-load-for-method-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @enableAssumeHooksFollowRulesOfReact[22m
[2m  function Component({label, highlightedItem}) {[22m
[2m    const serverTime = useServerTime();[22m
[2m    const highlight = new Highlight(highlightedItem);[22m

[2m    const time = serverTime.get();[22m
[2m    // subtle bit here: the binary expression infers the result of the call[22m
[2m    // as a primitive and not needing memoization. the logical is necessary[22m
[2m    // because without it there are no intermediate scopes which observe[22m
[2m    // the result of the binary expression, so its memoization can be pruned[22m
[2m    const timestampLabel = time / 1000 || label;[22m

[2m    return ([22m
[2m      <>[22m
[2m        {highlight.render()}[22m
[2m        {timestampLabel}[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  function useServerTime() {[22m
[2m    'use no forget';[22m

[2m    return {[22m
[2m      get() {[22m
[2m        return 42000; // would be a constant value from the server[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  class Highlight {[22m
[2m    constructor(value) {[22m
[2m      this.value = value;[22m
[2m    }[22m

[2m    render() {[22m
[2m      return this.value;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{label: '<unused>', highlightedItem: 'Seconds passed: '}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { label, highlightedItem } = t0;[22m
[32m-   const serverTime = useServerTime();[39m
[31m+   const serverTime = (function () {[39m
[31m+     const $res$ = useServerTime();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    let timestampLabel;[22m
[2m    if ($[0] !== highlightedItem || $[1] !== serverTime || $[2] !== label) {[22m
[2m      const highlight = new Highlight(highlightedItem);[22m

[2m      const time = serverTime.get();[22m

[2m      timestampLabel = time / 1000 || label;[22m

[2m      t1 = highlight.render();[22m
[2m      $[0] = highlightedItem;[22m
[2m      $[1] = serverTime;[22m
[2m      $[2] = label;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = timestampLabel;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m      timestampLabel = $[4];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[5] !== t1 || $[6] !== timestampLabel) {[22m
[2m      t2 = ([22m
[2m        <>[22m
[2m          {t1}[22m
[2m          {timestampLabel}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[5] = t1;[22m
[2m      $[6] = timestampLabel;[22m
[2m      $[7] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[7];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  function useServerTime() {[22m
[2m    "use no forget";[22m

[2m    return {[22m
[2m      get() {[22m
[2m        return 42000;[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  class Highlight {[22m
[2m    constructor(value) {[22m
[2m      this.value = value;[22m
[2m    }[22m

[2m    render() {[22m
[2m      return this.value;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ label: "<unused>", highlightedItem: "Seconds passed: " }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Seconds passed: 42[22m

[31m[1mFAIL:[22m[39m repro-hoisting
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const wat = () => {[22m
[2m      const pathname = 'wat';[22m
[2m      pathname;[22m
[2m    };[22m

[2m    const pathname = props.wat;[22m
[2m    const deeplinkItemId = pathname ? props.itemID : null;[22m

[2m    return <button onClick={() => wat()}>{deeplinkItemId}</button>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{wat: '/dev/null', itemID: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    const wat = _temp;[22m

[2m    const pathname_0 = props.wat;[22m
[2m    const deeplinkItemId = pathname_0 ? props.itemID : null;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => wat();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[1] !== deeplinkItemId) {[22m
[32m-     t1 = <button onClick={t0}>{deeplinkItemId}</button>;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = t0;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {deeplinkItemId}[39m
[31m+       </button>[39m
[31m+     );[39m
[2m      $[1] = deeplinkItemId;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ wat: "/dev/null", itemID: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <button>42</button>[22m

[31m[1mFAIL:[22m[39m repro-hoisting-variable-collision
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = props.items.map(x => x);[22m
[2m    const x = 42;[22m
[2m    return [x, items];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{items: [0, 42, null, undefined, {object: true}]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.items) {[22m
[2m      t0 = props.items.map(_temp);[22m
[2m      $[0] = props.items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const items = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== items) {[22m
[2m      t1 = [42, items];[22m
[2m      $[2] = items;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp(x) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ items: [0, 42, null, undefined, { object: true }] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42,[0,42,null,null,{"object":true}]][22m

[31m[1mFAIL:[22m[39m repro-duplicate-type-import
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import type {ReactElement} from 'react';[22m

[2m  function Component(_props: {}): ReactElement {[22m
[2m    return <div>hello world</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import type { ReactElement } from "react";[22m

[2m  function Component(_props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(_props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div>hello world</div>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>hello world</div>[22m

[31m[1mFAIL:[22m[39m repro-duplicate-instruction-from-merge-consecutive-scopes
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{}</div><div>{"title":false}</div>
Forget:
(kind: ok) <div>{"title":"[[ function params=0 ]]"}</div><div>{"title":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m repro-duplicate-import-specifier
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import type {SetStateAction, Dispatch} from 'react';[22m
[2m  import {useState} from 'react';[22m

[2m  function Component(_props: {}) {[22m
[2m    const [x, _setX]: [number, Dispatch<SetStateAction<number>>] = useState(0);[22m
[2m    return {x};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import type { SetStateAction, Dispatch } from "react";[22m
[2m  import { useState } from "react";[22m

[2m  function Component(_props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const [x] = useState(0);[39m
[31m+   Object.freeze(_props);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = { x };[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":0}[22m

[31m[1mFAIL:[22m[39m repro-dont-memoize-array-with-mutable-map-after-hook
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect, useState} from 'react';[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = [{...props.value}];[22m
[2m    useEffect(() => {}, []);[22m
[2m    const onClick = () => {[22m
[2m      console.log(x.length);[22m
[2m    };[22m
[2m    let y;[22m
[2m    return ([22m
[2m      <div onClick={onClick}>[22m
[2m        {x.map(item => {[22m
[2m          item.flag = true;[22m
[2m          return <span key={item.id}>{item.text}</span>;[22m
[2m        })}[22m
[2m        {mutate(y)}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: {id: 0, text: 'Hello', flag: false}}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect, useState } from "react";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [{ ...props.value }];[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   useEffect(_temp, t0);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(_temp), Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const onClick = () => {[22m
[2m      console.log(x.length);[22m
[2m    };[22m

[2m    let y;[22m

[2m    const t1 = x.map(_temp2);[22m
[2m    let t2;[22m
[2m    if ($[1] !== y) {[22m
[2m      t2 = mutate(y);[22m
[2m      $[1] = y;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[3] !== onClick || $[4] !== t1 || $[5] !== t2) {[22m
[2m      t3 = ([22m
[32m-       <div onClick={onClick}>[39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[2m          {t1}[22m
[2m          {t2}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[3] = onClick;[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t2;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m
[2m  function _temp2(item) {[22m
[2m    item.flag = true;[22m
[32m-   return <span key={item.id}>{item.text}</span>;[39m
[31m+   return ([39m
[31m+     <span[39m
[31m+       key={function () {[39m
[31m+         const $res$ = item.id;[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[31m+       }}[39m
[31m+     >[39m
[31m+       {item.text}[39m
[31m+     </span>[39m
[31m+   );[39m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: { id: 0, text: "Hello", flag: false } }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><span>Hello</span></div>[22m

[31m[1mFAIL:[22m[39m repro-dont-memoize-array-with-capturing-map-after-hook
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect, useState} from 'react';[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = [{...props.value}];[22m
[2m    useEffect(() => {}, []);[22m
[2m    const onClick = () => {[22m
[2m      console.log(x.length);[22m
[2m    };[22m
[2m    let y;[22m
[2m    return ([22m
[2m      <div onClick={onClick}>[22m
[2m        {x.map(item => {[22m
[2m          y = item;[22m
[2m          return <span key={item.id}>{item.text}</span>;[22m
[2m        })}[22m
[2m        {mutate(y)}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: {id: 0, text: 'Hello!'}}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect, useState } from "react";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [{ ...props.value }];[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   useEffect(_temp, t0);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(_temp), Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const onClick = () => {[22m
[2m      console.log(x.length);[22m
[2m    };[22m

[2m    let y;[22m

[2m    const t1 = x.map((item) => {[22m
[2m      y = item;[22m
[32m-     return <span key={item.id}>{item.text}</span>;[39m
[31m+     return ([39m
[31m+       <span[39m
[31m+         key={function () {[39m
[31m+           const $res$ = item.id;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {item.text}[39m
[31m+       </span>[39m
[31m+     );[39m
[2m    });[22m
[2m    const t2 = mutate(y);[22m
[2m    let t3;[22m
[2m    if ($[1] !== onClick || $[2] !== t1 || $[3] !== t2) {[22m
[2m      t3 = ([22m
[32m-       <div onClick={onClick}>[39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[2m          {t1}[22m
[2m          {t2}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[1] = onClick;[22m
[2m      $[2] = t1;[22m
[2m      $[3] = t2;[22m
[2m      $[4] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[4];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: { id: 0, text: "Hello!" } }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><span>Hello!</span></div>[22m

[31m[1mFAIL:[22m[39m repro-dce-circular-reference
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component({data}) {[22m
[2m    let x = 0;[22m
[2m    for (const item of data) {[22m
[2m      const {current, other} = item;[22m
[2m      x += current;[22m
[2m      identity(other);[22m
[2m    }[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        data: [[22m
[2m          {current: 2, other: 3},[22m
[2m          {current: 4, other: 5},[22m
[2m        ],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { data } = t0;[22m
[2m    let x = 0;[22m
[2m    for (const item of data) {[22m
[2m      const { current, other } = item;[22m
[2m      x = x + current;[22m
[2m      identity(other);[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        data: [[22m
[2m          { current: 2, other: 3 },[22m
[2m          { current: 4, other: 5 },[22m
[2m        ],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [6][22m

[31m[1mFAIL:[22m[39m repro-allocating-ternary-test-instruction-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, makeObject_Primitives} from 'shared-runtime';[22m

[2m  function useTest({cond}) {[22m
[2m    const val = makeObject_Primitives();[22m

[2m    useHook();[22m
[2m    /**[22m
[2m     * We don't technically need a reactive scope for this ternary as[22m
[2m     * it cannot produce newly allocated values.[22m
[2m     * While identity(...) may allocate, we can teach the compiler that[22m
[2m     * its result is only used as as a test condition[22m
[2m     */[22m
[2m    const result = identity(cond) ? val : null;[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useTest,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, makeObject_Primitives } from "shared-runtime";[22m

[2m  function useTest(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = makeObject_Primitives();[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    const val = t1;[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[1] !== cond) {[22m
[2m      t2 = identity(cond) ? val : null;[22m
[2m      $[1] = cond;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    const result = t2;[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useTest,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) useHook is not defined[22m

[31m[1mFAIL:[22m[39m reordering-across-blocks
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  function Component({config}) {[22m
[2m    /**[22m
[2m     * The original memoization is optimal in the sense that it has[22m
[2m     * one output (the object) and one dependency (`config`). Both[22m
[2m     * the `a` and `b` functions will have to be recreated whenever[22m
[2m     * `config` changes, cascading to update the object.[22m
[2m     *[22m
[2m     * However, we currently only consider consecutive scopes for[22m
[2m     * merging, so we first see the `a` scope, then the `b` scope,[22m
[2m     * and see that the output of the `a` scope is used later -[22m
[2m     * so we don't merge these scopes, and so on.[22m
[2m     *[22m
[2m     * The more optimal thing would be to build a dependency graph[22m
[2m     * of scopes so that we can see the data flow is along the lines[22m
[2m     * of:[22m
[2m     *[22m
[2m     *             config[22m
[2m     *            /      \[22m
[2m     *          [a]      [b][22m
[2m     *           \       /[22m
[2m     *           [object][22m
[2m     *[22m
[2m     * All the scopes (shown in []) are transitively dependent on[22m
[2m     * `config`, so they can be merged.[22m
[2m     */[22m
[2m    const object = useMemo(() => {[22m
[2m      const a = event => {[22m
[2m        config?.onA?.(event);[22m
[2m      };[22m

[2m      const b = event => {[22m
[2m        config?.onB?.(event);[22m
[2m      };[22m

[2m      return {[22m
[2m        b,[22m
[2m        a,[22m
[2m      };[22m
[2m    }, [config]);[22m

[2m    return <Stringify value={object} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { config } = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== config) {[22m
[2m      t2 = (event) => {[22m
[2m        config?.onA?.(event);[22m
[2m      };[22m
[2m      $[0] = config;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[2m    const a = t2;[22m
[2m    let t3;[22m
[2m    if ($[2] !== config) {[22m
[2m      t3 = (event_0) => {[22m
[2m        config?.onB?.(event_0);[22m
[2m      };[22m
[2m      $[2] = config;[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[2m    const b = t3;[22m
[2m    let t4;[22m
[2m    if ($[4] !== b || $[5] !== a) {[22m
[2m      t4 = { b, a };[22m
[2m      $[4] = b;[22m
[2m      $[5] = a;[22m
[2m      $[6] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[6];[22m
[2m    }[22m
[2m    t1 = t4;[22m
[2m    const object = t1;[22m
[2m    let t5;[22m
[2m    if ($[7] !== object) {[22m
[32m-     t5 = <Stringify value={object} />;[39m
[31m+     t5 = ([39m
[31m+       <Stringify[39m
[31m+         value={function () {[39m
[31m+           const $res$ = object;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[7] = object;[22m
[2m      $[8] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[8];[22m
[2m    }[22m
[2m    return t5;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Fixture not implemented[22m

[31m[1mFAIL:[22m[39m renaming-jsx-tag-lowercase
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{}}</div><div>{"value":{}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div><div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m rename-source-variables
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableChangeVariableCodegen[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  const $ = 'module_$';[22m
[2m  const t0 = 'module_t0';[22m
[2m  const c_0 = 'module_c_0';[22m
[2m  function useFoo(props: {value: number}): number {[22m
[2m    const results = identity(props.value);[22m
[2m    console.log($);[22m
[2m    console.log(t0);[22m
[2m    console.log(c_0);[22m
[2m    return results;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableChangeVariableCodegen[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const $ = "module_$";[22m
[2m  const t0 = "module_t0";[22m
[2m  const c_0 = "module_c_0";[22m
[2m  function useFoo(props) {[22m
[2m    const $0 = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const c_00 = $0[0] !== props.value;[22m
[2m    let t1;[22m
[2m    if (c_00) {[22m
[2m      t1 = identity(props.value);[22m
[2m      $0[0] = props.value;[22m
[2m      $0[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $0[1];[22m
[2m    }[22m
[2m    const results = t1;[22m
[2m    console.log($);[22m
[2m    console.log(t0);[22m
[2m    console.log(c_0);[22m
[2m    return results;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 0[22m
[2m  logs: ['module_$','module_t0','module_c_0'][22m

[31m[1mFAIL:[22m[39m rename-source-variables-nested-object-method
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableChangeVariableCodegen[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  const $ = 'module_$';[22m
[2m  const t0 = 'module_t0';[22m
[2m  const c_0 = 'module_c_0';[22m
[2m  function useFoo(props: {value: number}): number {[22m
[2m    const a = {[22m
[2m      foo() {[22m
[2m        const b = {[22m
[2m          bar() {[22m
[2m            console.log($);[22m
[2m            console.log(t0);[22m
[2m            console.log(c_0);[22m
[2m            return identity(props.value);[22m
[2m          },[22m
[2m        };[22m
[2m        return b;[22m
[2m      },[22m
[2m    };[22m
[2m    return a.foo().bar();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableChangeVariableCodegen[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const $ = "module_$";[22m
[2m  const t0 = "module_t0";[22m
[2m  const c_0 = "module_c_0";[22m
[2m  function useFoo(props) {[22m
[2m    const $0 = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const c_00 = $0[0] !== props.value;[22m
[2m    let t1;[22m
[2m    if (c_00) {[22m
[2m      const a = {[22m
[2m        foo() {[22m
[2m          const b = {[22m
[2m            bar() {[22m
[2m              console.log($);[22m
[2m              console.log(t0);[22m
[2m              console.log(c_0);[22m
[2m              return identity(props.value);[22m
[2m            },[22m
[2m          };[22m
[2m          return b;[22m
[2m        },[22m
[2m      };[22m

[2m      t1 = a.foo().bar();[22m
[2m      $0[0] = props.value;[22m
[2m      $0[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $0[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m
[2m  logs: ['module_$','module_t0','module_c_0'][22m

[31m[1mFAIL:[22m[39m rename-source-variables-nested-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableChangeVariableCodegen[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  const $ = 'module_$';[22m
[2m  const t0 = 'module_t0';[22m
[2m  const c_0 = 'module_c_0';[22m
[2m  function useFoo(props: {value: number}): number {[22m
[2m    const a = () => {[22m
[2m      const b = () => {[22m
[2m        const c = () => {[22m
[2m          console.log($);[22m
[2m          console.log(t0);[22m
[2m          console.log(c_0);[22m
[2m          return identity(props.value);[22m
[2m        };[22m
[2m        return c;[22m
[2m      };[22m
[2m      return b;[22m
[2m    };[22m
[2m    return a()()();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableChangeVariableCodegen[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const $ = "module_$";[22m
[2m  const t0 = "module_t0";[22m
[2m  const c_0 = "module_c_0";[22m
[2m  function useFoo(props) {[22m
[2m    const $0 = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    const c_00 = $0[0] !== props.value;[22m
[2m    let t1;[22m
[2m    if (c_00) {[22m
[2m      t1 = () => {[22m
[2m        const b = () => {[22m
[2m          const c = () => {[22m
[2m            console.log($);[22m
[2m            console.log(t0);[22m
[2m            console.log(c_0);[22m
[2m            return identity(props.value);[22m
[2m          };[22m
[2m          return c;[22m
[2m        };[22m
[2m        return b;[22m
[2m      };[22m
[2m      $0[0] = props.value;[22m
[2m      $0[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $0[1];[22m
[2m    }[22m
[2m    const a = t1;[22m
[2m    const c_2 = $0[2] !== a;[22m
[2m    let t2;[22m
[2m    if (c_2) {[22m
[2m      t2 = a()()();[22m
[2m      $0[2] = a;[22m
[2m      $0[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $0[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m
[2m  logs: ['module_$','module_t0','module_c_0'][22m

[31m[1mFAIL:[22m[39m regexp-literal
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const pattern = /foo/g;[22m
[2m    const value = makeValue();[22m
[2m    // We treat RegExp instances as mutable objects (bc they are)[22m
[2m    // so by default we assume this could be mutating `value`:[22m
[2m    if (pattern.test(value)) {[22m
[2m      return <div>{value}</div>;[22m
[2m    }[22m
[2m    return <div>Default</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let value;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const pattern = /foo/g;[22m
[2m      value = makeValue();[22m

[2m      t0 = pattern.test(value);[22m
[2m      $[0] = t0;[22m
[2m      $[1] = value;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      value = $[1];[22m
[2m    }[22m
[2m    if (t0) {[22m
[2m      let t1;[22m
[2m      if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t1 = <div>{value}</div>;[22m
[2m        $[2] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[2];[22m
[2m      }[22m
[2m      return t1;[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = <div>Default</div>;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-parameter-mutate-in-effect
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>foo</div>
Forget:
(kind: exception) Cannot add property current, object is not extensible

[31m[1mFAIL:[22m[39m ref-like-name-in-useCallback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableTreatRefLikeIdentifiersAsRefs @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useRef, useCallback} from 'react';[22m

[2m  function useCustomRef() {[22m
[2m    return useRef({click: () => {}});[22m
[2m  }[22m

[2m  function Foo() {[22m
[2m    const customRef = useCustomRef();[22m

[2m    const onClick = useCallback(() => {[22m
[2m      customRef.current?.click();[22m
[2m    }, []);[22m

[2m    return <button onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableTreatRefLikeIdentifiersAsRefs @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useRef, useCallback } from "react";[22m

[2m  function useCustomRef() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { click: _temp };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   return useRef(t0);[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  function Foo() {[22m
[2m    const $ = _c(3);[22m
[32m-   const customRef = useCustomRef();[39m
[31m+   const customRef = (function () {[39m
[31m+     const $res$ = useCustomRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        customRef.current?.click();[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== onClick) {[22m
[32m-     t1 = <button onClick={onClick} />;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = onClick;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <button></button>[22m

[31m[1mFAIL:[22m[39m ref-like-name-in-useCallback-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableTreatRefLikeIdentifiersAsRefs @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useRef, useCallback} from 'react';[22m

[2m  function useCustomRef() {[22m
[2m    return useRef({click: () => {}});[22m
[2m  }[22m

[2m  function Foo() {[22m
[2m    const ref = useCustomRef();[22m

[2m    const onClick = useCallback(() => {[22m
[2m      ref.current?.click();[22m
[2m    }, []);[22m

[2m    return <button onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableTreatRefLikeIdentifiersAsRefs @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useRef, useCallback } from "react";[22m

[2m  function useCustomRef() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { click: _temp };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   return useRef(t0);[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  function Foo() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useCustomRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useCustomRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        ref.current?.click();[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== onClick) {[22m
[32m-     t1 = <button onClick={onClick} />;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = onClick;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <button></button>[22m

[31m[1mFAIL:[22m[39m ref-like-name-in-effect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableTreatRefLikeIdentifiersAsRefs @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useRef, useEffect} from 'react';[22m

[2m  function useCustomRef() {[22m
[2m    return useRef({click: () => {}});[22m
[2m  }[22m

[2m  function Foo() {[22m
[2m    const ref = useCustomRef();[22m

[2m    useEffect(() => {[22m
[2m      ref.current?.click();[22m
[2m    }, []);[22m

[2m    return <div>foo</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableTreatRefLikeIdentifiersAsRefs @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useRef, useEffect } from "react";[22m

[2m  function useCustomRef() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { click: _temp };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   return useRef(t0);[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  function Foo() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useCustomRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useCustomRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        ref.current?.click();[22m
[2m      };[22m
[2m      t1 = [];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[32m-   useEffect(t0, t1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t0), Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = <div>foo</div>;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>foo</div>[22m

[31m[1mFAIL:[22m[39m ref-in-effect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const ref = useRef(null);[22m
[2m    const onChange = e => {[22m
[2m      const newValue = e.target.value ?? ref.current;[22m
[2m      ref.current = newValue;[22m
[2m    };[22m
[2m    useEffect(() => {[22m
[2m      console.log(ref.current);[22m
[2m    });[22m
[2m    return <Foo onChange={onChange} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const ref = useRef(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = (e) => {[22m
[2m        const newValue = e.target.value ?? ref.current;[22m
[2m        ref.current = newValue;[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onChange = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = () => {[22m
[2m        console.log(ref.current);[22m
[2m      };[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[32m-   useEffect(t1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    if ($[2] !== onChange) {[22m
[32m-     t2 = <Foo onChange={onChange} />;[39m
[31m+     t2 = ([39m
[31m+       <Foo[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = onChange;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-write-not-added-to-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function VideoTab() {[22m
[2m    const ref = useRef();[22m
[2m    let x = () => {[22m
[2m      ref.current = 1;[22m
[2m    };[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function VideoTab() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        ref.current = 1;[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== x) {[22m
[32m-     t1 = <VideoList videos={x} />;[39m
[31m+     t1 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-optional-field-no-added-to-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function VideoTab() {[22m
[2m    const ref = useRef();[22m
[2m    let x = () => {[22m
[2m      ref.current?.x;[22m
[2m    };[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function VideoTab() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        ref.current?.x;[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== x) {[22m
[32m-     t1 = <VideoList videos={x} />;[39m
[31m+     t1 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-not-added-to-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function VideoTab() {[22m
[2m    const ref = useRef();[22m
[2m    let x = () => {[22m
[2m      console.log(ref.current);[22m
[2m    };[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function VideoTab() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        console.log(ref.current);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== x) {[22m
[32m-     t1 = <VideoList videos={x} />;[39m
[31m+     t1 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-not-added-to-dep-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender:false[22m
[2m  function Foo({a}) {[22m
[2m    const ref = useRef();[22m
[2m    const x = {a, val: ref.current};[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender:false[22m
[2m  function Foo(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a } = t0;[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = { a, val: ref.current };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== x) {[22m
[32m-     t2 = <VideoList videos={x} />;[39m
[31m+     t2 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = x;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-field-write-not-added-to-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useRef} from 'react';[22m

[2m  function Component() {[22m
[2m    const ref = useRef({text: {value: null}});[22m
[2m    const inputChanged = e => {[22m
[2m      ref.current.text.value = e.target.value;[22m
[2m    };[22m

[2m    return <input onChange={inputChanged} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useRef } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(4);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { text: { value: null } };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   const ref = useRef(t0);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = (e) => {[22m
[2m        ref.current.text.value = e.target.value;[22m
[2m      };[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const inputChanged = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== inputChanged) {[22m
[32m-     t2 = <input onChange={inputChanged} />;[39m
[31m+     t2 = ([39m
[31m+       <input[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = inputChanged;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = inputChanged;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input>[22m

[31m[1mFAIL:[22m[39m ref-current-field-not-added-to-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender false[22m
[2m  function VideoTab() {[22m
[2m    const ref = useRef();[22m
[2m    let x = () => {[22m
[2m      console.log(ref.current.x);[22m
[2m    };[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender false[22m
[2m  function VideoTab() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        console.log(ref.current.x);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== x) {[22m
[32m-     t1 = <VideoList videos={x} />;[39m
[31m+     t1 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-aliased-not-added-to-dep-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender:false[22m
[2m  function Foo({a}) {[22m
[2m    const ref = useRef();[22m
[2m    const val = ref.current;[22m
[2m    const x = {a, val};[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender:false[22m
[2m  function Foo(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a } = t0;[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const val = ref.current;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = { a, val };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== x) {[22m
[32m-     t2 = <VideoList videos={x} />;[39m
[31m+     t2 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = x;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m ref-current-aliased-no-added-to-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender false[22m
[2m  function VideoTab() {[22m
[2m    const ref = useRef();[22m
[2m    const t = ref.current;[22m
[2m    let x = () => {[22m
[2m      console.log(t);[22m
[2m    };[22m

[2m    return <VideoList videos={x} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender false[22m
[2m  function VideoTab() {[22m
[2m    const $ = _c(3);[22m
[32m-   const ref = useRef();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const t = ref.current;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        console.log(t);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== x) {[22m
[32m-     t1 = <VideoList videos={x} />;[39m
[31m+     t1 = ([39m
[31m+       <VideoList[39m
[31m+         videos={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reduce-reactive-cond-deps-return-in-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({obj, objIsNull}) {[22m
[2m    const x = [];[22m
[2m    if (objIsNull) {[22m
[2m      return;[22m
[2m    } else {[22m
[2m      x.push(obj.a);[22m
[2m    }[22m
[2m    x.push(obj.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{obj: null, objIsNull: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {obj: null, objIsNull: true},[22m
[2m      {obj: {a: 2}, objIsNull: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { obj, objIsNull } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== objIsNull || $[1] !== obj) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (objIsNull) {[22m
[2m          t1 = undefined;[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          x.push(obj.a);[22m
[2m        }[22m

[2m        x.push(obj.b);[22m
[2m      }[22m
[2m      $[0] = objIsNull;[22m
[2m      $[1] = obj;[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ obj: null, objIsNull: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { obj: null, objIsNull: true },[22m
[2m      { obj: { a: 2 }, objIsNull: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m
[2m  [2,null][22m

[31m[1mFAIL:[22m[39m reduce-reactive-cond-deps-cfg-nested-testifelse
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {setProperty} from 'shared-runtime';[22m

[2m  function useFoo({o, branchCheck}: {o: {value: number}; branchCheck: boolean}) {[22m
[2m    let x = {};[22m
[2m    if (branchCheck) {[22m
[2m      setProperty(x, o.value);[22m
[2m    } else {[22m
[2m      if (o.value) {[22m
[2m        setProperty(x, o.value);[22m
[2m      } else {[22m
[2m        setProperty(x, o.value);[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{o: {value: 2}, branchCheck: false}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { setProperty } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { o, branchCheck } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== branchCheck || $[1] !== o.value) {[22m
[2m      x = {};[22m
[2m      if (branchCheck) {[22m
[2m        setProperty(x, o.value);[22m
[2m      } else {[22m
[2m        if (o.value) {[22m
[2m          setProperty(x, o.value);[22m
[2m        } else {[22m
[2m          setProperty(x, o.value);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = branchCheck;[22m
[2m      $[1] = o.value;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ o: { value: 2 }, branchCheck: false }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"wat0":2}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-cond-deps-break-in-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({obj, objIsNull}) {[22m
[2m    const x = [];[22m
[2m    b0: {[22m
[2m      if (objIsNull) {[22m
[2m        break b0;[22m
[2m      } else {[22m
[2m        x.push(obj.a);[22m
[2m      }[22m
[2m      x.push(obj.b);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{obj: null, objIsNull: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {obj: null, objIsNull: true},[22m
[2m      {obj: {a: 2}, objIsNull: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { obj, objIsNull } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== objIsNull || $[1] !== obj) {[22m
[2m      x = [];[22m
[2m      bb0: {[22m
[2m        if (objIsNull) {[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          x.push(obj.a);[22m
[2m        }[22m

[2m        x.push(obj.b);[22m
[2m      }[22m
[2m      $[0] = objIsNull;[22m
[2m      $[1] = obj;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ obj: null, objIsNull: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { obj: null, objIsNull: true },[22m
[2m      { obj: { a: 2 }, objIsNull: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m
[2m  [2,null][22m

[31m[1mFAIL:[22m[39m recursive-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(x) {[22m
[2m    if (x <= 0) {[22m
[2m      return 0;[22m
[2m    }[22m
[2m    return x + foo(x - 1) + (() => foo(x - 2))();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [10],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(x) {[22m
[31m+   Object.freeze(x);[39m
[2m    if (x <= 0) {[22m
[2m      return 0;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    t0 = foo(x - 2);[22m
[2m    return x + foo(x - 1) + t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [10],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 364[22m

[31m[1mFAIL:[22m[39m reassignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.p0);[22m
[2m    let y = x;[22m

[2m    x = [];[22m
[2m    let _ = <Component x={x} />;[22m

[2m    y.push(props.p1);[22m

[2m    return <Component x={x} y={y} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.p0 || $[1] !== props.p1) {[22m
[2m      let x = [];[22m
[2m      x.push(props.p0);[22m
[2m      const y = x;[22m
[2m      let t1;[22m
[2m      if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t1 = [];[22m
[2m        $[3] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[3];[22m
[2m      }[22m
[2m      x = t1;[22m

[2m      y.push(props.p1);[22m

[32m-     t0 = <Component x={x} y={y} />;[39m
[31m+     t0 = ([39m
[31m+       <Component[39m
[31m+         x={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         y={function () {[39m
[31m+           const $res$ = y;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props.p0;[22m
[2m      $[1] = props.p1;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reassignment-separate-scopes
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = [];[22m
[2m    if (a) {[22m
[2m      x.push(a);[22m
[2m    }[22m
[2m    let y = <div>{x}</div>;[22m

[2m    switch (b) {[22m
[2m      case 0: {[22m
[2m        x = [];[22m
[2m        x.push(b);[22m
[2m        break;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = [];[22m
[2m        x.push(c);[22m
[2m      }[22m
[2m    }[22m
[2m    return ([22m
[2m      <div>[22m
[2m        {y}[22m
[2m        {x}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(10);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        x.push(a);[22m
[2m      }[22m

[2m      t0 = <div>{x}</div>;[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    bb0: switch (b) {[22m
[2m      case 0: {[22m
[2m        if ($[3] !== b) {[22m
[2m          x = [];[22m
[2m          x.push(b);[22m
[2m          $[3] = b;[22m
[2m          $[4] = x;[22m
[2m        } else {[22m
[2m          x = $[4];[22m
[2m        }[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      default: {[22m
[2m        if ($[5] !== c) {[22m
[2m          x = [];[22m
[2m          x.push(c);[22m
[2m          $[5] = c;[22m
[2m          $[6] = x;[22m
[2m        } else {[22m
[2m          x = $[6];[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[7] !== y || $[8] !== x) {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          {y}[22m
[2m          {x}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[7] = y;[22m
[2m      $[8] = x;[22m
[2m      $[9] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[9];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reassignment-conditional
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.p0);[22m
[2m    let y = x;[22m

[2m    if (props.p1) {[22m
[2m      x = [];[22m
[2m    }[22m

[2m    y.push(props.p2);[22m

[2m    return <Component x={x} y={y} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.p0 || $[1] !== props.p1 || $[2] !== props.p2) {[22m
[2m      let x = [];[22m
[2m      x.push(props.p0);[22m
[2m      const y = x;[22m
[2m      if (props.p1) {[22m
[2m        let t1;[22m
[2m        if ($[4] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t1 = [];[22m
[2m          $[4] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[4];[22m
[2m        }[22m
[2m        x = t1;[22m
[2m      }[22m

[2m      y.push(props.p2);[22m

[32m-     t0 = <Component x={x} y={y} />;[39m
[31m+     t0 = ([39m
[31m+       <Component[39m
[31m+         x={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         y={function () {[39m
[31m+           const $res$ = y;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props.p0;[22m
[2m      $[1] = props.p1;[22m
[2m      $[2] = props.p2;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reassigned-phi-in-returned-function-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return () => {[22m
[2m      let str;[22m
[2m      if (arguments.length) {[22m
[2m        str = arguments[0];[22m
[2m      } else {[22m
[2m        str = props.str;[22m
[2m      }[22m
[2m      global.log(str);[22m
[2m    };[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.str) {[22m
[2m      t0 = () => {[22m
[2m        let str;[22m
[2m        if (arguments.length) {[22m
[2m          str = arguments[0];[22m
[2m        } else {[22m
[2m          str = props.str;[22m
[2m        }[22m

[2m        global.log(str);[22m
[2m      };[22m
[2m      $[0] = props.str;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reassign-primitive-in-context
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 5;[22m
[2m    let foo = () => {[22m
[2m      x = {};[22m
[2m    };[22m
[2m    foo();[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x = 5;[22m
[2m      const foo = () => {[22m
[2m        x = {};[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m

[31m[1mFAIL:[22m[39m reassign-object-in-context
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    let foo = () => {[22m
[2m      x = {};[22m
[2m    };[22m
[2m    foo();[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x = [];[22m
[2m      const foo = () => {[22m
[2m        x = {};[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reassign-global-hook-arg
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  let b = 1;[22m

[2m  export default function MyApp() {[22m
[2m    const fn = () => {[22m
[2m      b = 2;[22m
[2m    };[22m
[2m    return useFoo(fn);[22m
[2m  }[22m

[2m  function useFoo(fn) {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  let b = 1;[22m

[2m  export default function MyApp() {[22m
[2m    const fn = _temp;[22m
[32m-   return useFoo(fn);[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useFoo(Object.freeze(fn));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {[22m
[2m    b = 2;[22m
[2m  }[22m

[32m- function useFoo(fn) {}[39m
[31m+ function useFoo(fn) {[39m
[31m+   Object.freeze(fn);[39m
[31m+ }[39m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m reanimated-no-memo-arg
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableCustomTypeDefinitionForReanimated[22m
[2m  function Component() {[22m
[2m    const radius = useSharedValue(50);[22m

[2m    const animatedProps = useAnimatedProps(() => {[22m
[2m      // draw a circle[22m
[2m      const path = `[22m
[2m      M 100, 100[22m
[2m      m -${radius.value}, 0[22m
[2m      a ${radius.value},${radius.value} 0 1,0 ${radius.value * 2},0[22m
[2m      a ${radius.value},${radius.value} 0 1,0 ${-radius.value * 2},0[22m
[2m      `;[22m
[2m      return {[22m
[2m        d: path,[22m
[2m      };[22m
[2m    });[22m

[2m    // attach animated props to an SVG path using animatedProps[22m
[2m    return ([22m
[2m      <Svg>[22m
[2m        <AnimatedPath animatedProps={animatedProps} fill="black" />[22m
[2m      </Svg>[22m
[2m    );[22m
[2m  }[22m
[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableCustomTypeDefinitionForReanimated[22m
[2m  function Component() {[22m
[2m    const $ = _c(2);[22m
[32m-   const radius = useSharedValue(50);[39m
[31m+   const radius = (function () {[39m
[31m+     const $res$ = useSharedValue(Object.freeze(50));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[32m-   const animatedProps = useAnimatedProps(() => {[39m
[32m-     const path = `[39m
[31m+   const animatedProps = (function () {[39m
[31m+     const $res$ = useAnimatedProps([39m
[31m+       Object.freeze(() => {[39m
[31m+         const path = `[39m
[2m      M 100, 100[22m
[2m      m -${radius.value}, 0[22m
[2m      a ${radius.value},${radius.value} 0 1,0 ${radius.value * 2},0[22m
[2m      a ${radius.value},${radius.value} 0 1,0 ${-radius.value * 2},0[22m
[2m      `;[22m
[32m-     return { d: path };[39m
[32m-   });[39m
[31m+         return { d: path };[39m
[31m+       }),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== animatedProps) {[22m
[2m      t0 = ([22m
[2m        <Svg>[22m
[32m-         <AnimatedPath animatedProps={animatedProps} fill="black" />[39m
[31m+         <AnimatedPath[39m
[31m+           animatedProps={function () {[39m
[31m+             const $res$ = animatedProps;[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+           fill="black"[39m
[31m+         />[39m
[2m        </Svg>[22m
[2m      );[22m
[2m      $[0] = animatedProps;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m readonly-object-method-calls
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const user = useFragment([22m
[2m      graphql`[22m
[2m        fragment Component_user on User {[22m
[2m          name[22m
[2m        }[22m
[2m      `,[22m
[2m      props.user[22m
[2m    );[22m
[2m    const posts = user.timeline.posts.edges.nodes.map(node => ([22m
[2m      <Post post={node} />[22m
[2m    ));[22m
[2m    posts.push({});[22m
[2m    const count = posts.length;[22m
[2m    foo(count);[22m
[2m    return <>{posts}</>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[32m-   const user = useFragment([39m
[32m-     graphql`[39m
[32m-       fragment Component_user on User {[39m
[32m-         name[39m
[32m-       }[39m
[32m-     `,[39m
[32m-     props.user,[39m
[32m-   );[39m
[31m+   Object.freeze(props);[39m
[31m+   const user = (function () {[39m
[31m+     const $res$ = useFragment([39m
[31m+       Object.freeze(graphql`[39m
[31m+         fragment Component_user on User {[39m
[31m+           name[39m
[31m+         }[39m
[31m+       `),[39m
[31m+       Object.freeze(props.user),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let posts;[22m
[2m    if ($[0] !== user.timeline.posts.edges.nodes) {[22m
[2m      posts = user.timeline.posts.edges.nodes.map(_temp);[22m
[2m      let t0;[22m
[2m      if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t0 = {};[22m
[2m        $[2] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[2];[22m
[2m      }[22m
[2m      posts.push(t0);[22m
[2m      $[0] = user.timeline.posts.edges.nodes;[22m
[2m      $[1] = posts;[22m
[2m    } else {[22m
[2m      posts = $[1];[22m
[2m    }[22m
[2m    const count = posts.length;[22m
[2m    foo(count);[22m
[2m    let t0;[22m
[2m    if ($[3] !== posts) {[22m
[2m      t0 = <>{posts}</>;[22m
[2m      $[3] = posts;[22m
[2m      $[4] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[4];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp(node) {[22m
[32m-   return <Post post={node} />;[39m
[31m+   return ([39m
[31m+     <Post[39m
[31m+       post={function () {[39m
[31m+         const $res$ = node;[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[31m+       }}[39m
[31m+     />[39m
[31m+   );[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m readonly-object-method-calls-mutable-lambda
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeObject();[22m
[2m    const user = useFragment([22m
[2m      graphql`[22m
[2m        fragment Component_user on User {[22m
[2m          name[22m
[2m        }[22m
[2m      `,[22m
[2m      props.user[22m
[2m    );[22m
[2m    const posts = user.timeline.posts.edges.nodes.map(node => {[22m
[2m      x.y = true;[22m
[2m      return <Post post={node} />;[22m
[2m    });[22m
[2m    posts.push({});[22m
[2m    const count = posts.length;[22m
[2m    foo(count);[22m
[2m    return <>{posts}</>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    const x = makeObject();[22m
[32m-   const user = useFragment([39m
[32m-     graphql`[39m
[32m-       fragment Component_user on User {[39m
[32m-         name[39m
[32m-       }[39m
[32m-     `,[39m
[32m-     props.user,[39m
[32m-   );[39m
[31m+   const user = (function () {[39m
[31m+     const $res$ = useFragment([39m
[31m+       Object.freeze(graphql`[39m
[31m+         fragment Component_user on User {[39m
[31m+           name[39m
[31m+         }[39m
[31m+       `),[39m
[31m+       Object.freeze(props.user),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const posts = user.timeline.posts.edges.nodes.map((node) => {[22m
[2m      x.y = true;[22m
[32m-     return <Post post={node} />;[39m
[31m+     return ([39m
[31m+       <Post[39m
[31m+         post={function () {[39m
[31m+           const $res$ = node;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m    });[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    posts.push(t0);[22m
[2m    const count = posts.length;[22m
[2m    foo(count);[22m
[2m    let t1;[22m
[2m    if ($[1] !== posts) {[22m
[2m      t1 = <>{posts}</>;[22m
[2m      $[1] = posts;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactivity-via-readonly-alias-of-mutable-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const y = x;[22m

[2m    // y isn't reactive yet when we first visit this, so z is initially non-reactive[22m
[2m    const z = [y];[22m

[2m    // then we realize y is reactive. we need a fixpoint to propagate this back to z[22m
[2m    y.push(props.input);[22m

[2m    // PruneNonReactiveDependencies partially propagates reactivity (for now) which[22m
[2m    // we bypass with an indirection of storing into another variable[22m
[2m    const a = [z];[22m

[2m    // b's value is conditional on `a`, which is reactive per above[22m
[2m    let b = 0;[22m
[2m    if (a[0][0][0] === 42) {[22m
[2m      b = 1;[22m
[2m    }[22m

[2m    return [b];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {input: 42},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [];[22m
[2m    const y = x;[22m

[2m    const z = [y];[22m

[2m    y.push(props.input);[22m

[2m    const a = [z];[22m

[2m    let b = 0;[22m
[2m    if (a[0][0][0] === 42) {[22m
[2m      b = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== b) {[22m
[2m      t0 = [b];[22m
[2m      $[0] = b;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { input: 42 },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m      { input: "sathya" },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [0][22m
[2m  [0][22m
[2m  [1][22m
[2m  [0][22m
[2m  [1][22m
[2m  [0][22m

[31m[1mFAIL:[22m[39m reactivity-via-aliased-mutation-through-property-load
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = [];[22m
[2m    x.y = y;[22m
[2m    x.y.push(props.input);[22m

[2m    let z = 0;[22m
[2m    if (x.y[0]) {[22m
[2m      z = 1;[22m
[2m    }[22m

[2m    return [z];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {input: true},[22m
[2m      {input: true},[22m
[2m      {input: false},[22m
[2m      {input: false},[22m
[2m      {input: true},[22m
[2m      {input: false},[22m
[2m      {input: true},[22m
[2m      {input: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const x = {};[22m
[2m    const y = [];[22m
[2m    x.y = y;[22m
[2m    x.y.push(props.input);[22m

[2m    let z = 0;[22m
[2m    if (x.y[0]) {[22m
[2m      z = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== z) {[22m
[2m      t0 = [z];[22m
[2m      $[0] = z;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { input: true },[22m
[2m      { input: true },[22m
[2m      { input: false },[22m
[2m      { input: false },[22m
[2m      { input: true },[22m
[2m      { input: false },[22m
[2m      { input: true },[22m
[2m      { input: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [0][22m
[2m  [0][22m
[2m  [1][22m
[2m  [0][22m
[2m  [1][22m
[2m  [0][22m

[31m[1mFAIL:[22m[39m reactivity-via-aliased-mutation-lambda
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const f = arg => {[22m
[2m      const y = x;[22m
[2m      y.push(arg);[22m
[2m    };[22m
[2m    f(props.input);[22m

[2m    return [x[0]];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {input: 42},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.input) {[22m
[2m      x = [];[22m
[2m      const f = (arg) => {[22m
[2m        const y = x;[22m
[2m        y.push(arg);[22m
[2m      };[22m

[2m      f(props.input);[22m
[2m      $[0] = props.input;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m

[2m    const t0 = x[0];[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { input: 42 },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m      { input: "sathya" },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m
[2m  [42][22m
[2m  ["sathya"][22m
[2m  ["sathya"][22m
[2m  [42][22m
[2m  ["sathya"][22m
[2m  [42][22m
[2m  ["sathya"][22m

[31m[1mFAIL:[22m[39m reactivity-via-aliased-mutation-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const y = x;[22m
[2m    y.push(props.input);[22m

[2m    return [x[0]];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {input: 42},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m      {input: 42},[22m
[2m      {input: 'sathya'},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.input) {[22m
[2m      x = [];[22m
[2m      const y = x;[22m
[2m      y.push(props.input);[22m
[2m      $[0] = props.input;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m

[2m    const t0 = x[0];[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { input: 42 },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m      { input: "sathya" },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m      { input: 42 },[22m
[2m      { input: "sathya" },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m
[2m  [42][22m
[2m  ["sathya"][22m
[2m  ["sathya"][22m
[2m  [42][22m
[2m  ["sathya"][22m
[2m  [42][22m
[2m  ["sathya"][22m

[31m[1mFAIL:[22m[39m reactivity-analysis-reactive-via-mutation-of-property-load
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = bar();[22m
[2m    mutate(items.a, props.a);[22m

[2m    const count = foo(items.length + 1);[22m

[2m    return {items, count};[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      items = bar();[22m
[2m      mutate(items.a, props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = items;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m    }[22m

[2m    const t0 = items.length + 1;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = foo(t0);[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const count = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== items || $[5] !== count) {[22m
[2m      t2 = { items, count };[22m
[2m      $[4] = items;[22m
[2m      $[5] = count;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactivity-analysis-reactive-via-mutation-of-computed-load
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = bar();[22m
[2m    mutate(items[props.key], props.a);[22m

[2m    const count = foo(items.length + 1);[22m

[2m    return {items, count};[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] !== props.key || $[1] !== props.a) {[22m
[2m      items = bar();[22m
[2m      mutate(items[props.key], props.a);[22m
[2m      $[0] = props.key;[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = items;[22m
[2m    } else {[22m
[2m      items = $[2];[22m
[2m    }[22m

[2m    const t0 = items.length + 1;[22m
[2m    let t1;[22m
[2m    if ($[3] !== t0) {[22m
[2m      t1 = foo(t0);[22m
[2m      $[3] = t0;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const count = t1;[22m
[2m    let t2;[22m
[2m    if ($[5] !== items || $[6] !== count) {[22m
[2m      t2 = { items, count };[22m
[2m      $[5] = items;[22m
[2m      $[6] = count;[22m
[2m      $[7] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[7];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactivity-analysis-interleaved-reactivity
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are technically independent, but their mutation is interleaved[22m
[2m    // so they are grouped in a single reactive scope. a does not have any[22m
[2m    // reactive inputs, but b does. therefore, we have to treat a as reactive,[22m
[2m    // since it will be recreated based on a reactive input.[22m
[2m    const a = {};[22m
[2m    const b = [];[22m
[2m    b.push(props.b);[22m
[2m    a.a = null;[22m

[2m    // because a may recreate when b does, it becomes reactive. we have to recreate[22m
[2m    // c if a changes.[22m
[2m    const c = [a];[22m

[2m    // Example usage that could fail if we didn't treat a as reactive:[22m
[2m    //  const [c, a] = Component({b: ...});[22m
[2m    //  assert(c[0] === a);[22m
[2m    return [c, a];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.b) {[22m
[2m      a = {};[22m
[2m      const b = [];[22m
[2m      b.push(props.b);[22m
[2m      a.a = null;[22m

[2m      t0 = [a];[22m
[2m      $[0] = props.b;[22m
[2m      $[1] = a;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const c = t0;[22m
[2m    let t1;[22m
[2m    if ($[3] !== c || $[4] !== a) {[22m
[2m      t1 = [c, a];[22m
[2m      $[3] = c;[22m
[2m      $[4] = a;[22m
[2m      $[5] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[5];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactive-scopes
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function f(a, b) {[22m
[2m    let x = []; // <- x starts being mutable here.[22m
[2m    if (a.length === 1) {[22m
[2m      if (b) {[22m
[2m        x.push(b); // <- x stops being mutable here.[22m
[2m      }[22m
[2m    }[22m

[2m    return <div>{x}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function f(a, b) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a.length || $[1] !== b) {[22m
[2m      const x = [];[22m
[2m      if (a.length === 1) {[22m
[2m        if (b) {[22m
[2m          x.push(b);[22m
[2m        }[22m
[2m      }[22m

[2m      t0 = <div>{x}</div>;[22m
[2m      $[0] = a.length;[22m
[2m      $[1] = b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactive-scopes-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const x = [];[22m
[2m    if (a) {[22m
[2m      const y = [];[22m
[2m      y.push(b);[22m
[2m      x.push(<div>{y}</div>);[22m
[2m    } else {[22m
[2m      x.push(c);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        let y;[22m
[2m        if ($[4] !== b) {[22m
[2m          y = [];[22m
[2m          y.push(b);[22m
[2m          $[4] = b;[22m
[2m          $[5] = y;[22m
[2m        } else {[22m
[2m          y = $[5];[22m
[2m        }[22m
[2m        let t0;[22m
[2m        if ($[6] !== y) {[22m
[2m          t0 = <div>{y}</div>;[22m
[2m          $[6] = y;[22m
[2m          $[7] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[7];[22m
[2m        }[22m
[2m        x.push(t0);[22m
[2m      } else {[22m
[2m        x.push(c);[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactive-dependency-object-captured-with-reactive-mutated
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = props.y;[22m
[2m    const z = [x, y];[22m
[2m    mutate(z);[22m
[2m    // x's object identity can change bc it co-mutates with z, which is reactive via props.y[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{y: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.y) {[22m
[2m      const x = {};[22m
[2m      const y = props.y;[22m
[2m      const z = [x, y];[22m
[2m      mutate(z);[22m

[2m      t0 = [x];[22m
[2m      $[0] = props.y;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ y: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{}][22m

[31m[1mFAIL:[22m[39m reactive-dependency-nonreactive-captured-with-reactive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = props.y;[22m
[2m    return [x, y]; // x is captured here along with a reactive value. this shouldn't make `x` reactive![22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{y: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    const y = props.y;[22m
[2m    let t1;[22m
[2m    if ($[1] !== y) {[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = y;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ y: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{},42][22m

[31m[1mFAIL:[22m[39m reactive-dependency-fixpoint
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    let y = 0;[22m

[2m    while (x === 0) {[22m
[2m      x = y;[22m
[2m      y = props.value;[22m
[2m    }[22m

[2m    // x and y initially start out with non-reactive values,[22m
[2m    // but after an iteration of the loop y becomes reactive,[22m
[2m    // and this reactive value then flows into x on the next[22m
[2m    // loop iteration, making x reactive.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    let y = 0;[22m
[2m    while (x === 0) {[22m
[2m      x = y;[22m
[2m      y = props.value;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m

[31m[1mFAIL:[22m[39m reactive-dependencies-non-optional-properties-inside-optional-chain
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return props.post.feedback.comments?.edges?.map(render);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.post.feedback.comments) {[22m
[2m      t0 = props.post.feedback.comments?.edges?.map(render);[22m
[2m      $[0] = props.post.feedback.comments;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-while-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    let i = 0;[22m
[2m    while (i < props.test) {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m      i++;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose value is affected by[22m
[2m    // `props.test` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {test: 12},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m      {test: 1},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let i = 0;[22m
[2m    while (i < props.test) {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m

[2m      i++;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { test: 12 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m      { test: 1 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [10][22m
[2m  [10][22m
[2m  [1][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-via-mutation-switch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // x is mutated conditionally based on a reactive value,[22m
[2m    // so it needs to be considered reactive[22m
[2m    let x = [];[22m
[2m    if (props.cond) {[22m
[2m      x.push(1);[22m
[2m    }[22m
[2m    // Since x is reactive, y is now reactively controlled too:[22m
[2m    let y = false;[22m
[2m    switch (x[0]) {[22m
[2m      case 1: {[22m
[2m        y = true;[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    // Thus this value should be reactive on `y`:[22m
[2m    return [y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m

[2m    const x = [];[22m
[2m    if (props.cond) {[22m
[2m      x.push(1);[22m
[2m    }[22m

[2m    let y = false;[22m
[2m    switch (x[0]) {[22m
[2m      case 1: {[22m
[2m        y = true;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== y) {[22m
[2m      t0 = [y];[22m
[2m      $[0] = y;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [true][22m
[2m  [true][22m
[2m  [false][22m
[2m  [false][22m
[2m  [true][22m
[2m  [false][22m
[2m  [true][22m
[2m  [false][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-via-mutation-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // x is mutated conditionally based on a reactive value,[22m
[2m    // so it needs to be considered reactive[22m
[2m    let x = [];[22m
[2m    if (props.cond) {[22m
[2m      x.push(1);[22m
[2m    }[22m
[2m    // Since x is reactive, y is now reactively controlled too:[22m
[2m    let y = false;[22m
[2m    if (x[0]) {[22m
[2m      y = true;[22m
[2m    }[22m
[2m    // Thus this value should be reactive on `y`:[22m
[2m    return [y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m

[2m    const x = [];[22m
[2m    if (props.cond) {[22m
[2m      x.push(1);[22m
[2m    }[22m

[2m    let y = false;[22m
[2m    if (x[0]) {[22m
[2m      y = true;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== y) {[22m
[2m      t0 = [y];[22m
[2m      $[0] = y;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [true][22m
[2m  [true][22m
[2m  [false][22m
[2m  [false][22m
[2m  [true][22m
[2m  [false][22m
[2m  [true][22m
[2m  [false][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-switch-condition
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const GLOBAL = 42;[22m

[2m  function Component({value}) {[22m
[2m    let x;[22m
[2m    switch (GLOBAL) {[22m
[2m      case value: {[22m
[2m        x = 1;[22m
[2m        break;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 2;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `props.value` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {value: GLOBAL},[22m
[2m      {value: GLOBAL},[22m
[2m      {value: null},[22m
[2m      {value: null},[22m
[2m      {value: GLOBAL},[22m
[2m      {value: null},[22m
[2m      {value: GLOBAL},[22m
[2m      {value: null},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const GLOBAL = 42;[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let x;[22m
[2m    bb0: switch (GLOBAL) {[22m
[2m      case value: {[22m
[2m        x = 1;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 2;[22m
[2m      }[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { value: GLOBAL },[22m
[2m      { value: GLOBAL },[22m
[2m      { value: null },[22m
[2m      { value: null },[22m
[2m      { value: GLOBAL },[22m
[2m      { value: null },[22m
[2m      { value: GLOBAL },[22m
[2m      { value: null },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [2][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-switch-case-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    switch (props.cond) {[22m
[2m      case true: {[22m
[2m        x = 1;[22m
[2m        break;[22m
[2m      }[22m
[2m      case false: {[22m
[2m        x = 2;[22m
[2m        break;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 3;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `props.cond` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    bb0: switch (props.cond) {[22m
[2m      case true: {[22m
[2m        x = 1;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      case false: {[22m
[2m        x = 2;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 3;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [2][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-reactive-after-fixpoint
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m

[2m    let value = null;[22m
[2m    loop: for (let i = 0; i < 10; i++) {[22m
[2m      switch (value) {[22m
[2m        case true: {[22m
[2m          x = 1;[22m
[2m          break loop;[22m
[2m        }[22m
[2m        case false: {[22m
[2m          x = 2;[22m
[2m          break loop;[22m
[2m        }[22m
[2m      }[22m

[2m      value = props.cond;[22m
[2m    }[22m

[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `value` used as the switch test[22m
[2m    // condition. That variable is initially null on the first iteration[22m
[2m    // of the loop, but is later set to `props.value` which is reactive.[22m
[2m    // Therefore x should be treated as reactive.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m

[2m    let value = null;[22m
[2m    for (let i = 0; i < 10; i++) {[22m
[2m      switch (value) {[22m
[2m        case true: {[22m
[2m          x = 1;[22m
[2m          break;[22m
[2m        }[22m
[2m        case false: {[22m
[2m          x = 2;[22m
[2m          break;[22m
[2m        }[22m
[2m      }[22m

[2m      value = props.cond;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [2][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-phi-setState-type
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) ok
ok
ok
ok
ok
ok
ok
ok
Forget:
(kind: ok) [[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]
[[ (exception in render) Invariant Violation: Expected the correct setState function ]]

[31m[1mFAIL:[22m[39m reactive-control-dependency-on-context-variable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    // Reassign `x` based on a reactive value, but inside a function expression[22m
[2m    // to make it a context variable[22m
[2m    const f = () => {[22m
[2m      if (props.cond) {[22m
[2m        x = 1;[22m
[2m      } else {[22m
[2m        x = 2;[22m
[2m      }[22m
[2m    };[22m
[2m    // Pass `f` through a function to prevent IIFE inlining optimizations[22m
[2m    const f2 = identity(f);[22m
[2m    f2();[22m

[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `props.cond` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.cond) {[22m
[2m      const f = () => {[22m
[2m        if (props.cond) {[22m
[2m          x = 1;[22m
[2m        } else {[22m
[2m          x = 2;[22m
[2m        }[22m
[2m      };[22m

[2m      const f2 = identity(f);[22m
[2m      f2();[22m
[2m      $[0] = props.cond;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m

[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [2][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    if (props.cond) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `props.cond` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if (props.cond) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [1][22m
[2m  [2][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-while
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    while (c[0][0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    while (c[0][0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-switch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    switch (c[0][0]) {[22m
[2m      case true: {[22m
[2m        x = 1;[22m
[2m        break;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 2;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    bb0: switch (c[0][0]) {[22m
[2m      case true: {[22m
[2m        x = 1;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 2;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    if (c[0][0]) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    if (c[0][0]) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-for-update
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(10);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (let i = 0; i < 10; i += c[0][0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(10);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (let i = 0; i < 10; i = i + c[0][0], i) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-for-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(10);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (let i = 0; i < c[0][0]; i++) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(10);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (let i = 0; i < c[0][0]; i++) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-for-of
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (const i of c[0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(null);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (const i of c[0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-for-init
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(0);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (let i = c[0][0]; i < 10; i++) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(0);[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (let i = c[0][0]; i < 10; i++) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-for-in
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push({a: false});[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (const i in c[0][0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push({ a: false });[22m

[2m    const c = [a];[22m

[2m    let x;[22m
[2m    for (const i in c[0][0]) {[22m
[2m      x = 1;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-from-interleaved-reactivity-do-while
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a and b are independent but their mutations are interleaved, so[22m
[2m    // they get grouped in a reactive scope. this means that a becomes[22m
[2m    // reactive since it will effectively re-evaluate based on a reactive[22m
[2m    // input[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(false);[22m

[2m    // Downstream consumer of a, which initially seems non-reactive except[22m
[2m    // that a becomes reactive, per above[22m
[2m    const c = [a];[22m

[2m    let x = 0;[22m
[2m    do {[22m
[2m      x += 1;[22m
[2m    } while (c[0][0]);[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" value `c[0]` which becomes reactive via[22m
[2m    // being interleaved with `b`.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    b.push(props.cond);[22m
[2m    a.push(false);[22m

[2m    const c = [a];[22m

[2m    let x = 0;[22m
[2m    do {[22m
[2m      x = x + 1;[22m
[2m    } while (c[0][0]);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-forof-collection
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    for (const i of props.values) {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose value is derived from[22m
[2m    // `props.values` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {values: [12]},[22m
[2m      {values: [12]},[22m
[2m      {values: [1]},[22m
[2m      {values: [1]},[22m
[2m      {values: [12]},[22m
[2m      {values: [1]},[22m
[2m      {values: [12]},[22m
[2m      {values: [1]},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    for (const i of props.values) {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { values: [12] },[22m
[2m      { values: [12] },[22m
[2m      { values: [1] },[22m
[2m      { values: [1] },[22m
[2m      { values: [12] },[22m
[2m      { values: [1] },[22m
[2m      { values: [12] },[22m
[2m      { values: [1] },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [10][22m
[2m  [10][22m
[2m  [1][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-forin-collection
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    for (const key in props.values) {[22m
[2m      const i = parseInt(key, 10);[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose value is derived from[22m
[2m    // `props.values` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {values: {'12': true}},[22m
[2m      {values: {'12': true}},[22m
[2m      {values: {'1': true}},[22m
[2m      {values: {'1': true}},[22m
[2m      {values: {'12': true}},[22m
[2m      {values: {'1': true}},[22m
[2m      {values: {'12': true}},[22m
[2m      {values: {'1': true}},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    for (const key in props.values) {[22m
[2m      const i = parseInt(key, 10);[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { values: { "12": true } },[22m
[2m      { values: { "12": true } },[22m
[2m      { values: { "1": true } },[22m
[2m      { values: { "1": true } },[22m
[2m      { values: { "12": true } },[22m
[2m      { values: { "1": true } },[22m
[2m      { values: { "12": true } },[22m
[2m      { values: { "1": true } },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [10][22m
[2m  [10][22m
[2m  [1][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-for-update
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    for (let i = 0; i < 10; i += props.update) {[22m
[2m      if (i > 0 && i % 2 === 0) {[22m
[2m        x = 2;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose possible values are[22m
[2m    // affected by `props.update` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {update: 2},[22m
[2m      {update: 2},[22m
[2m      {update: 1},[22m
[2m      {update: 1},[22m
[2m      {update: 2},[22m
[2m      {update: 1},[22m
[2m      {update: 2},[22m
[2m      {update: 1},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    for (let i = 0; i < 10; i = i + props.update, i) {[22m
[2m      if (i > 0 && i % 2 === 0) {[22m
[2m        x = 2;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { update: 2 },[22m
[2m      { update: 2 },[22m
[2m      { update: 1 },[22m
[2m      { update: 1 },[22m
[2m      { update: 2 },[22m
[2m      { update: 1 },[22m
[2m      { update: 2 },[22m
[2m      { update: 1 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [2][22m
[2m  [1][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m
[2m  [2][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-for-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    for (let i = 0; i < props.test; i++) {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose value is capped by[22m
[2m    // `props.test` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {test: 12},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m      {test: 1},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    for (let i = 0; i < props.test; i++) {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { test: 12 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m      { test: 1 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [10][22m
[2m  [10][22m
[2m  [1][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-for-init
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    for (let i = props.init; i < 10; i++) {[22m
[2m      if (i === 0) {[22m
[2m        x = 0;[22m
[2m        break;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose initial value `props.init` is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {init: 0},[22m
[2m      {init: 0},[22m
[2m      {init: 10},[22m
[2m      {init: 10},[22m
[2m      {init: 0},[22m
[2m      {init: 10},[22m
[2m      {init: 0},[22m
[2m      {init: 10},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    for (const i = props.init; i < 10; ) {[22m
[2m      if (i === 0) {[22m
[2m        x = 0;[22m
[2m        break;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { init: 0 },[22m
[2m      { init: 0 },[22m
[2m      { init: 10 },[22m
[2m      { init: 10 },[22m
[2m      { init: 0 },[22m
[2m      { init: 10 },[22m
[2m      { init: 0 },[22m
[2m      { init: 10 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [0][22m
[2m  [0][22m
[2m  [null][22m
[2m  [null][22m
[2m  [0][22m
[2m  [null][22m
[2m  [0][22m
[2m  [null][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-do-while-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    let i = 0;[22m
[2m    do {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m
[2m      i++;[22m
[2m    } while (i < props.test);[22m
[2m    // The values assigned to `x` are non-reactive, but the value of `x`[22m
[2m    // depends on the "control" variable `i`, whose value is affected by[22m
[2m    // `props.test` which is reactive.[22m
[2m    // Therefore x should be treated as reactive too.[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {test: 12},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m      {test: 1},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m      {test: 12},[22m
[2m      {test: 1},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let i = 0;[22m
[2m    do {[22m
[2m      if (i > 10) {[22m
[2m        x = 10;[22m
[2m      } else {[22m
[2m        x = 1;[22m
[2m      }[22m

[2m      i++;[22m
[2m    } while (i < props.test);[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { test: 12 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m      { test: 1 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m      { test: 12 },[22m
[2m      { test: 1 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [10][22m
[2m  [10][22m
[2m  [1][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m reactive-control-dependency-do-while-indirect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    let y = 0;[22m
[2m    let z = 0;[22m
[2m    do {[22m
[2m      x += 1;[22m
[2m      y += 1;[22m
[2m      z = y;[22m
[2m    } while (x < props.limit);[22m
[2m    return [z];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {limit: 10},[22m
[2m      {limit: 10},[22m
[2m      {limit: 1},[22m
[2m      {limit: 1},[22m
[2m      {limit: 10},[22m
[2m      {limit: 1},[22m
[2m      {limit: 10},[22m
[2m      {limit: 1},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    let y = 0;[22m
[2m    let z;[22m
[2m    do {[22m
[2m      x = x + 1;[22m
[2m      y = y + 1;[22m
[2m      z = y;[22m
[2m    } while (x < props.limit);[22m
[2m    let t0;[22m
[2m    if ($[0] !== z) {[22m
[2m      t0 = [z];[22m
[2m      $[0] = z;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { limit: 10 },[22m
[2m      { limit: 10 },[22m
[2m      { limit: 1 },[22m
[2m      { limit: 1 },[22m
[2m      { limit: 10 },[22m
[2m      { limit: 1 },[22m
[2m      { limit: 10 },[22m
[2m      { limit: 1 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [10][22m
[2m  [10][22m
[2m  [1][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m
[2m  [10][22m
[2m  [1][22m

[31m[1mFAIL:[22m[39m react-namespace
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const FooContext = React.createContext({current: null});[22m

[2m  function Component(props) {[22m
[2m    const foo = React.useContext(FooContext);[22m
[2m    const ref = React.useRef();[22m
[2m    const [x, setX] = React.useState(false);[22m
[2m    const onClick = () => {[22m
[2m      setX(true);[22m
[2m      ref.current = true;[22m
[2m    };[22m
[2m    return <div onClick={onClick}>{React.cloneElement(props.children)}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{children: <div>Hello</div>}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const FooContext = React.createContext({ current: null });[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[32m-   React.useContext(FooContext);[39m
[32m-   const ref = React.useRef();[39m
[32m-   const [x, setX] = React.useState(false);[39m
[31m+   Object.freeze(props);[39m
[31m+   (function () {[39m
[31m+     const $res$ = React.useContext(Object.freeze(FooContext));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = React.useRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const [x, setX] = (function () {[39m
[31m+     const $res$ = React.useState(Object.freeze(false));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        setX(true);[22m
[2m        ref.current = true;[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== props.children) {[22m
[2m      t1 = React.cloneElement(props.children);[22m
[2m      $[1] = props.children;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== onClick || $[4] !== t1) {[22m
[32m-     t2 = <div onClick={onClick}>{t1}</div>;[39m
[31m+     t2 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {t1}[39m
[31m+       </div>[39m
[31m+     );[39m
[2m      $[3] = onClick;[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ children: <div>Hello</div> }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>Hello</div></div>[22m

[31m[1mFAIL:[22m[39m quoted-strings-jsx-attribute-escaped-constant-propagation
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) Some "text"
Forget:
(kind: ok)
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','text','text','Child','text','Child','\n' +
  '    at Child (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:40:16)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m quoted-strings-in-jsx-attribute
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) Some "text"
Forget:
(kind: ok)
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','text','text','Child','text','Child','\n' +
  '    at Child (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:40:16)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m quoted-strings-in-jsx-attribute-escaped
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) Some \"text\"
Forget:
(kind: ok)
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','text','text','Child','text','Child','\n' +
  '    at Child (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:40:16)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m prune-scopes-whose-deps-may-invalidate-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useHook, identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let x = 42;[22m
[2m    if (props.cond) {[22m
[2m      x = [];[22m
[2m    }[22m
[2m    useHook(); // intersperse a hook call to prevent memoization of x[22m
[2m    identity(x);[22m

[2m    const y = [x];[22m

[2m    return [y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useHook, identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 42;[22m
[2m    if (props.cond) {[22m
[2m      x = [];[22m
[2m    }[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    identity(x);[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== y) {[22m
[2m      t1 = [y];[22m
[2m      $[2] = y;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[42]][22m

[31m[1mFAIL:[22m[39m prune-scopes-whose-deps-invalidate-object
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    useHook(); // intersperse a hook call to prevent memoization of x[22m
[2m    x.value = props.value;[22m

[2m    const y = {x};[22m

[2m    return {y};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { useHook } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = {};[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    x.value = props.value;[22m

[2m    const y = { x };[22m
[2m    return { y };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"y":{"x":{"value":"sathya"}}}[22m

[31m[1mFAIL:[22m[39m prune-scopes-whose-deps-invalidate-new
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = new Foo();[22m
[2m    useHook(); // intersperse a hook call to prevent memoization of x[22m
[2m    x.value = props.value;[22m

[2m    const y = {x};[22m

[2m    return {y};[22m
[2m  }[22m

[2m  class Foo {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { useHook } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = new Foo();[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    x.value = props.value;[22m

[2m    const y = { x };[22m
[2m    return { y };[22m
[2m  }[22m

[2m  class Foo {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"y":{"x":{"value":"sathya"}}}[22m

[31m[1mFAIL:[22m[39m prune-scopes-whose-deps-invalidate-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const o = {};[22m
[2m    const x = <div>{props.value}</div>; // create within the range of x to group with x[22m
[2m    useHook(); // intersperse a hook call to prevent memoization of x[22m
[2m    o.value = props.value;[22m

[2m    const y = <div>{x}</div>;[22m

[2m    return <div>{y}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useHook } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    const o = {};[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = <div>{props.value}</div>;[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    o.value = props.value;[22m
[2m    let t1;[22m
[2m    if ($[2] !== x) {[22m
[2m      t1 = <div>{x}</div>;[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== y) {[22m
[2m      t2 = <div>{y}</div>;[22m
[2m      $[4] = y;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div><div>sathya</div></div></div>[22m

[31m[1mFAIL:[22m[39m prune-scopes-whose-deps-invalidate-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useHook} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    useHook(); // intersperse a hook call to prevent memoization of x[22m
[2m    x.push(props.value);[22m

[2m    const y = [x];[22m

[2m    return [y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { useHook } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [];[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    x.push(props.value);[22m

[2m    const y = [x];[22m
[2m    return [y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[["sathya"]]][22m

[31m[1mFAIL:[22m[39m property-call-spread
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = foo.bar(...props.a, null, ...props.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      t0 = foo.bar(...props.a, null, ...props.b);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m property-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = [];[22m
[2m    x.y = y;[22m
[2m    const child = <Component data={y} />;[22m
[2m    x.y.push(props.p0);[22m
[2m    return <Component data={x}>{child}</Component>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.p0) {[22m
[2m      const x = {};[22m
[2m      const y = [];[22m
[2m      x.y = y;[22m
[32m-     const child = <Component data={y} />;[39m
[31m+     const child = ([39m
[31m+       <Component[39m
[31m+         data={function () {[39m
[31m+           const $res$ = y;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      x.y.push(props.p0);[22m
[32m-     t0 = <Component data={x}>{child}</Component>;[39m
[31m+     t0 = ([39m
[31m+       <Component[39m
[31m+         data={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {child}[39m
[31m+       </Component>[39m
[31m+     );[39m
[2m      $[0] = props.p0;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m prop-capturing-function-1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let z = {a, b};[22m
[2m    let x = function () {[22m
[2m      console.log(z);[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      t0 = { a, b };[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[3] !== z) {[22m
[2m      t1 = function () {[22m
[2m        console.log(z);[22m
[2m      };[22m
[2m      $[3] = z;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m primitive-reassigned-loop-force-scopes-enabled
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableForest[22m
[2m  function Component({base, start, increment, test}) {[22m
[2m    let value = base;[22m
[2m    for (let i = start; i < test; i += increment) {[22m
[2m      value += i;[22m
[2m    }[22m
[2m    return <div>{value}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{base: 0, start: 0, test: 10, increment: 1}],[22m
[2m    sequentialRenders: [[22m
[2m      {base: 0, start: 1, test: 10, increment: 1},[22m
[2m      {base: 0, start: 0, test: 10, increment: 2},[22m
[2m      {base: 2, start: 0, test: 10, increment: 2},[22m
[2m      {base: 0, start: 0, test: 11, increment: 2},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableForest[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { base, start, increment, test } = t0;[22m
[2m    let value;[22m
[2m    if ($[0] !== base || $[1] !== start || $[2] !== test || $[3] !== increment) {[22m
[2m      value = base;[22m
[2m      for (let i = start; i < test; i = i + increment, i) {[22m
[2m        value = value + i;[22m
[2m      }[22m
[2m      $[0] = base;[22m
[2m      $[1] = start;[22m
[2m      $[2] = test;[22m
[2m      $[3] = increment;[22m
[2m      $[4] = value;[22m
[2m    } else {[22m
[2m      value = $[4];[22m
[2m    }[22m
[2m    return <div>{value}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ base: 0, start: 0, test: 10, increment: 1 }],[22m
[2m    sequentialRenders: [[22m
[2m      { base: 0, start: 1, test: 10, increment: 1 },[22m
[2m      { base: 0, start: 0, test: 10, increment: 2 },[22m
[2m      { base: 2, start: 0, test: 10, increment: 2 },[22m
[2m      { base: 0, start: 0, test: 11, increment: 2 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>45</div>[22m
[2m  <div>20</div>[22m
[2m  <div>22</div>[22m
[2m  <div>30</div>[22m

[31m[1mFAIL:[22m[39m primitive-as-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.b + 1 is an non-allocating expression, which means Forget can[22m
[2m  // emit it trivially and repeatedly (e.g. no need to memoize props.b + 1[22m
[2m  // separately from props.b)[22m
[2m  // Correctness:[22m
[2m  //   y depends on either props.b or props.b + 1[22m
[2m  function PrimitiveAsDep(props) {[22m
[2m    let y = foo(props.b + 1);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.b + 1 is an non-allocating expression, which means Forget can[22m
[2m  // emit it trivially and repeatedly (e.g. no need to memoize props.b + 1[22m
[2m  // separately from props.b)[22m
[2m  // Correctness:[22m
[2m  //   y depends on either props.b or props.b + 1[22m
[2m  function PrimitiveAsDep(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const t0 = props.b + 1;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = foo(t0);[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m primitive-as-dep-nested-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.b + 1 is an non-allocating expression, which means Forget can[22m
[2m  // emit it trivially and repeatedly (e.g. no need to memoize props.b + 1[22m
[2m  // separately from props.b)[22m
[2m  // Correctness:[22m

[2m  import {identity, mutate, setProperty} from 'shared-runtime';[22m

[2m  //   y depends on either props.b or props.b + 1[22m
[2m  function PrimitiveAsDepNested(props) {[22m
[2m    let x = {};[22m
[2m    mutate(x);[22m
[2m    let y = identity(props.b + 1);[22m
[2m    setProperty(x, props.a);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: PrimitiveAsDepNested,[22m
[2m    params: [{a: 1, b: 2}],[22m
[2m    sequentialRenders: [[22m
[2m      // change b[22m
[2m      {a: 1, b: 3},[22m
[2m      // change b[22m
[2m      {a: 1, b: 4},[22m
[2m      // change a[22m
[2m      {a: 2, b: 4},[22m
[2m      // change a[22m
[2m      {a: 3, b: 4},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.b + 1 is an non-allocating expression, which means Forget can[22m
[2m  // emit it trivially and repeatedly (e.g. no need to memoize props.b + 1[22m
[2m  // separately from props.b)[22m
[2m  // Correctness:[22m

[2m  import { identity, mutate, setProperty } from "shared-runtime";[22m

[2m  //   y depends on either props.b or props.b + 1[22m
[2m  function PrimitiveAsDepNested(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.b || $[1] !== props.a) {[22m
[2m      const x = {};[22m
[2m      mutate(x);[22m
[2m      const t1 = props.b + 1;[22m
[2m      let t2;[22m
[2m      if ($[3] !== t1) {[22m
[2m        t2 = identity(t1);[22m
[2m        $[3] = t1;[22m
[2m        $[4] = t2;[22m
[2m      } else {[22m
[2m        t2 = $[4];[22m
[2m      }[22m
[2m      const y = t2;[22m
[2m      setProperty(x, props.a);[22m
[2m      t0 = [x, y];[22m
[2m      $[0] = props.b;[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: PrimitiveAsDepNested,[22m
[2m    params: [{ a: 1, b: 2 }],[22m
[2m    sequentialRenders: [[22m
[2m      // change b[22m
[2m      { a: 1, b: 3 },[22m
[2m      // change b[22m
[2m      { a: 1, b: 4 },[22m
[2m      // change a[22m
[2m      { a: 2, b: 4 },[22m
[2m      // change a[22m
[2m      { a: 3, b: 4 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"wat0":"joe","wat1":1},4][22m
[2m  [{"wat0":"joe","wat1":1},5][22m
[2m  [{"wat0":"joe","wat1":2},5][22m
[2m  [{"wat0":"joe","wat1":3},5][22m

[31m[1mFAIL:[22m[39m primitive-alias-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = 'foo';[22m
[2m    if (a) {[22m
[2m      x = 'bar';[22m
[2m    } else {[22m
[2m      x = 'baz';[22m
[2m    }[22m
[2m    let y = x;[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if (a) {[22m
[2m      x = "bar";[22m
[2m    } else {[22m
[2m      x = "baz";[22m
[2m    }[22m

[2m    const y = x;[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m phi-type-inference-property-store
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @debug[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    let y;[22m
[2m    if (props.cond) {[22m
[2m      y = {};[22m
[2m    } else {[22m
[2m      y = {a: props.a};[22m
[2m    }[22m
[2m    // This should be inferred as `<store> y` s.t. `x` can still[22m
[2m    // be independently memoized. *But* this also must properly[22m
[2m    // extend the mutable range of the object literals in the[22m
[2m    // if/else branches[22m
[2m    y.x = x;[22m

[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: false, a: 'a!'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @debug[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let y;[22m
[2m    if ($[1] !== props) {[22m
[2m      if (props.cond) {[22m
[2m        y = {};[22m
[2m      } else {[22m
[2m        y = { a: props.a };[22m
[2m      }[22m

[2m      y.x = x;[22m
[2m      $[1] = props;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[3] !== y) {[22m
[2m      t1 = [x, y];[22m
[2m      $[3] = y;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: false, a: "a!" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{},{"a":"a!","x":"[[ cyclic ref *1 ]]"}][22m

[31m[1mFAIL:[22m[39m phi-type-inference-array-push
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    let y;[22m
[2m    if (props.cond) {[22m
[2m      y = [props.value];[22m
[2m    } else {[22m
[2m      y = [];[22m
[2m    }[22m
[2m    // This should be inferred as `<store> y` s.t. `x` can still[22m
[2m    // be independently memoized. *But* this also must properly[22m
[2m    // extend the mutable range of the array literals in the[22m
[2m    // if/else branches[22m
[2m    y.push(x);[22m

[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true, value: 42}],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true, value: 3.14},[22m
[2m      {cond: false, value: 3.14},[22m
[2m      {cond: true, value: 42},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = {};[22m
[2m      let y;[22m
[2m      if (props.cond) {[22m
[2m        y = [props.value];[22m
[2m      } else {[22m
[2m        y = [];[22m
[2m      }[22m

[2m      y.push(x);[22m

[2m      t0 = [x, y];[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true, value: 42 }],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true, value: 3.14 },[22m
[2m      { cond: false, value: 3.14 },[22m
[2m      { cond: true, value: 42 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{},[3.14,"[[ cyclic ref *1 ]]"]][22m
[2m  [{},["[[ cyclic ref *1 ]]"]][22m
[2m  [{},[42,"[[ cyclic ref *1 ]]"]][22m

[31m[1mFAIL:[22m[39m phi-reference-effects
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {arrayPush} from 'shared-runtime';[22m

[2m  function Foo(cond) {[22m
[2m    let x = null;[22m
[2m    if (cond) {[22m
[2m      x = [];[22m
[2m    } else {[22m
[2m    }[22m
[2m    // Here, x = phi(x$null, x$[]) should receive a ValueKind of Mutable[22m
[2m    arrayPush(x, 2);[22m

[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{cond: true}],[22m
[2m    sequentialRenders: [{cond: true}, {cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { arrayPush } from "shared-runtime";[22m

[2m  function Foo(cond) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(cond);[39m
[2m    let x;[22m
[2m    if ($[0] !== cond) {[22m
[2m      x = null;[22m
[2m      if (cond) {[22m
[2m        x = [];[22m
[2m      }[22m

[2m      arrayPush(x, 2);[22m
[2m      $[0] = cond;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ cond: true }],[22m
[2m    sequentialRenders: [{ cond: true }, { cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m partial-early-return-within-reactive-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    let y = null;[22m
[2m    if (props.cond) {[22m
[2m      x.push(props.a);[22m
[2m      // oops no memo![22m
[2m      return x;[22m
[2m    } else {[22m
[2m      y = foo();[22m
[2m      if (props.b) {[22m
[2m        return;[22m
[2m      }[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true, a: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        const x = [];[22m
[2m        if (props.cond) {[22m
[2m          x.push(props.a);[22m
[2m          t0 = x;[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          let t1;[22m
[2m          if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m            t1 = foo();[22m
[2m            $[3] = t1;[22m
[2m          } else {[22m
[2m            t1 = $[3];[22m
[2m          }[22m
[2m          y = t1;[22m
[2m          if (props.b) {[22m
[2m            t0 = undefined;[22m
[2m            break bb0;[22m
[2m          }[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = y;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true, a: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m

[31m[1mFAIL:[22m[39m overlapping-scopes-within-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = [];[22m
[2m    if (a) {[22m
[2m      let y = [];[22m
[2m      if (b) {[22m
[2m        y.push(c);[22m
[2m      }[22m

[2m      x.push(y);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        let y;[22m
[2m        if ($[4] !== b || $[5] !== c) {[22m
[2m          y = [];[22m
[2m          if (b) {[22m
[2m            y.push(c);[22m
[2m          }[22m
[2m          $[4] = b;[22m
[2m          $[5] = c;[22m
[2m          $[6] = y;[22m
[2m        } else {[22m
[2m          y = $[6];[22m
[2m        }[22m

[2m        x.push(y);[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m overlapping-scopes-while
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = [];[22m
[2m    let y = [];[22m
[2m    while (c) {[22m
[2m      y.push(b);[22m
[2m      x.push(a);[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    const x = [];[22m
[2m    const y = [];[22m
[2m    while (c) {[22m
[2m      y.push(b);[22m
[2m      x.push(a);[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m overlapping-scopes-shadowing-within-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = [];[22m
[2m    if (a) {[22m
[2m      let y = [];[22m
[2m      if (b) {[22m
[2m        y.push(c);[22m
[2m      }[22m

[2m      x.push(<div>{y}</div>);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        let y;[22m
[2m        if ($[4] !== b || $[5] !== c) {[22m
[2m          y = [];[22m
[2m          if (b) {[22m
[2m            y.push(c);[22m
[2m          }[22m
[2m          $[4] = b;[22m
[2m          $[5] = c;[22m
[2m          $[6] = y;[22m
[2m        } else {[22m
[2m          y = $[6];[22m
[2m        }[22m
[2m        let t0;[22m
[2m        if ($[7] !== y) {[22m
[2m          t0 = <div>{y}</div>;[22m
[2m          $[7] = y;[22m
[2m          $[8] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[8];[22m
[2m        }[22m
[2m        x.push(t0);[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m overlapping-scopes-shadowed
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    let x = [];[22m
[2m    let y = [];[22m
[2m    y.push(b);[22m
[2m    x.push(a);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    const x = [];[22m
[2m    const y = [];[22m
[2m    y.push(b);[22m
[2m    x.push(a);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m overlapping-scopes-interleaved
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    let x = [];[22m
[2m    let y = [];[22m
[2m    x.push(a);[22m
[2m    y.push(b);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    const x = [];[22m
[2m    const y = [];[22m
[2m    x.push(a);[22m
[2m    y.push(b);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m overlapping-scopes-interleaved-by-terminal
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const x = [];[22m
[2m    const y = [];[22m

[2m    if (x) {[22m
[2m    }[22m

[2m    y.push(a);[22m
[2m    x.push(b);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    const x = [];[22m
[2m    const y = [];[22m
[2m    if (x) {[22m
[2m    }[22m

[2m    y.push(a);[22m
[2m    x.push(b);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m outlining-in-react-memo
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <ul><li>foo</li><li>bar</li></ul>
Forget:
(kind: ok) <ul><li>foo</li><li>bar</li></ul>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '      const $res$ = item.id;\n' +
  '      Object.freeze($res$);\n' +
  '      return $res$;\n' +
  '    }','\n' +
  '    at ul\n' +
  '    at eval (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:34:36)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m outlining-in-func-expr
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <ul><li>foo</li><li>bar</li></ul>
Forget:
(kind: ok) <ul><li>foo</li><li>bar</li></ul>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '      const $res$ = item.id;\n' +
  '      Object.freeze($res$);\n' +
  '      return $res$;\n' +
  '    }','\n' +
  '    at ul\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m outlined-helper
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>{"item":"one"}</div></div>
Forget:
(kind: ok) <div><div>{"item":"[[ function params=0 ]]"}</div></div>

[31m[1mFAIL:[22m[39m outlined-destructured-params
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"name":"one"}</div>
Forget:
(kind: ok) <div>{"name":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m optional-receiver-optional-method
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeOptionalObject(props);[22m
[2m    const y = makeObject(props);[22m
[2m    const z = x?.optionalMethod?.(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = makeOptionalObject(props);[22m
[2m      const y = makeObject(props);[22m
[2m      t0 = x?.optionalMethod?.(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-receiver-method-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeOptionalObject(props);[22m
[2m    const y = makeObject(props);[22m
[2m    const z = x?.method(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = makeOptionalObject(props);[22m
[2m      const y = makeObject(props);[22m
[2m      t0 = x?.method(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-method-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeObject(props);[22m
[2m    const y = makeObject(props);[22m
[2m    const z = x.optionalMethod?.(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = makeObject(props);[22m
[2m      const y = makeObject(props);[22m
[2m      t0 = x.optionalMethod?.(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-member-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    let x = bar(props.a);[22m
[2m    let y = x?.b;[22m

[2m    let z = useBar(y);[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = bar(props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    const y = x?.b;[22m

[32m-   const z = useBar(y);[39m
[31m+   const z = (function () {[39m
[31m+     const $res$ = useBar(Object.freeze(y));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-member-expression-with-optional-member-expr-as-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeObject();[22m
[2m    return x.y?.[props.a?.[props.b?.[props.c]]];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = makeObject();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x.y?.[props.a?.[props.b?.[props.c]]];[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-member-expression-chain
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Note that `a?.b.c` is semantically different from `(a?.b).c`[22m
[2m  // We should codegen the correct member expressions[22m
[2m  function Component(props) {[22m
[2m    let x = props?.b.c;[22m
[2m    let y = props?.b.c.d?.e.f.g?.h;[22m
[2m    return {x, y};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Note that `a?.b.c` is semantically different from `(a?.b).c`[22m
[2m  // We should codegen the correct member expressions[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    const x = props?.b.c;[22m
[2m    const y = props?.b.c.d?.e.f.g?.h;[22m
[2m    let t0;[22m
[2m    if ($[0] !== x || $[1] !== y) {[22m
[2m      t0 = { x, y };[22m
[2m      $[0] = x;[22m
[2m      $[1] = y;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-member-expression-call-as-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeObject();[22m
[2m    return x?.[foo(props.value)];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = makeObject();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== props) {[22m
[2m      t1 = x?.[foo(props.value)];[22m
[2m      $[1] = props;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-computed-member-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const object = makeObject(props);[22m
[2m    return object?.[props.key];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = makeObject(props);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const object = t0;[22m
[2m    return object?.[props.key];[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-computed-load-static
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = a?.b.c[0];[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = a?.b.c[0];[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeOptionalFunction(props);[22m
[2m    const y = makeObject(props);[22m
[2m    const z = x?.(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = makeOptionalFunction(props);[22m
[2m      const y = makeObject(props);[22m
[2m      t0 = x?.(y.a, props.a, foo(y.b), bar(props.b));[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-call-with-optional-property-load
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return props?.items?.map?.(render)?.filter(Boolean) ?? [];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = props?.items?.map?.(render)?.filter(Boolean) ?? [];[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-call-with-independently-memoizable-arg
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeOptionalFunction(props);[22m
[2m    // for a regular call, the JSX element could be independently memoized[22m
[2m    // since it is an immutable value. however, because the call is optional,[22m
[2m    // we can't extract out independent memoization for the element w/o[22m
[2m    // forcing that argument to evaluate unconditionally[22m
[2m    const y = x?.([22m
[2m      <div>[22m
[2m        <span>{props.text}</span>[22m
[2m      </div>[22m
[2m    );[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = makeOptionalFunction(props);[22m

[2m      t0 = x?.([22m
[2m        <div>[22m
[2m          <span>{props.text}</span>[22m
[2m        </div>,[22m
[2m      );[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-call-simple
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return foo?.(props);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = foo?.(props);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-call-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const item = useFragment([22m
[2m      graphql`[22m
[2m        fragment F on T {[22m
[2m          id[22m
[2m        }[22m
[2m      `,[22m
[2m      props.item[22m
[2m    );[22m
[2m    return item.items?.map(item => renderItem(item)) ?? [];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const item = useFragment([39m
[32m-     graphql`[39m
[32m-       fragment F on T {[39m
[32m-         id[39m
[32m-       }[39m
[32m-     `,[39m
[32m-     props.item,[39m
[32m-   );[39m
[31m+   Object.freeze(props);[39m
[31m+   const item = (function () {[39m
[31m+     const $res$ = useFragment([39m
[31m+       Object.freeze(graphql`[39m
[31m+         fragment F on T {[39m
[31m+           id[39m
[31m+         }[39m
[31m+       `),[39m
[31m+       Object.freeze(props.item),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== item.items) {[22m
[2m      t0 = item.items?.map(_temp) ?? [];[22m
[2m      $[0] = item.items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp(item_0) {[22m
[2m    return renderItem(item_0);[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m optional-call-chained
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return call?.(props.a)?.(props.b)?.(props.c);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = call?.(props.a)?.(props.b)?.(props.c);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m option-enable-change-variable-codegen
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableChangeVariableCodegen[22m
[2m  function Component(props) {[22m
[2m    const c_0 = [props.a, props.b.c];[22m
[2m    return c_0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 3.14, b: {c: true}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableChangeVariableCodegen[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    const c_00 = $[0] !== props.a;[22m
[2m    const c_1 = $[1] !== props.b.c;[22m
[2m    let t0;[22m
[2m    if (c_00 || c_1) {[22m
[2m      t0 = [props.a, props.b.c];[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b.c;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const c_0 = t0;[22m
[2m    return c_0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 3.14, b: { c: true } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [3.14,true][22m

[31m[1mFAIL:[22m[39m object-shorthand-method-nested
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react';[22m
[2m  import {createHookWrapper} from 'shared-runtime';[22m

[2m  function useHook({value}) {[22m
[2m    const [state] = useState(false);[22m

[2m    return {[22m
[2m      getX() {[22m
[2m        return {[22m
[2m          a: [],[22m
[2m          getY() {[22m
[2m            return value;[22m
[2m          },[22m
[2m          state,[22m
[2m        };[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react";[22m
[2m  import { createHookWrapper } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[32m-   const [state] = useState(false);[39m
[31m+   const [state] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(false));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[0] !== value || $[1] !== state) {[22m
[2m      t1 = {[22m
[2m        getX() {[22m
[2m          return {[22m
[2m            a: [],[22m
[2m            getY() {[22m
[2m              return value;[22m
[2m            },[22m
[2m            state,[22m
[2m          };[22m
[2m        },[22m
[2m      };[22m
[2m      $[0] = value;[22m
[2m      $[1] = state;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getX":{"kind":"Function","result":{"a":[],"getY":{"kind":"Function","result":0},"state":false}}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-shorthand-method-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper} from 'shared-runtime';[22m

[2m  function useHook({a, b, c}) {[22m
[2m    return {[22m
[2m      x: [a],[22m
[2m      y() {[22m
[2m        return [b];[22m
[2m      },[22m
[2m      z: {c},[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{a: 1, b: 2, c: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b, c } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = [a];[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] !== b || $[3] !== c || $[4] !== t1) {[22m
[2m      let t3;[22m
[2m      if ($[6] !== c) {[22m
[2m        t3 = { c };[22m
[2m        $[6] = c;[22m
[2m        $[7] = t3;[22m
[2m      } else {[22m
[2m        t3 = $[7];[22m
[2m      }[22m
[2m      t2 = {[22m
[2m        x: t1,[22m
[2m        y() {[22m
[2m          return [b];[22m
[2m        },[22m
[2m        z: t3,[22m
[2m      };[22m
[2m      $[2] = b;[22m
[2m      $[3] = c;[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ a: 1, b: 2, c: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"x":[1],"y":{"kind":"Function","result":[2]},"z":{"c":2}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-shorthand-method-1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper} from 'shared-runtime';[22m
[2m  function useHook({a, b}) {[22m
[2m    return {[22m
[2m      x: function () {[22m
[2m        return [a];[22m
[2m      },[22m
[2m      y() {[22m
[2m        return [b];[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{a: 1, b: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper } from "shared-runtime";[22m
[2m  function useHook(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = function () {[22m
[2m        return [a];[22m
[2m      };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] !== b || $[3] !== t1) {[22m
[2m      t2 = {[22m
[2m        x: t1,[22m
[2m        y() {[22m
[2m          return [b];[22m
[2m        },[22m
[2m      };[22m
[2m      $[2] = b;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ a: 1, b: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"x":{"kind":"Function","result":[1]},"y":{"kind":"Function","result":[2]}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-properties
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const x = a.x;[22m
[2m    const y = {...b.c.d};[22m
[2m    y.z = c.d.e;[22m
[2m    foo(a.b.c);[22m
[2m    [a.b.c];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+[39m
[2m    const y = { ...b.c.d };[22m
[2m    y.z = c.d.e;[22m
[2m    foo(a.b.c);[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m object-pattern-params
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component({a, b}) {[22m
[2m    let y = {a};[22m
[2m    let z = {b};[22m
[2m    return {y, z};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(t0) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== b) {[22m
[2m      t2 = { b };[22m
[2m      $[2] = b;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const z = t2;[22m
[2m    let t3;[22m
[2m    if ($[4] !== y || $[5] !== z) {[22m
[2m      t3 = { y, z };[22m
[2m      $[4] = y;[22m
[2m      $[5] = z;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m object-mutated-in-consequent-alternate-both-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeObject_Primitives} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const object = makeObject_Primitives();[22m
[2m    if (props.cond) {[22m
[2m      object.value = 1;[22m
[2m      return object;[22m
[2m    } else {[22m
[2m      object.value = props.value;[22m
[2m      return object;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: false, value: [0, 1, 2]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeObject_Primitives } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        const object = makeObject_Primitives();[22m
[2m        if (props.cond) {[22m
[2m          object.value = 1;[22m
[2m          t0 = object;[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          object.value = props.value;[22m
[2m          t0 = object;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: false, value: [0, 1, 2] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":0,"b":"value1","c":true,"value":[0,1,2]}[22m

[31m[1mFAIL:[22m[39m object-method-shorthand-mutated-after
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper, mutate, mutateAndReturn} from 'shared-runtime';[22m
[2m  function useHook({value}) {[22m
[2m    const x = mutateAndReturn({value});[22m
[2m    const obj = {[22m
[2m      getValue() {[22m
[2m        return x;[22m
[2m      },[22m
[2m    };[22m
[2m    mutate(obj);[22m
[2m    return obj;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper, mutate, mutateAndReturn } from "shared-runtime";[22m
[2m  function useHook(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let obj;[22m
[2m    if ($[0] !== value) {[22m
[2m      const x = mutateAndReturn({ value });[22m
[2m      obj = {[22m
[2m        getValue() {[22m
[2m          return x;[22m
[2m        },[22m
[2m      };[22m

[2m      mutate(obj);[22m
[2m      $[0] = value;[22m
[2m      $[1] = obj;[22m
[2m    } else {[22m
[2m      obj = $[1];[22m
[2m    }[22m
[2m    return obj;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getValue":{"kind":"Function","result":{"value":0,"wat0":"joe"}},"wat0":"joe"},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-method-shorthand-hook-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper} from 'shared-runtime';[22m
[2m  import {useState} from 'react';[22m
[2m  function useFoo() {[22m
[2m    const [state, _setState] = useState(false);[22m
[2m    return {[22m
[2m      func() {[22m
[2m        return state;[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useFoo),[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper } from "shared-runtime";[22m
[2m  import { useState } from "react";[22m
[2m  function useFoo() {[22m
[2m    const $ = _c(2);[22m
[32m-   const [state] = useState(false);[39m
[31m+   const [state] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(false));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== state) {[22m
[2m      t0 = {[22m
[2m        func() {[22m
[2m          return state;[22m
[2m        },[22m
[2m      };[22m
[2m      $[0] = state;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useFoo),[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"func":{"kind":"Function","result":false}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-method-shorthand-derived-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper, mutateAndReturn} from 'shared-runtime';[22m
[2m  function useHook({value}) {[22m
[2m    const x = mutateAndReturn({value});[22m
[2m    const obj = {[22m
[2m      getValue() {[22m
[2m        return x;[22m
[2m      },[22m
[2m    };[22m
[2m    return obj;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper, mutateAndReturn } from "shared-runtime";[22m
[2m  function useHook(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = mutateAndReturn({ value });[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== x) {[22m
[2m      t2 = {[22m
[2m        getValue() {[22m
[2m          return x;[22m
[2m        },[22m
[2m      };[22m
[2m      $[2] = x;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const obj = t2;[22m
[2m    return obj;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getValue":{"kind":"Function","result":{"value":0,"wat0":"joe"}}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-method-shorthand-aliased-mutate-after
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper, mutate, mutateAndReturn} from 'shared-runtime';[22m
[2m  function useHook({value}) {[22m
[2m    const x = mutateAndReturn({value});[22m
[2m    const obj = {[22m
[2m      getValue() {[22m
[2m        return value;[22m
[2m      },[22m
[2m    };[22m
[2m    mutate(x);[22m
[2m    return obj;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper, mutate, mutateAndReturn } from "shared-runtime";[22m
[2m  function useHook(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let obj;[22m
[2m    if ($[0] !== value) {[22m
[2m      const x = mutateAndReturn({ value });[22m
[2m      obj = {[22m
[2m        getValue() {[22m
[2m          return value;[22m
[2m        },[22m
[2m      };[22m

[2m      mutate(x);[22m
[2m      $[0] = value;[22m
[2m      $[1] = obj;[22m
[2m    } else {[22m
[2m      obj = $[1];[22m
[2m    }[22m
[2m    return obj;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getValue":{"kind":"Function","result":0}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-method-shorthand-3
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper, mutate} from 'shared-runtime';[22m

[2m  function useHook(a) {[22m
[2m    const x = {a};[22m
[2m    let obj = {[22m
[2m      method() {[22m
[2m        mutate(x);[22m
[2m        return x;[22m
[2m      },[22m
[2m    };[22m
[2m    return obj.method();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{x: 1}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper, mutate } from "shared-runtime";[22m

[2m  function useHook(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      const obj = {[22m
[2m        method() {[22m
[2m          mutate(x);[22m
[2m          return x;[22m
[2m        },[22m
[2m      };[22m

[2m      t0 = obj.method();[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ x: 1 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"a":{"x":1},"wat0":"joe"},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-method-maybe-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper, setProperty} from 'shared-runtime';[22m
[2m  function useHook(props) {[22m
[2m    const x = {[22m
[2m      getX() {[22m
[2m        return props;[22m
[2m      },[22m
[2m    };[22m
[2m    const y = {[22m
[2m      getY() {[22m
[2m        return 'y';[22m
[2m      },[22m
[2m    };[22m
[2m    return setProperty(x, y);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper, setProperty } from "shared-runtime";[22m
[2m  function useHook(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = {[22m
[2m        getX() {[22m
[2m          return props;[22m
[2m        },[22m
[2m      };[22m

[2m      const y = {[22m
[2m        getY() {[22m
[2m          return "y";[22m
[2m        },[22m
[2m      };[22m

[2m      t0 = setProperty(x, y);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getX":{"kind":"Function","result":{"value":0}},"wat0":{"getY":{"kind":"Function","result":"y"}}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-literal-spread-element
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {...props.foo};[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.foo) {[22m
[2m      t0 = { ...props.foo };[22m
[2m      $[0] = props.foo;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m object-literal-method-in-ternary-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper, CONST_STRING0, CONST_STRING1} from 'shared-runtime';[22m

[2m  function useHook({value}) {[22m
[2m    return {[22m
[2m      getValue() {[22m
[2m        return identity(value);[22m
[2m      },[22m
[2m    }[22m
[2m      ? CONST_STRING0[22m
[2m      : CONST_STRING1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    createHookWrapper,[22m
[2m    CONST_STRING0,[22m
[2m    CONST_STRING1,[22m
[2m  } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    return {[22m
[2m      getValue() {[22m
[2m        return identity(value);[22m
[2m      },[22m
[2m    }[22m
[2m      ? CONST_STRING0[22m
[2m      : CONST_STRING1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":"global string 0","shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-literal-method-in-ternary-consequent
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {createHookWrapper} from 'shared-runtime';[22m

[2m  function useHook({isCond, value}) {[22m
[2m    return isCond[22m
[2m      ? {[22m
[2m          getValue() {[22m
[2m            return value;[22m
[2m          },[22m
[2m        }[22m
[2m      : 42;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{isCond: true, value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { createHookWrapper } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { isCond, value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== isCond || $[1] !== value) {[22m
[2m      t1 = isCond[22m
[2m        ? {[22m
[2m            getValue() {[22m
[2m              return value;[22m
[2m            },[22m
[2m          }[22m
[2m        : 42;[22m
[2m      $[0] = isCond;[22m
[2m      $[1] = value;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ isCond: true, value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getValue":{"kind":"Function","result":0}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-literal-method-derived-in-ternary-consequent
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, createHookWrapper} from 'shared-runtime';[22m

[2m  function useHook({isCond, value}) {[22m
[2m    return isCond[22m
[2m      ? identity({[22m
[2m          getValue() {[22m
[2m            return value;[22m
[2m          },[22m
[2m        })[22m
[2m      : 42;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{isCond: true, value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, createHookWrapper } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { isCond, value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== isCond || $[1] !== value) {[22m
[2m      t1 = isCond[22m
[2m        ? identity({[22m
[2m            getValue() {[22m
[2m              return value;[22m
[2m            },[22m
[2m          })[22m
[2m        : 42;[22m
[2m      $[0] = isCond;[22m
[2m      $[1] = value;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ isCond: true, value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":{"getValue":{"kind":"Function","result":0}},"shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-literal-method-call-in-ternary-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    createHookWrapper,[22m
[2m    identity,[22m
[2m    CONST_STRING0,[22m
[2m    CONST_STRING1,[22m
[2m  } from 'shared-runtime';[22m

[2m  function useHook({value}) {[22m
[2m    return {[22m
[2m      getValue() {[22m
[2m        return identity(value);[22m
[2m      },[22m
[2m    }.getValue()[22m
[2m      ? CONST_STRING0[22m
[2m      : CONST_STRING1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    createHookWrapper,[22m
[2m    identity,[22m
[2m    CONST_STRING0,[22m
[2m    CONST_STRING1,[22m
[2m  } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    return {[22m
[2m      getValue() {[22m
[2m        return identity(value);[22m
[2m      },[22m
[2m    }.getValue()[22m
[2m      ? CONST_STRING0[22m
[2m      : CONST_STRING1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: createHookWrapper(useHook),[22m
[2m    params: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"result":"global string 1","shouldInvokeFns":true}</div>[22m

[31m[1mFAIL:[22m[39m object-expression-string-literal-key
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {['foo']: props.foo};[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.foo) {[22m
[2m      t0 = { foo: props.foo };[22m
[2m      $[0] = props.foo;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m object-expression-computed-key
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  const SCALE = 2;[22m

[2m  function Component(props) {[22m
[2m    const {key} = props;[22m
[2m    const context = {[22m
[2m      [key]: identity([props.value, SCALE]),[22m
[2m    };[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{key: 'Sathya', value: 'Compiler'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const SCALE = 2;[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    const { key } = props;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = identity([props.value, SCALE]);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== key || $[3] !== t0) {[22m
[2m      t1 = { [key]: t0 };[22m
[2m      $[2] = key;[22m
[2m      $[3] = t0;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const context = t1;[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ key: "Sathya", value: "Compiler" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"Sathya":["Compiler",2]}[22m

[31m[1mFAIL:[22m[39m object-expression-computed-key-object-mutated-later
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, mutate} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const key = {};[22m
[2m    const context = {[22m
[2m      [key]: identity([props.value]),[22m
[2m    };[22m
[2m    mutate(key);[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, mutate } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const key = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== props.value) {[22m
[2m      t1 = identity([props.value]);[22m
[2m      $[1] = props.value;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== t1) {[22m
[2m      t2 = { [key]: t1 };[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    const context = t2;[22m

[2m    mutate(key);[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"[object Object]":[42]}[22m

[31m[1mFAIL:[22m[39m object-expression-computed-key-non-reactive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  const SCALE = 2;[22m

[2m  function Component(props) {[22m
[2m    const key = SCALE;[22m
[2m    const context = {[22m
[2m      [key]: identity([props.value]),[22m
[2m    };[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{key: 'Sathya', value: 'Compiler'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const SCALE = 2;[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = identity([props.value]);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { [SCALE]: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const context = t1;[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ key: "Sathya", value: "Compiler" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"2":["Compiler"]}[22m

[31m[1mFAIL:[22m[39m object-expression-computed-key-constant-string
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const key = 'KeyName';[22m
[2m    const context = {[22m
[2m      [key]: identity([props.value]),[22m
[2m    };[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = identity([props.value]);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { ["KeyName"]: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const context = t1;[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"KeyName":[42]}[22m

[31m[1mFAIL:[22m[39m object-expression-computed-key-constant-number
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const key = 42;[22m
[2m    const context = {[22m
[2m      [key]: identity([props.value]),[22m
[2m    };[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'hello!'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = identity([props.value]);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { [42]: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const context = t1;[22m
[2m    return context;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "hello!" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"42":["hello!"]}[22m

[31m[1mFAIL:[22m[39m object-computed-access-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const x = {...a};[22m
[2m    x[b] = c[b];[22m
[2m    x[1 + 2] = c[b * 4];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    const x = { ...a };[22m
[2m    x[b] = c[b];[22m
[2m    x[3] = c[b * 4];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m obj-mutated-after-nested-if-else-with-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = someObj();[22m
[2m    if (a) {[22m
[2m      let z;[22m
[2m      if (b) {[22m
[2m        const w = someObj();[22m
[2m        z = w;[22m
[2m      } else {[22m
[2m        z = someObj();[22m
[2m      }[22m
[2m      const y = z;[22m
[2m      x = z;[22m
[2m    } else {[22m
[2m      x = someObj();[22m
[2m    }[22m

[2m    x.f = 1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c, d) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    someObj();[22m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      if (a) {[22m
[2m        let z;[22m
[2m        if (b) {[22m
[2m          const w = someObj();[22m
[2m          z = w;[22m
[2m        } else {[22m
[2m          z = someObj();[22m
[2m        }[22m

[2m        x = z;[22m
[2m      } else {[22m
[2m        x = someObj();[22m
[2m      }[22m

[2m      x.f = 1;[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m obj-mutated-after-if-else
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = someObj();[22m
[2m    if (a) {[22m
[2m      x = someObj();[22m
[2m    } else {[22m
[2m      x = someObj();[22m
[2m    }[22m

[2m    x.f = 1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c, d) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    someObj();[22m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      if (a) {[22m
[2m        x = someObj();[22m
[2m      } else {[22m
[2m        x = someObj();[22m
[2m      }[22m

[2m      x.f = 1;[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m obj-mutated-after-if-else-with-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = someObj();[22m
[2m    if (a) {[22m
[2m      const y = someObj();[22m
[2m      const z = y;[22m
[2m      x = z;[22m
[2m    } else {[22m
[2m      x = someObj();[22m
[2m    }[22m

[2m    x.f = 1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c, d) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    someObj();[22m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      if (a) {[22m
[2m        const y = someObj();[22m
[2m        const z = y;[22m
[2m        x = z;[22m
[2m      } else {[22m
[2m        x = someObj();[22m
[2m      }[22m

[2m      x.f = 1;[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m obj-literal-mutated-after-if-else
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = {};[22m
[2m    if (someVal) {[22m
[2m      x = {b};[22m
[2m    } else {[22m
[2m      x = {c};[22m
[2m    }[22m

[2m    x.f = 1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c, d) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    let x;[22m
[2m    if ($[0] !== b || $[1] !== c) {[22m
[2m      if (someVal) {[22m
[2m        x = { b };[22m
[2m      } else {[22m
[2m        x = { c };[22m
[2m      }[22m

[2m      x.f = 1;[22m
[2m      $[0] = b;[22m
[2m      $[1] = c;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m obj-literal-cached-in-if-else
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let x = {};[22m
[2m    if (someVal) {[22m
[2m      x = {b};[22m
[2m    } else {[22m
[2m      x = {c};[22m
[2m    }[22m

[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c, d) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    let x;[22m
[2m    if (someVal) {[22m
[2m      let t0;[22m
[2m      if ($[0] !== b) {[22m
[2m        t0 = { b };[22m
[2m        $[0] = b;[22m
[2m        $[1] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[1];[22m
[2m      }[22m
[2m      x = t0;[22m
[2m    } else {[22m
[2m      let t0;[22m
[2m      if ($[2] !== c) {[22m
[2m        t0 = { c };[22m
[2m        $[2] = c;[22m
[2m        $[3] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[3];[22m
[2m      }[22m
[2m      x = t0;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m nonreactive-noescaping-dependency-can-inline-into-consuming-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow[22m
[2m  function Component() {[22m
[2m    return ([22m
[2m      <div[22m
[2m        className={stylex([22m
[2m          // this value is a) in its own scope, b) non-reactive, and c) non-escaping[22m
[2m          // its scope gets pruned bc it's non-escaping, but this doesn't mean we need to[22m
[2m          // create a temporary for it[22m
[2m          flags.feature('feature-name') ? styles.featureNameStyle : null[22m
[2m        )}></div>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[2m        <div[22m
[32m-         className={stylex([39m
[32m-           flags.feature("feature-name") ? styles.featureNameStyle : null,[39m
[32m-         )}[39m
[31m+         className={function () {[39m
[31m+           const $res$ = stylex([39m
[31m+             flags.feature("feature-name") ? styles.featureNameStyle : null,[39m
[31m+           );[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[2m        />[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Fixture not implemented[22m

[31m[1mFAIL:[22m[39m nonoptional-load-from-optional-memberexpr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Note that `a?.b.c` is semantically different from `(a?.b).c`[22m
[2m  // Here, 'props?.a` is an optional chain, and `.b` is an unconditional load[22m
[2m  // (nullthrows if a is nullish)[22m

[2m  function Component(props) {[22m
[2m    let x = (props?.a).b;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Note that `a?.b.c` is semantically different from `(a?.b).c`[22m
[2m  // Here, 'props?.a` is an optional chain, and `.b` is an unconditional load[22m
[2m  // (nullthrows if a is nullish)[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = (props?.a).b;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m nonmutating-capture-in-unsplittable-memo-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, mutate} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Currently, InferReactiveScopeVariables do not ensure that maybe-aliased[22m
[2m   * values get assigned the same reactive scope. This is safe only when an[22m
[2m   * already-constructed value is captured, e.g.[22m
[2m   * ```js[22m
[2m   * const x = makeObj();  ⌝ mutable range of x[22m
[2m   * mutate(x);            ⌟[22m
[2m   *                       <-- after this point, we can produce a canonical version[22m
[2m   *                           of x for all following aliases[22m
[2m   * const y = [];[22m
[2m   * y.push(x);            <-- y captures x[22m
[2m   * ```[22m
[2m   *[22m
[2m   * However, if a value is captured/aliased during its mutable range and the[22m
[2m   * capturing container is separately memoized, it becomes difficult to guarantee[22m
[2m   * that all aliases refer to the same value.[22m
[2m   *[22m
[2m   */[22m
[2m  function useFoo({a, b}) {[22m
[2m    const x = {a};[22m
[2m    const y = {};[22m
[2m    mutate(x);[22m
[2m    const z = [identity(y), b];[22m
[2m    mutate(y);[22m

[2m    if (z[0] !== y) {[22m
[2m      throw new Error('oh no!');[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{a: 2, b: 3}],[22m
[2m    sequentialRenders: [[22m
[2m      {a: 2, b: 3},[22m
[2m      {a: 4, b: 3},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, mutate } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Currently, InferReactiveScopeVariables do not ensure that maybe-aliased[22m
[2m   * values get assigned the same reactive scope. This is safe only when an[22m
[2m   * already-constructed value is captured, e.g.[22m
[2m   * ```js[22m
[2m   * const x = makeObj();  ⌝ mutable range of x[22m
[2m   * mutate(x);            ⌟[22m
[2m   *                       <-- after this point, we can produce a canonical version[22m
[2m   *                           of x for all following aliases[22m
[2m   * const y = [];[22m
[2m   * y.push(x);            <-- y captures x[22m
[2m   * ```[22m
[2m   *[22m
[2m   * However, if a value is captured/aliased during its mutable range and the[22m
[2m   * capturing container is separately memoized, it becomes difficult to guarantee[22m
[2m   * that all aliases refer to the same value.[22m
[2m   *[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let z;[22m
[2m    let y;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      mutate(x);[22m
[2m      z = [identity(y), b];[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = z;[22m
[2m      $[3] = y;[22m
[2m    } else {[22m
[2m      z = $[2];[22m
[2m      y = $[3];[22m
[2m    }[22m
[2m    if (z[0] !== y) {[22m
[2m      throw new Error("oh no!");[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ a: 2, b: 3 }],[22m
[2m    sequentialRenders: [[22m
[2m      { a: 2, b: 3 },[22m
[2m      { a: 4, b: 3 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"wat0":"joe"},3][22m
[2m  [{"wat0":"joe"},3][22m

[31m[1mFAIL:[22m[39m non-null-assertion
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  interface ComponentProps {[22m
[2m    name?: string;[22m
[2m  }[22m

[2m  function Component(props: ComponentProps) {[22m
[2m    return props.name!.toUpperCase();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Alice'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  interface ComponentProps {[22m
[2m    name?: string;[22m
[2m  }[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = props.name.toUpperCase();[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Alice" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "ALICE"[22m

[31m[1mFAIL:[22m[39m noAlias-filter-on-array-prop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const filtered = props.items.filter(item => item != null);[22m
[2m    return filtered;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        items: [{a: true}, null, true, false, null, 'string', 3.14, null, [null]],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.items) {[22m
[2m      t0 = props.items.filter(_temp);[22m
[2m      $[0] = props.items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const filtered = t0;[22m
[2m    return filtered;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    return item != null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        items: [[22m
[2m          { a: true },[22m
[2m          null,[22m
[2m          true,[22m
[2m          false,[22m
[2m          null,[22m
[2m          "string",[22m
[2m          3.14,[22m
[2m          null,[22m
[2m          [null],[22m
[2m        ],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":true},true,false,"string",3.14,[null]][22m

[31m[1mFAIL:[22m[39m no-flow-bailout-unrelated
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableFlowSuppressions[22m

[2m  function useX() {}[22m

[2m  function Foo(props) {[22m
[2m    // $FlowFixMe[incompatible-type][22m
[2m    useX();[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @enableFlowSuppressions[22m

[2m  function useX() {}[22m

[2m  function Foo(props) {[22m
[32m-   useX();[39m
[31m+   Object.freeze(props);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useX();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m new-spread
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = new Foo(...props.foo, null, ...[props.bar]);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.bar || $[1] !== props.foo) {[22m
[2m      t0 = new Foo(...props.foo, null, ...[props.bar]);[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = props.foo;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m new-does-not-mutate-class
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  class Foo {}[22m
[2m  function Component({val}) {[22m
[2m    const MyClass = identity(Foo);[22m
[2m    const x = [val];[22m
[2m    const y = new MyClass();[22m

[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{val: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  class Foo {}[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { val } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = identity(Foo);[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    const MyClass = t1;[22m
[2m    let t2;[22m
[2m    if ($[1] !== val) {[22m
[2m      t2 = [val];[22m
[2m      $[1] = val;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    const x = t2;[22m
[2m    let t3;[22m
[2m    if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t3 = new MyClass();[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[2m    const y = t3;[22m
[2m    let t4;[22m
[2m    if ($[4] !== x) {[22m
[2m      t4 = [x, y];[22m
[2m      $[4] = x;[22m
[2m      $[5] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[5];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ val: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[0],{}][22m

[31m[1mFAIL:[22m[39m nested-scopes-hook-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(props) {[22m
[2m    let x = [];[22m
[2m    let y = [];[22m
[2m    y.push(useHook(props.foo));[22m
[2m    x.push(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [];[22m
[2m    const y = [];[22m
[32m-   y.push(useHook(props.foo));[39m
[31m+   y.push([39m
[31m+     (function () {[39m
[31m+       const $res$ = useHook(Object.freeze(props.foo));[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })(),[39m
[31m+   );[39m
[2m    x.push(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m nested-scopes-begin-same-instr-valueblock
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, mutate} from 'shared-runtime';[22m

[2m  function Foo({cond}) {[22m
[2m    const x = identity(identity(cond)) ? {a: 2} : {b: 2};[22m

[2m    mutate(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{cond: false}],[22m
[2m    sequentialRenders: [{cond: false}, {cond: false}, {cond: true}, {cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, mutate } from "shared-runtime";[22m

[2m  function Foo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond) {[22m
[2m      x = identity(identity(cond)) ? { a: 2 } : { b: 2 };[22m

[2m      mutate(x);[22m
[2m      $[0] = cond;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":2,"wat0":"joe"}[22m
[2m  {"b":2,"wat0":"joe"}[22m
[2m  {"a":2,"wat0":"joe"}[22m
[2m  {"a":2,"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m nested-optional-member-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // We should codegen nested optional properties correctly[22m
[2m  // (i.e. placing `?` in the correct PropertyLoad)[22m
[2m  function Component(props) {[22m
[2m    let x = foo(props.a?.b.c.d);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // We should codegen nested optional properties correctly[22m
[2m  // (i.e. placing `?` in the correct PropertyLoad)[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const t0 = props.a?.b.c.d;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = foo(t0);[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m nested-function-shadowed-identifiers
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [x, setX] = useState(null);[22m

[2m    const onChange = e => {[22m
[2m      let x = null; // intentionally shadow the original x[22m
[2m      setX(currentX => currentX + x); // intentionally refer to shadowed x[22m
[2m    };[22m

[2m    return <input value={x} onChange={onChange} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[32m-   const [x, setX] = useState(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x, setX] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = (e) => {[22m
[2m        setX((currentX) => currentX + null);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onChange = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== x) {[22m
[32m-     t1 = <input value={x} onChange={onChange} />;[39m
[31m+     t1 = ([39m
[31m+       <input[39m
[31m+         value={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m mutation-within-jsx
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
<div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>
<div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m mutation-within-jsx-and-break
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
<div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>
<div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m mutation-within-capture-and-mutablerange
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * This test fixture is similar to mutation-within-jsx. The only difference[22m
[2m   * is that there is no `freeze` effect here, which means that `z` may be[22m
[2m   * mutated after its memo block through mutating `y`.[22m
[2m   *[22m
[2m   * While this is technically correct (as `z` is a nested memo block), it[22m
[2m   * is an edge case as we believe that values are not mutated after their[22m
[2m   * memo blocks (which may lead to 'tearing', i.e. mutating one render's[22m
[2m   * values in a subsequent render.[22m
[2m   */[22m
[2m  function useFoo({a, b}) {[22m
[2m    // x and y's scopes start here[22m
[2m    const x = {a};[22m
[2m    const y = [b];[22m
[2m    mutate(x);[22m
[2m    // z captures the result of `mutate(y)`, which may be aliased to `y`.[22m
[2m    const z = [mutate(y)];[22m
[2m    // the following line may also mutate z[22m
[2m    mutate(y);[22m
[2m    // and end here[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{a: 2, b: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  /**[22m
[2m   * This test fixture is similar to mutation-within-jsx. The only difference[22m
[2m   * is that there is no `freeze` effect here, which means that `z` may be[22m
[2m   * mutated after its memo block through mutating `y`.[22m
[2m   *[22m
[2m   * While this is technically correct (as `z` is a nested memo block), it[22m
[2m   * is an edge case as we believe that values are not mutated after their[22m
[2m   * memo blocks (which may lead to 'tearing', i.e. mutating one render's[22m
[2m   * values in a subsequent render.[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let z;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const x = { a };[22m
[2m      const y = [b];[22m
[2m      mutate(x);[22m

[2m      z = [mutate(y)];[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = z;[22m
[2m    } else {[22m
[2m      z = $[2];[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ a: 2, b: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null][22m

[31m[1mFAIL:[22m[39m mutation-during-jsx-construction
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, mutate, mutateAndReturnNewValue} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const key = {};[22m
[2m    // Key is modified by the function, but key itself is not frozen[22m
[2m    const element = <div key={mutateAndReturnNewValue(key)}>{props.value}</div>;[22m
[2m    // Key is later mutated here: this mutation must be grouped with the[22m
[2m    // jsx construction above[22m
[2m    mutate(key);[22m
[2m    return element;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, mutate, mutateAndReturnNewValue } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let element;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      const key = {};[22m

[32m-     element = <div key={mutateAndReturnNewValue(key)}>{props.value}</div>;[39m
[31m+     element = ([39m
[31m+       <div[39m
[31m+         key={function () {[39m
[31m+           const $res$ = mutateAndReturnNewValue(key);[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {props.value}[39m
[31m+       </div>[39m
[31m+     );[39m

[2m      mutate(key);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = element;[22m
[2m    } else {[22m
[2m      element = $[1];[22m
[2m    }[22m
[2m    return element;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>42</div>[22m

[31m[1mFAIL:[22m[39m mutate-outer-scope-within-value-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {CONST_TRUE, identity, shallowCopy} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * There are three values with their own scopes in this fixture.[22m
[2m   * - arr, whose mutable range extends to the `mutate(...)` call[22m
[2m   * - cond, which has a mutable range of exactly 1 (e.g. created but not[22m
[2m   *   mutated)[22m
[2m   * - { val: CONST_TRUE }, which is also not mutated after creation. However,[22m
[2m   *   its scope range becomes extended to the value block.[22m
[2m   *[22m
[2m   * After AlignScopesToBlockScopes, our scopes look roughly like this[22m
[2m   * ```js[22m
[2m   *  [1] arr = shallowCopy()            ⌝@0[22m
[2m   *  [2] cond = identity()        <- @1 |[22m
[2m   *  [3] $0 = Ternary test=cond     ⌝@2 |[22m
[2m   *  [4]        {val : CONST_TRUE}  |   |[22m
[2m   *  [5]        mutate(arr)         |   |[22m
[2m   *  [6] return $0                  ⌟   ⌟[22m
[2m   * ```[22m
[2m   *[22m
[2m   * Observe that instruction 5 mutates scope 0, which means that scopes 0 and 2[22m
[2m   * should be merged.[22m
[2m   */[22m
[2m  function useFoo({input}) {[22m
[2m    const arr = shallowCopy(input);[22m

[2m    const cond = identity(false);[22m
[2m    return cond ? {val: CONST_TRUE} : mutate(arr);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { CONST_TRUE, identity, shallowCopy } from "shared-runtime";[22m

[2m  /**[22m
[2m   * There are three values with their own scopes in this fixture.[22m
[2m   * - arr, whose mutable range extends to the `mutate(...)` call[22m
[2m   * - cond, which has a mutable range of exactly 1 (e.g. created but not[22m
[2m   *   mutated)[22m
[2m   * - { val: CONST_TRUE }, which is also not mutated after creation. However,[22m
[2m   *   its scope range becomes extended to the value block.[22m
[2m   *[22m
[2m   * After AlignScopesToBlockScopes, our scopes look roughly like this[22m
[2m   * ```js[22m
[2m   *  [1] arr = shallowCopy()            ⌝@0[22m
[2m   *  [2] cond = identity()        <- @1 |[22m
[2m   *  [3] $0 = Ternary test=cond     ⌝@2 |[22m
[2m   *  [4]        {val : CONST_TRUE}  |   |[22m
[2m   *  [5]        mutate(arr)         |   |[22m
[2m   *  [6] return $0                  ⌟   ⌟[22m
[2m   * ```[22m
[2m   *[22m
[2m   * Observe that instruction 5 mutates scope 0, which means that scopes 0 and 2[22m
[2m   * should be merged.[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== input) {[22m
[2m      const arr = shallowCopy(input);[22m

[2m      const cond = identity(false);[22m
[2m      t1 = cond ? { val: CONST_TRUE } : mutate(arr);[22m
[2m      $[0] = input;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) mutate is not defined[22m

[31m[1mFAIL:[22m[39m mutable-liverange-loop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function mutate() {}[22m
[2m  function cond() {}[22m

[2m  function Component(props) {[22m
[2m    let a = {};[22m
[2m    let b = {};[22m
[2m    let c = {};[22m
[2m    let d = {};[22m
[2m    while (true) {[22m
[2m      mutate(a, b);[22m
[2m      if (cond(a)) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m

[2m    // all of these tests are seemingly readonly, since the values are never directly[22m
[2m    // mutated again. but they are all aliased by `d`, which is later modified, and[22m
[2m    // these are therefore mutable references:[22m
[2m    if (a) {[22m
[2m    }[22m
[2m    if (b) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (d) {[22m
[2m    }[22m

[2m    mutate(d, null);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function mutate() {}[22m
[2m  function cond() {}[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const a = {};[22m
[2m    const b = {};[22m
[2m    const c = {};[22m
[2m    const d = {};[22m
[2m    while (true) {[22m
[2m      mutate(a, b);[22m
[2m      if (cond(a)) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    if (a) {[22m
[2m    }[22m
[2m    if (b) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (d) {[22m
[2m    }[22m

[2m    mutate(d, null);[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m mutable-lifetime-with-aliasing
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function mutate(x, y) {[22m
[2m    'use no forget';[22m
[2m    if (!Array.isArray(x.value)) {[22m
[2m      x.value = [];[22m
[2m    }[22m
[2m    x.value.push(y);[22m
[2m    if (y != null) {[22m
[2m      y.value = x;[22m
[2m    }[22m
[2m  }[22m

[2m  function Component(props) {[22m
[2m    const a = {};[22m
[2m    const b = [a]; // array elements alias[22m
[2m    const c = {};[22m
[2m    const d = {c}; // object values alias[22m

[2m    // capture all the values into this object[22m
[2m    const x = {};[22m
[2m    x.b = b;[22m
[2m    const y = mutate(x, d); // mutation aliases the arg and return value[22m

[2m    // all of these tests are seemingly readonly, since the values are never directly[22m
[2m    // mutated again. but they are all aliased by `x`, which is later modified, and[22m
[2m    // these are therefore mutable references:[22m
[2m    if (a) {[22m
[2m    }[22m
[2m    if (b) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (d) {[22m
[2m    }[22m
[2m    if (y) {[22m
[2m    }[22m

[2m    // could in theory mutate any of a/b/c/x/z, so the above should be inferred as mutable[22m
[2m    mutate(x, null);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function mutate(x, y) {[22m
[2m    "use no forget";[22m
[2m    if (!Array.isArray(x.value)) {[22m
[2m      x.value = [];[22m
[2m    }[22m
[2m    x.value.push(y);[22m
[2m    if (y != null) {[22m
[2m      y.value = x;[22m
[2m    }[22m
[2m  }[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = {};[22m
[2m      const b = [a];[22m
[2m      const c = {};[22m
[2m      const d = { c };[22m

[2m      x = {};[22m
[2m      x.b = b;[22m
[2m      const y = mutate(x, d);[22m
[2m      if (a) {[22m
[2m      }[22m
[2m      if (b) {[22m
[2m      }[22m
[2m      if (c) {[22m
[2m      }[22m
[2m      if (d) {[22m
[2m      }[22m
[2m      if (y) {[22m
[2m      }[22m

[2m      mutate(x, null);[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":[{}],"value":[{"c":{},"value":"[[ cyclic ref *0 ]]"},null]}[22m

[31m[1mFAIL:[22m[39m mutable-lifetime-loops
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function mutate(x, y) {[22m
[2m    'use no forget';[22m
[2m    if (x != null) {[22m
[2m      x.value = (x.value ?? 0) + 1;[22m
[2m    }[22m
[2m    if (y != null) {[22m
[2m      y.value = (y.value ?? 0) + 1;[22m
[2m    }[22m
[2m  }[22m
[2m  function cond(x) {[22m
[2m    'use no forget';[22m
[2m    return x.value > 5;[22m
[2m  }[22m

[2m  function testFunction(props) {[22m
[2m    let a = {};[22m
[2m    let b = {};[22m
[2m    let c = {};[22m
[2m    let d = {};[22m
[2m    while (true) {[22m
[2m      let z = a;[22m
[2m      a = b;[22m
[2m      b = c;[22m
[2m      c = d;[22m
[2m      d = z;[22m
[2m      mutate(a, b);[22m
[2m      if (cond(a)) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m

[2m    // all of these tests are seemingly readonly, since the values are never directly[22m
[2m    // mutated again. but they are all aliased by `d`, which is later modified, and[22m
[2m    // these are therefore mutable references:[22m
[2m    if (a) {[22m
[2m    }[22m
[2m    if (b) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (d) {[22m
[2m    }[22m

[2m    mutate(d, null);[22m
[2m    return {a, b, c, d};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: testFunction,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function mutate(x, y) {[22m
[2m    "use no forget";[22m
[2m    if (x != null) {[22m
[2m      x.value = (x.value ?? 0) + 1;[22m
[2m    }[22m
[2m    if (y != null) {[22m
[2m      y.value = (y.value ?? 0) + 1;[22m
[2m    }[22m
[2m  }[22m
[2m  function cond(x) {[22m
[2m    "use no forget";[22m
[2m    return x.value > 5;[22m
[2m  }[22m

[2m  function testFunction(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      let a = {};[22m
[2m      let b = {};[22m
[2m      let c = {};[22m
[2m      let d = {};[22m
[2m      while (true) {[22m
[2m        const z = a;[22m
[2m        a = b;[22m
[2m        b = c;[22m
[2m        c = d;[22m
[2m        d = z;[22m
[2m        mutate(a, b);[22m
[2m        if (cond(a)) {[22m
[2m          break;[22m
[2m        }[22m
[2m      }[22m
[2m      if (a) {[22m
[2m      }[22m
[2m      if (b) {[22m
[2m      }[22m
[2m      if (c) {[22m
[2m      }[22m
[2m      if (d) {[22m
[2m      }[22m

[2m      mutate(d, null);[22m
[2m      t0 = { a, b, c, d };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: testFunction,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":{"value":6},"b":{"value":5},"c":{"value":4},"d":{"value":6}}[22m

[31m[1mFAIL:[22m[39m multiple-calls-to-hoisted-callback-from-other-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const [_state, setState] = useState();[22m
[2m    const a = () => {[22m
[2m      return b();[22m
[2m    };[22m
[2m    const b = () => {[22m
[2m      return ([22m
[2m        <>[22m
[2m          <div onClick={() => onClick(true)}>a</div>[22m
[2m          <div onClick={() => onClick(false)}>b</div>[22m
[2m        </>[22m
[2m      );[22m
[2m    };[22m
[2m    const onClick = value => {[22m
[2m      setState(value);[22m
[2m    };[22m

[2m    return <div>{a()}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[32m-   const [_state, setState] = useState();[39m
[31m+   Object.freeze(props);[39m
[31m+   const [_state, setState] = (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = () => b();[22m

[2m      const b = () => ([22m
[2m        <>[22m
[32m-         <div onClick={() => onClick(true)}>a</div>[39m
[32m-         <div onClick={() => onClick(false)}>b</div>[39m
[31m+         <div[39m
[31m+           onClick={function () {[39m
[31m+             const $res$ = () => onClick(true);[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+         >[39m
[31m+           a[39m
[31m+         </div>[39m
[31m+         <div[39m
[31m+           onClick={function () {[39m
[31m+             const $res$ = () => onClick(false);[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+         >[39m
[31m+           b[39m
[31m+         </div>[39m
[2m        </>[22m
[2m      );[22m

[2m      const onClick = (value) => {[22m
[2m        setState(value);[22m
[2m      };[22m

[2m      t0 = <div>{a()}</div>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>a</div><div>b</div></div>[22m

[31m[1mFAIL:[22m[39m multi-directive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    'use foo';[22m
[2m    'use bar';[22m
[2m    return <div>"foo"</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[32m-   "use foo";[39m
[32m-   "use bar";[39m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div>"foo"</div>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>"foo"</div>[22m

[31m[1mFAIL:[22m[39m multi-arrow-expr-gating-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating[22m
[2m  const ErrorView = (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  const Renderer = props => ([22m
[2m    <Foo>[22m
[2m      <Bar></Bar>[22m
[2m      <ErrorView></ErrorView>[22m
[2m    </Foo>[22m
[2m  );[22m

[2m  export default Renderer;[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating[22m
[2m  const ErrorView = isForgetEnabled_Fixtures()[22m
[2m    ? (error, _retry) => {[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(error);[39m
[31m+       Object.freeze(_retry);[39m
[2m        let t0;[22m
[2m        if ($[0] !== error) {[22m
[32m-         t0 = <MessageBox error={error} />;[39m
[31m+         t0 = ([39m
[31m+           <MessageBox[39m
[31m+             error={function () {[39m
[31m+               const $res$ = error;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[0] = error;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  const Renderer = isForgetEnabled_Fixtures()[22m
[2m    ? (props) => {[22m
[2m        const $ = _c(1);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = ([22m
[2m            <Foo>[22m
[2m              <Bar />[22m
[2m              <ErrorView />[22m
[2m            </Foo>[22m
[2m          );[22m
[2m          $[0] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[0];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (props) => ([22m
[2m        <Foo>[22m
[2m          <Bar></Bar>[22m
[2m          <ErrorView></ErrorView>[22m
[2m        </Foo>[22m
[2m      );[22m
[2m  export default Renderer;[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m multi-arrow-expr-export-gating-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating[22m
[2m  const ErrorView = (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  export const Renderer = props => ([22m
[2m    <Foo>[22m
[2m      <Bar></Bar>[22m
[2m      <ErrorView></ErrorView>[22m
[2m    </Foo>[22m
[2m  );[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating[22m
[2m  const ErrorView = isForgetEnabled_Fixtures()[22m
[2m    ? (error, _retry) => {[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(error);[39m
[31m+       Object.freeze(_retry);[39m
[2m        let t0;[22m
[2m        if ($[0] !== error) {[22m
[32m-         t0 = <MessageBox error={error} />;[39m
[31m+         t0 = ([39m
[31m+           <MessageBox[39m
[31m+             error={function () {[39m
[31m+               const $res$ = error;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[0] = error;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  export const Renderer = isForgetEnabled_Fixtures()[22m
[2m    ? (props) => {[22m
[2m        const $ = _c(1);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = ([22m
[2m            <Foo>[22m
[2m              <Bar />[22m
[2m              <ErrorView />[22m
[2m            </Foo>[22m
[2m          );[22m
[2m          $[0] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[0];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (props) => ([22m
[2m        <Foo>[22m
[2m          <Bar></Bar>[22m
[2m          <ErrorView></ErrorView>[22m
[2m        </Foo>[22m
[2m      );[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m multi-arrow-expr-export-default-gating-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating[22m
[2m  const ErrorView = (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  export default Renderer = props => ([22m
[2m    <Foo>[22m
[2m      <Bar></Bar>[22m
[2m      <ErrorView></ErrorView>[22m
[2m    </Foo>[22m
[2m  );[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating[22m
[2m  const ErrorView = isForgetEnabled_Fixtures()[22m
[2m    ? (error, _retry) => {[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(error);[39m
[31m+       Object.freeze(_retry);[39m
[2m        let t0;[22m
[2m        if ($[0] !== error) {[22m
[32m-         t0 = <MessageBox error={error} />;[39m
[31m+         t0 = ([39m
[31m+           <MessageBox[39m
[31m+             error={function () {[39m
[31m+               const $res$ = error;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[0] = error;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  export default Renderer = isForgetEnabled_Fixtures()[22m
[2m    ? (props) => {[22m
[2m        const $ = _c(1);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = ([22m
[2m            <Foo>[22m
[2m              <Bar />[22m
[2m              <ErrorView />[22m
[2m            </Foo>[22m
[2m          );[22m
[2m          $[0] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[0];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (props) => ([22m
[2m        <Foo>[22m
[2m          <Bar></Bar>[22m
[2m          <ErrorView></ErrorView>[22m
[2m        </Foo>[22m
[2m      );[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m module-scoped-bindings
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import React from 'react';[22m
[2m  import {useState} from 'react';[22m

[2m  const CONST = true;[22m

[2m  let NON_REASSIGNED_LET = true;[22m

[2m  let REASSIGNED_LET = false;[22m
[2m  REASSIGNED_LET = true;[22m

[2m  function reassignedFunction() {}[22m
[2m  reassignedFunction = true;[22m

[2m  function nonReassignedFunction() {}[22m

[2m  class ReassignedClass {}[22m
[2m  ReassignedClass = true;[22m

[2m  class NonReassignedClass {}[22m

[2m  function Component() {[22m
[2m    const [state] = useState(null);[22m
[2m    return [[22m
[2m      React,[22m
[2m      state,[22m
[2m      CONST,[22m
[2m      NON_REASSIGNED_LET,[22m
[2m      REASSIGNED_LET,[22m
[2m      reassignedFunction,[22m
[2m      nonReassignedFunction,[22m
[2m      ReassignedClass,[22m
[2m      NonReassignedClass,[22m
[2m    ];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import React from "react";[22m
[2m  import { useState } from "react";[22m

[2m  const CONST = true;[22m

[2m  let NON_REASSIGNED_LET = true;[22m

[2m  let REASSIGNED_LET = false;[22m
[2m  REASSIGNED_LET = true;[22m

[2m  function reassignedFunction() {}[22m
[2m  reassignedFunction = true;[22m

[2m  function nonReassignedFunction() {}[22m

[2m  class ReassignedClass {}[22m
[2m  ReassignedClass = true;[22m

[2m  class NonReassignedClass {}[22m

[2m  function Component() {[22m
[2m    const $ = _c(2);[22m
[32m-   const [state] = useState(null);[39m
[31m+   const [state] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== state) {[22m
[2m      t0 = [[22m
[2m        React,[22m

[2m        state,[22m
[2m        CONST,[22m
[2m        NON_REASSIGNED_LET,[22m
[2m        REASSIGNED_LET,[22m
[2m        reassignedFunction,[22m
[2m        nonReassignedFunction,[22m
[2m        ReassignedClass,[22m
[2m        NonReassignedClass,[22m
[2m      ];[22m
[2m      $[0] = state;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"Children":{"map":"[[ function params=3 ]]","forEach":"[[ function params=3 ]]","count":"[[ function params=1 ]]","toArray":"[[ function params=1 ]]","only":"[[ function params=1 ]]"},"Component":"[[ function params=3 ]]","PureComponent":"[[ function params=3 ]]","__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE":{"H":{"readContext":"[[ function params=1 ]]","use":"[[ function params=1 ]]","useCallback":"[[ function params=2 ]]","useContext":"[[ function params=1 ]]","useEffect":"[[ function params=2 ]]","useImperativeHandle":"[[ function params=3 ]]","useInsertionEffect":"[[ function params=2 ]]","useLayoutEffect":"[[ function params=2 ]]","useMemo":"[[ function params=2 ]]","useReducer":"[[ function params=3 ]]","useRef":"[[ function params=1 ]]","useState":"[[ function params=1 ]]","useDebugValue":"[[ function params=2 ]]","useDeferredValue":"[[ function params=2 ]]","useTransition":"[[ function params=0 ]]","useSyncExternalStore":"[[ function params=3 ]]","useId":"[[ function params=0 ]]","useCacheRefresh":"[[ function params=0 ]]","useMemoCache":"[[ function params=1 ]]","useHostTransitionStatus":"[[ function params=0 ]]","useFormState":"[[ function params=3 ]]","useActionState":"[[ function params=3 ]]","useOptimistic":"[[ function params=2 ]]"},"A":{"getCacheForType":"[[ function params=1 ]]","getOwner":"[[ function params=0 ]]"},"T":null,"actQueue":["[[ function params=0 ]]","[[ function params=1 ]]"],"isBatchingLegacy":false,"didScheduleLegacyUpdate":false,"didUsePromise":false,"thrownErrors":[],"setExtraStackFrame":"[[ function params=1 ]]","getCurrentStack":"[[ function params=0 ]]","getStackAddendum":"[[ function params=0 ]]"},"act":"[[ function params=1 ]]","cache":"[[ function params=1 ]]","cloneElement":"[[ function params=3 ]]","createContext":"[[ function params=1 ]]","createElement":"[[ function params=3 ]]","createRef":"[[ function params=0 ]]","forwardRef":"[[ function params=1 ]]","isValidElement":"[[ function params=1 ]]","lazy":"[[ function params=1 ]]","memo":"[[ function params=2 ]]","startTransition":"[[ function params=2 ]]","unstable_useCacheRefresh":"[[ function params=0 ]]","use":"[[ function params=1 ]]","useActionState":"[[ function params=3 ]]","useCallback":"[[ function params=2 ]]","useContext":"[[ function params=1 ]]","useDebugValue":"[[ function params=2 ]]","useDeferredValue":"[[ function params=2 ]]","useEffect":"[[ function params=2 ]]","useId":"[[ function params=0 ]]","useImperativeHandle":"[[ function params=3 ]]","useInsertionEffect":"[[ function params=2 ]]","useLayoutEffect":"[[ function params=2 ]]","useMemo":"[[ function params=2 ]]","useOptimistic":"[[ function params=2 ]]","useReducer":"[[ function params=3 ]]","useRef":"[[ function params=1 ]]","useState":"[[ function params=1 ]]","useSyncExternalStore":"[[ function params=3 ]]","useTransition":"[[ function params=0 ]]","version":"19.0.0-beta-b498834eab-20240506","c":"[[ function params=1 ]]"},"[[ cyclic ref *6 ]]",true,true,true,true,"[[ function params=0 ]]",true,"[[ function params=0 ]]"][22m

[31m[1mFAIL:[22m[39m method-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {addOne, shallowCopy} from 'shared-runtime';[22m

[2m  function foo(a, b, c) {[22m
[2m    // Construct and freeze x[22m
[2m    const x = shallowCopy(a);[22m
[2m    <div>{x}</div>;[22m

[2m    // y should depend on `x` and `b`[22m
[2m    const y = x.foo(b);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{foo: addOne}, 3],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { addOne, shallowCopy } from "shared-runtime";[22m

[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = shallowCopy(a);[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== x || $[3] !== b) {[22m
[2m      t1 = x.foo(b);[22m
[2m      $[2] = x;[22m
[2m      $[3] = b;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{ foo: addOne }, 3],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 4[22m

[31m[1mFAIL:[22m[39m method-call-fn-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    // Construct and freeze x[22m
[2m    const x = makeObject(a);[22m
[2m    <div>{x}</div>;[22m

[2m    // y should depend on `x` and `b`[22m
[2m    const method = x.method;[22m
[2m    const y = method.call(x, b);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = makeObject(a);[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m

[2m    const method = x.method;[22m
[2m    let t1;[22m
[2m    if ($[2] !== method || $[3] !== x || $[4] !== b) {[22m
[2m      t1 = method.call(x, b);[22m
[2m      $[2] = method;[22m
[2m      $[3] = x;[22m
[2m      $[4] = b;[22m
[2m      $[5] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[5];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m method-call-computed
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    // Construct and freeze x, y[22m
[2m    const x = makeObject(a);[22m
[2m    const y = makeObject(a);[22m
[2m    <div>[22m
[2m      {x}[22m
[2m      {y}[22m
[2m    </div>;[22m

[2m    // z should depend on `x`, `y.method`, and `b`[22m
[2m    const z = x[y.method](b);[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = makeObject(a);[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== a) {[22m
[2m      t1 = makeObject(a);[22m
[2m      $[2] = a;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== x || $[5] !== y.method || $[6] !== b) {[22m
[2m      t2 = x[y.method](b);[22m
[2m      $[4] = x;[22m
[2m      $[5] = y.method;[22m
[2m      $[6] = b;[22m
[2m      $[7] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[7];[22m
[2m    }[22m
[2m    const z = t2;[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m merged-scopes-are-valid-effect-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateMemoizedEffectDependencies[22m

[2m  import {useEffect} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const y = [[props.value]]; // merged w scope for inner array[22m

[2m    useEffect(() => {[22m
[2m      console.log(y);[22m
[2m    }, [y]); // should still be a valid dependency here[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateMemoizedEffectDependencies[22m

[2m  import { useEffect } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = [[props.value]];[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== y) {[22m
[2m      t1 = () => {[22m
[2m        console.log(y);[22m
[2m      };[22m
[2m      t2 = [y];[22m
[2m      $[2] = y;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[32m-   useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[42]][22m
[2m  logs: [[ [ 42 ] ]][22m

[31m[1mFAIL:[22m[39m merge-scopes-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableInstructionReordering[22m
[2m  import {useState} from 'react';[22m

[2m  function Component() {[22m
[2m    const [state, setState] = useState(0);[22m
[2m    const onClick = () => {[22m
[2m      setState(s => s + 1);[22m
[2m    };[22m
[2m    return ([22m
[2m      <>[22m
[2m        <span>Count: {state}</span>[22m
[2m        <button onClick={onClick}>Increment</button>[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableInstructionReordering[22m
[2m  import { useState } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(4);[22m
[32m-   const [state, setState] = useState(0);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        setState((s) => s + 1);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t1 = <button onClick={onClick}>Increment</button>;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         Increment[39m
[31m+       </button>[39m
[31m+     );[39m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] !== state) {[22m
[2m      t2 = ([22m
[2m        <>[22m
[2m          <span>Count: {state}</span>[22m
[2m          {t1}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[2] = state;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Fixture not implemented[22m

[31m[1mFAIL:[22m[39m merge-nested-scopes-with-same-inputs
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {setProperty} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    // start of scope for y, depend on props.a[22m
[2m    let y = {};[22m

[2m    // nested scope for x, dependent on props.a[22m
[2m    const x = {};[22m
[2m    setProperty(x, props.a);[22m
[2m    // end of scope for x[22m

[2m    y.a = props.a;[22m
[2m    y.x = x;[22m
[2m    // end of scope for y[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { setProperty } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      y = {};[22m

[2m      const x = {};[22m
[2m      setProperty(x, props.a);[22m

[2m      y.a = props.a;[22m
[2m      y.x = x;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":42,"x":{"wat0":42}}[22m

[31m[1mFAIL:[22m[39m merge-consecutive-scopes
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react';[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  function Component() {[22m
[2m    let [state, setState] = useState(0);[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <Stringify text="Counter" />[22m
[2m        <span>{state}</span>[22m
[2m        <button data-testid="button" onClick={() => setState(state + 1)}>[22m
[2m          increment[22m
[2m        </button>[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  function Component() {[22m
[2m    const $ = _c(8);[22m
[32m-   const [state, setState] = useState(0);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <Stringify text="Counter" />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[1] !== state) {[22m
[2m      t1 = <span>{state}</span>;[22m
[2m      $[1] = state;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== state) {[22m
[2m      t2 = ([22m
[32m-       <button data-testid="button" onClick={() => setState(state + 1)}>[39m
[31m+       <button[39m
[31m+         data-testid="button"[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = () => setState(state + 1);[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[2m          increment[22m
[2m        </button>[22m
[2m      );[22m
[2m      $[3] = state;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== t1 || $[6] !== t2) {[22m
[2m      t3 = ([22m
[2m        <div>[22m
[2m          {t0}[22m
[2m          {t1}[22m
[2m          {t2}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[5] = t1;[22m
[2m      $[6] = t2;[22m
[2m      $[7] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[7];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>{"text":"Counter"}</div><span>0</span><button data-testid="button">increment</button></div>[22m

[31m[1mFAIL:[22m[39m merge-consecutive-scopes-reordering
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableInstructionReordering[22m
[2m  import {useState} from 'react';[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  function Component() {[22m
[2m    let [state, setState] = useState(0);[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <Stringify text="Counter" />[22m
[2m        <span>{state}</span>[22m
[2m        <button data-testid="button" onClick={() => setState(state + 1)}>[22m
[2m          increment[22m
[2m        </button>[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableInstructionReordering[22m
[2m  import { useState } from "react";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  function Component() {[22m
[2m    const $ = _c(7);[22m
[32m-   const [state, setState] = useState(0);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== state) {[22m
[2m      t0 = ([22m
[32m-       <button data-testid="button" onClick={() => setState(state + 1)}>[39m
[31m+       <button[39m
[31m+         data-testid="button"[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = () => setState(state + 1);[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[2m          increment[22m
[2m        </button>[22m
[2m      );[22m
[2m      t1 = <span>{state}</span>;[22m
[2m      $[0] = state;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = <Stringify text="Counter" />;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[4] !== t1 || $[5] !== t0) {[22m
[2m      t3 = ([22m
[2m        <div>[22m
[2m          {t2}[22m
[2m          {t1}[22m
[2m          {t0}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t0;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>{"text":"Counter"}</div><span>0</span><button data-testid="button">increment</button></div>[22m

[31m[1mFAIL:[22m[39m merge-consecutive-scopes-objects
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react';[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  // This is a translation of the original merge-consecutive-scopes which uses plain objects[22m
[2m  // to describe the UI instead of JSX. The JSXText elements in that fixture happen to[22m
[2m  // prevent scome scopes from merging, which concealed a bug with the merging logic.[22m
[2m  // By avoiding JSX we eliminate extraneous instructions and more accurately test the merging.[22m
[2m  function Component(props) {[22m
[2m    let [state, setState] = useState(0);[22m
[2m    return [[22m
[2m      {component: Stringify, props: {text: 'Counter'}},[22m
[2m      {component: 'span', props: {children: [state]}},[22m
[2m      {[22m
[2m        component: 'button',[22m
[2m        props: {[22m
[2m          'data-testid': 'button',[22m
[2m          onClick: () => setState(state + 1),[22m
[2m          children: ['increment'],[22m
[2m        },[22m
[2m      },[22m
[2m    ];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  // This is a translation of the original merge-consecutive-scopes which uses plain objects[22m
[2m  // to describe the UI instead of JSX. The JSXText elements in that fixture happen to[22m
[2m  // prevent scome scopes from merging, which concealed a bug with the merging logic.[22m
[2m  // By avoiding JSX we eliminate extraneous instructions and more accurately test the merging.[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(11);[22m
[32m-   const [state, setState] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { component: Stringify, props: { text: "Counter" } };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[1] !== state) {[22m
[2m      t1 = { component: "span", props: { children: [state] } };[22m
[2m      $[1] = state;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== state) {[22m
[2m      t2 = () => setState(state + 1);[22m
[2m      $[3] = state;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t3 = ["increment"];[22m
[2m      $[5] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[5];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[6] !== t2) {[22m
[2m      t4 = {[22m
[2m        component: "button",[22m
[2m        props: { "data-testid": "button", onClick: t2, children: t3 },[22m
[2m      };[22m
[2m      $[6] = t2;[22m
[2m      $[7] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[7];[22m
[2m    }[22m
[2m    let t5;[22m
[2m    if ($[8] !== t1 || $[9] !== t4) {[22m
[2m      t5 = [t0, t1, t4];[22m
[2m      $[8] = t1;[22m
[2m      $[9] = t4;[22m
[2m      $[10] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[10];[22m
[2m    }[22m
[2m    return t5;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"component":"[[ function params=1 ]]","props":{"text":"Counter"}},{"component":"span","props":{"children":[0]}},{"component":"button","props":{"data-testid":"button","onClick":"[[ function params=0 ]]","children":["increment"]}}][22m

[31m[1mFAIL:[22m[39m merge-consecutive-scopes-no-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {getNumber} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    // Two scopes: one for `getNumber()`, one for the object literal.[22m
[2m    // Neither has dependencies so they should merge[22m
[2m    return {session_id: getNumber()};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { getNumber } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = { session_id: getNumber() };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"session_id":4}[22m

[31m[1mFAIL:[22m[39m merge-consecutive-scopes-deps-subset-of-decls
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState} from 'react';[22m

[2m  function Component() {[22m
[2m    const [count, setCount] = useState(0);[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <button onClick={() => setCount(count - 1)}>Decrement</button>[22m
[2m        {/**[22m
[2m         * The scope for the <button> depends on just the scope for the callback,[22m
[2m         * but the previous scope (after merging) will declare both the above[22m
[2m         * <button> and the callback.[22m
[2m         */}[22m
[2m        <button onClick={() => setCount(count + 1)}>Increment</button>[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(2);[22m
[32m-   const [count, setCount] = useState(0);[39m
[31m+   const [count, setCount] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== count) {[22m
[2m      t0 = ([22m
[2m        <div>[22m
[32m-         <button onClick={() => setCount(count - 1)}>Decrement</button>[39m
[31m+         <button[39m
[31m+           onClick={function () {[39m
[31m+             const $res$ = () => setCount(count - 1);[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+         >[39m
[31m+           Decrement[39m
[31m+         </button>[39m

[32m-         <button onClick={() => setCount(count + 1)}>Increment</button>[39m
[31m+         <button[39m
[31m+           onClick={function () {[39m
[31m+             const $res$ = () => setCount(count + 1);[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+         >[39m
[31m+           Increment[39m
[31m+         </button>[39m
[2m        </div>[22m
[2m      );[22m
[2m      $[0] = count;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><button>Decrement</button><button>Increment</button></div>[22m

[31m[1mFAIL:[22m[39m merge-consecutive-nested-scopes
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {getNumber} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    // Two scopes: one for `getNumber()`, one for the object literal.[22m
[2m    // Neither has dependencies so they should merge[22m
[2m    if (props.cond) {[22m
[2m      x = {session_id: getNumber()};[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { getNumber } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if (props.cond) {[22m
[2m      let t0;[22m
[2m      if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t0 = { session_id: getNumber() };[22m
[2m        $[0] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[0];[22m
[2m      }[22m
[2m      x = t0;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"session_id":4}[22m

[31m[1mFAIL:[22m[39m memoize-value-block-value-sequence
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    let x;[22m
[2m    (x = []), null;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      (x = []), null;[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m memoize-value-block-value-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    let x;[22m
[2m    true && ((x = []), null);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      true && ((x = []), null);[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m memoize-value-block-value-logical-no-sequence
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    let x;[22m
[2m    true && (x = []);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      true && (x = []);[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m memoize-value-block-value-conditional
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    let x;[22m
[2m    true ? (x = []) : (x = {});[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      true ? (x = []) : (x = {});[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m memoization-comments
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableMemoizationComments[22m
[2m  import {addOne, getNumber, identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = identity(props.a);[22m
[2m    const y = addOne(x);[22m
[2m    const z = identity(props.b);[22m
[2m    return [x, y, z];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1, b: 10}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableMemoizationComments[22m
[2m  import { addOne, getNumber, identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let x; // "useMemo" for t0 and x:[22m
[2m    // check if props.a changed[22m
[2m    if ($[0] !== props.a) {[22m
[2m      // Inputs changed, recompute[22m
[2m      x = identity(props.a);[22m
[2m      t0 = addOne(x);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      // Inputs did not change, use cached value[22m
[2m      t0 = $[1];[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    let t1; // "useMemo" for t1:[22m
[2m    // check if props.b changed[22m
[2m    if ($[3] !== props.b) {[22m
[2m      // Inputs changed, recompute[22m
[2m      t1 = identity(props.b);[22m
[2m      $[3] = props.b;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      // Inputs did not change, use cached value[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const z = t1;[22m
[2m    let t2; // "useMemo" for t2:[22m
[2m    // check if x, y, or z changed[22m
[2m    if ($[5] !== x || $[6] !== y || $[7] !== z) {[22m
[2m      // Inputs changed, recompute[22m
[2m      t2 = [x, y, z];[22m
[2m      $[5] = x;[22m
[2m      $[6] = y;[22m
[2m      $[7] = z;[22m
[2m      $[8] = t2;[22m
[2m    } else {[22m
[2m      // Inputs did not change, use cached value[22m
[2m      t2 = $[8];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m
[2m  export const FIXTURE_ENTRYPOINT = { fn: Component, params: [{ a: 1, b: 10 }] };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1,2,10][22m

[31m[1mFAIL:[22m[39m mege-consecutive-scopes-dont-merge-with-different-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {getNumber, identity} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    // Two scopes: one for `getNumber()`, one for the object literal.[22m
[2m    // Neither has dependencies so they should merge[22m
[2m    return {a: getNumber(), b: identity(props.id), c: ['static']};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { getNumber, identity } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = getNumber();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[1] !== props.id) {[22m
[2m      t1 = identity(props.id);[22m
[2m      $[1] = props.id;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = ["static"];[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[4] !== t1) {[22m
[2m      t3 = { a: t0, b: t1, c: t2 };[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[5];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":4,"b":42,"c":["static"]}[22m

[31m[1mFAIL:[22m[39m maybe-mutate-object-in-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    const object = {};[22m
[2m    // We optimistically assume function calls within callbacks don't mutate (unless the function[22m
[2m    // is known to be called during render), so this should get memoized[22m
[2m    const onClick = () => {[22m
[2m      mutate(object);[22m
[2m    };[22m
[2m    return <Foo callback={onClick}>{props.children}</Foo>;[22m
[2m  }[22m

[2m  function Foo({children}) {[22m
[2m    return children;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{children: <div>Hello</div>}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const object = {};[22m

[2m      t0 = () => {[22m
[2m        mutate(object);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== props.children) {[22m
[32m-     t1 = <Foo callback={onClick}>{props.children}</Foo>;[39m
[31m+     t1 = ([39m
[31m+       <Foo[39m
[31m+         callback={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {props.children}[39m
[31m+       </Foo>[39m
[31m+     );[39m
[2m      $[1] = props.children;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  function Foo(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { children } = t0;[22m
[2m    return children;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ children: <div>Hello</div> }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>Hello</div>[22m

[31m[1mFAIL:[22m[39m logical-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(props) {[22m
[2m    let a = props.a || (props.b && props.c && props.d);[22m
[2m    let b = (props.a && props.b && props.c) || props.d;[22m
[2m    return a ? b : props.c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const a = props.a || (props.b && props.c && props.d);[22m
[2m    const b = (props.a && props.b && props.c) || props.d;[22m
[2m    return a ? b : props.c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m logical-expression-object
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(props) {[22m
[2m    // The mutable range for a extens the entire body.[22m
[2m    // commenting out the last line of InferMutableRanges fixes it.[22m
[2m    // my guess of what's going on is that a is aliased into the return value object literal,[22m
[2m    // and that alias makes it look like the range of a needs to be extended to that point.[22m
[2m    // but what's weird is that the end of a's range doesn't quite extend to the object.[22m
[2m    let a = props.a || (props.b && props.c && props.d);[22m
[2m    let b = (props.a && props.b && props.c) || props.d;[22m
[2m    return {a, b};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = props.a || (props.b && props.c && props.d);[22m
[2m    const b = (props.a && props.b && props.c) || props.d;[22m
[2m    let t0;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      t0 = { a, b };[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m log-pruned-memoization
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"items":[42,{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},[{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true},{"a":0,"b":"value1","c":true}]]}</div>
Forget:
(kind: ok) <div>{"items":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m lambda-mutated-ref-non-reactive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function f(a) {[22m
[2m    let x;[22m
[2m    (() => {[22m
[2m      x = {};[22m
[2m    })();[22m
[2m    // this is not reactive on `x` as `x` is never reactive[22m
[2m    return <div x={x} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function f(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x;[22m
[2m      x = {};[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t0 = <div x={x} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         x={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m lambda-mutated-non-reactive-to-reactive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function f(a) {[22m
[2m    let x;[22m
[2m    (() => {[22m
[2m      x = {a};[22m
[2m    })();[22m
[2m    return <div x={x} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function f(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x;[22m
[2m      x = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m

[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[32m-     t1 = <div x={t0} />;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         x={function () {[39m
[31m+           const $res$ = t0;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m lambda-capture-returned-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Here, element should not be memoized independently of aliasedElement, since[22m
[2m  // it is captured by fn.[22m
[2m  // AnalyzeFunctions currently does not find captured objects.[22m
[2m  //  - mutated context refs are declared as `Capture` effect in `FunctionExpression.deps`[22m
[2m  //  - all other context refs are left as Unknown. InferReferenceEffects currently demotes[22m
[2m  //    them to reads[22m
[2m  function CaptureNotMutate(props) {[22m
[2m    const idx = foo(props.x);[22m
[2m    const element = bar(props.el);[22m

[2m    const fn = function () {[22m
[2m      const arr = {element};[22m
[2m      return arr[idx];[22m
[2m    };[22m
[2m    const aliasedElement = fn();[22m
[2m    mutate(aliasedElement);[22m
[2m    return aliasedElement;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Here, element should not be memoized independently of aliasedElement, since[22m
[2m  // it is captured by fn.[22m
[2m  // AnalyzeFunctions currently does not find captured objects.[22m
[2m  //  - mutated context refs are declared as `Capture` effect in `FunctionExpression.deps`[22m
[2m  //  - all other context refs are left as Unknown. InferReferenceEffects currently demotes[22m
[2m  //    them to reads[22m
[2m  function CaptureNotMutate(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.x) {[22m
[2m      t0 = foo(props.x);[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const idx = t0;[22m
[2m    let aliasedElement;[22m
[2m    if ($[2] !== props.el || $[3] !== idx) {[22m
[2m      const element = bar(props.el);[22m

[2m      const fn = function () {[22m
[2m        const arr = { element };[22m
[2m        return arr[idx];[22m
[2m      };[22m

[2m      aliasedElement = fn();[22m
[2m      mutate(aliasedElement);[22m
[2m      $[2] = props.el;[22m
[2m      $[3] = idx;[22m
[2m      $[4] = aliasedElement;[22m
[2m    } else {[22m
[2m      aliasedElement = $[4];[22m
[2m    }[22m
[2m    return aliasedElement;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m labeled-break-within-label-switch
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {CONST_STRING0} from 'shared-runtime';[22m

[2m  function useHook(cond) {[22m
[2m    const log = [];[22m
[2m    switch (CONST_STRING0) {[22m
[2m      case CONST_STRING0:[22m
[2m        log.push(`@A`);[22m
[2m        bb0: {[22m
[2m          if (cond) {[22m
[2m            break bb0;[22m
[2m          }[22m
[2m          log.push(`@B`);[22m
[2m        }[22m
[2m        log.push(`@C`);[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { CONST_STRING0 } from "shared-runtime";[22m

[2m  function useHook(cond) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(cond);[39m
[2m    let log;[22m
[2m    if ($[0] !== cond) {[22m
[2m      log = [];[22m
[2m      switch (CONST_STRING0) {[22m
[2m        case CONST_STRING0: {[22m
[2m          log.push(`@A`);[22m
[2m          bb0: {[22m
[2m            if (cond) {[22m
[2m              break bb0;[22m
[2m            }[22m

[2m            log.push(`@B`);[22m
[2m          }[22m

[2m          log.push(`@C`);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = log;[22m
[2m    } else {[22m
[2m      log = $[1];[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["@A","@C"][22m

[31m[1mFAIL:[22m[39m labeled-break-within-label-loop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useHook(end) {[22m
[2m    const log = [];[22m
[2m    for (let i = 0; i < end + 1; i++) {[22m
[2m      log.push(`${i} @A`);[22m
[2m      bb0: {[22m
[2m        if (i === end) {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        log.push(`${i} @B`);[22m
[2m      }[22m
[2m      log.push(`${i} @C`);[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [1],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useHook(end) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(end);[39m
[2m    let log;[22m
[2m    if ($[0] !== end) {[22m
[2m      log = [];[22m
[2m      for (let i = 0; i < end + 1; i++) {[22m
[2m        log.push(`${i} @A`);[22m
[2m        bb0: {[22m
[2m          if (i === end) {[22m
[2m            break bb0;[22m
[2m          }[22m

[2m          log.push(`${i} @B`);[22m
[2m        }[22m

[2m        log.push(`${i} @C`);[22m
[2m      }[22m
[2m      $[0] = end;[22m
[2m      $[1] = log;[22m
[2m    } else {[22m
[2m      log = $[1];[22m
[2m    }[22m
[2m    return log;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [1],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["0 @A","0 @B","0 @C","1 @A","1 @C"][22m

[31m[1mFAIL:[22m[39m jsx-ternary-local-variable
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>HigherOrderComponent<div>StaticText2</div></div>
Forget:
(kind: exception) props.items.map is not a function

[31m[1mFAIL:[22m[39m jsx-tag-evaluation-order
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {StaticText1, StaticText2} from 'shared-runtime';[22m

[2m  function Component(props: {value: string}) {[22m
[2m    let Tag = StaticText1;[22m

[2m    // Currently, Forget preserves jsx whitespace in the source text.[22m
[2m    // prettier-ignore[22m
[2m    return ([22m
[2m      <Tag>{((Tag = StaticText2), props.value)}<Tag /></Tag>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'string value 1'}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { StaticText1, StaticText2 } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m

[2m    const t0 = props.value;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = <StaticText2 />;[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[1] !== t0) {[22m
[2m      t2 = ([22m
[2m        <StaticText1>[22m
[2m          {t0}[22m
[2m          {t1}[22m
[2m        </StaticText1>[22m
[2m      );[22m
[2m      $[1] = t0;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "string value 1" }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>StaticText1string value 1<div>StaticText2</div></div>[22m

[31m[1mFAIL:[22m[39m jsx-tag-evaluation-order-non-global
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {StaticText1, StaticText2} from 'shared-runtime';[22m

[2m  function MaybeMutable() {[22m
[2m    return {};[22m
[2m  }[22m
[2m  function maybeMutate(x) {}[22m

[2m  function Component(props) {[22m
[2m    const maybeMutable = new MaybeMutable();[22m
[2m    let Tag = props.component;[22m
[2m    // NOTE: the order of evaluation in the lowering is incorrect:[22m
[2m    // the jsx element's tag observes `Tag` after reassignment, but should observe[22m
[2m    // it before the reassignment.[22m

[2m    // Currently, Forget preserves jsx whitespace in the source text.[22m
[2m    // prettier-ignore[22m
[2m    return ([22m
[2m      <Tag>{((Tag = props.alternateComponent), maybeMutate(maybeMutable))}<Tag /></Tag>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{component: StaticText1, alternateComponent: StaticText2}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { StaticText1, StaticText2 } from "shared-runtime";[22m

[2m  function MaybeMutable() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[32m- function maybeMutate(x) {}[39m
[31m+ function maybeMutate(x) {[39m
[31m+   Object.freeze(x);[39m
[31m+ }[39m

[2m  function Component(props) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(props);[39m
[2m    let Tag;[22m
[2m    let T0;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.component || $[1] !== props.alternateComponent) {[22m
[2m      const maybeMutable = new MaybeMutable();[22m
[2m      Tag = props.component;[22m

[2m      T0 = Tag;[22m
[2m      t0 = ((Tag = props.alternateComponent), maybeMutate(maybeMutable));[22m
[2m      $[0] = props.component;[22m
[2m      $[1] = props.alternateComponent;[22m
[2m      $[2] = Tag;[22m
[2m      $[3] = T0;[22m
[2m      $[4] = t0;[22m
[2m    } else {[22m
[2m      Tag = $[2];[22m
[2m      T0 = $[3];[22m
[2m      t0 = $[4];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[5] !== Tag) {[22m
[2m      t1 = <Tag />;[22m
[2m      $[5] = Tag;[22m
[2m      $[6] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[6];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[7] !== T0 || $[8] !== t0 || $[9] !== t1) {[22m
[2m      t2 = ([22m
[2m        <T0>[22m
[2m          {t0}[22m
[2m          {t1}[22m
[2m        </T0>[22m
[2m      );[22m
[2m      $[7] = T0;[22m
[2m      $[8] = t0;[22m
[2m      $[9] = t1;[22m
[2m      $[10] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[10];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ component: StaticText1, alternateComponent: StaticText2 }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>StaticText1<div>StaticText2</div></div>[22m

[31m[1mFAIL:[22m[39m jsx-string-attribute-non-ascii
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><h1>potetotes</h1><span>in addition to understanding JavaScript semantics and the rules of React, the compiler team also understands தமிழ், 中文, 日本語, 한국어 and i think that’s pretty cool</span></div>
Forget:
(kind: ok) <div><h1>potetotes</h1><span></span></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','text','text','span','text','span','\n' +
  '    at span\n' +
  '    at div\n' +
  '    at Post (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:39:36)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-string-attribute-expression-container
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><span>
</span><span>A	E</span><span>나은</span><span>Lauren</span><span>சத்யா</span><span>Sathya</span></div>
Forget:
(kind: ok) <div><span></span><span></span><span></span><span>Lauren</span><span></span><span>Sathya</span></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','span','value','span','\n' +
  '    at span\n' +
  '    at Text (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:60:36)\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-spread
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return ([22m
[2m      <Component {...props} {...{bar: props.cond ? props.foo : props.bar}} />[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m

[2m    const t0 = props.cond ? props.foo : props.bar;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = { bar: t0 };[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] !== props || $[3] !== t1) {[22m
[2m      t2 = <Component {...props} {...t1} />;[22m
[2m      $[2] = props;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m jsx-reactive-local-variable-member-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as sharedRuntime from 'shared-runtime';[22m

[2m  function Component({something}: {something: {StaticText1: React.ElementType}}) {[22m
[2m    const Foo = something.StaticText1;[22m
[2m    return () => <Foo />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{something: sharedRuntime}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as sharedRuntime from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { something } = t0;[22m
[2m    const Foo = something.StaticText1;[22m
[2m    let t1;[22m
[2m    if ($[0] !== Foo) {[22m
[2m      t1 = () => <Foo />;[22m
[2m      $[0] = Foo;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ something: sharedRuntime }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m jsx-namespaced-name
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return <xml:http protocol:version={props.version} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.version) {[22m
[32m-     t0 = <xml:http protocol:version={props.version} />;[39m
[31m+     t0 = ([39m
[31m+       <xml:http[39m
[31m+         protocol:version={function () {[39m
[31m+           const $res$ = props.version;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props.version;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m jsx-memberexpr-tag-in-lambda
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>4</div>
Forget:
(kind: ok) <div></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','div','value','div','\n' +
  '    at div\n' +
  '    at Text (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/shared-runtime.js:183:61)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-member-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    return ([22m
[2m      <Sathya.Codes.Forget>[22m
[2m        <Foo.Bar.Baz />[22m
[2m      </Sathya.Codes.Forget>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[2m        <Sathya.Codes.Forget>[22m
[2m          <Foo.Bar.Baz />[22m
[2m        </Sathya.Codes.Forget>[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m jsx-member-expression-tag-grouping
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const maybeMutable = new MaybeMutable();[22m
[2m    return <Foo.Bar>{maybeMutate(maybeMutable)}</Foo.Bar>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const maybeMutable = new MaybeMutable();[22m
[2m      t0 = <Foo.Bar>{maybeMutate(maybeMutable)}</Foo.Bar>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m jsx-local-tag-in-lambda
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":4}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m jsx-local-memberexpr-tag
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>4</div>
Forget:
(kind: ok) <div></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','div','value','div','\n' +
  '    at div\n' +
  '    at Text (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/shared-runtime.js:183:61)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-local-memberexpr-tag-conditional
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>4</div>
Forget:
(kind: ok) <div></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','div','value','div','\n' +
  '    at div\n' +
  '    at Text (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/shared-runtime.js:183:61)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-freeze
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {jsx as _jsx} from 'react/jsx-runtime';[22m
[2m  import {shallowCopy} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const childprops = {style: {width: props.width}};[22m
[2m    const element = _jsx('div', {[22m
[2m      childprops: childprops,[22m
[2m      children: '"hello world"',[22m
[2m    });[22m
[2m    shallowCopy(childprops); // function that in theory could mutate, we assume not bc createElement freezes[22m
[2m    return element;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { jsx as _jsx } from "react/jsx-runtime";[22m
[2m  import { shallowCopy } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let element;[22m
[2m    if ($[0] !== props.width) {[22m
[2m      const childprops = { style: { width: props.width } };[22m
[2m      element = _jsx("div", { childprops, children: '"hello world"' });[22m
[2m      shallowCopy(childprops);[22m
[2m      $[0] = props.width;[22m
[2m      $[1] = element;[22m
[2m    } else {[22m
[2m      element = $[1];[22m
[2m    }[22m
[2m    return element;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div childprops="[object Object]">"hello world"</div>[22m

[31m[1mFAIL:[22m[39m jsx-fragment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    return ([22m
[2m      <>[22m
[2m        Hello {props.greeting}{' '}[22m
[2m        <div>[22m
[2m          <>Text</>[22m
[2m        </div>[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[2m        <div>[22m
[2m          <>Text</>[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[1] !== props.greeting) {[22m
[2m      t1 = ([22m
[2m        <>[22m
[2m          Hello {props.greeting} {t0}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[1] = props.greeting;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m jsx-empty-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  export function Component(props) {[22m
[2m    return ([22m
[2m      <div>[22m
[2m        {}[22m
[2m        {props.a}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 'hello'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  export function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = <div>{props.a}</div>;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: "hello" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m jsx-attribute-with-jsx-fragment-value.flow
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>{"item":{"id":1,"name":"One!"}}</div></div>
Forget:
(kind: ok) <div></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','div','value','div','\n' +
  '    at div\n' +
  '    at Foo (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:58:36)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-attribute-with-jsx-element-value
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>One!</div></div>
Forget:
(kind: ok)
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','Foo','value','Foo','\n' +
  '    at Foo (eval at doEval (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:200:28), <anonymous>:59:5)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m jsx-attribute-default-to-true
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"truthyAttribute":true}</div>
Forget:
(kind: ok) <div>{"truthyAttribute":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m issue933-disjoint-set-infinite-loop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function makeObj() {[22m
[2m    'use no forget';[22m
[2m    const result = [];[22m
[2m    result.a = {b: 2};[22m

[2m    return result;[22m
[2m  }[22m

[2m  // This caused an infinite loop in the compiler[22m
[2m  function MyApp(props) {[22m
[2m    const y = makeObj();[22m
[2m    const tmp = y.a;[22m
[2m    const tmp2 = tmp.b;[22m
[2m    y.push(tmp2);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function makeObj() {[22m
[2m    "use no forget";[22m
[2m    const result = [];[22m
[2m    result.a = { b: 2 };[22m

[2m    return result;[22m
[2m  }[22m

[2m  // This caused an infinite loop in the compiler[22m
[2m  function MyApp(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      y = makeObj();[22m
[2m      const tmp = y.a;[22m
[2m      const tmp2 = tmp.b;[22m
[2m      y.push(tmp2);[22m
[2m      $[0] = y;[22m
[2m    } else {[22m
[2m      y = $[0];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: [],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m

[31m[1mFAIL:[22m[39m issue852
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(c) {[22m
[2m    let x = {c};[22m
[2m    mutate(x);[22m
[2m    let a = x;[22m
[2m    let b = a;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(c) {[22m
[31m+   Object.freeze(c);[39m
[2m    const x = { c };[22m
[2m    mutate(x);[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m inverted-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c, d) {[22m
[2m    let y = [];[22m
[2m    label: if (a) {[22m
[2m      if (b) {[22m
[2m        y.push(c);[22m
[2m        break label;[22m
[2m      }[22m
[2m      y.push(d);[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c, d) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[31m+   Object.freeze(d);[39m
[2m    let y;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c || $[3] !== d) {[22m
[2m      y = [];[22m
[2m      bb0: if (a) {[22m
[2m        if (b) {[22m
[2m          y.push(c);[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        y.push(d);[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = d;[22m
[2m      $[4] = y;[22m
[2m    } else {[22m
[2m      y = $[4];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m inverted-if-else
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = null;[22m
[2m    label: {[22m
[2m      if (a) {[22m
[2m        x = b;[22m
[2m        break label;[22m
[2m      }[22m
[2m      x = c;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    bb0: {[22m
[2m      if (a) {[22m
[2m        x = b;[22m
[2m        break bb0;[22m
[2m      }[22m

[2m      x = c;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m interdependent
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  /**[22m
[2m   * Should produce 1 scope:[22m
[2m   *[22m
[2m   * return: inputs=props.a & props.b; outputs=return[22m
[2m   *   const a = compute(props.a);[22m
[2m   *   const b = compute(props.b);[22m
[2m   *   foo(a, b);[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const a = compute(props.a);[22m
[2m    const b = compute(props.b);[22m
[2m    foo(a, b);[22m
[2m    return <Foo a={a} b={b} />;[22m
[2m  }[22m

[2m  function compute() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; /**[22m
[2m   * Should produce 1 scope:[22m
[2m   *[22m
[2m   * return: inputs=props.a & props.b; outputs=return[22m
[2m   *   const a = compute(props.a);[22m
[2m   *   const b = compute(props.b);[22m
[2m   *   foo(a, b);[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    let b;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      a = compute(props.a);[22m
[2m      b = compute(props.b);[22m
[2m      foo(a, b);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = a;[22m
[2m      $[3] = b;[22m
[2m    } else {[22m
[2m      a = $[2];[22m
[2m      b = $[3];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[4] !== a || $[5] !== b) {[22m
[32m-     t0 = <Foo a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = a;[22m
[2m      $[5] = b;[22m
[2m      $[6] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[6];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  function compute() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m interdependent-across-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function compute() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  /**[22m
[2m   * Should produce 1 scope:[22m
[2m   *[22m
[2m   * return: inputs=props.a & props.b & props.c; outputs=return[22m
[2m   *   const a = compute(props.a);[22m
[2m   *   const b = compute(props.b);[22m
[2m   *   if (props.c)[22m
[2m   *     foo(a, b);[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const a = compute(props.a);[22m
[2m    const b = compute(props.b);[22m
[2m    if (props.c) {[22m
[2m      foo(a, b);[22m
[2m    }[22m
[2m    return <Foo a={a} b={b} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function compute() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  /**[22m
[2m   * Should produce 1 scope:[22m
[2m   *[22m
[2m   * return: inputs=props.a & props.b & props.c; outputs=return[22m
[2m   *   const a = compute(props.a);[22m
[2m   *   const b = compute(props.b);[22m
[2m   *   if (props.c)[22m
[2m   *     foo(a, b);[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    let b;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b || $[2] !== props.c) {[22m
[2m      a = compute(props.a);[22m
[2m      b = compute(props.b);[22m
[2m      if (props.c) {[22m
[2m        foo(a, b);[22m
[2m      }[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = props.c;[22m
[2m      $[3] = a;[22m
[2m      $[4] = b;[22m
[2m    } else {[22m
[2m      a = $[3];[22m
[2m      b = $[4];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[5] !== a || $[6] !== b) {[22m
[32m-     t0 = <Foo a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[5] = a;[22m
[2m      $[6] = b;[22m
[2m      $[7] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[7];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m inner-memo-value-not-promoted-to-outer-scope-static
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const count = new MaybeMutable();[22m
[2m    return ([22m
[2m      <View>[22m
[2m        <View>[22m
[2m          {<span>Text</span>}[22m
[2m          {<span>{maybeMutate(count)}</span>}[22m
[2m        </View>[22m
[2m      </View>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const count = new MaybeMutable();[22m

[2m      t0 = ([22m
[2m        <View>[22m
[2m          <View>[22m
[2m            <span>Text</span>[22m
[2m            <span>{maybeMutate(count)}</span>[22m
[2m          </View>[22m
[2m        </View>[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m inner-memo-value-not-promoted-to-outer-scope-dynamic
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const item = useFragment(FRAGMENT, props.item);[22m
[2m    useFreeze(item);[22m

[2m    const count = new MaybeMutable(item);[22m
[2m    return ([22m
[2m      <View>[22m
[2m        <View>[22m
[2m          {<span>Text</span>}[22m
[2m          {<span>{maybeMutate(count)}</span>}[22m
[2m        </View>[22m
[2m      </View>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(15);[22m
[32m-   const item = useFragment(FRAGMENT, props.item);[39m
[32m-   useFreeze(item);[39m
[31m+   Object.freeze(props);[39m
[31m+   const item = (function () {[39m
[31m+     const $res$ = useFragment([39m
[31m+       Object.freeze(FRAGMENT),[39m
[31m+       Object.freeze(props.item),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(item));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let T0;[22m
[2m    let t1;[22m
[2m    let T1;[22m
[2m    if ($[0] !== item) {[22m
[2m      const count = new MaybeMutable(item);[22m

[2m      T1 = View;[22m
[2m      T0 = View;[22m
[2m      if ($[5] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t1 = <span>Text</span>;[22m
[2m        $[5] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[5];[22m
[2m      }[22m
[2m      t0 = maybeMutate(count);[22m
[2m      $[0] = item;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = T0;[22m
[2m      $[3] = t1;[22m
[2m      $[4] = T1;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      T0 = $[2];[22m
[2m      t1 = $[3];[22m
[2m      T1 = $[4];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[6] !== t0) {[22m
[2m      t2 = <span>{t0}</span>;[22m
[2m      $[6] = t0;[22m
[2m      $[7] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[7];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[8] !== T0 || $[9] !== t1 || $[10] !== t2) {[22m
[2m      t3 = ([22m
[2m        <T0>[22m
[2m          {t1}[22m
[2m          {t2}[22m
[2m        </T0>[22m
[2m      );[22m
[2m      $[8] = T0;[22m
[2m      $[9] = t1;[22m
[2m      $[10] = t2;[22m
[2m      $[11] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[11];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[12] !== T1 || $[13] !== t3) {[22m
[2m      t4 = <T1>{t3}</T1>;[22m
[2m      $[12] = T1;[22m
[2m      $[13] = t3;[22m
[2m      $[14] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[14];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-types-through-type-cast.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow[22m
[2m  import {getNumber} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    // We can infer that `x` is a primitive bc it is aliased to `y`,[22m
[2m    // which is used in a binary expression[22m
[2m    const x = getNumber();[22m
[2m    const y = (x: any);[22m
[2m    y + 1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { getNumber } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const x = getNumber();[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 4[22m

[31m[1mFAIL:[22m[39m infer-property-delete
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeObject();[22m
[2m    const y = delete x.value;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = makeObject();[22m
[2m    const y = delete x.value;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-phi-primitive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    let x;[22m
[2m    if (a) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m    }[22m

[2m    let y = x;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [true, false],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let x;[22m
[2m    if (a) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m    }[22m

[2m    const y = x;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [true, false],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 1[22m

[31m[1mFAIL:[22m[39m infer-global-object
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity, sum} from 'shared-runtime';[22m

[2m  // Check that we correctly resolve type and effect lookups on the javascript[22m
[2m  // global object.[22m
[2m  function Component(props) {[22m
[2m    let neverAliasedOrMutated = identity(props.b);[22m
[2m    let primitiveVal1 = Math.max(props.a, neverAliasedOrMutated);[22m
[2m    let primitiveVal2 = Infinity;[22m
[2m    let primitiveVal3 = globalThis.globalThis.NaN;[22m

[2m    // Even though we don't know the function signature of sum,[22m
[2m    // we should be able to infer that it does not mutate its inputs.[22m
[2m    sum(primitiveVal1, primitiveVal2, primitiveVal3);[22m
[2m    return {primitiveVal1, primitiveVal2, primitiveVal3};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1, b: 2}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, sum } from "shared-runtime";[22m

[2m  // Check that we correctly resolve type and effect lookups on the javascript[22m
[2m  // global object.[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.b) {[22m
[2m      t0 = identity(props.b);[22m
[2m      $[0] = props.b;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const neverAliasedOrMutated = t0;[22m
[2m    const primitiveVal1 = Math.max(props.a, neverAliasedOrMutated);[22m

[2m    const primitiveVal3 = globalThis.globalThis.NaN;[22m

[2m    sum(primitiveVal1, Infinity, primitiveVal3);[22m
[2m    let t1;[22m
[2m    if ($[2] !== primitiveVal1) {[22m
[2m      t1 = { primitiveVal1, primitiveVal2: Infinity, primitiveVal3 };[22m
[2m      $[2] = primitiveVal1;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 1, b: 2 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"primitiveVal1":2,"primitiveVal2":null,"primitiveVal3":null}[22m

[31m[1mFAIL:[22m[39m infer-functions-hook-with-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  function useDiv(props) {[22m
[2m    return <div />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  function useDiv(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-functions-hook-with-hook-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  function useStateValue(props) {[22m
[2m    const [state, _] = useState(null);[22m
[2m    return [state];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  function useStateValue(props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const [state] = useState(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [state] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== state) {[22m
[2m      t0 = [state];[22m
[2m      $[0] = state;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-functions-component-with-ref-arg
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m

[2m  function Foo({}, ref) {[22m
[2m    return <div ref={ref} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m

[2m  function Foo(t0, ref) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[31m+   Object.freeze(ref);[39m
[2m    let t1;[22m
[2m    if ($[0] !== ref) {[22m
[32m-     t1 = <div ref={ref} />;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = ref;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m infer-functions-component-with-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  function Component(props) {[22m
[2m    return <div />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-functions-component-with-hook-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  function Component(props) {[22m
[2m    const [state, _] = useState(null);[22m
[2m    return [state];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const [state] = useState(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [state] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== state) {[22m
[2m      t0 = [state];[22m
[2m      $[0] = state;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-function-forwardRef
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  React.forwardRef(props => {[22m
[2m    return <div />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  React.forwardRef((props) => {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-function-expression-component
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m

[2m  const Component = function ComponentName(props) {[22m
[2m    return <Foo />;[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m

[2m  const Component = function ComponentName(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <Foo />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-function-expression-React-memo-gating
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating @compilationMode(infer)[22m
[2m  import React from 'react';[22m
[2m  export default React.forwardRef(function notNamedLikeAComponent(props) {[22m
[2m    return <div />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating @compilationMode(infer)[22m
[2m  import React from "react";[22m
[2m  export default React.forwardRef([22m
[2m    isForgetEnabled_Fixtures()[22m
[2m      ? function notNamedLikeAComponent(props) {[22m
[2m          const $ = _c(1);[22m
[31m+         Object.freeze(props);[39m
[2m          let t0;[22m
[2m          if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m            t0 = <div />;[22m
[2m            $[0] = t0;[22m
[2m          } else {[22m
[2m            t0 = $[0];[22m
[2m          }[22m
[2m          return t0;[22m
[2m        }[22m
[2m      : function notNamedLikeAComponent(props) {[22m
[2m          return <div />;[22m
[2m        },[22m
[2m  );[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-function-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  const Component = props => {[22m
[2m    return <div />;[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  const Component = (props) => {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-function-React-memo
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  React.memo(props => {[22m
[2m    return <div />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  React.memo((props) => {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = <div />;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-computed-delete
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @debug[22m
[2m  function Component(props) {[22m
[2m    const x = makeObject();[22m
[2m    const y = delete x[props.value];[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @debug[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = makeObject();[22m
[2m    const y = delete x[props.value];[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m infer-compile-hooks-with-multiple-params
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer)[22m
[2m  import {useNoAlias} from 'shared-runtime';[22m

[2m  // This should be compiled by Forget[22m
[2m  function useFoo(value1, value2) {[22m
[2m    return {[22m
[2m      value: useNoAlias(value1 + value2),[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [1, 2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer)[22m
[2m  import { useNoAlias } from "shared-runtime";[22m

[2m  // This should be compiled by Forget[22m
[2m  function useFoo(value1, value2) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(value1);[39m
[31m+   Object.freeze(value2);[39m

[32m-   const t0 = useNoAlias(value1 + value2);[39m
[31m+   const t0 = (function () {[39m
[31m+     const $res$ = useNoAlias(Object.freeze(value1 + value2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = { value: t0 };[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [1, 2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"value":{}}[22m

[31m[1mFAIL:[22m[39m independently-memoize-object-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const x = {a: a};[22m
[2m    // NOTE: this array should memoize independently from x, w only b,c as deps[22m
[2m    x.y = [b, c];[22m

[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = { a };[22m
[2m      let t0;[22m
[2m      if ($[4] !== b || $[5] !== c) {[22m
[2m        t0 = [b, c];[22m
[2m        $[4] = b;[22m
[2m        $[5] = c;[22m
[2m        $[6] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[6];[22m
[2m      }[22m
[2m      x.y = t0;[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m independent
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  /**[22m
[2m   * Should produce 3 scopes:[22m
[2m   *[22m
[2m   * a: inputs=props.a, outputs=a[22m
[2m   *   a = compute(props.a);[22m
[2m   * b: inputs=props.b, outputs=b[22m
[2m   *   b = compute(props.b);[22m
[2m   * return: inputs=a, b outputs=return[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const a = compute(props.a);[22m
[2m    const b = compute(props.b);[22m
[2m    return <Foo a={a} b={b} />;[22m
[2m  }[22m

[2m  function compute() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; /**[22m
[2m   * Should produce 3 scopes:[22m
[2m   *[22m
[2m   * a: inputs=props.a, outputs=a[22m
[2m   *   a = compute(props.a);[22m
[2m   * b: inputs=props.b, outputs=b[22m
[2m   *   b = compute(props.b);[22m
[2m   * return: inputs=a, b outputs=return[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = compute(props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const a = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== props.b) {[22m
[2m      t1 = compute(props.b);[22m
[2m      $[2] = props.b;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const b = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== a || $[5] !== b) {[22m
[32m-     t2 = <Foo a={a} b={b} />;[39m
[31m+     t2 = ([39m
[31m+       <Foo[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = a;[22m
[2m      $[5] = b;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  function compute() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m independent-across-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function compute() {}[22m
[2m  function mutate() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  /**[22m
[2m   * Should produce 3 scopes:[22m
[2m   *[22m
[2m   * a: inputs=props.a & props.c; outputs=a[22m
[2m   *   a = compute(props.a);[22m
[2m   *   if (props.c)[22m
[2m   *     mutate(a)[22m
[2m   * b: inputs=props.b & props.c; outputs=b[22m
[2m   *   b = compute(props.b);[22m
[2m   *   if (props.c)[22m
[2m   *     mutate(b)[22m
[2m   * return: inputs=a, b outputs=return[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const a = compute(props.a);[22m
[2m    const b = compute(props.b);[22m
[2m    if (props.c) {[22m
[2m      mutate(a);[22m
[2m      mutate(b);[22m
[2m    }[22m
[2m    return <Foo a={a} b={b} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function compute() {}[22m
[2m  function mutate() {}[22m
[2m  function foo() {}[22m
[2m  function Foo() {}[22m

[2m  /**[22m
[2m   * Should produce 3 scopes:[22m
[2m   *[22m
[2m   * a: inputs=props.a & props.c; outputs=a[22m
[2m   *   a = compute(props.a);[22m
[2m   *   if (props.c)[22m
[2m   *     mutate(a)[22m
[2m   * b: inputs=props.b & props.c; outputs=b[22m
[2m   *   b = compute(props.b);[22m
[2m   *   if (props.c)[22m
[2m   *     mutate(b)[22m
[2m   * return: inputs=a, b outputs=return[22m
[2m   *   return = <Foo a={a} b={b} />[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    let b;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b || $[2] !== props.c) {[22m
[2m      a = compute(props.a);[22m
[2m      b = compute(props.b);[22m
[2m      if (props.c) {[22m
[2m        mutate(a);[22m
[2m        mutate(b);[22m
[2m      }[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = props.c;[22m
[2m      $[3] = a;[22m
[2m      $[4] = b;[22m
[2m    } else {[22m
[2m      a = $[3];[22m
[2m      b = $[4];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[5] !== a || $[6] !== b) {[22m
[32m-     t0 = <Foo a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[5] = a;[22m
[2m      $[6] = b;[22m
[2m      $[7] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[7];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m incompatible-destructuring-kinds
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"a":null,"b":"[[ cyclic ref *1 ]]","onClick":"[[ function params=0 ]]"}</div>
Forget:
(kind: ok) <div>{"a":"[[ function params=0 ]]","b":"[[ function params=0 ]]","onClick":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m inadvertent-mutability-readonly-lambda
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [value, setValue] = useState(null);[22m
[2m    // NOTE: this lambda does not capture any mutable values (only the state setter)[22m
[2m    // and thus should be treated as readonly[22m
[2m    const onChange = e => setValue(value => value + e.target.value);[22m

[2m    useOtherHook();[22m

[2m    // x should be independently memoizeable, since foo(x, onChange) cannot modify onChange[22m
[2m    const x = {};[22m
[2m    foo(x, onChange);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const [value, setValue] = useState(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [value, setValue] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = (e) => setValue((value_0) => value_0 + e.target.value);[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onChange = t0;[22m
[32m-[39m
[32m-   useOtherHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useOtherHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let x;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x = {};[22m
[2m      foo(x, onChange);[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m inadvertent-mutability-readonly-class
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const env = useRelayEnvironment();[22m
[2m    // Note: this is a class has no mutable methods, ie it always treats `this` as readonly[22m
[2m    const mutator = new Mutator(env);[22m

[2m    useOtherHook();[22m

[2m    // `x` should be independently memoizeable, since foo(x, mutator) cannot mutate[22m
[2m    // the mutator.[22m
[2m    const x = {};[22m
[2m    foo(x, mutator);[22m
[2m    return x;[22m
[2m  }[22m

[2m  class Mutator {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[32m-   const env = useRelayEnvironment();[39m
[31m+   Object.freeze(props);[39m
[31m+   const env = (function () {[39m
[31m+     const $res$ = useRelayEnvironment();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const mutator = new Mutator(env);[22m
[32m-[39m
[32m-   useOtherHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useOtherHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const x = {};[22m
[2m    foo(x, mutator);[22m
[2m    return x;[22m
[2m  }[22m

[2m  class Mutator {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m immutable-hooks
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableAssumeHooksFollowRulesOfReact true[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    // In enableAssumeHooksFollowRulesOfReact mode hooks freeze their inputs and return frozen values[22m
[2m    const y = useFoo(x);[22m
[2m    // Thus both x and y are frozen here, and x can be independently memoized[22m
[2m    bar(x, y);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableAssumeHooksFollowRulesOfReact true[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m

[32m-   const y = useFoo(x);[39m
[31m+   const y = (function () {[39m
[31m+     const $res$ = useFoo(Object.freeze(x));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    bar(x, y);[22m
[2m    let t1;[22m
[2m    if ($[1] !== y) {[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = y;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m iife-return-modified-later
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = (() => {[22m
[2m      return [];[22m
[2m    })();[22m
[2m    items.push(props.a);[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: {}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let items;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = [];[22m
[2m      items = t0;[22m

[2m      items.push(props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = items;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: {} }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{}][22m

[31m[1mFAIL:[22m[39m iife-return-modified-later-phi
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = (() => {[22m
[2m      if (props.cond) {[22m
[2m        return [];[22m
[2m      } else {[22m
[2m        return null;[22m
[2m      }[22m
[2m    })();[22m
[2m    items?.push(props.a);[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: {}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] !== props) {[22m
[2m      let t0;[22m
[2m      if (props.cond) {[22m
[2m        t0 = [];[22m
[2m      } else {[22m
[2m        t0 = null;[22m
[2m      }[22m
[2m      items = t0;[22m

[2m      items?.push(props.a);[22m
[2m      $[0] = props;[22m
[2m      $[1] = items;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: {} }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m ignore-use-no-forget
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @ignoreUseNoForget[22m
[2m  function Component(prop) {[22m
[2m    'use no forget';[22m
[2m    const result = prop.x.toFixed();[22m
[2m    return <div>{result}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 1}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @ignoreUseNoForget[22m
[2m  function Component(prop) {[22m
[32m-   "use no forget";[39m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(prop);[39m
[2m    let t0;[22m
[2m    if ($[0] !== prop.x) {[22m
[2m      t0 = prop.x.toFixed();[22m
[2m      $[0] = prop.x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const result = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== result) {[22m
[2m      t1 = <div>{result}</div>;[22m
[2m      $[2] = result;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 1 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>1</div>[22m

[31m[1mFAIL:[22m[39m idx-no-outlining
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @customMacros(idx)[22m
[2m  import idx from 'idx';[22m

[2m  function Component(props) {[22m
[2m    // the lambda should not be outlined[22m
[2m    const groupName = idx(props, _ => _.group.label);[22m
[2m    return <div>{groupName}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @customMacros(idx)[22m

[2m  function Component(props) {[22m
[2m    var _ref2;[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      var _ref;[22m

[2m      t0 =[22m
[2m        (_ref = props) != null[22m
[2m          ? (_ref = _ref.group) != null[22m
[2m            ? _ref.label[22m
[2m            : _ref[22m
[2m          : _ref;[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const groupName = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== groupName) {[22m
[2m      t1 = <div>{groupName}</div>;[22m
[2m      $[2] = groupName;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m hooks-with-prefix
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @hookPattern:".*\b(use[^$]+)$"[22m

[2m  import * as React from 'react';[22m
[2m  import {makeArray, useHook} from 'shared-runtime';[22m

[2m  const React$useState = React.useState;[22m
[2m  const React$useMemo = React.useMemo;[22m
[2m  const Internal$Reassigned$useHook = useHook;[22m

[2m  function Component() {[22m
[2m    const [state, setState] = React$useState(0);[22m
[2m    const object = Internal$Reassigned$useHook();[22m
[2m    const json = JSON.stringify(object);[22m
[2m    const doubledArray = React$useMemo(() => {[22m
[2m      return makeArray(state);[22m
[2m    }, [state]);[22m
[2m    return ([22m
[2m      <div>[22m
[2m        {doubledArray.join('')}[22m
[2m        {json}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @hookPattern:".*\b(use[^$]+)$"[22m

[2m  import * as React from "react";[22m
[2m  import { makeArray, useHook } from "shared-runtime";[22m

[2m  const React$useState = React.useState;[22m
[2m  const React$useMemo = React.useMemo;[22m
[2m  const Internal$Reassigned$useHook = useHook;[22m

[2m  function Component() {[22m
[2m    const $ = _c(8);[22m
[32m-   const [state] = React$useState(0);[39m
[32m-   const object = Internal$Reassigned$useHook();[39m
[31m+   const [state] = (function () {[39m
[31m+     const $res$ = React$useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const object = (function () {[39m
[31m+     const $res$ = Internal$Reassigned$useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== object) {[22m
[2m      t0 = JSON.stringify(object);[22m
[2m      $[0] = object;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const json = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== state) {[22m
[2m      t1 = makeArray(state);[22m
[2m      const doubledArray = t1;[22m

[2m      t2 = doubledArray.join("");[22m
[2m      $[2] = state;[22m
[2m      $[3] = t2;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== t2 || $[6] !== json) {[22m
[2m      t3 = ([22m
[2m        <div>[22m
[2m          {t2}[22m
[2m          {json}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[5] = t2;[22m
[2m      $[6] = json;[22m
[2m      $[7] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[7];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>0{"a":0,"b":"value1","c":true}</div>[22m

[31m[1mFAIL:[22m[39m hooks-with-React-namespace
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    const [x, setX] = React.useState(1);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[32m-   const [x] = React.useState(1);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = React.useState(Object.freeze(1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 1[22m

[31m[1mFAIL:[22m[39m hooks-freeze-possibly-mutable-arguments
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const cond = props.cond;[22m
[2m    const x = props.x;[22m
[2m    let a;[22m
[2m    if (cond) {[22m
[2m      a = x;[22m
[2m    } else {[22m
[2m      a = [];[22m
[2m    }[22m
[2m    useFreeze(a); // should freeze, value *may* be mutable[22m
[2m    useFreeze(a); // should be readonly[22m
[2m    call(a); // should be readonly[22m
[2m    return a;[22m
[2m  }[22m

[2m  function useFreeze(x) {}[22m
[2m  function call(x) {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    const cond = props.cond;[22m
[2m    const x = props.x;[22m
[2m    let a;[22m
[2m    if (cond) {[22m
[2m      a = x;[22m
[2m    } else {[22m
[2m      let t0;[22m
[2m      if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t0 = [];[22m
[2m        $[0] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[0];[22m
[2m      }[22m
[2m      a = t0;[22m
[2m    }[22m
[32m-[39m
[32m-   useFreeze(a);[39m
[32m-   useFreeze(a);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(a));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(a));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    call(a);[22m
[2m    return a;[22m
[2m  }[22m

[32m- function useFreeze(x) {}[39m
[32m- function call(x) {}[39m
[31m+ function useFreeze(x) {[39m
[31m+   Object.freeze(x);[39m
[31m+ }[39m
[31m+ function call(x) {[39m
[31m+   Object.freeze(x);[39m
[31m+ }[39m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m hooks-freeze-arguments
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    const a = [];[22m
[2m    useFreeze(a); // should freeze[22m
[2m    useFreeze(a); // should be readonly[22m
[2m    call(a); // should be readonly[22m
[2m    return a;[22m
[2m  }[22m

[2m  function useFreeze(x) {}[22m
[2m  function call(x) {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const a = t0;[22m
[32m-   useFreeze(a);[39m
[32m-   useFreeze(a);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(a));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(a));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    call(a);[22m
[2m    return a;[22m
[2m  }[22m

[32m- function useFreeze(x) {}[39m
[32m- function call(x) {}[39m
[31m+ function useFreeze(x) {[39m
[31m+   Object.freeze(x);[39m
[31m+ }[39m
[31m+ function call(x) {[39m
[31m+   Object.freeze(x);[39m
[31m+ }[39m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m hook-noAlias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useNoAlias} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const item = {a: props.a};[22m
[2m    const x = useNoAlias(item, () => {[22m
[2m      console.log(props);[22m
[2m    }, [props.a]);[22m
[2m    return [x, item];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: {id: 42}}],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useNoAlias } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = { a: props.a };[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const item = t0;[22m
[32m-   const x = useNoAlias(item, () => {[39m
[32m-     console.log(props);[39m
[32m-   }, [props.a]);[39m
[31m+   const x = (function () {[39m
[31m+     const $res$ = useNoAlias([39m
[31m+       Object.freeze(item),[39m
[31m+       Object.freeze(() => {[39m
[31m+         console.log(props);[39m
[31m+       }),[39m
[31m+       Object.freeze([props.a]),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    if ($[2] !== x || $[3] !== item) {[22m
[2m      t1 = [x, item];[22m
[2m      $[2] = x;[22m
[2m      $[3] = item;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: { id: 42 } }],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{},{"a":{"id":42}}][22m

[31m[1mFAIL:[22m[39m hook-inside-logical-expression
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const user =[22m
[2m      useFragment([22m
[2m        graphql`[22m
[2m          fragment F on T {[22m
[2m            id[22m
[2m          }[22m
[2m        `,[22m
[2m        props.user[22m
[2m      ) ?? {};[22m
[2m    return user.name;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const user =[22m
[32m-     useFragment([39m
[32m-       graphql`[39m
[32m-         fragment F on T {[39m
[32m-           id[39m
[32m-         }[39m
[32m-       `,[39m
[32m-       props.user,[39m
[32m-     ) ?? {};[39m
[31m+     (function () {[39m
[31m+       const $res$ = useFragment([39m
[31m+         Object.freeze(graphql`[39m
[31m+           fragment F on T {[39m
[31m+             id[39m
[31m+           }[39m
[31m+         `),[39m
[31m+         Object.freeze(props.user),[39m
[31m+       );[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })() ?? {};[39m
[2m    return user.name;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m hook-declaration-basic.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @compilationMode(infer)[22m
[2m  export default hook useFoo(bar: number) {[22m
[2m    return [bar];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  export default function useFoo(bar) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(bar);[39m
[2m    let t0;[22m
[2m    if ($[0] !== bar) {[22m
[2m      t0 = [bar];[22m
[2m      $[0] = bar;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m hook-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFreeze() {}[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const y = useFreeze(x);[22m
[2m    foo(y, x);[22m
[2m    return ([22m
[2m      <Component>[22m
[2m        {x}[22m
[2m        {y}[22m
[2m      </Component>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFreeze() {}[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[32m-   const y = useFreeze(x);[39m
[31m+   const y = (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(x));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    foo(y, x);[22m
[2m    let t1;[22m
[2m    if ($[1] !== y) {[22m
[2m      t1 = ([22m
[2m        <Component>[22m
[2m          {x}[22m
[2m          {y}[22m
[2m        </Component>[22m
[2m      );[22m
[2m      $[1] = y;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m holey-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function t(props) {[22m
[2m    let [, setstate] = useState();[22m
[2m    setstate(1);[22m
[2m    return props.foo;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function t(props) {[22m
[32m-   const [, setstate] = useState();[39m
[31m+   Object.freeze(props);[39m
[31m+   const [, setstate] = (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    setstate(1);[22m
[2m    return props.foo;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m holey-array-pattern-dce
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function t(props) {[22m
[2m    let [, foo, bar] = props;[22m
[2m    return foo;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function t(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const [, foo] = props;[22m
[2m    return foo;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m holey-array-pattern-dce-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function t(props) {[22m
[2m    let [foo, bar, ,] = props;[22m
[2m    return foo;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function t(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const [foo] = props;[22m
[2m    return foo;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m holey-array-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {CONST_STRING0} from 'shared-runtime';[22m

[2m  function t(props) {[22m
[2m    let x = [, CONST_STRING0, props];[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: [{a: 1, b: 2}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { CONST_STRING0 } from "shared-runtime";[22m

[2m  function t(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = [, CONST_STRING0, props];[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: t,[22m
[2m    params: [{ a: 1, b: 2 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null,"global string 0",{"a":1,"b":2}][22m

[31m[1mFAIL:[22m[39m hoisting-within-lambda
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component({}) {[22m
[2m    const outer = () => {[22m
[2m      const inner = () => {[22m
[2m        return x;[22m
[2m      };[22m
[2m      const x = 3;[22m
[2m      return inner();[22m
[2m    };[22m
[2m    return <div>{outer()}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(t0);[39m
[2m    const outer = _temp;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = <div>{outer()}</div>;[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    const inner = () => x;[22m
[2m    const x = 3;[22m
[2m    return inner();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>3</div>[22m

[31m[1mFAIL:[22m[39m hoisting-recursive-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo({value}: {value: number}) {[22m
[2m    const factorial = (x: number) => {[22m
[2m      if (x <= 1) {[22m
[2m        return 1;[22m
[2m      } else {[22m
[2m        return x * factorial(x - 1);[22m
[2m      }[22m
[2m    };[22m

[2m    return factorial(value);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{value: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      const factorial = (x) => {[22m
[2m        if (x <= 1) {[22m
[2m          return 1;[22m
[2m        } else {[22m
[2m          return x * factorial(x - 1);[22m
[2m        }[22m
[2m      };[22m

[2m      t1 = factorial(value);[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ value: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 6[22m

[31m[1mFAIL:[22m[39m hoisting-recursive-call-within-lambda
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo({}) {[22m
[2m    const outer = val => {[22m
[2m      const fact = x => {[22m
[2m        if (x <= 0) {[22m
[2m          return 1;[22m
[2m        }[22m
[2m        return x * fact(x - 1);[22m
[2m      };[22m
[2m      return fact(val);[22m
[2m    };[22m
[2m    return outer(3);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(t0) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(t0);[39m
[2m    const outer = _temp;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = outer(3);[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp(val) {[22m
[2m    const fact = (x) => {[22m
[2m      if (x <= 0) {[22m
[2m        return 1;[22m
[2m      }[22m
[2m      return x * fact(x - 1);[22m
[2m    };[22m
[2m    return fact(val);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 6[22m

[31m[1mFAIL:[22m[39m hoisting-nested-const-declaration-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function hoisting(cond) {[22m
[2m    let items = [];[22m
[2m    if (cond) {[22m
[2m      const foo = () => {[22m
[2m        items.push(bar());[22m
[2m      };[22m
[2m      const bar = () => true;[22m
[2m      foo();[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: hoisting,[22m
[2m    params: [true],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function hoisting(cond) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(cond);[39m
[2m    let items;[22m
[2m    if ($[0] !== cond) {[22m
[2m      items = [];[22m
[2m      if (cond) {[22m
[2m        const foo = () => {[22m
[2m          items.push(bar());[22m
[2m        };[22m

[2m        const bar = _temp;[22m
[2m        foo();[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = items;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    return true;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: hoisting,[22m
[2m    params: [true],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [true][22m

[31m[1mFAIL:[22m[39m hoisting-nested-block-statements
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {print} from 'shared-runtime';[22m

[2m  function hoisting(cond) {[22m
[2m    if (cond) {[22m
[2m      const x = 1;[22m
[2m      print(x);[22m
[2m    }[22m

[2m    const x = 2;[22m
[2m    print(x);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: hoisting,[22m
[2m    params: [false],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { print } from "shared-runtime";[22m

[2m  function hoisting(cond) {[22m
[31m+   Object.freeze(cond);[39m
[2m    if (cond) {[22m
[2m      print(1);[22m
[2m    }[22m

[2m    print(2);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: hoisting,[22m
[2m    params: [false],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m
[2m  logs: [2][22m

[31m[1mFAIL:[22m[39m hoisting-member-expression
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"onClick":"[[ function params=1 ]]"}</div>
Forget:
(kind: ok) <div>{"onClick":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m hoisting-computed-member-expression
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"onClick":{"kind":"Function","result":1},"onClick2":{"kind":"Function","result":1},"shouldInvokeFns":true}</div>
Forget:
(kind: ok) <div>{"onClick":{"kind":"Function","result":{"kind":"Function","result":1}},"onClick2":{"kind":"Function","result":{"kind":"Function","result":1}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>

[31m[1mFAIL:[22m[39m hoisted-declaration-with-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {StaticText1, Stringify, identity, useHook} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * `button` and `dispatcher` must end up in the same memo block. It would be[22m
[2m   * invalid for `button` to take a dependency on `dispatcher` as dispatcher[22m
[2m   * is created later.[22m
[2m   */[22m
[2m  function useFoo({onClose}) {[22m
[2m    const button = StaticText1 ?? ([22m
[2m      <Stringify[22m
[2m        primary={{[22m
[2m          label: identity('label'),[22m
[2m          onPress: onClose,[22m
[2m        }}[22m
[2m        secondary={{[22m
[2m          onPress: () => {[22m
[2m            dispatcher.go('route2');[22m
[2m          },[22m
[2m        }}[22m
[2m      />[22m
[2m    );[22m

[2m    const dispatcher = useHook();[22m

[2m    return button;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{onClose: identity()}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { StaticText1, Stringify, identity, useHook } from "shared-runtime";[22m

[2m  /**[22m
[2m   * `button` and `dispatcher` must end up in the same memo block. It would be[22m
[2m   * invalid for `button` to take a dependency on `dispatcher` as dispatcher[22m
[2m   * is created later.[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { onClose } = t0;[22m
[2m    const button = StaticText1 ?? ([22m
[2m      <Stringify[22m
[32m-       primary={{ label: identity("label"), onPress: onClose }}[39m
[32m-       secondary={{[39m
[32m-         onPress: () => {[39m
[32m-           dispatcher.go("route2");[39m
[32m-         },[39m
[31m+       primary={function () {[39m
[31m+         const $res$ = { label: identity("label"), onPress: onClose };[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[31m+       }}[39m
[31m+       secondary={function () {[39m
[31m+         const $res$ = {[39m
[31m+           onPress: () => {[39m
[31m+             dispatcher.go("route2");[39m
[31m+           },[39m
[31m+         };[39m
[31m+         Object.freeze($res$);[39m
[31m+         return $res$;[39m
[2m        }}[22m
[2m      />[22m
[2m    );[22m

[32m-   const dispatcher = useHook();[39m
[31m+   const dispatcher = (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return button;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ onClose: identity() }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=1 ]]"[22m

[31m[1mFAIL:[22m[39m globals-dont-resolve-local-useState
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState as _useState, useCallback, useEffect} from 'react';[22m
[2m  import {ValidateMemoization} from 'shared-runtime';[22m

[2m  function useState(value) {[22m
[2m    const [state, setState] = _useState(value);[22m
[2m    return [state, setState];[22m
[2m  }[22m

[2m  function Component() {[22m
[2m    const [state, setState] = useState('hello');[22m

[2m    return <div onClick={() => setState('goodbye')}>{state}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState as _useState, useCallback, useEffect } from "react";[22m
[2m  import { ValidateMemoization } from "shared-runtime";[22m

[2m  function useState(value) {[22m
[2m    const $ = _c(2);[22m
[32m-   const [state, setState] = _useState(value);[39m
[31m+   Object.freeze(value);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = _useState(Object.freeze(value));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== state) {[22m
[2m      t0 = [state, setState];[22m
[2m      $[0] = state;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  function Component() {[22m
[2m    const $ = _c(5);[22m
[32m-   const [state, setState] = useState("hello");[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze("hello"));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== setState) {[22m
[2m      t0 = () => setState("goodbye");[22m
[2m      $[0] = setState;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0 || $[3] !== state) {[22m
[32m-     t1 = <div onClick={t0}>{state}</div>;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = t0;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {state}[39m
[31m+       </div>[39m
[31m+     );[39m
[2m      $[2] = t0;[22m
[2m      $[3] = state;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>hello</div>[22m

[31m[1mFAIL:[22m[39m globals-String
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = String(x);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    const y = String(x);[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m globals-Number
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = Number(x);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    const y = Number(x);[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m globals-Boolean
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {};[22m
[2m    const y = Boolean(x);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    const y = Boolean(x);[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m global-jsx-tag-lowered-between-mutations
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const maybeMutable = new MaybeMutable();[22m
[2m    // NOTE: this will produce invalid output.[22m
[2m    // The HIR is roughly:[22m
[2m    //                                   ⌵ mutable range of `maybeMutable`[22m
[2m    // StoreLocal maybeMutable = ...     ⌝[22m
[2m    // t0 = LoadGlobal View              ⎮ <-- View is lowered inside this mutable range[22m
[2m    //                                         and thus gets becomes an output of this scope,[22m
[2m    //                                         gets promoted to temporary[22m
[2m    // t1 = LoadGlobal maybeMutate       ⎮[22m
[2m    // t2 = LoadLocal maybeMutable       ⎮[22m
[2m    // t3 = Call t1(t2)                  ⌟[22m
[2m    // t4 = Jsx tag=t0 props=[] children=[t3] <-- `t0` is an invalid tag[22m
[2m    return <View>{maybeMutate(maybeMutable)}</View>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const maybeMutable = new MaybeMutable();[22m

[2m      t0 = <View>{maybeMutate(maybeMutable)}</View>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m gating-with-hoisted-type-reference.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @gating[22m
[2m  import {memo} from 'react';[22m

[2m  type Props = React.ElementConfig<typeof Component>;[22m

[2m  component Component(value: string) {[22m
[2m    return <div>{value}</div>;[22m
[2m  }[22m

[2m  export default memo<Props>(Component);[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { memo } from "react";[22m

[2m  type Props = React.ElementConfig<typeof Component>;[22m
[2m  const Component = isForgetEnabled_Fixtures()[22m
[2m    ? function Component(t0) {[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(t0);[39m
[2m        const { value } = t0;[22m
[2m        let t1;[22m
[2m        if ($[0] !== value) {[22m
[2m          t1 = <div>{value}</div>;[22m
[2m          $[0] = value;[22m
[2m          $[1] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[1];[22m
[2m        }[22m
[2m        return t1;[22m
[2m      }[22m
[2m    : function Component({ value }: $ReadOnly<{ value: string }>) {[22m
[2m        return <div>{value}</div>;[22m
[2m      };[22m

[2m  export default memo<Props>(Component);[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m gating-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating @compilationMode(annotation)[22m
[2m  function Bar(props) {[22m
[2m    'use forget';[22m
[2m    return <div>{props.bar}</div>;[22m
[2m  }[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  function Foo(props) {[22m
[2m    'use forget';[22m
[2m    return <Foo>{props.bar}</Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating @compilationMode(annotation)[22m
[2m  const Bar = isForgetEnabled_Fixtures()[22m
[2m    ? function Bar(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <div>{props.bar}</div>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Bar(props) {[22m
[2m        "use forget";[22m
[2m        return <div>{props.bar}</div>;[22m
[2m      };[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m
[2m  const Foo = isForgetEnabled_Fixtures()[22m
[2m    ? function Foo(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <Foo>{props.bar}</Foo>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Foo(props) {[22m
[2m        "use forget";[22m
[2m        return <Foo>{props.bar}</Foo>;[22m
[2m      };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m gating-test-export-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating @compilationMode(annotation)[22m
[2m  export function Bar(props) {[22m
[2m    'use forget';[22m
[2m    return <div>{props.bar}</div>;[22m
[2m  }[22m

[2m  export function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  export function Foo(props) {[22m
[2m    'use forget';[22m
[2m    return <Foo>{props.bar}</Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating @compilationMode(annotation)[22m
[2m  export const Bar = isForgetEnabled_Fixtures()[22m
[2m    ? function Bar(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <div>{props.bar}</div>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Bar(props) {[22m
[2m        "use forget";[22m
[2m        return <div>{props.bar}</div>;[22m
[2m      };[22m

[2m  export function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  export const Foo = isForgetEnabled_Fixtures()[22m
[2m    ? function Foo(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <Foo>{props.bar}</Foo>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Foo(props) {[22m
[2m        "use forget";[22m
[2m        return <Foo>{props.bar}</Foo>;[22m
[2m      };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m gating-test-export-function-and-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating @compilationMode(annotation)[22m
[2m  export default function Bar(props) {[22m
[2m    'use forget';[22m
[2m    return <div>{props.bar}</div>;[22m
[2m  }[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  export function Foo(props) {[22m
[2m    'use forget';[22m
[2m    return <Foo>{props.bar}</Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating @compilationMode(annotation)[22m
[2m  const Bar = isForgetEnabled_Fixtures()[22m
[2m    ? function Bar(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <div>{props.bar}</div>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Bar(props) {[22m
[2m        "use forget";[22m
[2m        return <div>{props.bar}</div>;[22m
[2m      };[22m
[2m  export default Bar;[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  export const Foo = isForgetEnabled_Fixtures()[22m
[2m    ? function Foo(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <Foo>{props.bar}</Foo>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Foo(props) {[22m
[2m        "use forget";[22m
[2m        return <Foo>{props.bar}</Foo>;[22m
[2m      };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m gating-test-export-default-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating @compilationMode(annotation)[22m
[2m  export default function Bar(props) {[22m
[2m    'use forget';[22m
[2m    return <div>{props.bar}</div>;[22m
[2m  }[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  function Foo(props) {[22m
[2m    'use forget';[22m
[2m    return <Foo>{props.bar}</Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating @compilationMode(annotation)[22m
[2m  const Bar = isForgetEnabled_Fixtures()[22m
[2m    ? function Bar(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <div>{props.bar}</div>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Bar(props) {[22m
[2m        "use forget";[22m
[2m        return <div>{props.bar}</div>;[22m
[2m      };[22m
[2m  export default Bar;[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m
[2m  const Foo = isForgetEnabled_Fixtures()[22m
[2m    ? function Foo(props) {[22m
[32m-       "use forget";[39m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <Foo>{props.bar}</Foo>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Foo(props) {[22m
[2m        "use forget";[22m
[2m        return <Foo>{props.bar}</Foo>;[22m
[2m      };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m functionexpr–conditional-access
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableTreatFunctionDepsAsConditional[22m
[2m  function Component(props) {[22m
[2m    function getLength() {[22m
[2m      return props.bar.length;[22m
[2m    }[22m

[2m    return props.bar && getLength();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{bar: null}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableTreatFunctionDepsAsConditional[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = function getLength() {[22m
[2m        return props.bar.length;[22m
[2m      };[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const getLength = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== props.bar || $[3] !== getLength) {[22m
[2m      t1 = props.bar && getLength();[22m
[2m      $[2] = props.bar;[22m
[2m      $[3] = getLength;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ bar: null }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m function-param-assignment-pattern
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(x = 'default', y = [{}]) {[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0, t1) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[31m+   Object.freeze(t1);[39m
[2m    const x = t0 === undefined ? "default" : t0;[22m
[2m    let t2;[22m
[2m    if ($[0] !== t1) {[22m
[2m      t2 = t1 === undefined ? [{}] : t1;[22m
[2m      $[0] = t1;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[2m    const y = t2;[22m
[2m    let t3;[22m
[2m    if ($[2] !== x || $[3] !== y) {[22m
[2m      t3 = [x, y];[22m
[2m      $[2] = x;[22m
[2m      $[3] = y;[22m
[2m      $[4] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[4];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m function-expression-with-store-to-parameter
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const mutate = (object, key, value) => {[22m
[2m      object.updated = true;[22m
[2m      object[key] = value;[22m
[2m    };[22m
[2m    const x = makeObject(props);[22m
[2m    mutate(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const mutate = _temp;[22m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = makeObject(props);[22m
[2m      mutate(x);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m
[2m  function _temp(object, key, value) {[22m
[2m    object.updated = true;[22m
[2m    object[key] = value;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m function-expression-prototype-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const f = function () {[22m
[2m      return <div>{props.name}</div>;[22m
[2m    };[22m
[2m    return f.call();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Jason'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = function () {[22m
[2m        return <div>{props.name}</div>;[22m
[2m      };[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const f = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== f) {[22m
[2m      t1 = f.call();[22m
[2m      $[2] = f;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Jason" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>Jason</div>[22m

[31m[1mFAIL:[22m[39m function-expression-prototype-call-mutating
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":["Lauren"],"output":["Lauren"]}</div>
<div>{"inputs":["Lauren"],"output":["Lauren"]}</div>
<div>{"inputs":["Jason"],"output":["Jason"]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m function-expression-maybe-mutates-hook-return-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const id = useSelectedEntitytId();[22m
[2m    // this example should infer `id` as mutable, and then infer `onLoad` as mutable,[22m
[2m    // and be rejected because onLoad cannot be passed as a frozen value in the JSX.[22m
[2m    // however, we likely have to allow this example to work, because hook return[22m
[2m    // values are generally immutable in practice and are also widely referenced in[22m
[2m    // callbacks.[22m
[2m    const onLoad = () => {[22m
[2m      log(id);[22m
[2m    };[22m
[2m    return <Foo onLoad={onLoad} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const id = useSelectedEntitytId();[39m
[31m+   Object.freeze(props);[39m
[31m+   const id = (function () {[39m
[31m+     const $res$ = useSelectedEntitytId();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== id) {[22m
[2m      t0 = () => {[22m
[2m        log(id);[22m
[2m      };[22m
[2m      $[0] = id;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onLoad = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== onLoad) {[22m
[32m-     t1 = <Foo onLoad={onLoad} />;[39m
[31m+     t1 = ([39m
[31m+       <Foo[39m
[31m+         onLoad={function () {[39m
[31m+           const $res$ = onLoad;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = onLoad;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m function-expression-captures-value-later-frozen-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = {};[22m
[2m    // onChange should be inferred as immutable, because the value[22m
[2m    // it captures (`x`) is frozen by the time the function is referenced[22m
[2m    const onChange = e => {[22m
[2m      maybeMutate(x, e.target.value);[22m
[2m    };[22m
[2m    if (props.cond) {[22m
[2m      <div>{x}</div>;[22m
[2m    }[22m
[2m    return <Foo value={x} onChange={onChange} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = (e) => {[22m
[2m        maybeMutate(x, e.target.value);[22m
[2m      };[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const onChange = t1;[22m
[2m    if (props.cond) {[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t2 = <Foo value={x} onChange={onChange} />;[39m
[31m+     t2 = ([39m
[31m+       <Foo[39m
[31m+         value={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         onChange={function () {[39m
[31m+           const $res$ = onChange;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m function-expr-directive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    'use strict';[22m
[2m    let [count, setCount] = React.useState(0);[22m
[2m    function update() {[22m
[2m      'worklet';[22m
[2m      setCount(count => count + 1);[22m
[2m    }[22m
[2m    return <button onClick={update}>{count}</button>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[32m-   "use strict";[39m
[2m    const $ = _c(3);[22m

[32m-   const [count, setCount] = React.useState(0);[39m
[31m+   const [count, setCount] = (function () {[39m
[31m+     const $res$ = React.useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = function update() {[22m
[2m        "worklet";[22m

[2m        setCount((count_0) => count_0 + 1);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const update = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== count) {[22m
[32m-     t1 = <button onClick={update}>{count}</button>;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = update;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {count}[39m
[31m+       </button>[39m
[31m+     );[39m
[2m      $[1] = count;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <button>0</button>[22m

[31m[1mFAIL:[22m[39m function-declaration-simple
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let t = {a};[22m
[2m    function x(p) {[22m
[2m      p.foo();[22m
[2m    }[22m
[2m    x(t);[22m
[2m    return t;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[2m    let t;[22m
[2m    if ($[0] !== a) {[22m
[2m      t = { a };[22m
[2m      let t0;[22m
[2m      if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t0 = function x(p) {[22m
[2m          p.foo();[22m
[2m        };[22m
[2m        $[2] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[2];[22m
[2m      }[22m
[2m      const x = t0;[22m

[2m      x(t);[22m
[2m      $[0] = a;[22m
[2m      $[1] = t;[22m
[2m    } else {[22m
[2m      t = $[1];[22m
[2m    }[22m
[2m    return t;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m frozen-after-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    const a = [];[22m
[2m    const b = a;[22m
[2m    useFreeze(a);[22m
[2m    foo(b); // should be readonly, value is guaranteed frozen via alias[22m
[2m    return b;[22m
[2m  }[22m

[2m  function useFreeze() {}[22m
[2m  function foo(x) {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const a = t0;[22m
[2m    const b = a;[22m
[32m-   useFreeze(a);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useFreeze(Object.freeze(a));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    foo(b);[22m
[2m    return b;[22m
[2m  }[22m

[2m  function useFreeze() {}[22m
[32m- function foo(x) {}[39m
[31m+ function foo(x) {[39m
[31m+   Object.freeze(x);[39m
[31m+ }[39m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m for-with-assignment-as-update
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = props.init;[22m
[2m    for (let i = 0; i < 100; i = i + 1) {[22m
[2m      x += i;[22m
[2m    }[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{init: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = props.init;[22m
[2m    for (let i = 0; i < 100; i = i + 1) {[22m
[2m      x = x + i;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ init: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [4950][22m

[31m[1mFAIL:[22m[39m for-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    for (let i = 0; i < props.count; i++) {[22m
[2m      return;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    for (const i = 0; 0 < props.count; ) {[22m
[2m      return;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m for-of-nonmutating-loop-local-collection
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[1],"output":[1]}</div><div>{"inputs":[[1],0],"output":[0,1]}</div>
<div>{"inputs":[1],"output":[1]}</div><div>{"inputs":[[1],1],"output":[1,1]}</div>
<div>{"inputs":[0],"output":[0]}</div><div>{"inputs":[[0],1],"output":[1,0]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m for-of-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeObject_Primitives, mutateAndReturn, toJSON} from 'shared-runtime';[22m

[2m  function Component(_props) {[22m
[2m    const collection = [makeObject_Primitives()];[22m
[2m    const results = [];[22m
[2m    for (const item of collection) {[22m
[2m      results.push(<div key={toJSON(item)}>{toJSON(mutateAndReturn(item))}</div>);[22m
[2m    }[22m
[2m    return <div>{results}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeObject_Primitives, mutateAndReturn, toJSON } from "shared-runtime";[22m

[2m  function Component(_props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(_props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const collection = [makeObject_Primitives()];[22m
[2m      const results = [];[22m
[2m      for (const item of collection) {[22m
[2m        results.push([22m
[32m-         <div key={toJSON(item)}>{toJSON(mutateAndReturn(item))}</div>,[39m
[31m+         <div[39m
[31m+           key={function () {[39m
[31m+             const $res$ = toJSON(item);[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+         >[39m
[31m+           {toJSON(mutateAndReturn(item))}[39m
[31m+         </div>,[39m
[2m        );[22m
[2m      }[22m

[2m      t0 = <div>{results}</div>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>{"a":0,"b":"value1","c":true,"wat0":"joe"}</div></div>[22m

[31m[1mFAIL:[22m[39m for-of-mutate-item-of-local-collection
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeObject_Primitives} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const items = [makeObject_Primitives(), makeObject_Primitives()];[22m
[2m    for (const x of items) {[22m
[2m      x.a += 1;[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}, {}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeObject_Primitives } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      items = [makeObject_Primitives(), makeObject_Primitives()];[22m
[2m      for (const x of items) {[22m
[2m        x.a = x.a + 1;[22m
[2m      }[22m
[2m      $[0] = items;[22m
[2m    } else {[22m
[2m      items = $[0];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}, {}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":1,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m
[2m  [{"a":1,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m
[2m  [{"a":1,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m

[31m[1mFAIL:[22m[39m for-of-iterator-of-immutable-collection
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Router({title, mapping}) {[22m
[2m    const array = [];[22m
[2m    for (let entry of mapping.values()) {[22m
[2m      array.push([title, entry]);[22m
[2m    }[22m
[2m    return array;[22m
[2m  }[22m

[2m  const routes = new Map([[22m
[2m    ['about', '/about'],[22m
[2m    ['contact', '/contact'],[22m
[2m  ]);[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Router,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {[22m
[2m        title: 'Foo',[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m      {[22m
[2m        title: 'Bar',[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Router(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { title, mapping } = t0;[22m
[2m    let array;[22m
[2m    if ($[0] !== mapping || $[1] !== title) {[22m
[2m      array = [];[22m
[2m      for (const entry of mapping.values()) {[22m
[2m        array.push([title, entry]);[22m
[2m      }[22m
[2m      $[0] = mapping;[22m
[2m      $[1] = title;[22m
[2m      $[2] = array;[22m
[2m    } else {[22m
[2m      array = $[2];[22m
[2m    }[22m
[2m    return array;[22m
[2m  }[22m

[2m  const routes = new Map([[22m
[2m    ["about", "/about"],[22m
[2m    ["contact", "/contact"],[22m
[2m  ]);[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Router,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {[22m
[2m        title: "Foo",[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m      {[22m
[2m        title: "Bar",[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [["Foo","/about"],["Foo","/contact"]][22m
[2m  [["Bar","/about"],["Bar","/contact"]][22m

[31m[1mFAIL:[22m[39m for-of-immutable-collection
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Router({title, mapping}) {[22m
[2m    const array = [];[22m
[2m    for (let [, entry] of mapping) {[22m
[2m      array.push([title, entry]);[22m
[2m    }[22m
[2m    return array;[22m
[2m  }[22m

[2m  const routes = new Map([[22m
[2m    ['about', '/about'],[22m
[2m    ['contact', '/contact'],[22m
[2m  ]);[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Router,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {[22m
[2m        title: 'Foo',[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m      {[22m
[2m        title: 'Bar',[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Router(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { title, mapping } = t0;[22m
[2m    let array;[22m
[2m    if ($[0] !== mapping || $[1] !== title) {[22m
[2m      array = [];[22m
[2m      for (const [, entry] of mapping) {[22m
[2m        array.push([title, entry]);[22m
[2m      }[22m
[2m      $[0] = mapping;[22m
[2m      $[1] = title;[22m
[2m      $[2] = array;[22m
[2m    } else {[22m
[2m      array = $[2];[22m
[2m    }[22m
[2m    return array;[22m
[2m  }[22m

[2m  const routes = new Map([[22m
[2m    ["about", "/about"],[22m
[2m    ["contact", "/contact"],[22m
[2m  ]);[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Router,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {[22m
[2m        title: "Foo",[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m      {[22m
[2m        title: "Bar",[22m
[2m        mapping: routes,[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [["Foo","/about"],["Foo","/contact"]][22m
[2m  [["Bar","/about"],["Bar","/contact"]][22m

[31m[1mFAIL:[22m[39m for-of-capture-item-of-local-collection-mutate-later
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeObject_Primitives} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let lastItem = {};[22m
[2m    const items = [makeObject_Primitives(), makeObject_Primitives()];[22m
[2m    for (const x of items) {[22m
[2m      lastItem = x;[22m
[2m    }[22m
[2m    if (lastItem != null) {[22m
[2m      lastItem.a += 1;[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeObject_Primitives } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      let lastItem = {};[22m
[2m      items = [makeObject_Primitives(), makeObject_Primitives()];[22m
[2m      for (const x of items) {[22m
[2m        lastItem = x;[22m
[2m      }[22m
[2m      if (lastItem != null) {[22m
[2m        lastItem.a = lastItem.a + 1;[22m
[2m      }[22m
[2m      $[0] = items;[22m
[2m    } else {[22m
[2m      items = $[0];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":0,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m
[2m  [{"a":0,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m

[31m[1mFAIL:[22m[39m for-of-capture-item-of-local-collection-mutate-later-value-initially-null
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeObject_Primitives} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let lastItem = null;[22m
[2m    const items = [makeObject_Primitives(), makeObject_Primitives()];[22m
[2m    for (const x of items) {[22m
[2m      lastItem = x;[22m
[2m    }[22m
[2m    if (lastItem != null) {[22m
[2m      lastItem.a += 1;[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}, {}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeObject_Primitives } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      let lastItem = null;[22m
[2m      items = [makeObject_Primitives(), makeObject_Primitives()];[22m
[2m      for (const x of items) {[22m
[2m        lastItem = x;[22m
[2m      }[22m
[2m      if (lastItem != null) {[22m
[2m        lastItem.a = lastItem.a + 1;[22m
[2m      }[22m
[2m      $[0] = items;[22m
[2m    } else {[22m
[2m      items = $[0];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}, {}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":0,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m
[2m  [{"a":0,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m
[2m  [{"a":0,"b":"value1","c":true},{"a":1,"b":"value1","c":true}][22m

[31m[1mFAIL:[22m[39m for-multiple-variable-declarations-in-initializer
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = [];[22m

[2m    for (let i = 0, length = props.items.length; i < length; i++) {[22m
[2m      items.push(props.items[i]);[22m
[2m    }[22m

[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{items: ['a', 'b', 42]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let items;[22m
[2m    if ($[0] !== props.items) {[22m
[2m      items = [];[22m
[2m      for (let i = 0, length = props.items.length; i < length; i++) {[22m
[2m        items.push(props.items[i]);[22m
[2m      }[22m
[2m      $[0] = props.items;[22m
[2m      $[1] = items;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ items: ["a", "b", 42] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["a","b",42][22m

[31m[1mFAIL:[22m[39m for-loop-with-value-block-initializer
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>one</div></div>
<div></div>
<div><div>zero</div><div>one</div><div>two</div></div>
<div><div>one</div><div>two</div></div>
Forget:
(kind: ok) <div><div>one</div></div>
<div></div>
<div><div>zero</div><div>one</div><div>two</div></div>
<div><div>one</div><div>two</div></div>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = item.id;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = item.id;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = item.id;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)']

[31m[1mFAIL:[22m[39m for-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let y = 0;[22m
[2m    for ([22m
[2m      let x = 0;[22m
[2m      x > props.min && x < props.max;[22m
[2m      x += props.cond ? props.increment : 2[22m
[2m    ) {[22m
[2m      x *= 2;[22m
[2m      y += x;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let y = 0;[22m
[2m    for ([22m
[2m      let x = 0;[22m
[2m      x > props.min && x < props.max;[22m
[2m      x = x + (props.cond ? props.increment : 2), x[22m
[2m    ) {[22m
[2m      x = x * 2;[22m
[2m      y = y + x;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m for-in-statement
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div><div>a</div><div>b</div><div>c</div></div>
<div><div>lauren</div><div>mofei</div><div>sathya</div><div>jason</div></div>
Forget:
(kind: ok) <div><div>a</div><div>b</div><div>c</div></div>
<div><div>lauren</div><div>mofei</div><div>sathya</div><div>jason</div></div>
logs: ['Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = key;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = key;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = key;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = key;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)','Warning: Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.%s','function () {\n' +
  '          const $res$ = key;\n' +
  '          Object.freeze($res$);\n' +
  '          return $res$;\n' +
  '        }','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)\n' +
  '    at WrapperTestComponentWithErrorBoundary (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:63:9)']

[31m[1mFAIL:[22m[39m for-in-statement-type-inference
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {identity, mutate} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    const object = {...props.value};[22m
[2m    for (const y in object) {[22m
[2m      x = y;[22m
[2m    }[22m
[2m    mutate(x); // can't modify, x is known primitive![22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: {a: 'a', b: 'B', c: 'C!'}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  const { identity, mutate } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    const object = { ...props.value };[22m
[2m    for (const y in object) {[22m
[2m      x = y;[22m
[2m    }[22m

[2m    mutate(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: { a: "a", b: "B", c: "C!" } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "c"[22m

[31m[1mFAIL:[22m[39m for-in-statement-empty-body
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    for (const y in props.value) {[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: {a: 'a', b: 'B', c: 'C!'}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    for (const y in props.value) {[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: { a: "a", b: "B", c: "C!" } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m for-in-statement-continue
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    const object = {...props.value};[22m
[2m    for (const y in object) {[22m
[2m      if (y === 'continue') {[22m
[2m        continue;[22m
[2m      }[22m
[2m      x = object[y];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: {a: 'a', continue: 'skip', b: 'hello!'}}],[22m
[2m    sequentialRenders: [[22m
[2m      {value: {a: 'a', continue: 'skip', b: 'hello!'}},[22m
[2m      {value: {a: 'a', continue: 'skip', b: 'hello!'}},[22m
[2m      {value: {a: 'skip!', continue: true}},[22m
[2m      {value: {a: 'a', continue: 'skip', b: 'hello!'}},[22m
[2m      {value: {a: 'skip!', continue: true}},[22m
[2m      {value: {a: 'a', continue: 'skip', b: 'hello!'}},[22m
[2m      {value: {a: 'skip!', continue: true}},[22m
[2m      {value: {a: 'skip!', continue: true}},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = { ...props.value };[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const object = t0;[22m
[2m    for (const y in object) {[22m
[2m      if (y === "continue") {[22m
[2m        continue;[22m
[2m      }[22m

[2m      x = object[y];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: { a: "a", continue: "skip", b: "hello!" } }],[22m
[2m    sequentialRenders: [[22m
[2m      { value: { a: "a", continue: "skip", b: "hello!" } },[22m
[2m      { value: { a: "a", continue: "skip", b: "hello!" } },[22m
[2m      { value: { a: "skip!", continue: true } },[22m
[2m      { value: { a: "a", continue: "skip", b: "hello!" } },[22m
[2m      { value: { a: "skip!", continue: true } },[22m
[2m      { value: { a: "a", continue: "skip", b: "hello!" } },[22m
[2m      { value: { a: "skip!", continue: true } },[22m
[2m      { value: { a: "skip!", continue: true } },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "hello!"[22m
[2m  "hello!"[22m
[2m  "skip!"[22m
[2m  "hello!"[22m
[2m  "skip!"[22m
[2m  "hello!"[22m
[2m  "skip!"[22m
[2m  "skip!"[22m

[31m[1mFAIL:[22m[39m for-in-statement-break
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    const object = {...props.value};[22m
[2m    for (const y in object) {[22m
[2m      if (y === 'break') {[22m
[2m        break;[22m
[2m      }[22m
[2m      x = object[y];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    // should return 'a'[22m
[2m    params: [{a: 'a', break: null, c: 'C!'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = { ...props.value };[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const object = t0;[22m
[2m    for (const y in object) {[22m
[2m      if (y === "break") {[22m
[2m        break;[22m
[2m      }[22m

[2m      x = object[y];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    // should return 'a'[22m
[2m    params: [{ a: "a", break: null, c: "C!" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m for-in-statement-body-always-returns
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    for (const x in props.value) {[22m
[2m      return x;[22m
[2m    }[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: {a: 'A!'}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    for (const x in props.value) {[22m
[2m      return x;[22m
[2m    }[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: { a: "A!" } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "a"[22m

[31m[1mFAIL:[22m[39m for-empty-update
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    for (let i = 0; i < props.count; ) {[22m
[2m      x += i;[22m
[2m      if (x > 10) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    for (const i = 0; 0 < props.count; ) {[22m
[2m      x = x + 0;[22m
[2m      if (x > 10) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m for-empty-update-with-continue
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    for (let i = 0; i < props.count; ) {[22m
[2m      x += i;[22m
[2m      i += 1;[22m
[2m      continue;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    for (let i = 0; i < props.count; ) {[22m
[2m      x = x + i;[22m
[2m      i = i + 1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m flatten-scopes-with-methodcall-hook
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {ObjectWithHooks} = require('shared-runtime');[22m

[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const [y] = ObjectWithHooks.useMakeArray();[22m
[2m    x.push(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  const { ObjectWithHooks } = require("shared-runtime");[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [];[22m
[32m-   const [y] = ObjectWithHooks.useMakeArray();[39m
[31m+   const [y] = (function () {[39m
[31m+     const $res$ = ObjectWithHooks.useMakeArray();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    x.push(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 1[22m

[31m[1mFAIL:[22m[39m flag-enable-emit-hook-guards
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableEmitHookGuards[22m
[2m  import {createContext, useContext, useEffect, useState} from 'react';[22m
[2m  import {[22m
[2m    CONST_STRING0,[22m
[2m    ObjectWithHooks,[22m
[2m    getNumber,[22m
[2m    identity,[22m
[2m    print,[22m
[2m  } from 'shared-runtime';[22m

[2m  const MyContext = createContext('my context value');[22m
[2m  function Component({value}) {[22m
[2m    print(identity(CONST_STRING0));[22m
[2m    const [state, setState] = useState(getNumber());[22m
[2m    print(value, state);[22m
[2m    useEffect(() => {[22m
[2m      if (state === 4) {[22m
[2m        setState(5);[22m
[2m      }[22m
[2m    }, [state]);[22m
[2m    print(identity(value + state));[22m
[2m    return ObjectWithHooks.useIdentity(useContext(MyContext));[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    args: [{value: 0}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { $dispatcherGuard } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableEmitHookGuards[22m
[2m  import { createContext, useContext, useEffect, useState } from "react";[22m
[2m  import {[22m
[2m    CONST_STRING0,[22m
[2m    ObjectWithHooks,[22m
[2m    getNumber,[22m
[2m    identity,[22m
[2m    print,[22m
[2m  } from "shared-runtime";[22m

[2m  const MyContext = createContext("my context value");[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    try {[22m
[2m      $dispatcherGuard(0);[22m
[2m      const { value } = t0;[22m
[2m      print(identity(CONST_STRING0));[22m
[2m      let t1;[22m
[2m      if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t1 = getNumber();[22m
[2m        $[0] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[0];[22m
[2m      }[22m
[2m      const [state, setState] = (function () {[22m
[2m        try {[22m
[2m          $dispatcherGuard(2);[22m
[32m-         return useState(t1);[39m
[31m+         return (function () {[39m
[31m+           const $res$ = useState(Object.freeze(t1));[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         })();[39m
[2m        } finally {[22m
[2m          $dispatcherGuard(3);[22m
[2m        }[22m
[2m      })();[22m
[2m      print(value, state);[22m
[2m      let t2;[22m
[2m      let t3;[22m
[2m      if ($[1] !== state) {[22m
[2m        t2 = () => {[22m
[2m          if (state === 4) {[22m
[2m            setState(5);[22m
[2m          }[22m
[2m        };[22m

[2m        t3 = [state];[22m
[2m        $[1] = state;[22m
[2m        $[2] = t2;[22m
[2m        $[3] = t3;[22m
[2m      } else {[22m
[2m        t2 = $[2];[22m
[2m        t3 = $[3];[22m
[2m      }[22m
[2m      (function () {[22m
[2m        try {[22m
[2m          $dispatcherGuard(2);[22m
[32m-         return useEffect(t2, t3);[39m
[31m+         return (function () {[39m
[31m+           const $res$ = useEffect(Object.freeze(t2), Object.freeze(t3));[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         })();[39m
[2m        } finally {[22m
[2m          $dispatcherGuard(3);[22m
[2m        }[22m
[2m      })();[22m
[2m      print(identity(value + state));[22m
[2m      return (function () {[22m
[2m        try {[22m
[2m          $dispatcherGuard(2);[22m
[32m-         return ObjectWithHooks.useIdentity([39m
[32m-           (function () {[39m
[32m-             try {[39m
[32m-               $dispatcherGuard(2);[39m
[32m-               return useContext(MyContext);[39m
[32m-             } finally {[39m
[32m-               $dispatcherGuard(3);[39m
[32m-             }[39m
[32m-           })(),[39m
[32m-         );[39m
[31m+         return (function () {[39m
[31m+           const $res$ = ObjectWithHooks.useIdentity([39m
[31m+             Object.freeze([39m
[31m+               (function () {[39m
[31m+                 try {[39m
[31m+                   $dispatcherGuard(2);[39m
[31m+                   return (function () {[39m
[31m+                     const $res$ = useContext(Object.freeze(MyContext));[39m
[31m+                     Object.freeze($res$);[39m
[31m+                     return $res$;[39m
[31m+                   })();[39m
[31m+                 } finally {[39m
[31m+                   $dispatcherGuard(3);[39m
[31m+                 }[39m
[31m+               })(),[39m
[31m+             ),[39m
[31m+           );[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         })();[39m
[2m        } finally {[22m
[2m          $dispatcherGuard(3);[22m
[2m        }[22m
[2m      })();[22m
[2m    } finally {[22m
[2m      $dispatcherGuard(1);[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    args: [{ value: 0 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fast-refresh-reloading
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[0],"output":[0]}</div>
<div>{"inputs":[0],"output":[0]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m fast-refresh-refresh-on-const-changes-dev
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer) @enableResetCacheOnSourceFileChanges[22m
[2m  import {useEffect, useMemo, useState} from 'react';[22m
[2m  import {ValidateMemoization} from 'shared-runtime';[22m

[2m  let pretendConst = 0;[22m

[2m  function unsafeResetConst() {[22m
[2m    pretendConst = 0;[22m
[2m  }[22m

[2m  function unsafeUpdateConst() {[22m
[2m    pretendConst += 1;[22m
[2m  }[22m

[2m  function Component() {[22m
[2m    useState(() => {[22m
[2m      // unsafe: reset the constant when first rendering the instance[22m
[2m      unsafeResetConst();[22m
[2m    });[22m
[2m    // UNSAFE! changing a module variable that is read by a component is normally[22m
[2m    // unsafe, but in this case we're simulating a fast refresh between each render[22m
[2m    unsafeUpdateConst();[22m

[2m    // TODO: In fast refresh mode (@enableResetCacheOnSourceFileChanges) Forget should[22m
[2m    // reset on changes to globals that impact the component/hook, effectively memoizing[22m
[2m    // as if value was reactive. However, we don't want to actually treat globals as[22m
[2m    // reactive (though that would be trivial) since it could change compilation too much[22m
[2m    // btw dev and prod. Instead, we should reset the cache via a secondary mechanism.[22m
[2m    const value = useMemo(() => [{pretendConst}], [pretendConst]);[22m

[2m    return <ValidateMemoization inputs={[pretendConst]} output={value} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer) @enableResetCacheOnSourceFileChanges[22m
[2m  import { useEffect, useMemo, useState } from "react";[22m
[2m  import { ValidateMemoization } from "shared-runtime";[22m

[2m  let pretendConst = 0;[22m

[2m  function unsafeResetConst() {[22m
[2m    pretendConst = 0;[22m
[2m  }[22m

[2m  function unsafeUpdateConst() {[22m
[2m    pretendConst += 1;[22m
[2m  }[22m

[2m  function Component() {[22m
[2m    const $ = _c(3);[22m
[2m    if ([22m
[2m      $[0] !== "8d7015668f857996c3d895a7a90e3e16b8a791d5b9cd13f2c76e1c254aeedebb"[22m
[2m    ) {[22m
[2m      for (let $i = 0; $i < 3; $i += 1) {[22m
[2m        $[$i] = Symbol.for("react.memo_cache_sentinel");[22m
[2m      }[22m
[2m      $[0] = "8d7015668f857996c3d895a7a90e3e16b8a791d5b9cd13f2c76e1c254aeedebb";[22m
[2m    }[22m
[32m-   useState(_temp);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState(Object.freeze(_temp));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    unsafeUpdateConst();[22m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = [{ pretendConst }];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const value = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t2 = <ValidateMemoization inputs={[pretendConst]} output={value} />;[39m
[31m+     t2 = ([39m
[31m+       <ValidateMemoization[39m
[31m+         inputs={function () {[39m
[31m+           const $res$ = [pretendConst];[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         output={function () {[39m
[31m+           const $res$ = value;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    unsafeResetConst();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    sequentialRenders: [{}, {}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fast-refresh-dont-refresh-const-changes-prod
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[],"output":[{"pretendConst":1}]}</div>
<div>{"inputs":[],"output":[{"pretendConst":1}]}</div>
Forget:
(kind: ok) [[ (exception in render) TypeError: inputs.some is not a function ]]
[[ (exception in render) TypeError: inputs.some is not a function ]]

[31m[1mFAIL:[22m[39m extend-scopes-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x = [];[22m
[2m    if (a) {[22m
[2m      if (b) {[22m
[2m        if (c) {[22m
[2m          x.push(0);[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m    if (x.length) {[22m
[2m      return x;[22m
[2m    }[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        if (b) {[22m
[2m          if (c) {[22m
[2m            x.push(0);[22m
[2m          }[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    if (x.length) {[22m
[2m      return x;[22m
[2m    }[22m
[2m    return null;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m expression-with-assignment-dynamic
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function f(y) {[22m
[2m    let x = y;[22m
[2m    return x + (x = 2) + x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function f(y) {[22m
[31m+   Object.freeze(y);[39m
[2m    let x = y;[22m
[2m    return x + (x = 2) + 2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: f,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m existing-variables-with-c-name
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"inputs":[0],"output":[0]}</div>
<div>{"inputs":[0],"output":[0]}</div>
<div>{"inputs":[0],"output":[0]}</div>
Forget:
(kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]
[[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]]

[31m[1mFAIL:[22m[39m escape-analysis-not-switch-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = [props.a];[22m
[2m    let x = props.b;[22m
[2m    switch (a) {[22m
[2m      case true: {[22m
[2m        x = props.c;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const a = [props.a];[22m
[2m    let x = props.b;[22m
[2m    switch (a) {[22m
[2m      case true: {[22m
[2m        x = props.c;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-not-switch-case
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = [props.a];[22m
[2m    let x = props.b;[22m
[2m    switch (props.c) {[22m
[2m      case a: {[22m
[2m        x = props.d;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const a = [props.a];[22m
[2m    let x = props.b;[22m
[2m    switch (props.c) {[22m
[2m      case a: {[22m
[2m        x = props.d;[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-not-if-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [props.a];[22m
[2m    let y;[22m
[2m    if (x) {[22m
[2m      y = props.b;[22m
[2m    } else {[22m
[2m      y = props.c;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [props.a];[22m
[2m    let y;[22m
[2m    if (x) {[22m
[2m      y = props.b;[22m
[2m    } else {[22m
[2m      y = props.c;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-not-conditional-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [props.a];[22m
[2m    const y = x ? props.b : props.c;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [props.a];[22m
[2m    const y = x ? props.b : props.c;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-non-escaping-interleaved-primitive-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a does not need to be memoized ever, even though it's a[22m
[2m    // dependency of c, which exists in a scope that has a memoized[22m
[2m    // output. it doesn't need to be memoized bc the value is a primitive type.[22m
[2m    const a = props.a + props.b;[22m

[2m    // b and c are interleaved and grouped into a single scope,[22m
[2m    // but they are independent values. c does not escape, but[22m
[2m    // we need to ensure that a is memoized or else b will invalidate[22m
[2m    // on every render since a is a dependency.[22m
[2m    const b = [];[22m
[2m    const c = {};[22m
[2m    c.a = a;[22m
[2m    b.push(props.c);[22m

[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m

[2m    const a = props.a + props.b;[22m
[2m    let b;[22m
[2m    if ($[0] !== a || $[1] !== props.c) {[22m
[2m      b = [];[22m
[2m      const c = {};[22m
[2m      c.a = a;[22m
[2m      b.push(props.c);[22m
[2m      $[0] = a;[22m
[2m      $[1] = props.c;[22m
[2m      $[2] = b;[22m
[2m    } else {[22m
[2m      b = $[2];[22m
[2m    }[22m
[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-non-escaping-interleaved-allocating-nested-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a can be independently memoized, is not mutated later[22m
[2m    // but a is a dependnecy of b, which is a dependency of c.[22m
[2m    // we have to memoize a to avoid breaking memoization of b,[22m
[2m    // to avoid breaking memoization of c.[22m
[2m    const a = [props.a];[22m

[2m    // a can be independently memoized, is not mutated later,[22m
[2m    // but is a dependency of d which is part of c's scope.[22m
[2m    // we have to memoize b to avoid breaking memoization of c.[22m
[2m    const b = [a];[22m

[2m    // c and d are interleaved and grouped into a single scope,[22m
[2m    // but they are independent values. d does not escape, but[22m
[2m    // we need to ensure that b is memoized or else b will invalidate[22m
[2m    // on every render since a is a dependency. we also need to[22m
[2m    // ensure that a is memoized, since it's a dependency of b.[22m
[2m    const c = [];[22m
[2m    const d = {};[22m
[2m    d.b = b;[22m
[2m    c.push(props.b);[22m

[2m    return c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = [props.a];[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const a = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== a) {[22m
[2m      t1 = [a];[22m
[2m      $[2] = a;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const b = t1;[22m
[2m    let c;[22m
[2m    if ($[4] !== b || $[5] !== props.b) {[22m
[2m      c = [];[22m
[2m      const d = {};[22m
[2m      d.b = b;[22m
[2m      c.push(props.b);[22m
[2m      $[4] = b;[22m
[2m      $[5] = props.b;[22m
[2m      $[6] = c;[22m
[2m    } else {[22m
[2m      c = $[6];[22m
[2m    }[22m
[2m    return c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-non-escaping-interleaved-allocating-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // a can be independently memoized, is not mutated later[22m
[2m    const a = [props.a];[22m

[2m    // b and c are interleaved and grouped into a single scope,[22m
[2m    // but they are independent values. c does not escape, but[22m
[2m    // we need to ensure that a is memoized or else b will invalidate[22m
[2m    // on every render since a is a dependency.[22m
[2m    const b = [];[22m
[2m    const c = {};[22m
[2m    c.a = a;[22m
[2m    b.push(props.b);[22m

[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = [props.a];[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const a = t0;[22m
[2m    let b;[22m
[2m    if ($[2] !== a || $[3] !== props.b) {[22m
[2m      b = [];[22m
[2m      const c = {};[22m
[2m      c.a = a;[22m
[2m      b.push(props.b);[22m
[2m      $[2] = a;[22m
[2m      $[3] = props.b;[22m
[2m      $[4] = b;[22m
[2m    } else {[22m
[2m      b = $[4];[22m
[2m    }[22m
[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = [props.a];[22m
[2m    const b = [props.b];[22m
[2m    const c = [props.c];[22m
[2m    // We don't do constant folding for non-primitive values (yet) so we consider[22m
[2m    // that any of a, b, or c could return here[22m
[2m    return (a && b) || c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = [props.a];[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const a = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== props.b) {[22m
[2m      t1 = [props.b];[22m
[2m      $[2] = props.b;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const b = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== props.c) {[22m
[2m      t2 = [props.c];[22m
[2m      $[4] = props.c;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    const c = t2;[22m
[2m    return (a && b) || c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-jsx-child
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const x = [];[22m
[2m    if (a) {[22m
[2m      const y = [];[22m
[2m      if (b) {[22m
[2m        y.push(c);[22m
[2m      }[22m
[2m      x.push(<div>{y}</div>);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        let y;[22m
[2m        if ($[4] !== b || $[5] !== c) {[22m
[2m          y = [];[22m
[2m          if (b) {[22m
[2m            y.push(c);[22m
[2m          }[22m
[2m          $[4] = b;[22m
[2m          $[5] = c;[22m
[2m          $[6] = y;[22m
[2m        } else {[22m
[2m          y = $[6];[22m
[2m        }[22m
[2m        let t0;[22m
[2m        if ($[7] !== y) {[22m
[2m          t0 = <div>{y}</div>;[22m
[2m          $[7] = y;[22m
[2m          $[8] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[8];[22m
[2m        }[22m
[2m        x.push(t0);[22m
[2m      }[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m escape-analysis-destructured-rest-element
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // b is an object, must be memoized even though the input is not memoized[22m
[2m    const {a, ...b} = props.a;[22m
[2m    // d is an array, mut be memoized even though the input is not memoized[22m
[2m    const [c, ...d] = props.c;[22m
[2m    return <div b={b} d={d}></div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let b;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      const { a, ...t0 } = props.a;[22m
[2m      b = t0;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = b;[22m
[2m    } else {[22m
[2m      b = $[1];[22m
[2m    }[22m
[2m    let d;[22m
[2m    if ($[2] !== props.c) {[22m
[2m      const [c, ...t0] = props.c;[22m
[2m      d = t0;[22m
[2m      $[2] = props.c;[22m
[2m      $[3] = d;[22m
[2m    } else {[22m
[2m      d = $[3];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[4] !== b || $[5] !== d) {[22m
[32m-     t0 = <div b={b} d={d} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         d={function () {[39m
[31m+           const $res$ = d;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = b;[22m
[2m      $[5] = d;[22m
[2m      $[6] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[6];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m early-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function MyApp(props) {[22m
[2m    let res;[22m
[2m    if (props.cond) {[22m
[2m      return;[22m
[2m    } else {[22m
[2m      res = 1;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function MyApp(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    if (props.cond) {[22m
[2m      return;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: MyApp,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m early-return-within-reactive-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeArray} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    if (props.cond) {[22m
[2m      x.push(props.a);[22m
[2m      // oops no memo![22m
[2m      return x;[22m
[2m    } else {[22m
[2m      return makeArray(props.b);[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      // pattern 1[22m
[2m      {cond: true, a: 42},[22m
[2m      {cond: true, a: 42},[22m
[2m      // pattern 2[22m
[2m      {cond: false, b: 3.14},[22m
[2m      {cond: false, b: 3.14},[22m
[2m      // pattern 1[22m
[2m      {cond: true, a: 42},[22m
[2m      // pattern 2[22m
[2m      {cond: false, b: 3.14},[22m
[2m      // pattern 1[22m
[2m      {cond: true, a: 42},[22m
[2m      // pattern 2[22m
[2m      {cond: false, b: 3.14},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeArray } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        const x = [];[22m
[2m        if (props.cond) {[22m
[2m          x.push(props.a);[22m
[2m          t0 = x;[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          let t1;[22m
[2m          if ($[2] !== props.b) {[22m
[2m            t1 = makeArray(props.b);[22m
[2m            $[2] = props.b;[22m
[2m            $[3] = t1;[22m
[2m          } else {[22m
[2m            t1 = $[3];[22m
[2m          }[22m
[2m          t0 = t1;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      // pattern 1[22m
[2m      { cond: true, a: 42 },[22m
[2m      { cond: true, a: 42 },[22m
[2m      // pattern 2[22m
[2m      { cond: false, b: 3.14 },[22m
[2m      { cond: false, b: 3.14 },[22m
[2m      // pattern 1[22m
[2m      { cond: true, a: 42 },[22m
[2m      // pattern 2[22m
[2m      { cond: false, b: 3.14 },[22m
[2m      // pattern 1[22m
[2m      { cond: true, a: 42 },[22m
[2m      // pattern 2[22m
[2m      { cond: false, b: 3.14 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m
[2m  [42][22m
[2m  [3.14][22m
[2m  [3.14][22m
[2m  [42][22m
[2m  [3.14][22m
[2m  [42][22m
[2m  [3.14][22m

[31m[1mFAIL:[22m[39m early-return-no-declarations-reassignments-dependencies
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeArray} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * This fixture tests what happens when a reactive has no declarations (other than an early return),[22m
[2m   * no reassignments, and no dependencies. In this case the only thing we can use to decide if we[22m
[2m   * should take the if or else branch is the early return declaration. But if that uses the same[22m
[2m   * sentinel as the memo cache sentinel, then if the previous execution did not early return it will[22m
[2m   * look like we didn't execute the memo block yet, and we'll needlessly re-execute instead of skipping[22m
[2m   * to the else branch.[22m
[2m   *[22m
[2m   * We have to use a distinct sentinel for the early return value.[22m
[2m   *[22m
[2m   * Here the fixture will always take the "else" branch and never early return. Logging (not included)[22m
[2m   * confirms that the scope for `x` only executes once, on the first render of the component.[22m
[2m   */[22m
[2m  let ENABLE_FEATURE = false;[22m

[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    if (ENABLE_FEATURE) {[22m
[2m      x.push(42);[22m
[2m      return x;[22m
[2m    } else {[22m
[2m      console.log('fallthrough');[22m
[2m    }[22m
[2m    return makeArray(props.a);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      {a: 42},[22m
[2m      {a: 42},[22m
[2m      {a: 3.14},[22m
[2m      {a: 3.14},[22m
[2m      {a: 42},[22m
[2m      {a: 3.14},[22m
[2m      {a: 42},[22m
[2m      {a: 3.14},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeArray } from "shared-runtime";[22m

[2m  /**[22m
[2m   * This fixture tests what happens when a reactive has no declarations (other than an early return),[22m
[2m   * no reassignments, and no dependencies. In this case the only thing we can use to decide if we[22m
[2m   * should take the if or else branch is the early return declaration. But if that uses the same[22m
[2m   * sentinel as the memo cache sentinel, then if the previous execution did not early return it will[22m
[2m   * look like we didn't execute the memo block yet, and we'll needlessly re-execute instead of skipping[22m
[2m   * to the else branch.[22m
[2m   *[22m
[2m   * We have to use a distinct sentinel for the early return value.[22m
[2m   *[22m
[2m   * Here the fixture will always take the "else" branch and never early return. Logging (not included)[22m
[2m   * confirms that the scope for `x` only executes once, on the first render of the component.[22m
[2m   */[22m
[2m  let ENABLE_FEATURE = false;[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        const x = [];[22m
[2m        if (ENABLE_FEATURE) {[22m
[2m          x.push(42);[22m
[2m          t0 = x;[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          console.log("fallthrough");[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[1] !== props.a) {[22m
[2m      t1 = makeArray(props.a);[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    sequentialRenders: [[22m
[2m      { a: 42 },[22m
[2m      { a: 42 },[22m
[2m      { a: 3.14 },[22m
[2m      { a: 3.14 },[22m
[2m      { a: 42 },[22m
[2m      { a: 3.14 },[22m
[2m      { a: 42 },[22m
[2m      { a: 3.14 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m early-return-nested-early-return-within-reactive-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    if (props.cond) {[22m
[2m      x.push(props.a);[22m
[2m      if (props.b) {[22m
[2m        const y = [props.b];[22m
[2m        x.push(y);[22m
[2m        // oops no memo![22m
[2m        return x;[22m
[2m      }[22m
[2m      // oops no memo![22m
[2m      return x;[22m
[2m    } else {[22m
[2m      return foo();[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true, a: 42, b: 3.14}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        const x = [];[22m
[2m        if (props.cond) {[22m
[2m          x.push(props.a);[22m
[2m          if (props.b) {[22m
[2m            let t1;[22m
[2m            if ($[2] !== props.b) {[22m
[2m              t1 = [props.b];[22m
[2m              $[2] = props.b;[22m
[2m              $[3] = t1;[22m
[2m            } else {[22m
[2m              t1 = $[3];[22m
[2m            }[22m
[2m            const y = t1;[22m
[2m            x.push(y);[22m
[2m            t0 = x;[22m
[2m            break bb0;[22m
[2m          }[22m

[2m          t0 = x;[22m
[2m          break bb0;[22m
[2m        } else {[22m
[2m          let t1;[22m
[2m          if ($[4] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m            t1 = foo();[22m
[2m            $[4] = t1;[22m
[2m          } else {[22m
[2m            t1 = $[4];[22m
[2m          }[22m
[2m          t0 = t1;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true, a: 42, b: 3.14 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42,[3.14]][22m

[31m[1mFAIL:[22m[39m drop-methodcall-usememo
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as React from 'react';[22m

[2m  function Component(props) {[22m
[2m    const x = React.useMemo(() => {[22m
[2m      const x = [];[22m
[2m      x.push(props.value);[22m
[2m      return x;[22m
[2m    }, [props.value]);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as React from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      x = [];[22m
[2m      x.push(props.value);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    t0 = x;[22m
[2m    const x_0 = t0;[22m
[2m    return x_0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [42][22m

[31m[1mFAIL:[22m[39m drop-methodcall-usecallback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as React from 'react';[22m

[2m  function Component(props) {[22m
[2m    const onClick = React.useCallback(() => {[22m
[2m      console.log(props.value);[22m
[2m    }, [props.value]);[22m
[2m    return <div onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as React from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t0 = () => {[22m
[2m        console.log(props.value);[22m
[2m      };[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== onClick) {[22m
[32m-     t1 = <div onClick={onClick} />;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[2] = onClick;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m dont-merge-overlapping-scopes-with-intermediate-reassignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    const array = [props.count];[22m
[2m    x = array;[22m
[2m    const element = <div>{array}</div>;[22m
[2m    return ([22m
[2m      <div>[22m
[2m        {element}[22m
[2m        {x}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{count: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.count) {[22m
[2m      t0 = [props.count];[22m
[2m      $[0] = props.count;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const array = t0;[22m
[2m    x = array;[22m
[2m    let t1;[22m
[2m    if ($[2] !== array) {[22m
[2m      t1 = <div>{array}</div>;[22m
[2m      $[2] = array;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const element = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== element || $[5] !== x) {[22m
[2m      t2 = ([22m
[2m        <div>[22m
[2m          {element}[22m
[2m          {x}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[4] = element;[22m
[2m      $[5] = x;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ count: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>42</div>42</div>[22m

[31m[1mFAIL:[22m[39m dont-merge-overlapping-scopes-store-const-used-later
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {Stringify, makeObject_Primitives} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const array = [props.count];[22m
[2m    const x = makeObject_Primitives();[22m
[2m    const element = <div>{array}</div>;[22m
[2m    console.log(x);[22m
[2m    return <div>{element}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{count: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { Stringify, makeObject_Primitives } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.count) {[22m
[2m      t0 = [props.count];[22m
[2m      $[0] = props.count;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const array = t0;[22m
[2m    const x = makeObject_Primitives();[22m
[2m    let t1;[22m
[2m    if ($[2] !== array) {[22m
[2m      t1 = <div>{array}</div>;[22m
[2m      $[2] = array;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const element = t1;[22m
[2m    console.log(x);[22m
[2m    let t2;[22m
[2m    if ($[4] !== element) {[22m
[2m      t2 = <div>{element}</div>;[22m
[2m      $[4] = element;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ count: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>42</div></div>[22m
[2m  logs: [{ a: 0, b: 'value1', c: true }][22m

[31m[1mFAIL:[22m[39m dont-merge-if-dep-is-inner-declaration-of-previous-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {ValidateMemoization} from 'shared-runtime';[22m

[2m  // Achieving Forget's level of memoization precision in this example isn't possible with useMemo[22m
[2m  // without significantly altering the code, so disable the non-Forget evaluation of this fixture.[22m
[2m  // @disableNonForgetInSprout[22m
[2m  function Component({a, b, c}) {[22m
[2m    const x = [];[22m
[2m    let y;[22m
[2m    if (a) {[22m
[2m      y = [b];[22m
[2m    }[22m
[2m    x.push(c);[22m

[2m    // this scope should not merge with the above scope because y does not invalidate[22m
[2m    // on changes to `c`[22m
[2m    const z = [y];[22m

[2m    // return [x, z];[22m
[2m    return ([22m
[2m      <>[22m
[2m        <ValidateMemoization inputs={[a, b, c]} output={x} />[22m
[2m        <ValidateMemoization inputs={[a, b]} output={z} />[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: false, b: null, c: 0}],[22m
[2m    sequentialRenders: [[22m
[2m      {a: false, b: null, c: 0},[22m
[2m      {a: false, b: null, c: 1},[22m
[2m      {a: true, b: 0, c: 1},[22m
[2m      {a: true, b: 1, c: 1},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { ValidateMemoization } from "shared-runtime";[22m

[2m  // Achieving Forget's level of memoization precision in this example isn't possible with useMemo[22m
[2m  // without significantly altering the code, so disable the non-Forget evaluation of this fixture.[22m
[2m  // @disableNonForgetInSprout[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(25);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b, c } = t0;[22m
[2m    let y;[22m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      x = [];[22m
[2m      if (a) {[22m
[2m        let t1;[22m
[2m        if ($[5] !== b) {[22m
[2m          t1 = [b];[22m
[2m          $[5] = b;[22m
[2m          $[6] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[6];[22m
[2m        }[22m
[2m        y = t1;[22m
[2m      }[22m

[2m      x.push(c);[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = y;[22m
[2m      $[4] = x;[22m
[2m    } else {[22m
[2m      y = $[3];[22m
[2m      x = $[4];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[7] !== y) {[22m
[2m      t1 = [y];[22m
[2m      $[7] = y;[22m
[2m      $[8] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[8];[22m
[2m    }[22m
[2m    const z = t1;[22m
[2m    let t2;[22m
[2m    if ($[9] !== a || $[10] !== b || $[11] !== c) {[22m
[2m      t2 = [a, b, c];[22m
[2m      $[9] = a;[22m
[2m      $[10] = b;[22m
[2m      $[11] = c;[22m
[2m      $[12] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[12];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[13] !== t2 || $[14] !== x) {[22m
[32m-     t3 = <ValidateMemoization inputs={t2} output={x} />;[39m
[31m+     t3 = ([39m
[31m+       <ValidateMemoization[39m
[31m+         inputs={function () {[39m
[31m+           const $res$ = t2;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         output={function () {[39m
[31m+           const $res$ = x;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[13] = t2;[22m
[2m      $[14] = x;[22m
[2m      $[15] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[15];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[16] !== a || $[17] !== b) {[22m
[2m      t4 = [a, b];[22m
[2m      $[16] = a;[22m
[2m      $[17] = b;[22m
[2m      $[18] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[18];[22m
[2m    }[22m
[2m    let t5;[22m
[2m    if ($[19] !== t4 || $[20] !== z) {[22m
[32m-     t5 = <ValidateMemoization inputs={t4} output={z} />;[39m
[31m+     t5 = ([39m
[31m+       <ValidateMemoization[39m
[31m+         inputs={function () {[39m
[31m+           const $res$ = t4;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         output={function () {[39m
[31m+           const $res$ = z;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[19] = t4;[22m
[2m      $[20] = z;[22m
[2m      $[21] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[21];[22m
[2m    }[22m
[2m    let t6;[22m
[2m    if ($[22] !== t3 || $[23] !== t5) {[22m
[2m      t6 = ([22m
[2m        <>[22m
[2m          {t3}[22m
[2m          {t5}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[22] = t3;[22m
[2m      $[23] = t5;[22m
[2m      $[24] = t6;[22m
[2m    } else {[22m
[2m      t6 = $[24];[22m
[2m    }[22m
[2m    return t6;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: false, b: null, c: 0 }],[22m
[2m    sequentialRenders: [[22m
[2m      { a: false, b: null, c: 0 },[22m
[2m      { a: false, b: null, c: 1 },[22m
[2m      { a: true, b: 0, c: 1 },[22m
[2m      { a: true, b: 1, c: 1 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[32m- (kind: ok) <div>{"inputs":[false,null,0],"output":[0]}</div><div>{"inputs":[false,null],"output":[null]}</div>[39m
[32m- <div>{"inputs":[false,null,1],"output":[1]}</div><div>{"inputs":[false,null],"output":[null]}</div>[39m
[32m- <div>{"inputs":[true,0,1],"output":[1]}</div><div>{"inputs":[true,0],"output":[[0]]}</div>[39m
[32m- <div>{"inputs":[true,1,1],"output":[1]}</div><div>{"inputs":[true,1],"output":[[1]]}</div>[39m
[31m+ (kind: ok) [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]][39m
[31m+ [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]][39m
[31m+ [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]][39m
[31m+ [[ (exception in render) Error: Too many re-renders. React limits the number of renders to prevent an infinite loop. ]][39m

[31m[1mFAIL:[22m[39m dominator
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = 0;[22m
[2m    label: if (props.a) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      if (props.b) {[22m
[2m        x = 2;[22m
[2m      } else {[22m
[2m        break label;[22m
[2m      }[22m
[2m      x = 3;[22m
[2m    }[22m
[2m    label2: switch (props.c) {[22m
[2m      case 'a': {[22m
[2m        x = 4;[22m
[2m        break;[22m
[2m      }[22m
[2m      case 'b': {[22m
[2m        break label2;[22m
[2m      }[22m
[2m      case 'c': {[22m
[2m        x = 5;[22m
[2m        // intentional fallthrough[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 6;[22m
[2m      }[22m
[2m    }[22m
[2m    if (props.d) {[22m
[2m      return null;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x = 0;[22m
[2m    bb0: if (props.a) {[22m
[2m      x = 1;[22m
[2m    } else {[22m
[2m      if (props.b) {[22m
[2m      } else {[22m
[2m        break bb0;[22m
[2m      }[22m

[2m      x = 3;[22m
[2m    }[22m
[2m    bb1: bb2: switch (props.c) {[22m
[2m      case "a": {[22m
[2m        x = 4;[22m
[2m        break bb2;[22m
[2m      }[22m
[2m      case "b": {[22m
[2m        break bb1;[22m
[2m      }[22m
[2m      case "c": {[22m
[2m      }[22m
[2m      default: {[22m
[2m        x = 6;[22m
[2m      }[22m
[2m    }[22m
[2m    if (props.d) {[22m
[2m      return null;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m do-while-early-unconditional-break
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [1, 2, 3];[22m
[2m    do {[22m
[2m      mutate(x);[22m
[2m      break;[22m
[2m    } while (props.cond);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x = [1, 2, 3];[22m

[2m      mutate(x);[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m do-while-conditional-break
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [0, 1, 2, 3];[22m
[2m    do {[22m
[2m      if (x === 0) {[22m
[2m        break;[22m
[2m      }[22m
[2m      mutate(x);[22m
[2m    } while (props.cond);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [0, 1, 2, 3];[22m
[2m      do {[22m
[2m        if (x === 0) {[22m
[2m          break;[22m
[2m        }[22m

[2m        mutate(x);[22m
[2m      } while (props.cond);[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m do-while-compound-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = [1, 2, 3];[22m
[2m    let ret = [];[22m
[2m    do {[22m
[2m      let item = x.pop();[22m
[2m      ret.push(item * 2);[22m
[2m    } while (x.length && props.cond);[22m
[2m    return ret;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let ret;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = [1, 2, 3];[22m
[2m      ret = [];[22m
[2m      do {[22m
[2m        const item = x.pop();[22m
[2m        ret.push(item * 2);[22m
[2m      } while (x.length && props.cond);[22m
[2m      $[0] = props;[22m
[2m      $[1] = ret;[22m
[2m    } else {[22m
[2m      ret = $[1];[22m
[2m    }[22m
[2m    return ret;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m do-while-break
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    do {[22m
[2m      break;[22m
[2m    } while (props.cond);[22m
[2m    return props;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    return props;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    const [[22m
[2m      d,[22m
[2m      [[22m
[2m        {[22m
[2m          e: {f},[22m
[2m          ...g[22m
[2m        },[22m
[2m      ],[22m
[2m      ...h[22m
[2m    ] = a;[22m
[2m    const {[22m
[2m      l: {[22m
[2m        m: [[n], ...o],[22m
[2m      },[22m
[2m      p,[22m
[2m    } = b;[22m
[2m    return [d, f, g, h, n, o, p];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(18);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let t0;[22m
[2m    let d;[22m
[2m    let h;[22m
[2m    if ($[0] !== a) {[22m
[2m      [d, t0, ...h] = a;[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = d;[22m
[2m      $[3] = h;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      d = $[2];[22m
[2m      h = $[3];[22m
[2m    }[22m
[2m    const [t1] = t0;[22m
[2m    let t2;[22m
[2m    let g;[22m
[2m    if ($[4] !== t1) {[22m
[2m      ({ e: t2, ...g } = t1);[22m
[2m      $[4] = t1;[22m
[2m      $[5] = t2;[22m
[2m      $[6] = g;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m      g = $[6];[22m
[2m    }[22m
[2m    const { f } = t2;[22m
[2m    const { l: t3, p } = b;[22m
[2m    const { m: t4 } = t3;[22m
[2m    let t5;[22m
[2m    let o;[22m
[2m    if ($[7] !== t4) {[22m
[2m      [t5, ...o] = t4;[22m
[2m      $[7] = t4;[22m
[2m      $[8] = t5;[22m
[2m      $[9] = o;[22m
[2m    } else {[22m
[2m      t5 = $[8];[22m
[2m      o = $[9];[22m
[2m    }[22m
[2m    const [n] = t5;[22m
[2m    let t6;[22m
[2m    if ([22m
[2m      $[10] !== d ||[22m
[2m      $[11] !== f ||[22m
[2m      $[12] !== g ||[22m
[2m      $[13] !== h ||[22m
[2m      $[14] !== n ||[22m
[2m      $[15] !== o ||[22m
[2m      $[16] !== p[22m
[2m    ) {[22m
[2m      t6 = [d, f, g, h, n, o, p];[22m
[2m      $[10] = d;[22m
[2m      $[11] = f;[22m
[2m      $[12] = g;[22m
[2m      $[13] = h;[22m
[2m      $[14] = n;[22m
[2m      $[15] = o;[22m
[2m      $[16] = p;[22m
[2m      $[17] = t6;[22m
[2m    } else {[22m
[2m      t6 = $[17];[22m
[2m    }[22m
[2m    return t6;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-with-typecast-as-default-value.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow[22m
[2m  function Component(props) {[22m
[2m    const [x = ([]: Array<number>)] = props.y;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{y: []}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const [t0] = props.y;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = t0 === undefined ? ([]: Array<number>) : t0;[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ y: [] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m

[31m[1mFAIL:[22m[39m destructuring-with-conditional-as-default-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [x = true ? 1 : 0] = props.y;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{y: []}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const [t0] = props.y;[22m
[2m    const x = t0 === undefined ? (true ? 1 : 0) : t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ y: [] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 1[22m

[31m[1mFAIL:[22m[39m destructuring-same-property-identifier-names
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const {[22m
[2m      x: {destructured},[22m
[2m      sameName: renamed,[22m
[2m    } = props;[22m
[2m    const sameName = identity(destructured);[22m

[2m    return [sameName, renamed];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: {destructured: 0}, sameName: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    const { x: t0, sameName: renamed } = props;[22m
[2m    const { destructured } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== destructured) {[22m
[2m      t1 = identity(destructured);[22m
[2m      $[0] = destructured;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const sameName = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== sameName || $[3] !== renamed) {[22m
[2m      t2 = [sameName, renamed];[22m
[2m      $[2] = sameName;[22m
[2m      $[3] = renamed;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: { destructured: 0 }, sameName: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [0,2][22m

[31m[1mFAIL:[22m[39m destructuring-property-inference
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    x.push(props.value);[22m
[2m    const {length: y} = x;[22m
[2m    foo(y);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      x = [];[22m
[2m      x.push(props.value);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    const { length: y } = x;[22m
[2m    foo(y);[22m
[2m    let t0;[22m
[2m    if ($[2] !== x || $[3] !== y) {[22m
[2m      t0 = [x, y];[22m
[2m      $[2] = x;[22m
[2m      $[3] = y;[22m
[2m      $[4] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[4];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-object-pattern-within-rest
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [y, ...{z}] = props.value;[22m
[2m    return [y, z];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: ['y', {z: 'z!'}]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let y;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      [y, ...t0] = props.value;[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    const { z } = t0;[22m
[2m    let t1;[22m
[2m    if ($[3] !== y || $[4] !== z) {[22m
[2m      t1 = [y, z];[22m
[2m      $[3] = y;[22m
[2m      $[4] = z;[22m
[2m      $[5] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[5];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: ["y", { z: "z!" }] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["y",null][22m

[31m[1mFAIL:[22m[39m destructuring-object-param-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component({a = 2}) {[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a: t1 } = t0;[22m
[2m    const a = t1 === undefined ? 2 : t1;[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-object-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const {x: {y} = {y: 'default'}} = props.y;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const { x: t0 } = props.y;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = t0 === undefined ? { y: "default" } : t0;[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const { y } = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-mixed-scope-declarations-and-locals
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const post = useFragment([22m
[2m      graphql`[22m
[2m        fragment F on T {[22m
[2m          id[22m
[2m        }[22m
[2m      `,[22m
[2m      props.post[22m
[2m    );[22m
[2m    const allUrls = [];[22m
[2m    // `media` and `urls` are exported from the scope that will wrap this code,[22m
[2m    // but `comments` is not (it doesn't need to be memoized, bc the callback[22m
[2m    // only checks `comments.length`)[22m
[2m    // because of the scope, the let declaration for media and urls are lifted[22m
[2m    // out of the scope, and the destructure statement ends up turning into[22m
[2m    // a reassignment, instead of a const declaration. this means we try to[22m
[2m    // reassign `comments` when there's no declaration for it.[22m
[2m    const {media, comments, urls} = post;[22m
[2m    const onClick = e => {[22m
[2m      if (!comments.length) {[22m
[2m        return;[22m
[2m      }[22m
[2m      console.log(comments.length);[22m
[2m    };[22m
[2m    allUrls.push(...urls);[22m
[2m    return <Media media={media} onClick={onClick} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const post = useFragment([39m
[32m-     graphql`[39m
[32m-       fragment F on T {[39m
[32m-         id[39m
[32m-       }[39m
[32m-     `,[39m
[32m-     props.post,[39m
[32m-   );[39m
[31m+   Object.freeze(props);[39m
[31m+   const post = (function () {[39m
[31m+     const $res$ = useFragment([39m
[31m+       Object.freeze(graphql`[39m
[31m+         fragment F on T {[39m
[31m+           id[39m
[31m+         }[39m
[31m+       `),[39m
[31m+       Object.freeze(props.post),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== post) {[22m
[2m      const allUrls = [];[22m

[2m      const { media, comments, urls } = post;[22m
[2m      let t1;[22m
[2m      if ($[2] !== comments.length) {[22m
[2m        t1 = (e) => {[22m
[2m          if (!comments.length) {[22m
[2m            return;[22m
[2m          }[22m

[2m          console.log(comments.length);[22m
[2m        };[22m
[2m        $[2] = comments.length;[22m
[2m        $[3] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[3];[22m
[2m      }[22m
[2m      const onClick = t1;[22m

[2m      allUrls.push(...urls);[22m
[32m-     t0 = <Media media={media} onClick={onClick} />;[39m
[31m+     t0 = ([39m
[31m+       <Media[39m
[31m+         media={function () {[39m
[31m+           const $res$ = media;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = post;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-mixed-scope-and-local-variables-with-default
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"media":null,"allUrls":["url1","url2","url3"],"onClick":"[[ function params=1 ]]"}</div>
Forget:
(kind: ok) <div>{"media":"[[ function params=0 ]]","allUrls":"[[ function params=0 ]]","onClick":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m destructuring-default-past-end-of-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // destructure past end of empty array, should evaluate to default[22m
[2m    const [x = 42] = props.value;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: []}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const [t0] = props.value;[22m
[2m    const x = t0 === undefined ? 42 : t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m destructuring-default-at-explicit-undefined
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // destructure slot index has an explicit undefined in the input, should return default[22m
[2m    const [x = 42] = props.value;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: [undefined]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const [t0] = props.value;[22m
[2m    const x = t0 === undefined ? 42 : t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [undefined] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m destructuring-default-at-explicit-null
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // destructure slot index has an explicit null in the input, should return null (not the default)[22m
[2m    const [x = 42] = props.value;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: [null]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const [t0] = props.value;[22m
[2m    const x = t0 === undefined ? 42 : t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [null] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m destructuring-default-at-array-hole
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // destructure slot index has a hole in the input, should return default[22m
[2m    const [x = 42] = props.value;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: [, /* hole! */ 3.14]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    const [t0] = props.value;[22m
[2m    const x = t0 === undefined ? 42 : t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [, /* hole! */ 3.14] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m destructuring-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let d, g, n, o;[22m
[2m    [[22m
[2m      d,[22m
[2m      [[22m
[2m        {[22m
[2m          e: {f: g},[22m
[2m        },[22m
[2m      ],[22m
[2m    ] = a;[22m
[2m    ({[22m
[2m      l: {[22m
[2m        m: [[n]],[22m
[2m      },[22m
[2m      o,[22m
[2m    } = b);[22m
[2m    return {d, g, n, o};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b, c) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    let d;[22m
[2m    let g;[22m
[2m    let n;[22m
[2m    let o;[22m
[2m    const [t0, t1] = a;[22m
[2m    d = t0;[22m
[2m    const [t2] = t1;[22m
[2m    const { e: t3 } = t2;[22m
[2m    ({ f: g } = t3);[22m
[2m    const { l: t4, o: t5 } = b;[22m
[2m    const { m: t6 } = t4;[22m
[2m    const [t7] = t6;[22m
[2m    [n] = t7;[22m
[2m    o = t5;[22m
[2m    let t8;[22m
[2m    if ($[0] !== d || $[1] !== g || $[2] !== n || $[3] !== o) {[22m
[2m      t8 = { d, g, n, o };[22m
[2m      $[0] = d;[22m
[2m      $[1] = g;[22m
[2m      $[2] = n;[22m
[2m      $[3] = o;[22m
[2m      $[4] = t8;[22m
[2m    } else {[22m
[2m      t8 = $[4];[22m
[2m    }[22m
[2m    return t8;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-assignment-array-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    if (props.cond) {[22m
[2m      [[x] = ['default']] = props.y;[22m
[2m    } else {[22m
[2m      x = props.fallback;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if (props.cond) {[22m
[2m      const [t0] = props.y;[22m
[2m      let t1;[22m
[2m      if ($[0] !== t0) {[22m
[2m        t1 = t0 === undefined ? ["default"] : t0;[22m
[2m        $[0] = t0;[22m
[2m        $[1] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[1];[22m
[2m      }[22m
[2m      [x] = t1;[22m
[2m    } else {[22m
[2m      x = props.fallback;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-array-param-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component([a = 2]) {[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const [t1] = t0;[22m
[2m    const a = t1 === undefined ? 2 : t1;[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructuring-array-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [[x] = ['default']] = props.y;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const [t0] = props.y;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = t0 === undefined ? ["default"] : t0;[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const [x] = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructure-param-string-literal-key
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo({data: dataTestID}) {[22m
[2m    return dataTestID;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{data: {}}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { data: dataTestID } = t0;[22m
[2m    return dataTestID;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{ data: {} }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m

[31m[1mFAIL:[22m[39m destructure-param-string-literal-key-invalid-identifier
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo({'data-foo-bar': dataTestID}) {[22m
[2m    return dataTestID;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{'data-foo-bar': {}}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { "data-foo-bar": dataTestID } = t0;[22m
[2m    return dataTestID;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{ "data-foo-bar": {} }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m

[31m[1mFAIL:[22m[39m destructure-object-declaration-to-context-var
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let {x} = props;[22m
[2m    const foo = () => {[22m
[2m      x = identity(props.x);[22m
[2m    };[22m
[2m    foo();[22m
[2m    return {x};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      const { x: t0 } = props;[22m
[2m      x = t0;[22m
[2m      const foo = () => {[22m
[2m        x = identity(props.x);[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { x: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":42}[22m

[31m[1mFAIL:[22m[39m destructure-object-assignment-to-context-var
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    ({x} = props);[22m
[2m    const foo = () => {[22m
[2m      x = identity(props.x);[22m
[2m    };[22m
[2m    foo();[22m
[2m    return {x};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      const { x: t0 } = props;[22m
[2m      x = t0;[22m
[2m      const foo = () => {[22m
[2m        x = identity(props.x);[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { x: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":42}[22m

[31m[1mFAIL:[22m[39m destructure-in-branch-ssa
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo(props: {[22m
[2m    x?: string;[22m
[2m    y?: string;[22m
[2m    z?: string;[22m
[2m    doDestructure: boolean;[22m
[2m  }) {[22m
[2m    let x = null;[22m
[2m    let y = null;[22m
[2m    let z = null;[22m
[2m    const myList = [];[22m
[2m    if (props.doDestructure) {[22m
[2m      ({x, y, z} = props);[22m

[2m      myList.push(z);[22m
[2m    }[22m
[2m    return {[22m
[2m      x,[22m
[2m      y,[22m
[2m      myList,[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{x: 'hello', y: 'world', doDestructure: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(props) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(props);[39m

[2m    let x = null;[22m
[2m    let y = null;[22m
[2m    let z;[22m
[2m    let myList;[22m
[2m    if ($[0] !== props) {[22m
[2m      myList = [];[22m
[2m      if (props.doDestructure) {[22m
[2m        ({ x, y, z } = props);[22m

[2m        myList.push(z);[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = myList;[22m
[2m      $[2] = x;[22m
[2m      $[3] = y;[22m
[2m      $[4] = z;[22m
[2m    } else {[22m
[2m      myList = $[1];[22m
[2m      x = $[2];[22m
[2m      y = $[3];[22m
[2m      z = $[4];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[5] !== x || $[6] !== y || $[7] !== myList) {[22m
[2m      t0 = { x, y, myList };[22m
[2m      $[5] = x;[22m
[2m      $[6] = y;[22m
[2m      $[7] = myList;[22m
[2m      $[8] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[8];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ x: "hello", y: "world", doDestructure: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":"hello","y":"world","myList":[null]}[22m

[31m[1mFAIL:[22m[39m destructure-direct-reassignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x, y;[22m
[2m    ({x, y} = {x: props.a, y: props.b});[22m
[2m    console.log(x); // prevent DCE from eliminating `x` altogether[22m
[2m    x = props.c;[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    let y;[22m
[2m    ({ x, y } = { x: props.a, y: props.b });[22m
[2m    console.log(x);[22m
[2m    x = props.c;[22m
[2m    return x + y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m destructure-default-array-with-unary
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [x = [-1, 1]] = props.value;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: []}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const [t0] = props.value;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = t0 === undefined ? [-1, 1] : t0;[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [-1,1][22m

[31m[1mFAIL:[22m[39m destructure-capture-global
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  let someGlobal = {};[22m
[2m  function component(a) {[22m
[2m    let x = {a, someGlobal};[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['value 1'],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  let someGlobal = {};[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a, someGlobal };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["value 1"],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":"value 1","someGlobal":{}}[22m

[31m[1mFAIL:[22m[39m destructure-array-declaration-to-context-var
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let [x] = props.value;[22m
[2m    const foo = () => {[22m
[2m      x = identity(props.value[0]);[22m
[2m    };[22m
[2m    foo();[22m
[2m    return {x};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: [42]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      const [t0] = props.value;[22m
[2m      x = t0;[22m
[2m      const foo = () => {[22m
[2m        x = identity(props.value[0]);[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { x: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [42] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":42}[22m

[31m[1mFAIL:[22m[39m destructure-array-assignment-to-context-var
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let x;[22m
[2m    [x] = props.value;[22m
[2m    const foo = () => {[22m
[2m      x = identity(props.value[0]);[22m
[2m    };[22m
[2m    foo();[22m
[2m    return {x};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: [42]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      const [t0] = props.value;[22m
[2m      x = t0;[22m
[2m      const foo = () => {[22m
[2m        x = identity(props.value[0]);[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = { x: t0 };[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: [42] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":42}[22m

[31m[1mFAIL:[22m[39m dependencies
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(x, y, z) {[22m
[2m    const items = [z];[22m
[2m    items.push(x);[22m

[2m    const items2 = [];[22m
[2m    if (x) {[22m
[2m      items2.push(y);[22m
[2m    }[22m

[2m    if (y) {[22m
[2m      items.push(x);[22m
[2m    }[22m

[2m    return items2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(x, y, z) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(x);[39m
[31m+   Object.freeze(y);[39m
[31m+   Object.freeze(z);[39m
[2m    const items = [z];[22m
[2m    items.push(x);[22m
[2m    let items2;[22m
[2m    if ($[0] !== x || $[1] !== y) {[22m
[2m      items2 = [];[22m
[2m      if (x) {[22m
[2m        items2.push(y);[22m
[2m      }[22m
[2m      $[0] = x;[22m
[2m      $[1] = y;[22m
[2m      $[2] = items2;[22m
[2m    } else {[22m
[2m      items2 = $[2];[22m
[2m    }[22m
[2m    if (y) {[22m
[2m      items.push(x);[22m
[2m    }[22m
[2m    return items2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m dependencies-outputs
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b) {[22m
[2m    const x = [];[22m
[2m    x.push(a);[22m
[2m    <div>{x}</div>;[22m

[2m    const y = [];[22m
[2m    if (x.length) {[22m
[2m      y.push(x);[22m
[2m    }[22m
[2m    if (b) {[22m
[2m      y.push(b);[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(a, b) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = [];[22m
[2m      x.push(a);[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    let y;[22m
[2m    if ($[2] !== x || $[3] !== b) {[22m
[2m      y = [];[22m
[2m      if (x.length) {[22m
[2m        y.push(x);[22m
[2m      }[22m
[2m      if (b) {[22m
[2m        y.push(b);[22m
[2m      }[22m
[2m      $[2] = x;[22m
[2m      $[3] = b;[22m
[2m      $[4] = y;[22m
[2m    } else {[22m
[2m      y = $[4];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m delete-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {a: props.a, b: props.b};[22m
[2m    delete x.b;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      x = { a: props.a, b: props.b };[22m
[2m      delete x.b;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m delete-computed-property
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = {a: props.a, b: props.b};[22m
[2m    const key = 'b';[22m
[2m    delete x[key];[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      x = { a: props.a, b: props.b };[22m
[2m      delete x["b"];[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m default-param-with-reorderable-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(x = () => [-1, true, 42.0, 'hello']) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const x = t0 === undefined ? _temp : t0;[22m
[2m    return x;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    return [-1, true, 42, "hello"];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m default-param-with-empty-callback
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(x = () => {}) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const x = t0 === undefined ? _temp : t0;[22m
[2m    return x;[22m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m default-param-calls-global-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(x = identity([() => {}, true, 42, 'hello'])) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = t0 === undefined ? identity([_temp, true, 42, "hello"]) : t0;[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["[[ function params=0 ]]",true,42,"hello"][22m

[31m[1mFAIL:[22m[39m default-param-array-with-unary
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(x = [-1, 1]) {[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = t0 === undefined ? [-1, 1] : t0;[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [-1,1][22m

[31m[1mFAIL:[22m[39m declare-reassign-variable-in-closure
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(p) {[22m
[2m    let x;[22m
[2m    const foo = () => {[22m
[2m      x = {};[22m
[2m    };[22m
[2m    foo();[22m

[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(p) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(p);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const foo = () => {[22m
[2m        x = {};[22m
[2m      };[22m

[2m      foo();[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m debugger
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    debugger;[22m
[2m    if (props.cond) {[22m
[2m      debugger;[22m
[2m    } else {[22m
[2m      while (props.cond) {[22m
[2m        debugger;[22m
[2m      }[22m
[2m    }[22m
[2m    debugger;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    debugger;[22m
[2m    if (props.cond) {[22m
[2m      debugger;[22m
[2m    } else {[22m
[2m      while (props.cond) {[22m
[2m        debugger;[22m
[2m      }[22m
[2m    }[22m
[2m    debugger;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m debugger-memoized
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    debugger;[22m
[2m    x.push(props.value);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      x = [];[22m
[2m      debugger;[22m

[2m      x.push(props.value);[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m dce-unused-prefix-update
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let i = 0;[22m
[2m    --i;[22m
[2m    i = props.i;[22m
[2m    return i;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{i: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let i;[22m

[2m    i = props.i;[22m
[2m    return i;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ i: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m dce-unused-postfix-update
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let i = 0;[22m
[2m    i++;[22m
[2m    i = props.i;[22m
[2m    return i;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{i: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    let i;[22m

[2m    i = props.i;[22m
[2m    return i;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ i: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m dce-unused-const
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const _ = 42;[22m
[2m    return props.value;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    return props.value;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m dce-loop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[2m    let x = 0;[22m
[2m    let y = 0;[22m
[2m    while (y < props.max) {[22m
[2m      x++;[22m
[2m      y++;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{max: 10}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(props) {[22m
[31m+   Object.freeze(props);[39m
[31m+[39m
[2m    let y = 0;[22m
[2m    while (y < props.max) {[22m
[2m      y++;[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: [{ max: 10 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 10[22m

[31m[1mFAIL:[22m[39m createElement-freeze
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import React from 'react';[22m
[2m  import {shallowCopy} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const childProps = {style: {width: props.width}};[22m
[2m    const element = React.createElement('div', childProps, ['hello world']);[22m
[2m    shallowCopy(childProps); // function that in theory could mutate, we assume not bc createElement freezes[22m
[2m    return element;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import React from "react";[22m
[2m  import { shallowCopy } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.width) {[22m
[2m      t0 = { style: { width: props.width } };[22m
[2m      $[0] = props.width;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const childProps = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== childProps) {[22m
[2m      let t2;[22m
[2m      if ($[4] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t2 = ["hello world"];[22m
[2m        $[4] = t2;[22m
[2m      } else {[22m
[2m        t2 = $[4];[22m
[2m      }[22m
[2m      t1 = React.createElement("div", childProps, t2);[22m
[2m      $[2] = childProps;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const element = t1;[22m
[2m    shallowCopy(childProps);[22m
[2m    return element;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>hello world</div>[22m

[31m[1mFAIL:[22m[39m controlled-input
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <input value="0">
Forget:
(kind: ok) <input value="">
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`value`','input','\n' +
  '    at input\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m context-variable-reassigned-two-lambdas
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {conditionalInvoke} from 'shared-runtime';[22m

[2m  function Component({doReassign1, doReassign2}) {[22m
[2m    let x = {};[22m
[2m    const reassign1 = () => {[22m
[2m      x = 2;[22m
[2m    };[22m
[2m    const reassign2 = () => {[22m
[2m      x = 3;[22m
[2m    };[22m
[2m    conditionalInvoke(doReassign1, reassign1);[22m
[2m    conditionalInvoke(doReassign2, reassign2);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{doReassign1: true, doReassign2: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {doReassign1: true, doReassign2: true},[22m
[2m      {doReassign1: true, doReassign2: false},[22m
[2m      {doReassign1: false, doReassign2: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { conditionalInvoke } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { doReassign1, doReassign2 } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== doReassign1 || $[1] !== doReassign2) {[22m
[2m      x = {};[22m
[2m      const reassign1 = () => {[22m
[2m        x = 2;[22m
[2m      };[22m

[2m      const reassign2 = () => {[22m
[2m        x = 3;[22m
[2m      };[22m

[2m      conditionalInvoke(doReassign1, reassign1);[22m
[2m      conditionalInvoke(doReassign2, reassign2);[22m
[2m      $[0] = doReassign1;[22m
[2m      $[1] = doReassign2;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ doReassign1: true, doReassign2: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { doReassign1: true, doReassign2: true },[22m
[2m      { doReassign1: true, doReassign2: false },[22m
[2m      { doReassign1: false, doReassign2: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 3[22m
[2m  2[22m
[2m  {}[22m

[31m[1mFAIL:[22m[39m context-variable-reassigned-reactive-capture
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {invoke} from 'shared-runtime';[22m

[2m  function Component({value}) {[22m
[2m    let x = null;[22m
[2m    const reassign = () => {[22m
[2m      x = value;[22m
[2m    };[22m
[2m    invoke(reassign);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 2}],[22m
[2m    sequentialRenders: [{value: 2}, {value: 4}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { invoke } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== value) {[22m
[2m      x = null;[22m
[2m      const reassign = () => {[22m
[2m        x = value;[22m
[2m      };[22m

[2m      invoke(reassign);[22m
[2m      $[0] = value;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 2 }],[22m
[2m    sequentialRenders: [{ value: 2 }, { value: 4 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 2[22m
[2m  4[22m

[31m[1mFAIL:[22m[39m context-variable-reassigned-outside-of-lambda
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"callback":{"kind":"Function"},"shouldInvokeFns":true}</div>
logs: [{}]
Forget:
(kind: ok) <div>{"callback":{"kind":"Function","result":{"kind":"Function"}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>
logs: [{}]

[31m[1mFAIL:[22m[39m context-variable-reassigned-objectmethod
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {invoke} from 'shared-runtime';[22m

[2m  function Component({cond}) {[22m
[2m    let x = 2;[22m
[2m    const obj = {[22m
[2m      method(cond) {[22m
[2m        if (cond) {[22m
[2m          x = 4;[22m
[2m        }[22m
[2m      },[22m
[2m    };[22m
[2m    invoke(obj.method, cond);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { invoke } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond) {[22m
[2m      x = 2;[22m
[2m      const obj = {[22m
[2m        method(cond_0) {[22m
[2m          if (cond_0) {[22m
[2m            x = 4;[22m
[2m          }[22m
[2m        },[22m
[2m      };[22m

[2m      invoke(obj.method, cond);[22m
[2m      $[0] = cond;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 4[22m

[31m[1mFAIL:[22m[39m context-variable-reactive-implicit-control-flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {conditionalInvoke} from 'shared-runtime';[22m

[2m  // same as context-variable-reactive-explicit-control-flow.js, but make[22m
[2m  // the control flow implicit[22m

[2m  function Component({shouldReassign}) {[22m
[2m    let x = null;[22m
[2m    const reassign = () => {[22m
[2m      x = 2;[22m
[2m    };[22m
[2m    conditionalInvoke(shouldReassign, reassign);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{shouldReassign: true}],[22m
[2m    sequentialRenders: [{shouldReassign: false}, {shouldReassign: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { conditionalInvoke } from "shared-runtime";[22m

[2m  // same as context-variable-reactive-explicit-control-flow.js, but make[22m
[2m  // the control flow implicit[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { shouldReassign } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== shouldReassign) {[22m
[2m      x = null;[22m
[2m      const reassign = () => {[22m
[2m        x = 2;[22m
[2m      };[22m

[2m      conditionalInvoke(shouldReassign, reassign);[22m
[2m      $[0] = shouldReassign;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ shouldReassign: true }],[22m
[2m    sequentialRenders: [{ shouldReassign: false }, { shouldReassign: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m
[2m  2[22m

[31m[1mFAIL:[22m[39m context-variable-reactive-explicit-control-flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {invoke} from 'shared-runtime';[22m

[2m  function Component({shouldReassign}) {[22m
[2m    let x = null;[22m
[2m    const reassign = () => {[22m
[2m      if (shouldReassign) {[22m
[2m        x = 2;[22m
[2m      }[22m
[2m    };[22m
[2m    invoke(reassign);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{shouldReassign: true}],[22m
[2m    sequentialRenders: [{shouldReassign: false}, {shouldReassign: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { invoke } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { shouldReassign } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== shouldReassign) {[22m
[2m      x = null;[22m
[2m      const reassign = () => {[22m
[2m        if (shouldReassign) {[22m
[2m          x = 2;[22m
[2m        }[22m
[2m      };[22m

[2m      invoke(reassign);[22m
[2m      $[0] = shouldReassign;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ shouldReassign: true }],[22m
[2m    sequentialRenders: [{ shouldReassign: false }, { shouldReassign: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m
[2m  2[22m

[31m[1mFAIL:[22m[39m context-variable-as-jsx-element-tag
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let Component = Stringify;[22m

[2m    Component = useMemo(() => {[22m
[2m      return Component;[22m
[2m    });[22m

[2m    return <Component {...props} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useMemo } from "react";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let Component;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      Component = Stringify;[22m

[2m      Component;[22m
[2m      let t0;[22m
[2m      t0 = Component;[22m
[2m      Component = t0;[22m
[2m      $[0] = Component;[22m
[2m    } else {[22m
[2m      Component = $[0];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[1] !== props) {[22m
[2m      t0 = <Component {...props} />;[22m
[2m      $[1] = props;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"name":"Sathya"}</div>[22m

[31m[1mFAIL:[22m[39m constructor
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo() {}[22m

[2m  function Component(props) {[22m
[2m    const a = [];[22m
[2m    const b = {};[22m
[2m    new Foo(a, b);[22m
[2m    let _ = <div a={a} />;[22m
[2m    new Foo(b);[22m
[2m    return <div a={a} b={b} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo() {}[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = [];[22m
[2m      const b = {};[22m
[2m      new Foo(a, b);[22m
[2m      new Foo(b);[22m
[32m-     t0 = <div a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m constant-propagation-unary
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{"_b":"baz","b0":false,"n0":true,"n1":false,"n2":false,"n3":false,"s0":true,"s1":false,"s2":false,"u":true,"n":true}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m constant-propagation-phi
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    let x;[22m
[2m    if (a) {[22m
[2m      x = 2 - 1;[22m
[2m    } else {[22m
[2m      x = 0 + 1;[22m
[2m    }[22m
[2m    if (x === 1) {[22m
[2m      return b;[22m
[2m    } else {[22m
[2m      return c;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    if (a) {[22m
[2m    }[22m
[2m    return b;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m constant-propagation-into-function-expressions
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = 42;[22m
[2m    const onEvent = () => {[22m
[2m      console.log(x);[22m
[2m    };[22m
[2m    return <Foo onEvent={onEvent} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const onEvent = () => {[22m
[2m        console.log(42);[22m
[2m      };[22m

[32m-     t0 = <Foo onEvent={onEvent} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         onEvent={function () {[39m
[31m+           const $res$ = onEvent;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m constant-propagation-bit-ops
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":[123,0,123,123,123,123,123,1,122,246,61,61,9,15.588457268119896,12.25,3.3219970854839125,0,1.5,1,0.5]}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m constant-propagate-global-phis
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>global string 1</div>
Forget:
(kind: ok) <div></div>

[31m[1mFAIL:[22m[39m constant-propagate-global-phis-constant
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>global string 0</div>
Forget:
(kind: ok) <div></div>
logs: ['Warning: Functions are not valid as a React child. This may happen if you return %s instead of <%s /> from render. Or maybe you meant to call this function rather than return it.\n' +
  '  <%s>{%s}</%s>%s','value','value','div','value','div','\n' +
  '    at div\n' +
  '    at Text (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/shared-runtime.js:183:61)\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m constant-computed
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const index = 'foo';[22m
[2m    const x = {};[22m
[2m    x[index] = x[index] + x['bar'];[22m
[2m    x[index](props.foo);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.foo) {[22m
[2m      x = {};[22m
[2m      x.foo = x.foo + x.bar;[22m
[2m      x.foo(props.foo);[22m
[2m      $[0] = props.foo;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m const-propagation-phi-nodes
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo(setOne: boolean) {[22m
[2m    let x;[22m
[2m    let y;[22m
[2m    let z;[22m
[2m    if (setOne) {[22m
[2m      x = y = z = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m      y = 3;[22m
[2m      z = 5;[22m
[2m    }[22m
[2m    return {x, y, z};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(setOne) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(setOne);[39m
[2m    let x;[22m
[2m    let y;[22m
[2m    let z;[22m
[2m    if (setOne) {[22m
[2m      x = y = z = 1;[22m
[2m    } else {[22m
[2m      x = 2;[22m
[2m      y = 3;[22m
[2m      z = 5;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== x || $[1] !== y || $[2] !== z) {[22m
[2m      t0 = { x, y, z };[22m
[2m      $[0] = x;[22m
[2m      $[1] = y;[22m
[2m      $[2] = z;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":1,"y":1,"z":1}[22m

[31m[1mFAIL:[22m[39m const-propagation-into-function-expression-global
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo() {[22m
[2m    const isX = GLOBAL_IS_X;[22m
[2m    const getJSX = () => {[22m
[2m      return <Child x={isX}></Child>;[22m
[2m    };[22m
[2m    const result = getJSX();[22m
[2m    return result;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo() {[22m
[2m    const $ = _c(1);[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     const getJSX = () => <Child x={GLOBAL_IS_X} />;[39m
[31m+     const getJSX = () => ([39m
[31m+       <Child[39m
[31m+         x={function () {[39m
[31m+           const $res$ = GLOBAL_IS_X;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m

[2m      t0 = getJSX();[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const result = t0;[22m
[2m    return result;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m console-readonly
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {shallowCopy} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const x = shallowCopy(props);[22m
[2m    // These calls should view x as readonly and be grouped outside of the reactive scope for x:[22m
[2m    console.log(x);[22m
[2m    console.info(x);[22m
[2m    console.warn(x);[22m
[2m    console.error(x);[22m
[2m    console.trace(x);[22m
[2m    console.table(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1, b: 2}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { shallowCopy } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = shallowCopy(props);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m

[2m    console.log(x);[22m
[2m    console.info(x);[22m
[2m    console.warn(x);[22m
[2m    console.error(x);[22m
[2m    console.trace(x);[22m
[2m    console.table(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 1, b: 2 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":1,"b":2}[22m
[2m  logs: [{ a: 1, b: 2 },{ a: 1, b: 2 },{ a: 1, b: 2 },{ a: 1, b: 2 },{ a: 1, b: 2 }][22m

[31m[1mFAIL:[22m[39m consecutive-use-memo
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useHook({a, b}) {[22m
[2m    const valA = useMemo(() => identity({a}), [a]);[22m
[2m    const valB = useMemo(() => identity([b]), [b]);[22m
[2m    return [valA, valB];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{a: 2, b: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useMemo } from "react";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useHook(t0) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== a) {[22m
[2m      t2 = identity({ a });[22m
[2m      $[0] = a;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[2m    t1 = t2;[22m
[2m    const valA = t1;[22m
[2m    let t3;[22m
[2m    let t4;[22m
[2m    if ($[2] !== b) {[22m
[2m      t4 = identity([b]);[22m
[2m      $[2] = b;[22m
[2m      $[3] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[3];[22m
[2m    }[22m
[2m    t3 = t4;[22m
[2m    const valB = t3;[22m
[2m    let t5;[22m
[2m    if ($[4] !== valA || $[5] !== valB) {[22m
[2m      t5 = [valA, valB];[22m
[2m      $[4] = valA;[22m
[2m      $[5] = valB;[22m
[2m      $[6] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[6];[22m
[2m    }[22m
[2m    return t5;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{ a: 2, b: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":2},[3]][22m

[31m[1mFAIL:[22m[39m conflicting-dollar-sign-variable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const $ = identity('jQuery');[22m
[2m    const t0 = identity([$]);[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $0 = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($0[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const $ = identity("jQuery");[22m
[2m      t0 = identity([$]);[22m
[2m      $0[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $0[0];[22m
[2m    }[22m
[2m    const t0$0 = t0;[22m
[2m    return t0$0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["jQuery"][22m

[31m[1mFAIL:[22m[39m conditional-set-state-in-render
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const [x, setX] = useState(0);[22m

[2m    const foo = () => {[22m
[2m      setX(1);[22m
[2m    };[22m

[2m    if (props.cond) {[22m
[2m      setX(2);[22m
[2m      foo();[22m
[2m    }[22m

[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[32m-   const [x, setX] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x, setX] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const foo = () => {[22m
[2m      setX(1);[22m
[2m    };[22m
[2m    if (props.cond) {[22m
[2m      setX(2);[22m
[2m      foo();[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m conditional-on-mutable
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function ComponentA(props) {[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    if (b) {[22m
[2m      a.push(props.p0);[22m
[2m    }[22m
[2m    if (props.p1) {[22m
[2m      b.push(props.p2);[22m
[2m    }[22m
[2m    return <Foo a={a} b={b} />;[22m
[2m  }[22m

[2m  function ComponentB(props) {[22m
[2m    const a = [];[22m
[2m    const b = [];[22m
[2m    if (mayMutate(b)) {[22m
[2m      a.push(props.p0);[22m
[2m    }[22m
[2m    if (props.p1) {[22m
[2m      b.push(props.p2);[22m
[2m    }[22m
[2m    return <Foo a={a} b={b} />;[22m
[2m  }[22m

[2m  function Foo() {}[22m
[2m  function mayMutate() {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function ComponentA(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const a = [];[22m
[2m      const b = [];[22m
[2m      if (b) {[22m
[2m        a.push(props.p0);[22m
[2m      }[22m
[2m      if (props.p1) {[22m
[2m        b.push(props.p2);[22m
[2m      }[22m

[32m-     t0 = <Foo a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  function ComponentB(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const a = [];[22m
[2m      const b = [];[22m
[2m      if (mayMutate(b)) {[22m
[2m        a.push(props.p0);[22m
[2m      }[22m
[2m      if (props.p1) {[22m
[2m        b.push(props.p2);[22m
[2m      }[22m

[32m-     t0 = <Foo a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  function Foo() {}[22m
[2m  function mayMutate() {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m conditional-early-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  /**[22m
[2m   * props.b does *not* influence `a`[22m
[2m   */[22m
[2m  function ComponentA(props) {[22m
[2m    const a_DEBUG = [];[22m
[2m    a_DEBUG.push(props.a);[22m
[2m    if (props.b) {[22m
[2m      return null;[22m
[2m    }[22m
[2m    a_DEBUG.push(props.d);[22m
[2m    return a_DEBUG;[22m
[2m  }[22m

[2m  /**[22m
[2m   * props.b *does* influence `a`[22m
[2m   */[22m
[2m  function ComponentB(props) {[22m
[2m    const a = [];[22m
[2m    a.push(props.a);[22m
[2m    if (props.b) {[22m
[2m      a.push(props.c);[22m
[2m    }[22m
[2m    a.push(props.d);[22m
[2m    return a;[22m
[2m  }[22m

[2m  /**[22m
[2m   * props.b *does* influence `a`, but only in a way that is never observable[22m
[2m   */[22m
[2m  function ComponentC(props) {[22m
[2m    const a = [];[22m
[2m    a.push(props.a);[22m
[2m    if (props.b) {[22m
[2m      a.push(props.c);[22m
[2m      return null;[22m
[2m    }[22m
[2m    a.push(props.d);[22m
[2m    return a;[22m
[2m  }[22m

[2m  /**[22m
[2m   * props.b *does* influence `a`[22m
[2m   */[22m
[2m  function ComponentD(props) {[22m
[2m    const a = [];[22m
[2m    a.push(props.a);[22m
[2m    if (props.b) {[22m
[2m      a.push(props.c);[22m
[2m      return a;[22m
[2m    }[22m
[2m    a.push(props.d);[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: ComponentA,[22m
[2m    params: [{a: 1, b: false, d: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; /**[22m
[2m   * props.b does *not* influence `a`[22m
[2m   */[22m
[2m  function ComponentA(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let a_DEBUG;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        a_DEBUG = [];[22m
[2m        a_DEBUG.push(props.a);[22m
[2m        if (props.b) {[22m
[2m          t0 = null;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        a_DEBUG.push(props.d);[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = a_DEBUG;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      a_DEBUG = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return a_DEBUG;[22m
[2m  }[22m

[2m  /**[22m
[2m   * props.b *does* influence `a`[22m
[2m   */[22m
[2m  function ComponentB(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    if ($[0] !== props) {[22m
[2m      a = [];[22m
[2m      a.push(props.a);[22m
[2m      if (props.b) {[22m
[2m        a.push(props.c);[22m
[2m      }[22m

[2m      a.push(props.d);[22m
[2m      $[0] = props;[22m
[2m      $[1] = a;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m    }[22m
[2m    return a;[22m
[2m  }[22m

[2m  /**[22m
[2m   * props.b *does* influence `a`, but only in a way that is never observable[22m
[2m   */[22m
[2m  function ComponentC(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        a = [];[22m
[2m        a.push(props.a);[22m
[2m        if (props.b) {[22m
[2m          a.push(props.c);[22m
[2m          t0 = null;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        a.push(props.d);[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = a;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return a;[22m
[2m  }[22m

[2m  /**[22m
[2m   * props.b *does* influence `a`[22m
[2m   */[22m
[2m  function ComponentD(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        a = [];[22m
[2m        a.push(props.a);[22m
[2m        if (props.b) {[22m
[2m          a.push(props.c);[22m
[2m          t0 = a;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        a.push(props.d);[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = a;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: ComponentA,[22m
[2m    params: [{ a: 1, b: false, d: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1,3][22m

[31m[1mFAIL:[22m[39m conditional-break-labeled
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  /**[22m
[2m   * props.b *does* influence `a`[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const a = [];[22m
[2m    a.push(props.a);[22m
[2m    label: {[22m
[2m      if (props.b) {[22m
[2m        break label;[22m
[2m      }[22m
[2m      a.push(props.c);[22m
[2m    }[22m
[2m    a.push(props.d);[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; /**[22m
[2m   * props.b *does* influence `a`[22m
[2m   */[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    if ($[0] !== props) {[22m
[2m      a = [];[22m
[2m      a.push(props.a);[22m
[2m      bb0: {[22m
[2m        if (props.b) {[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        a.push(props.c);[22m
[2m      }[22m

[2m      a.push(props.d);[22m
[2m      $[0] = props;[22m
[2m      $[1] = a;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m    }[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m concise-arrow-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component() {[22m
[2m    let [x, setX] = useState(0);[22m
[2m    const handler = v => setX(v);[22m
[2m    return <Foo handler={handler}></Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component() {[22m
[2m    const $ = _c(1);[22m
[32m-   const [x, setX] = useState(0);[39m
[31m+   const [x, setX] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const handler = (v) => setX(v);[22m
[32m-     t0 = <Foo handler={handler} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         handler={function () {[39m
[31m+           const $res$ = handler;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m computed-store-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let y = {a};[22m
[2m    let x = {b};[22m
[2m    x['y'] = y;[22m
[2m    mutate(x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let x;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const y = { a };[22m
[2m      x = { b };[22m
[2m      x.y = y;[22m
[2m      mutate(x);[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m computed-load-primitive-as-dependency
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let a = foo();[22m
[2m    // freeze `a` so we know the next line cannot mutate it[22m
[2m    <div>{a}</div>;[22m

[2m    // b should be dependent on `props.a`[22m
[2m    let b = bar(a[props.a] + 1);[22m
[2m    return b;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const a = foo();[22m

[2m    const t0 = a[props.a] + 1;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = bar(t0);[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const b = t1;[22m
[2m    return b;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m computed-call-spread
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = foo[props.method](...props.a, null, ...props.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.method || $[1] !== props.a || $[2] !== props.b) {[22m
[2m      t0 = foo[props.method](...props.a, null, ...props.b);[22m
[2m      $[0] = props.method;[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = props.b;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m component
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const items = props.items;[22m
[2m    const maxItems = props.maxItems;[22m

[2m    const renderedItems = [];[22m
[2m    const seen = new Set();[22m
[2m    const max = Math.max(0, maxItems);[22m
[2m    for (let i = 0; i < items.length; i += 1) {[22m
[2m      const item = items.at(i);[22m
[2m      if (item == null || seen.has(item)) {[22m
[2m        continue;[22m
[2m      }[22m
[2m      seen.add(item);[22m
[2m      renderedItems.push(<div>{item}</div>);[22m
[2m      if (renderedItems.length >= max) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    const count = renderedItems.length;[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <h1>{count} Items</h1>[22m
[2m        {renderedItems}[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(props);[39m
[2m    const items = props.items;[22m
[2m    const maxItems = props.maxItems;[22m
[2m    let renderedItems;[22m
[2m    if ($[0] !== maxItems || $[1] !== items) {[22m
[2m      renderedItems = [];[22m
[2m      const seen = new Set();[22m
[2m      const max = Math.max(0, maxItems);[22m
[2m      for (let i = 0; i < items.length; i = i + 1, i) {[22m
[2m        const item = items.at(i);[22m
[2m        if (item == null || seen.has(item)) {[22m
[2m          continue;[22m
[2m        }[22m

[2m        seen.add(item);[22m
[2m        renderedItems.push(<div>{item}</div>);[22m
[2m        if (renderedItems.length >= max) {[22m
[2m          break;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = maxItems;[22m
[2m      $[1] = items;[22m
[2m      $[2] = renderedItems;[22m
[2m    } else {[22m
[2m      renderedItems = $[2];[22m
[2m    }[22m

[2m    const count = renderedItems.length;[22m
[2m    let t0;[22m
[2m    if ($[3] !== count) {[22m
[2m      t0 = <h1>{count} Items</h1>;[22m
[2m      $[3] = count;[22m
[2m      $[4] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[4];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[5] !== t0 || $[6] !== renderedItems) {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          {t0}[22m
[2m          {renderedItems}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[5] = t0;[22m
[2m      $[6] = renderedItems;[22m
[2m      $[7] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[7];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m component-inner-function-with-many-args
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"cb":"[[ function params=3 ]]","id":0}</div>
Forget:
(kind: ok) <div>{"cb":"[[ function params=0 ]]","id":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m component-declaration-basic.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @compilationMode(infer)[22m
[2m  export default component Foo(bar: number) {[22m
[2m    return <Bar bar={bar} />;[22m
[2m  }[22m

[2m  function shouldNotCompile() {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  export default function Foo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { bar } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== bar) {[22m
[32m-     t1 = <Bar bar={bar} />;[39m
[31m+     t1 = ([39m
[31m+       <Bar[39m
[31m+         bar={function () {[39m
[31m+           const $res$ = bar;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = bar;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  function shouldNotCompile() {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m complex-while
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[2m    label: if (a) {[22m
[2m      while (b) {[22m
[2m        if (c) {[22m
[2m          break label;[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m    return c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function foo(a, b, c) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[31m+   Object.freeze(c);[39m
[2m    bb0: if (a) {[22m
[2m      while (b) {[22m
[2m        if (c) {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m    return c;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: foo,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m codegen-instrument-forget-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @instrumentForget @compilationMode(annotation)[22m

[2m  function Bar(props) {[22m
[2m    'use forget';[22m
[2m    return <div>{props.bar}</div>;[22m
[2m  }[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  function Foo(props) {[22m
[2m    'use forget';[22m
[2m    return <Foo>{props.bar}</Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { useRenderCounter, shouldInstrument } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @instrumentForget @compilationMode(annotation)[22m

[2m  function Bar(props) {[22m
[32m-   "use forget";[39m
[2m    if (__DEV__ && shouldInstrument)[22m
[2m      useRenderCounter("Bar", "/codegen-instrument-forget-test.ts");[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      t0 = <div>{props.bar}</div>;[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  function Foo(props) {[22m
[32m-   "use forget";[39m
[2m    if (__DEV__ && shouldInstrument)[22m
[2m      useRenderCounter("Foo", "/codegen-instrument-forget-test.ts");[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.bar) {[22m
[2m      t0 = <Foo>{props.bar}</Foo>;[22m
[2m      $[0] = props.bar;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m codegen-instrument-forget-gating-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @instrumentForget @compilationMode(annotation) @gating[22m

[2m  function Bar(props) {[22m
[2m    'use forget';[22m
[2m    return <div>{props.bar}</div>;[22m
[2m  }[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m

[2m  function Foo(props) {[22m
[2m    'use forget';[22m
[2m    return <Foo>{props.bar}</Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { useRenderCounter, shouldInstrument } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @instrumentForget @compilationMode(annotation) @gating[22m
[2m  const Bar = isForgetEnabled_Fixtures()[22m
[2m    ? function Bar(props) {[22m
[32m-       "use forget";[39m
[2m        if (__DEV__ && shouldInstrument)[22m
[2m          useRenderCounter("Bar", "/codegen-instrument-forget-gating-test.ts");[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <div>{props.bar}</div>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Bar(props) {[22m
[2m        "use forget";[22m
[2m        return <div>{props.bar}</div>;[22m
[2m      };[22m

[2m  function NoForget(props) {[22m
[2m    return <Bar>{props.noForget}</Bar>;[22m
[2m  }[22m
[2m  const Foo = isForgetEnabled_Fixtures()[22m
[2m    ? function Foo(props) {[22m
[32m-       "use forget";[39m
[2m        if (__DEV__ && shouldInstrument)[22m
[2m          useRenderCounter("Foo", "/codegen-instrument-forget-gating-test.ts");[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(props);[39m
[2m        let t0;[22m
[2m        if ($[0] !== props.bar) {[22m
[2m          t0 = <Foo>{props.bar}</Foo>;[22m
[2m          $[0] = props.bar;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : function Foo(props) {[22m
[2m        "use forget";[22m
[2m        return <Foo>{props.bar}</Foo>;[22m
[2m      };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m codegen-emit-make-read-only
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableEmitFreeze true[22m

[2m  function MyComponentName(props) {[22m
[2m    let x = {};[22m
[2m    foo(x, props.a);[22m
[2m    foo(x, props.b);[22m

[2m    let y = [];[22m
[2m    y.push(x);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { makeReadOnly } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableEmitFreeze true[22m

[2m  function MyComponentName(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let y;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      const x = {};[22m
[2m      foo(x, props.a);[22m
[2m      foo(x, props.b);[22m

[2m      y = [];[22m
[2m      y.push(x);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = __DEV__ ? makeReadOnly(y, "MyComponentName") : y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m codegen-emit-imports-same-source
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableEmitFreeze @instrumentForget[22m

[2m  function useFoo(props) {[22m
[2m    return foo(props.x);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import {[22m
[2m    useRenderCounter,[22m
[2m    shouldInstrument,[22m
[2m    makeReadOnly,[22m
[2m  } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableEmitFreeze @instrumentForget[22m

[2m  function useFoo(props) {[22m
[2m    if (__DEV__ && shouldInstrument)[22m
[2m      useRenderCounter("useFoo", "/codegen-emit-imports-same-source.ts");[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.x) {[22m
[2m      t0 = foo(props.x);[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = __DEV__ ? makeReadOnly(t0, "useFoo") : t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m change-detect-reassign
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableChangeDetectionForDebugging[22m
[2m  function Component(props) {[22m
[2m    let x = null;[22m
[2m    if (props.cond) {[22m
[2m      x = [];[22m
[2m      x.push(props.value);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { $structuralCheck } from "react-compiler-runtime";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableChangeDetectionForDebugging[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x = null;[22m
[2m    if (props.cond) {[22m
[2m      {[22m
[2m        x = [];[22m
[2m        x.push(props.value);[22m
[2m        let condition = $[0] !== props.value;[22m
[2m        if (!condition) {[22m
[2m          let old$x = $[1];[22m
[2m          $structuralCheck(old$x, x, "x", "Component", "cached", "(3:6)");[22m
[2m        }[22m
[2m        $[0] = props.value;[22m
[2m        $[1] = x;[22m
[2m        if (condition) {[22m
[2m          x = [];[22m
[2m          x.push(props.value);[22m
[2m          $structuralCheck($[1], x, "x", "Component", "recomputed", "(3:6)");[22m
[2m          x = $[1];[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-variable-in-nested-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      (function () {[22m
[2m        console.log(z);[22m
[2m      })();[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z) {[22m
[2m      t1 = function () {[22m
[2m        (function () {[22m
[2m          console.log(z);[22m
[2m        })();[22m
[2m      };[22m
[2m      $[2] = z;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-variable-in-nested-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      {[22m
[2m        console.log(z);[22m
[2m      }[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z) {[22m
[2m      t1 = function () {[22m
[2m        console.log(z);[22m
[2m      };[22m
[2m      $[2] = z;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-reference-changes-type
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = 1;[22m
[2m    (function () {[22m
[2m      y = x;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = 1;[22m

[2m      y;[22m
[2m      y = x;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-nested-member-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a: {a}};[22m
[2m    let x = function () {[22m
[2m      console.log(z.a.a);[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a: { a } };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z.a.a) {[22m
[2m      t1 = function () {[22m
[2m        console.log(z.a.a);[22m
[2m      };[22m
[2m      $[2] = z.a.a;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-nested-member-expr-in-nested-func
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a: {a}};[22m
[2m    let x = function () {[22m
[2m      (function () {[22m
[2m        console.log(z.a.a);[22m
[2m      })();[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a: { a } };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z.a.a) {[22m
[2m      t1 = function () {[22m
[2m        (function () {[22m
[2m          console.log(z.a.a);[22m
[2m        })();[22m
[2m      };[22m
[2m      $[2] = z.a.a;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-nested-member-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a: {a}};[22m
[2m    let x = function () {[22m
[2m      z.a.a();[22m
[2m    };[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a: { a } };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-member-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      console.log(z.a);[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z.a) {[22m
[2m      t1 = function () {[22m
[2m        console.log(z.a);[22m
[2m      };[22m
[2m      $[2] = z.a;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-within-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x;[22m
[2m    {[22m
[2m      x = function () {[22m
[2m        console.log(z);[22m
[2m      };[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z) {[22m
[2m      t1 = function () {[22m
[2m        console.log(z);[22m
[2m      };[22m
[2m      $[2] = z;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-skip-computed-path
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function StoreLandingUnseenGiftModalContainer(a) {[22m
[2m    const giftsSeen = {a};[22m
[2m    return (gift => (gift.id ? giftsSeen[gift.id] : false))();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: StoreLandingUnseenGiftModalContainer,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function StoreLandingUnseenGiftModalContainer(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      const giftsSeen = { a };[22m
[2m      t0 = ((gift) => (gift.id ? giftsSeen[gift.id] : false))();[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: StoreLandingUnseenGiftModalContainer,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-shadow-captured
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      let z;[22m
[2m      mutate(z);[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[31m+   Object.freeze(a);[39m
[31m+[39m
[2m    const x = _temp;[22m
[2m    return x;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    let z_0;[22m
[2m    mutate(z_0);[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-runs-inference
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let z = {a};[22m
[2m    let p = () => <Foo>{z}</Foo>;[22m
[2m    return p();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z) {[22m
[2m      t1 = () => <Foo>{z}</Foo>;[22m
[2m      $[2] = z;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const p = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== p) {[22m
[2m      t2 = p();[22m
[2m      $[4] = p;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-renamed-ref
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let z = {a};[22m
[2m    {[22m
[2m      let z = {b};[22m
[2m      (function () {[22m
[2m        mutate(z);[22m
[2m      })();[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m

[2m    const z_0 = { b };[22m

[2m    mutate(z_0);[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-member-expr-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component({mutator}) {[22m
[2m    const poke = () => {[22m
[2m      mutator.poke();[22m
[2m    };[22m

[2m    const hide = () => {[22m
[2m      mutator.user.hide();[22m
[2m    };[22m

[2m    return <Foo poke={poke} hide={hide}></Foo>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(t0) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { mutator } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== mutator) {[22m
[2m      t1 = () => {[22m
[2m        mutator.poke();[22m
[2m      };[22m
[2m      $[0] = mutator;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const poke = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== mutator.user) {[22m
[2m      t2 = () => {[22m
[2m        mutator.user.hide();[22m
[2m      };[22m
[2m      $[2] = mutator.user;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const hide = t2;[22m
[2m    let t3;[22m
[2m    if ($[4] !== poke || $[5] !== hide) {[22m
[32m-     t3 = <Foo poke={poke} hide={hide} />;[39m
[31m+     t3 = ([39m
[31m+       <Foo[39m
[31m+         poke={function () {[39m
[31m+           const $res$ = poke;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         hide={function () {[39m
[31m+           const $res$ = hide;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = poke;[22m
[2m      $[5] = hide;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-member-expr-arguments
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Foo(props) {[22m
[2m    const onFoo = useCallback([22m
[2m      reason => {[22m
[2m        log(props.router.location);[22m
[2m      },[22m
[2m      [props.router.location][22m
[2m    );[22m

[2m    return onFoo;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.router.location) {[22m
[2m      t0 = (reason) => {[22m
[2m        log(props.router.location);[22m
[2m      };[22m
[2m      $[0] = props.router.location;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const onFoo = t0;[22m
[2m    return onFoo;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-decl
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let t = {a};[22m
[2m    function x() {[22m
[2m      t.foo();[22m
[2m    }[22m
[2m    x(t);[22m
[2m    return t;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let t;[22m
[2m    if ($[0] !== a) {[22m
[2m      t = { a };[22m
[2m      const x = function x() {[22m
[2m        t.foo();[22m
[2m      };[22m

[2m      x(t);[22m
[2m      $[0] = a;[22m
[2m      $[1] = t;[22m
[2m    } else {[22m
[2m      t = $[1];[22m
[2m    }[22m
[2m    return t;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-conditional-capture-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @debug[22m
[2m  function component(a, b) {[22m
[2m    let z = {a};[22m
[2m    let y = b;[22m
[2m    let x = function () {[22m
[2m      if (y) {[22m
[2m        // we don't know for sure this mutates, so we should assume[22m
[2m        // that there is no mutation so long as `x` isn't called[22m
[2m        // during render[22m
[2m        maybeMutate(z);[22m
[2m      }[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @debug[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    const y = b;[22m
[2m    let t1;[22m
[2m    if ($[2] !== y || $[3] !== z) {[22m
[2m      t1 = function () {[22m
[2m        if (y) {[22m
[2m          maybeMutate(z);[22m
[2m        }[22m
[2m      };[22m
[2m      $[2] = y;[22m
[2m      $[3] = z;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-capture-ref-before-rename
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let z = {a};[22m
[2m    (function () {[22m
[2m      mutate(z);[22m
[2m    })();[22m
[2m    let y = z;[22m

[2m    {[22m
[2m      // z is shadowed & renamed but the lambda is unaffected.[22m
[2m      let z = {b};[22m
[2m      y = {y, z};[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let z;[22m
[2m    if ($[0] !== a) {[22m
[2m      z = { a };[22m

[2m      mutate(z);[22m
[2m      $[0] = a;[22m
[2m      $[1] = z;[22m
[2m    } else {[22m
[2m      z = $[1];[22m
[2m    }[22m

[2m    let y = z;[22m
[2m    let t0;[22m
[2m    if ($[2] !== b) {[22m
[2m      t0 = { b };[22m
[2m      $[2] = b;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    const z_0 = t0;[22m
[2m    let t1;[22m
[2m    if ($[4] !== y || $[5] !== z_0) {[22m
[2m      t1 = { y, z: z_0 };[22m
[2m      $[4] = y;[22m
[2m      $[5] = z_0;[22m
[2m      $[6] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[6];[22m
[2m    }[22m
[2m    y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a) {[22m
[2m    let x = [a];[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      y = x[0];[22m
[2m    };[22m
[2m    f0();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = [a];[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        y = x[0];[22m
[2m      };[22m

[2m      f0();[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a) {[22m
[2m    let x = [a];[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      y = x[0];[22m
[2m    })();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: ['TodoAdd'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = [a];[22m
[2m      y = {};[22m

[2m      y;[22m
[2m      y = x[0];[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: ["TodoAdd"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "TodoAdd"[22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-4
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a) {[22m
[2m    let x = [a];[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      y = x[0].a[1];[22m
[2m    };[22m
[2m    f0();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [{a: ['val1', 'val2']}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = [a];[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        y = x[0].a[1];[22m
[2m      };[22m

[2m      f0();[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [{ a: ["val1", "val2"] }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "val2"[22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-4-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a) {[22m
[2m    let x = [a];[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      y = x[0].a[1];[22m
[2m    })();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [{a: ['val1', 'val2']}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = [a];[22m
[2m      y = {};[22m

[2m      y;[22m
[2m      y = x[0].a[1];[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [{ a: ["val1", "val2"] }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "val2"[22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-3
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a, b) {[22m
[2m    let x = [a, b];[22m
[2m    let y = {};[22m
[2m    let t = {};[22m
[2m    const f0 = function () {[22m
[2m      y = x[0][1];[22m
[2m      t = x[1][0];[22m
[2m    };[22m
[2m    f0();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [[22m
[2m      [1, 2],[22m
[2m      [2, 3],[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a, b) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let y;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const x = [a, b];[22m
[2m      y = {};[22m
[2m      let t;[22m
[2m      t = {};[22m
[2m      const f0 = function () {[22m
[2m        y = x[0][1];[22m
[2m        t = x[1][0];[22m
[2m      };[22m

[2m      f0();[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [[22m
[2m      [1, 2],[22m
[2m      [2, 3],[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 2[22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-3-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a, b) {[22m
[2m    let x = [a, b];[22m
[2m    let y = {};[22m
[2m    let t = {};[22m
[2m    (function () {[22m
[2m      y = x[0][1];[22m
[2m      t = x[1][0];[22m
[2m    })();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [[22m
[2m      [1, 2],[22m
[2m      [2, 3],[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a, b) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let y;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const x = [a, b];[22m
[2m      y = {};[22m
[2m      let t;[22m
[2m      t = {};[22m

[2m      y;[22m
[2m      t;[22m
[2m      y = x[0][1];[22m
[2m      t = x[1][0];[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [[22m
[2m      [1, 2],[22m
[2m      [2, 3],[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 2[22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a) {[22m
[2m    let x = [a];[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      y = x[0][1];[22m
[2m    };[22m
[2m    f0();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [['val1', 'val2']],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = [a];[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        y = x[0][1];[22m
[2m      };[22m

[2m      f0();[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [["val1", "val2"]],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "val2"[22m

[31m[1mFAIL:[22m[39m capturing-function-alias-computed-load-2-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function bar(a) {[22m
[2m    let x = [a];[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      y = x[0][1];[22m
[2m    })();[22m

[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [['val1', 'val2']],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function bar(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = [a];[22m
[2m      y = {};[22m

[2m      y;[22m
[2m      y = x[0][1];[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: bar,[22m
[2m    params: [["val1", "val2"]],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "val2"[22m

[31m[1mFAIL:[22m[39m capturing-function-1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      console.log(z);[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z) {[22m
[2m      t1 = function () {[22m
[2m        console.log(z);[22m
[2m      };[22m
[2m      $[2] = z;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-simple-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      y = x;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        y = x;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-simple-alias-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      y = x;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m

[2m      y;[22m
[2m      y = x;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":"foo","wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-func-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let z = {a};[22m
[2m    let y = {b};[22m
[2m    let x = function () {[22m
[2m      z.a = 2;[22m
[2m      console.log(y.b);[22m
[2m    };[22m
[2m    x();[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let z;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      z = { a };[22m
[2m      const y = { b };[22m
[2m      const x = function () {[22m
[2m        z.a = 2;[22m
[2m        console.log(y.b);[22m
[2m      };[22m

[2m      x();[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = z;[22m
[2m    } else {[22m
[2m      z = $[2];[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-mutate-nested
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let y = {b: {a}};[22m
[2m    let x = function () {[22m
[2m      y.b.a = 2;[22m
[2m    };[22m
[2m    x();[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      y = { b: { a } };[22m
[2m      const x = function () {[22m
[2m        y.b.a = 2;[22m
[2m      };[22m

[2m      x();[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-mutate-3
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let y = {b};[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      z.a = 2;[22m
[2m      y.b;[22m
[2m    };[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-mutate-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a, b) {[22m
[2m    let y = {b};[22m
[2m    let z = {a};[22m
[2m    let x = function () {[22m
[2m      z.a = 2;[22m
[2m      y.b;[22m
[2m    };[22m
[2m    x();[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [{a: 'val1', b: 'val2'}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a, b) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== b) {[22m
[2m      t0 = { b };[22m
[2m      $[0] = b;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    let z;[22m
[2m    if ($[2] !== a || $[3] !== y.b) {[22m
[2m      z = { a };[22m
[2m      const x = function () {[22m
[2m        z.a = 2;[22m
[2m      };[22m

[2m      x();[22m
[2m      $[2] = a;[22m
[2m      $[3] = y.b;[22m
[2m      $[4] = z;[22m
[2m    } else {[22m
[2m      z = $[4];[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [{ a: "val1", b: "val2" }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":2}[22m

[31m[1mFAIL:[22m[39m capturing-func-alias-receiver-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      let a = y;[22m
[2m      a.x = x;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        const a_0 = y;[22m
[2m        a_0.x = x;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-alias-receiver-mutate-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      let a = y;[22m
[2m      a.x = x;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m

[2m      const a_0 = y;[22m
[2m      a_0.x = x;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":{"a":"foo"},"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-func-alias-receiver-computed-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      let a = y;[22m
[2m      a['x'] = x;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        const a_0 = y;[22m
[2m        a_0.x = x;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-alias-receiver-computed-mutate-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      let a = y;[22m
[2m      a['x'] = x;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m

[2m      const a_0 = y;[22m
[2m      a_0.x = x;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":{"a":"foo"},"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-func-alias-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      y.x = x;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        y.x = x;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-alias-mutate-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      y.x = x;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m

[2m      y.x = x;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":{"a":"foo"},"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-func-alias-computed-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    const f0 = function () {[22m
[2m      y['x'] = x;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      const f0 = function () {[22m
[2m        y.x = x;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-alias-computed-mutate-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m
[2m    (function () {[22m
[2m      y['x'] = x;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let y;[22m
[2m    if ($[0] !== a) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m

[2m      y.x = x;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = y;[22m
[2m    } else {[22m
[2m      y = $[1];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"x":{"a":"foo"},"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-func-alias-captured-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    const f0 = function () {[22m
[2m      let a = {y};[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let y;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      const x = { foo };[22m
[2m      y = { bar };[22m
[2m      const f0 = function () {[22m
[2m        const a = { y };[22m
[2m        const b = x;[22m
[2m        a.x = b;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-alias-captured-mutate-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    (function () {[22m
[2m      let a = {y};[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo', 'bar'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let y;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      const x = { foo };[22m
[2m      y = { bar };[22m

[2m      const a = { y };[22m
[2m      const b = x;[22m
[2m      a.x = b;[22m

[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo", "bar"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"bar":"bar","wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-func-alias-captured-mutate-arr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    const f0 = function () {[22m
[2m      let a = [y];[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let y;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      const x = { foo };[22m
[2m      y = { bar };[22m
[2m      const f0 = function () {[22m
[2m        const a = [y];[22m
[2m        const b = x;[22m
[2m        a.x = b;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-func-alias-captured-mutate-arr-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    (function () {[22m
[2m      let a = [y];[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo', 'bar'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let y;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      const x = { foo };[22m
[2m      y = { bar };[22m

[2m      const a = [y];[22m
[2m      const b = x;[22m
[2m      a.x = b;[22m

[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo", "bar"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"bar":"bar","wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m capturing-fun-alias-captured-mutate-arr-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    const f0 = function () {[22m
[2m      let a = [y];[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let x;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      x = { foo };[22m
[2m      const y = { bar };[22m
[2m      const f0 = function () {[22m
[2m        const a = [y];[22m
[2m        const b = x;[22m
[2m        a.x = b;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-fun-alias-captured-mutate-arr-2-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  const {mutate} = require('shared-runtime');[22m

[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    (function () {[22m
[2m      let a = [y];[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo', 'bar'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  const { mutate } = require("shared-runtime");[22m

[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let x;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      x = { foo };[22m
[2m      const y = { bar };[22m

[2m      const a = [y];[22m
[2m      const b = x;[22m
[2m      a.x = b;[22m

[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo", "bar"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"foo":"foo"}[22m

[31m[1mFAIL:[22m[39m capturing-fun-alias-captured-mutate-2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    const f0 = function () {[22m
[2m      let a = {y};[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    };[22m
[2m    f0();[22m
[2m    mutate(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let x;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      x = { foo };[22m
[2m      const y = { bar };[22m
[2m      const f0 = function () {[22m
[2m        const a = { y };[22m
[2m        const b = x;[22m
[2m        a.x = b;[22m
[2m      };[22m

[2m      f0();[22m
[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capturing-fun-alias-captured-mutate-2-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  function component(foo, bar) {[22m
[2m    let x = {foo};[22m
[2m    let y = {bar};[22m
[2m    (function () {[22m
[2m      let a = {y};[22m
[2m      let b = x;[22m
[2m      a.x = b;[22m
[2m    })();[22m
[2m    mutate(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['foo', 'bar'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  function component(foo, bar) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[2m    let x;[22m
[2m    if ($[0] !== foo || $[1] !== bar) {[22m
[2m      x = { foo };[22m
[2m      const y = { bar };[22m

[2m      const a = { y };[22m
[2m      const b = x;[22m
[2m      a.x = b;[22m

[2m      mutate(y);[22m
[2m      $[0] = foo;[22m
[2m      $[1] = bar;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["foo", "bar"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"foo":"foo"}[22m

[31m[1mFAIL:[22m[39m capturing-arrow-function-1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    let x = () => {[22m
[2m      console.log(z);[22m
[2m    };[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(a);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const z = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== z) {[22m
[2m      t1 = () => {[22m
[2m        console.log(z);[22m
[2m      };[22m
[2m      $[2] = z;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const x = t1;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capture_mutate-across-fns
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    const f0 = function () {[22m
[2m      const f1 = function () {[22m
[2m        z.b = 1;[22m
[2m      };[22m
[2m      f1();[22m
[2m    };[22m
[2m    f0();[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let z;[22m
[2m    if ($[0] !== a) {[22m
[2m      z = { a };[22m
[2m      const f0 = function () {[22m
[2m        const f1 = function () {[22m
[2m          z.b = 1;[22m
[2m        };[22m

[2m        f1();[22m
[2m      };[22m

[2m      f0();[22m
[2m      $[0] = a;[22m
[2m      $[1] = z;[22m
[2m    } else {[22m
[2m      z = $[1];[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capture_mutate-across-fns-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let z = {a};[22m
[2m    (function () {[22m
[2m      (function () {[22m
[2m        z.b = 1;[22m
[2m      })();[22m
[2m    })();[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let z;[22m
[2m    if ($[0] !== a) {[22m
[2m      z = { a };[22m

[2m      (function () {[22m
[2m        z.b = 1;[22m
[2m      })();[22m
[2m      $[0] = a;[22m
[2m      $[1] = z;[22m
[2m    } else {[22m
[2m      z = $[1];[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":2,"b":1}[22m

[31m[1mFAIL:[22m[39m capture-ref-for-later-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useRef} from 'react';[22m
[2m  import {addOne} from 'shared-runtime';[22m

[2m  function useKeyCommand() {[22m
[2m    const currentPosition = useRef(0);[22m
[2m    const handleKey = direction => () => {[22m
[2m      const position = currentPosition.current;[22m
[2m      const nextPosition = direction === 'left' ? addOne(position) : position;[22m
[2m      currentPosition.current = nextPosition;[22m
[2m    };[22m
[2m    const moveLeft = {[22m
[2m      handler: handleKey('left'),[22m
[2m    };[22m
[2m    const moveRight = {[22m
[2m      handler: handleKey('right'),[22m
[2m    };[22m
[2m    return [moveLeft, moveRight];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useKeyCommand,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useRef } from "react";[22m
[2m  import { addOne } from "shared-runtime";[22m

[2m  function useKeyCommand() {[22m
[2m    const $ = _c(2);[22m
[32m-   const currentPosition = useRef(0);[39m
[31m+   const currentPosition = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const handleKey = (direction) => () => {[22m
[2m      const position = currentPosition.current;[22m
[2m      const nextPosition = direction === "left" ? addOne(position) : position;[22m
[2m      currentPosition.current = nextPosition;[22m
[2m    };[22m

[2m    const moveLeft = { handler: handleKey("left") };[22m

[2m    const t0 = handleKey("right");[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = { handler: t0 };[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const moveRight = t1;[22m
[2m    return [moveLeft, moveRight];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useKeyCommand,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"handler":"[[ function params=0 ]]"},{"handler":"[[ function params=0 ]]"}][22m

[31m[1mFAIL:[22m[39m capture-param-mutate
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function getNativeLogFunction(level) {[22m
[2m    return function () {[22m
[2m      let str;[22m
[2m      if (arguments.length === 1 && typeof arguments[0] === 'string') {[22m
[2m        str = arguments[0];[22m
[2m      } else {[22m
[2m        str = Array.prototype.map[22m
[2m          .call(arguments, function (arg) {[22m
[2m            return inspect(arg, {[22m
[2m              depth: 10,[22m
[2m            });[22m
[2m          })[22m
[2m          .join(', ');[22m
[2m      }[22m
[2m      const firstArg = arguments[0];[22m
[2m      let logLevel = level;[22m
[2m      if ([22m
[2m        typeof firstArg === 'string' &&[22m
[2m        firstArg.slice(0, 9) === 'Warning: ' &&[22m
[2m        logLevel >= LOG_LEVELS.error[22m
[2m      ) {[22m
[2m        logLevel = LOG_LEVELS.warn;[22m
[2m      }[22m
[2m      if (global.__inspectorLog) {[22m
[2m        global.__inspectorLog([22m
[2m          INSPECTOR_LEVELS[logLevel],[22m
[2m          str,[22m
[2m          [].slice.call(arguments),[22m
[2m          INSPECTOR_FRAMES_TO_SKIP[22m
[2m        );[22m
[2m      }[22m
[2m      if (groupStack.length) {[22m
[2m        str = groupFormat('', str);[22m
[2m      }[22m
[2m      global.nativeLoggingHook(str, logLevel);[22m
[2m    };[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function getNativeLogFunction(level) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(level);[39m
[2m    let t0;[22m
[2m    if ($[0] !== level) {[22m
[2m      t0 = function () {[22m
[2m        let str;[22m
[2m        if (arguments.length === 1 && typeof arguments[0] === "string") {[22m
[2m          str = arguments[0];[22m
[2m        } else {[22m
[2m          str = Array.prototype.map[22m
[2m            .call(arguments, function (arg) {[22m
[2m              return inspect(arg, { depth: 10 });[22m
[2m            })[22m
[2m            .join(", ");[22m
[2m        }[22m

[2m        const firstArg = arguments[0];[22m
[2m        let logLevel = level;[22m
[2m        if ([22m
[2m          typeof firstArg === "string" &&[22m
[2m          firstArg.slice(0, 9) === "Warning: " &&[22m
[2m          logLevel >= LOG_LEVELS.error[22m
[2m        ) {[22m
[2m          logLevel = LOG_LEVELS.warn;[22m
[2m        }[22m
[2m        if (global.__inspectorLog) {[22m
[2m          global.__inspectorLog([22m
[2m            INSPECTOR_LEVELS[logLevel],[22m
[2m            str,[22m
[2m            [].slice.call(arguments),[22m
[2m            INSPECTOR_FRAMES_TO_SKIP,[22m
[2m          );[22m
[2m        }[22m
[2m        if (groupStack.length) {[22m
[2m          str = groupFormat("", str);[22m
[2m        }[22m

[2m        global.nativeLoggingHook(str, logLevel);[22m
[2m      };[22m
[2m      $[0] = level;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capture-indirect-mutate-alias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    const f0 = function () {[22m
[2m      let q = x;[22m
[2m      const f1 = function () {[22m
[2m        q.b = 1;[22m
[2m      };[22m
[2m      f1();[22m
[2m    };[22m
[2m    f0();[22m

[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = { a };[22m
[2m      const f0 = function () {[22m
[2m        const q = x;[22m
[2m        const f1 = function () {[22m
[2m          q.b = 1;[22m
[2m        };[22m

[2m        f1();[22m
[2m      };[22m

[2m      f0();[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m capture-indirect-mutate-alias-iife
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    (function () {[22m
[2m      let q = x;[22m
[2m      (function () {[22m
[2m        q.b = 1;[22m
[2m      })();[22m
[2m    })();[22m

[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = { a };[22m

[2m      const q = x;[22m
[2m      (function () {[22m
[2m        q.b = 1;[22m
[2m      })();[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":2,"b":1}[22m

[31m[1mFAIL:[22m[39m capitalized-function-allowlist
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateNoCapitalizedCalls @hookPattern:".*\b(use[^$]+)$"[22m
[2m  import * as React from 'react';[22m
[2m  const React$useState = React.useState;[22m
[2m  const THIS_IS_A_CONSTANT = () => {};[22m
[2m  function Component() {[22m
[2m    const b = Boolean(true); // OK[22m
[2m    const n = Number(3); // OK[22m
[2m    const s = String('foo'); // OK[22m
[2m    const [state, setState] = React$useState(0); // OK[22m
[2m    const [state2, setState2] = React.useState(1); // OK[22m
[2m    const constant = THIS_IS_A_CONSTANT(); // OK[22m
[2m    return 3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @validateNoCapitalizedCalls @hookPattern:".*\b(use[^$]+)$"[22m
[2m  import * as React from "react";[22m
[2m  const React$useState = React.useState;[22m
[2m  const THIS_IS_A_CONSTANT = () => {};[22m
[2m  function Component() {[22m
[2m    Boolean(true);[22m
[2m    Number(3);[22m
[2m    String("foo");[22m
[32m-   React$useState(0);[39m
[32m-   React.useState(1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = React$useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = React.useState(Object.freeze(1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    THIS_IS_A_CONSTANT();[22m
[2m    return 3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m    isComponent: true,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 3[22m

[31m[1mFAIL:[22m[39m call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const a = [];[22m
[2m    const b = {};[22m
[2m    foo(a, b);[22m
[2m    let _ = <div a={a} />;[22m
[2m    foo(b);[22m
[2m    return <div a={a} b={b} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo() {}[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const a = [];[22m
[2m      const b = {};[22m
[2m      foo(a, b);[22m

[2m      foo(b);[22m
[32m-     t0 = <div a={a} b={b} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         a={function () {[39m
[31m+           const $res$ = a;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         b={function () {[39m
[31m+           const $res$ = b;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m call-with-independently-memoizable-arg
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = makeFunction(props);[22m
[2m    const y = x([22m
[2m      <div>[22m
[2m        <span>{props.text}</span>[22m
[2m      </div>[22m
[2m    );[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      const x = makeFunction(props);[22m
[2m      let t1;[22m
[2m      if ($[2] !== props.text) {[22m
[2m        t1 = ([22m
[2m          <div>[22m
[2m            <span>{props.text}</span>[22m
[2m          </div>[22m
[2m        );[22m
[2m        $[2] = props.text;[22m
[2m        $[3] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[3];[22m
[2m      }[22m
[2m      t0 = x(t1);[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const y = t0;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m call-spread
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = foo(...props.a, null, ...props.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      t0 = foo(...props.a, null, ...props.b);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m call-args-destructuring-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = makeObject();[22m
[2m    x.foo(([x] = makeObject()));[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x = makeObject();[22m
[2m      x.foo(([x] = makeObject()));[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m call-args-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    let x = makeObject();[22m
[2m    x.foo((x = makeObject()));[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      x = makeObject();[22m
[2m      x.foo((x = makeObject()));[22m
[2m      $[0] = x;[22m
[2m    } else {[22m
[2m      x = $[0];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m builtin-jsx-tag-lowered-between-mutations
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const maybeMutable = new MaybeMutable();[22m
[2m    return <div>{maybeMutate(maybeMutable)}</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const maybeMutable = new MaybeMutable();[22m
[2m      t0 = <div>{maybeMutate(maybeMutable)}</div>;[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m bug-invalid-hoisting-functionexpr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * We currently hoist the accessed properties of function expressions,[22m
[2m   * regardless of control flow. This is simply because we wrote support for[22m
[2m   * function expressions before doing a lot of work in PropagateScopeDeps[22m
[2m   * to handle conditionally accessed dependencies.[22m
[2m   *[22m
[2m   * Current evaluator error:[22m
[2m   *  Found differences in evaluator results[22m
[2m   *  Non-forget (expected):[22m
[2m   *  (kind: ok) <div>{"shouldInvokeFns":true,"callback":{"kind":"Function","result":null}}</div>[22m
[2m   *  Forget:[22m
[2m   *  (kind: exception) Cannot read properties of null (reading 'prop')[22m
[2m   */[22m
[2m  function Component({obj, isObjNull}) {[22m
[2m    const callback = () => {[22m
[2m      if (!isObjNull) {[22m
[2m        return obj.prop;[22m
[2m      } else {[22m
[2m        return null;[22m
[2m      }[22m
[2m    };[22m
[2m    return <Stringify shouldInvokeFns={true} callback={callback} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{obj: null, isObjNull: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  /**[22m
[2m   * We currently hoist the accessed properties of function expressions,[22m
[2m   * regardless of control flow. This is simply because we wrote support for[22m
[2m   * function expressions before doing a lot of work in PropagateScopeDeps[22m
[2m   * to handle conditionally accessed dependencies.[22m
[2m   *[22m
[2m   * Current evaluator error:[22m
[2m   *  Found differences in evaluator results[22m
[2m   *  Non-forget (expected):[22m
[2m   *  (kind: ok) <div>{"shouldInvokeFns":true,"callback":{"kind":"Function","result":null}}</div>[22m
[2m   *  Forget:[22m
[2m   *  (kind: exception) Cannot read properties of null (reading 'prop')[22m
[2m   */[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { obj, isObjNull } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== isObjNull || $[1] !== obj.prop) {[22m
[2m      t1 = () => {[22m
[2m        if (!isObjNull) {[22m
[2m          return obj.prop;[22m
[2m        } else {[22m
[2m          return null;[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = isObjNull;[22m
[2m      $[1] = obj.prop;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const callback = t1;[22m
[2m    let t2;[22m
[2m    if ($[3] !== callback) {[22m
[32m-     t2 = <Stringify shouldInvokeFns={true} callback={callback} />;[39m
[31m+     t2 = ([39m
[31m+       <Stringify[39m
[31m+         shouldInvokeFns={function () {[39m
[31m+           const $res$ = true;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         callback={function () {[39m
[31m+           const $res$ = callback;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = callback;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ obj: null, isObjNull: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m block-scoping-switch-variable-scoping
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useMemo} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const outerHandlers = useMemo(() => {[22m
[2m      let handlers = {value: props.value};[22m
[2m      switch (props.test) {[22m
[2m        case true: {[22m
[2m          console.log(handlers.value);[22m
[2m          break;[22m
[2m        }[22m
[2m        default: {[22m
[2m        }[22m
[2m      }[22m
[2m      return handlers;[22m
[2m    });[22m
[2m    return outerHandlers;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{test: true, value: 'hello'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useMemo } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== props.value) {[22m
[2m      t1 = { value: props.value };[22m
[2m      $[0] = props.value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const handlers = t1;[22m
[2m    bb0: switch (props.test) {[22m
[2m      case true: {[22m
[2m        console.log(handlers.value);[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      default: {[22m
[2m      }[22m
[2m    }[22m

[2m    t0 = handlers;[22m
[2m    const outerHandlers = t0;[22m
[2m    return outerHandlers;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ test: true, value: "hello" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"value":"hello"}[22m
[2m  logs: ['hello'][22m

[31m[1mFAIL:[22m[39m block-scoping-switch-dead-code
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useHook(a, b) {[22m
[2m    switch (a) {[22m
[2m      case 1:[22m
[2m        if (b == null) {[22m
[2m          return;[22m
[2m        }[22m
[2m        console.log(b);[22m
[2m        break;[22m
[2m      case 2:[22m
[2m        return;[22m
[2m      default:[22m
[2m        return;[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [1, 'foo'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  function useHook(a, b) {[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    bb0: switch (a) {[22m
[2m      case 1: {[22m
[2m        if (b == null) {[22m
[2m          return;[22m
[2m        }[22m

[2m        console.log(b);[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      case 2: {[22m
[2m        return;[22m
[2m      }[22m
[2m      default: {[22m
[2m        return;[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [1, "foo"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m
[2m  logs: ['foo'][22m

[31m[1mFAIL:[22m[39m babel-existing-react-namespace-import
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as React from 'react';[22m
[2m  import {calculateExpensiveNumber} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const [x] = React.useState(0);[22m
[2m    const expensiveNumber = React.useMemo(() => calculateExpensiveNumber(x), [x]);[22m

[2m    return <div>{expensiveNumber}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as React from "react";[22m
[2m  import { calculateExpensiveNumber } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const [x] = React.useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = React.useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = calculateExpensiveNumber(x);[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const expensiveNumber = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] !== expensiveNumber) {[22m
[2m      t2 = <div>{expensiveNumber}</div>;[22m
[2m      $[2] = expensiveNumber;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>0</div>[22m

[31m[1mFAIL:[22m[39m babel-existing-react-kitchensink-import
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import * as React from 'react';[22m
[2m  import {useState, useMemo} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const [x] = useState(0);[22m
[2m    const expensiveNumber = useMemo(() => calculateExpensiveNumber(x), [x]);[22m

[2m    return <div>{expensiveNumber}</div>;[22m
[2m  }[22m

[2m  function Component2(props) {[22m
[2m    const [x] = useState(0);[22m
[2m    const expensiveNumber = useMemo(() => calculateExpensiveNumber(x), [x]);[22m

[2m    return <div>{expensiveNumber}</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import * as React from "react";[22m
[2m  import { useState, useMemo } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const [x] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = calculateExpensiveNumber(x);[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const expensiveNumber = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] !== expensiveNumber) {[22m
[2m      t2 = <div>{expensiveNumber}</div>;[22m
[2m      $[2] = expensiveNumber;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  function Component2(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const [x] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = calculateExpensiveNumber(x);[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const expensiveNumber = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] !== expensiveNumber) {[22m
[2m      t2 = <div>{expensiveNumber}</div>;[22m
[2m      $[2] = expensiveNumber;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m babel-existing-react-import
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useState, useMemo} from 'react';[22m

[2m  function Component(props) {[22m
[2m    const [x] = useState(0);[22m
[2m    const expensiveNumber = useMemo(() => calculateExpensiveNumber(x), [x]);[22m

[2m    return <div>{expensiveNumber}</div>;[22m
[2m  }[22m

[2m  function Component2(props) {[22m
[2m    const [x] = useState(0);[22m
[2m    const expensiveNumber = useMemo(() => calculateExpensiveNumber(x), [x]);[22m

[2m    return <div>{expensiveNumber}</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useState, useMemo } from "react";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const [x] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = calculateExpensiveNumber(x);[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const expensiveNumber = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] !== expensiveNumber) {[22m
[2m      t2 = <div>{expensiveNumber}</div>;[22m
[2m      $[2] = expensiveNumber;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  function Component2(props) {[22m
[2m    const $ = _c(4);[22m
[32m-   const [x] = useState(0);[39m
[31m+   Object.freeze(props);[39m
[31m+   const [x] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== x) {[22m
[2m      t1 = calculateExpensiveNumber(x);[22m
[2m      $[0] = x;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const expensiveNumber = t0;[22m
[2m    let t2;[22m
[2m    if ($[2] !== expensiveNumber) {[22m
[2m      t2 = <div>{expensiveNumber}</div>;[22m
[2m      $[2] = expensiveNumber;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m await
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  async function Component(props) {[22m
[2m    const user = await load(props.id);[22m
[2m    return <div>{user.name}</div>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  async function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.id) {[22m
[2m      t0 = await load(props.id);[22m
[2m      $[0] = props.id;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const user = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== user.name) {[22m
[2m      t1 = <div>{user.name}</div>;[22m
[2m      $[2] = user.name;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m await-side-effecting-promise
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  async function Component(props) {[22m
[2m    const x = [];[22m
[2m    await populateData(props.id, x);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  async function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.id) {[22m
[2m      x = [];[22m
[2m      await populateData(props.id, x);[22m
[2m      $[0] = props.id;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m assignment-in-nested-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useBar(props) {[22m
[2m    let z;[22m

[2m    if (props.a) {[22m
[2m      if (props.b) {[22m
[2m        z = baz();[22m
[2m      }[22m
[2m    }[22m

[2m    return z;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useBar(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let z;[22m
[2m    if (props.a) {[22m
[2m      if (props.b) {[22m
[2m        let t0;[22m
[2m        if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m          t0 = baz();[22m
[2m          $[0] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[0];[22m
[2m        }[22m
[2m        z = t0;[22m
[2m      }[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m assignment-expression-nested-path
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function g(props) {[22m
[2m    const a = {b: {c: props.c}};[22m
[2m    a.b.c = a.b.c + 1;[22m
[2m    a.b.c *= 2;[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: g,[22m
[2m    params: [{c: 2}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function g(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let a;[22m
[2m    if ($[0] !== props.c) {[22m
[2m      a = { b: { c: props.c } };[22m
[2m      a.b.c = a.b.c + 1;[22m
[2m      a.b.c = a.b.c * 2;[22m
[2m      $[0] = props.c;[22m
[2m      $[1] = a;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m    }[22m
[2m    return a;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: g,[22m
[2m    params: [{ c: 2 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":{"c":6}}[22m

[31m[1mFAIL:[22m[39m assignment-expression-computed
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [props.x];[22m
[2m    const index = 0;[22m
[2m    x[index] *= 2;[22m
[2m    x['0'] += 3;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{x: 2}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.x) {[22m
[2m      x = [props.x];[22m

[2m      x[0] = x[0] * 2;[22m
[2m      x["0"] = x["0"] + 3;[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ x: 2 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [7][22m

[31m[1mFAIL:[22m[39m arrow-function-expr-gating-test
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @gating[22m
[2m  const ErrorView = (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  export default ErrorView;[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { isForgetEnabled_Fixtures } from "ReactForgetFeatureFlag";[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @gating[22m
[2m  const ErrorView = isForgetEnabled_Fixtures()[22m
[2m    ? (error, _retry) => {[22m
[2m        const $ = _c(2);[22m
[31m+       Object.freeze(error);[39m
[31m+       Object.freeze(_retry);[39m
[2m        let t0;[22m
[2m        if ($[0] !== error) {[22m
[32m-         t0 = <MessageBox error={error} />;[39m
[31m+         t0 = ([39m
[31m+           <MessageBox[39m
[31m+             error={function () {[39m
[31m+               const $res$ = error;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }}[39m
[31m+           />[39m
[31m+         );[39m
[2m          $[0] = error;[22m
[2m          $[1] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[1];[22m
[2m        }[22m
[2m        return t0;[22m
[2m      }[22m
[2m    : (error, _retry) => <MessageBox error={error}></MessageBox>;[22m

[2m  export default ErrorView;[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m arrow-expr-directive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    'use strict';[22m
[2m    let [count, setCount] = React.useState(0);[22m
[2m    const update = () => {[22m
[2m      'worklet';[22m
[2m      setCount(count => count + 1);[22m
[2m    };[22m
[2m    return <button onClick={update}>{count}</button>;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[32m-   "use strict";[39m
[2m    const $ = _c(3);[22m

[32m-   const [count, setCount] = React.useState(0);[39m
[31m+   const [count, setCount] = (function () {[39m
[31m+     const $res$ = React.useState(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        "worklet";[22m

[2m        setCount((count_0) => count_0 + 1);[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const update = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== count) {[22m
[32m-     t1 = <button onClick={update}>{count}</button>;[39m
[31m+     t1 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = update;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {count}[39m
[31m+       </button>[39m
[31m+     );[39m
[2m      $[1] = count;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Fixture not implemented[22m

[31m[1mFAIL:[22m[39m array-push-effect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // arrayInstance.push should have the following effects:[22m
[2m  //  - read on all args (rest parameter)[22m
[2m  //  - mutate on receiver[22m
[2m  function Component(props) {[22m
[2m    const x = foo(props.x);[22m
[2m    const y = {y: props.y};[22m
[2m    const arr = [];[22m
[2m    arr.push({});[22m
[2m    arr.push(x, y);[22m
[2m    return arr;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // arrayInstance.push should have the following effects:[22m
[2m  //  - read on all args (rest parameter)[22m
[2m  //  - mutate on receiver[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(8);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.x) {[22m
[2m      t0 = foo(props.x);[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== props.y) {[22m
[2m      t1 = { y: props.y };[22m
[2m      $[2] = props.y;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    let arr;[22m
[2m    if ($[4] !== x || $[5] !== y) {[22m
[2m      arr = [];[22m
[2m      let t2;[22m
[2m      if ($[7] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t2 = {};[22m
[2m        $[7] = t2;[22m
[2m      } else {[22m
[2m        t2 = $[7];[22m
[2m      }[22m
[2m      arr.push(t2);[22m
[2m      arr.push(x, y);[22m
[2m      $[4] = x;[22m
[2m      $[5] = y;[22m
[2m      $[6] = arr;[22m
[2m    } else {[22m
[2m      arr = $[6];[22m
[2m    }[22m
[2m    return arr;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m array-property-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = [props.a, props.b, 'hello'];[22m
[2m    const x = a.push(42);[22m
[2m    const y = a.at(props.c);[22m

[2m    return {a, x, y};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1, b: 2, c: 0}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let a;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      a = [props.a, props.b, "hello"];[22m
[2m      t0 = a.push(42);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = t0;[22m
[2m      $[3] = a;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m      a = $[3];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[4] !== a || $[5] !== props.c) {[22m
[2m      t1 = a.at(props.c);[22m
[2m      $[4] = a;[22m
[2m      $[5] = props.c;[22m
[2m      $[6] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[6];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    let t2;[22m
[2m    if ($[7] !== a || $[8] !== x || $[9] !== y) {[22m
[2m      t2 = { a, x, y };[22m
[2m      $[7] = a;[22m
[2m      $[8] = x;[22m
[2m      $[9] = y;[22m
[2m      $[10] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[10];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 1, b: 2, c: 0 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":[1,2,"hello",42],"x":4,"y":1}[22m

[31m[1mFAIL:[22m[39m array-properties
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const a = [props.a, props.b, 'hello'];[22m
[2m    const x = a.length;[22m
[2m    const y = a.push;[22m
[2m    return {a, x, y, z: a.concat};[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: [1, 2], b: 2}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a || $[1] !== props.b) {[22m
[2m      t0 = [props.a, props.b, "hello"];[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = props.b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const a = t0;[22m
[2m    const x = a.length;[22m
[2m    const y = a.push;[22m
[2m    let t1;[22m
[2m    if ($[3] !== a || $[4] !== x || $[5] !== y) {[22m
[2m      t1 = { a, x, y, z: a.concat };[22m
[2m      $[3] = a;[22m
[2m      $[4] = x;[22m
[2m      $[5] = y;[22m
[2m      $[6] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[6];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: [1, 2], b: 2 }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":[[1,2],2,"hello"],"x":3,"y":"[[ function params=1 ]]","z":"[[ function params=1 ]]"}[22m

[31m[1mFAIL:[22m[39m array-pattern-params
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component([a, b]) {[22m
[2m    let y = {a};[22m
[2m    let z = {b};[22m
[2m    return [y, z];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [['val1', 'val2']],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(t0) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(t0);[39m
[2m    const [a, b] = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = { a };[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== b) {[22m
[2m      t2 = { b };[22m
[2m      $[2] = b;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const z = t2;[22m
[2m    let t3;[22m
[2m    if ($[4] !== y || $[5] !== z) {[22m
[2m      t3 = [y, z];[22m
[2m      $[4] = y;[22m
[2m      $[5] = z;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: component,[22m
[2m    params: [["val1", "val2"]],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":"val1"},{"b":"val2"}][22m

[31m[1mFAIL:[22m[39m array-map-noAlias-escaping-function
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const f = item => item;[22m
[2m    const x = [...props.items].map(f); // `f` doesn't escape here...[22m
[2m    return [x, f]; // ...but it does here so it's memoized[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{items: [{id: 1}]}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    const f = _temp;[22m
[2m    let t0;[22m
[2m    if ($[0] !== props.items) {[22m
[2m      t0 = [...props.items].map(f);[22m
[2m      $[0] = props.items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== x) {[22m
[2m      t1 = [x, f];[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    return item;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ items: [{ id: 1 }] }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[{"id":1}],"[[ function params=1 ]]"][22m

[31m[1mFAIL:[22m[39m array-map-mutable-array-non-mutating-lambda-mutated-result
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [{}];[22m
[2m    const y = x.map(item => {[22m
[2m      return item;[22m
[2m    });[22m
[2m    y[0].flag = true;[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const x = [{}];[22m
[2m      const y = x.map(_temp);[22m
[2m      y[0].flag = true;[22m
[2m      t0 = [x, y];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    return item;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[{"flag":true}],["[[ cyclic ref *2 ]]"]][22m

[31m[1mFAIL:[22m[39m array-map-mutable-array-mutating-lambda
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const y = x.map(item => {[22m
[2m      item.updated = true;[22m
[2m      return item;[22m
[2m    });[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const x = [];[22m
[2m      const y = x.map(_temp);[22m
[2m      t0 = [x, y];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    item.updated = true;[22m
[2m    return item;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[],[]][22m

[31m[1mFAIL:[22m[39m array-map-mutable-array-mutating-lambda-noAlias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    const y = x.map(item => {[22m
[2m      item.updated = true;[22m
[2m      return item;[22m
[2m    });[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const x = [];[22m
[2m      const y = x.map(_temp);[22m
[2m      t0 = [x, y];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    item.updated = true;[22m
[2m    return item;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[],[]][22m

[31m[1mFAIL:[22m[39m array-map-frozen-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    <dif>{x}</dif>;[22m
[2m    const y = x.map(item => item);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const y = x.map(_temp);[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    return item;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[],[]][22m

[31m[1mFAIL:[22m[39m array-map-frozen-array-noAlias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    <dif>{x}</dif>;[22m
[2m    const y = x.map(item => item);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      const y = x.map(_temp);[22m
[2m      t1 = [x, y];[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m
[2m  function _temp(item) {[22m
[2m    return item;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[],[]][22m

[31m[1mFAIL:[22m[39m array-map-captures-receiver-noAlias
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    // This item is part of the receiver, should be memoized[22m
[2m    const item = {a: props.a};[22m
[2m    const items = [item];[22m
[2m    const mapped = items.map(item => item);[22m
[2m    return mapped;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: {id: 42}}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = { a: props.a };[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const item = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== item) {[22m
[2m      t1 = [item];[22m
[2m      $[2] = item;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const items = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== items) {[22m
[2m      t2 = items.map(_temp);[22m
[2m      $[4] = items;[22m
[2m      $[5] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[5];[22m
[2m    }[22m
[2m    const mapped = t2;[22m
[2m    return mapped;[22m
[2m  }[22m
[2m  function _temp(item_0) {[22m
[2m    return item_0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: { id: 42 } }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":{"id":42}}][22m

[31m[1mFAIL:[22m[39m array-join
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [{}, [], props.value];[22m
[2m    const y = x.join(() => 'this closure gets stringified, not called');[22m
[2m    foo(y);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = {};[22m
[2m      t1 = [];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[2] !== props.value) {[22m
[2m      t2 = [t0, t1, props.value];[22m
[2m      $[2] = props.value;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const x = t2;[22m
[2m    const y = x.join(_temp);[22m
[2m    foo(y);[22m
[2m    let t3;[22m
[2m    if ($[4] !== x || $[5] !== y) {[22m
[2m      t3 = [x, y];[22m
[2m      $[4] = x;[22m
[2m      $[5] = y;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    return "this closure gets stringified, not called";[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m array-expression-spread
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [0, ...props.foo, null, ...props.bar, 'z'];[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{foo: [1, 2, 3], bar: [4, 5, 6]}],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.foo || $[1] !== props.bar) {[22m
[2m      t0 = [0, ...props.foo, null, ...props.bar, "z"];[22m
[2m      $[0] = props.foo;[22m
[2m      $[1] = props.bar;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ foo: [1, 2, 3], bar: [4, 5, 6] }],[22m
[2m    isComponent: false,[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [0,1,2,3,null,4,5,6,"z"][22m

[31m[1mFAIL:[22m[39m array-concat-should-capture
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Fixture showing why `concat` needs to capture both the callee and rest args.[22m
[2m   * Here, observe that arr1's values are captured into arr2.[22m
[2m   *  - Later mutations of arr2 may write to values within arr1.[22m
[2m   *  - Observe that it's technically valid to separately memoize the array arr1[22m
[2m   *    itself.[22m
[2m   */[22m
[2m  function Foo({inputNum}) {[22m
[2m    const arr1: Array<number | object> = [{a: 1}, {}];[22m
[2m    const arr2 = arr1.concat([1, inputNum]);[22m
[2m    mutate(arr2[0]);[22m
[2m    return arr2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{inputNum: 2}],[22m
[2m    sequentialRenders: [{inputNum: 2}, {inputNum: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Fixture showing why `concat` needs to capture both the callee and rest args.[22m
[2m   * Here, observe that arr1's values are captured into arr2.[22m
[2m   *  - Later mutations of arr2 may write to values within arr1.[22m
[2m   *  - Observe that it's technically valid to separately memoize the array arr1[22m
[2m   *    itself.[22m
[2m   */[22m
[2m  function Foo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { inputNum } = t0;[22m
[2m    let arr2;[22m
[2m    if ($[0] !== inputNum) {[22m
[2m      const arr1 = [{ a: 1 }, {}];[22m
[2m      arr2 = arr1.concat([1, inputNum]);[22m
[2m      mutate(arr2[0]);[22m
[2m      $[0] = inputNum;[22m
[2m      $[1] = arr2;[22m
[2m    } else {[22m
[2m      arr2 = $[1];[22m
[2m    }[22m
[2m    return arr2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ inputNum: 2 }],[22m
[2m    sequentialRenders: [{ inputNum: 2 }, { inputNum: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"a":1,"wat0":"joe"},{},1,2][22m
[2m  [{"a":1,"wat0":"joe"},{},1,3][22m

[31m[1mFAIL:[22m[39m array-at-mutate-after-capture
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // x's mutable range should extend to `mutate(y)`[22m

[2m  function Component(props) {[22m
[2m    let x = [42, {}];[22m
[2m    const idx = foo(props.b);[22m
[2m    let y = x.at(idx);[22m
[2m    mutate(y);[22m

[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // x's mutable range should extend to `mutate(y)`[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.b) {[22m
[2m      x = [42, {}];[22m
[2m      const idx = foo(props.b);[22m
[2m      const y = x.at(idx);[22m
[2m      mutate(y);[22m
[2m      $[0] = props.b;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m array-at-effect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // arrayInstance.at should have the following effects:[22m
[2m  //  - read on arg0[22m
[2m  //  - read on receiver[22m
[2m  //  - mutate on lvalue[22m
[2m  function ArrayAtTest(props) {[22m
[2m    const arr = [foo(props.x)];[22m
[2m    const result = arr.at(bar(props.y));[22m
[2m    return result;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // arrayInstance.at should have the following effects:[22m
[2m  //  - read on arg0[22m
[2m  //  - read on receiver[22m
[2m  //  - mutate on lvalue[22m
[2m  function ArrayAtTest(props) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.x) {[22m
[2m      t0 = foo(props.x);[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const arr = t1;[22m
[2m    let t2;[22m
[2m    if ($[4] !== props.y || $[5] !== arr) {[22m
[2m      let t3;[22m
[2m      if ($[7] !== props.y) {[22m
[2m        t3 = bar(props.y);[22m
[2m        $[7] = props.y;[22m
[2m        $[8] = t3;[22m
[2m      } else {[22m
[2m        t3 = $[8];[22m
[2m      }[22m
[2m      t2 = arr.at(t3);[22m
[2m      $[4] = props.y;[22m
[2m      $[5] = arr;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[2m    const result = t2;[22m
[2m    return result;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m array-at-closure
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = foo(props.x);[22m
[2m    const fn = function () {[22m
[2m      const arr = [...bar(props)];[22m
[2m      return arr.at(x);[22m
[2m    };[22m
[2m    const fnResult = fn();[22m
[2m    return fnResult;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.x) {[22m
[2m      t0 = foo(props.x);[22m
[2m      $[0] = props.x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== props || $[3] !== x) {[22m
[2m      t1 = function () {[22m
[2m        const arr = [...bar(props)];[22m
[2m        return arr.at(x);[22m
[2m      };[22m
[2m      $[2] = props;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    const fn = t1;[22m
[2m    let t2;[22m
[2m    if ($[5] !== fn) {[22m
[2m      t2 = fn();[22m
[2m      $[5] = fn;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[2m    const fnResult = t2;[22m
[2m    return fnResult;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m array-access-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component({a, b, c}) {[22m
[2m    const x = [a];[22m
[2m    const y = [null, b];[22m
[2m    const z = [[], [], [c]];[22m
[2m    x[0] = y[1];[22m
[2m    z[0][0] = x[0];[22m
[2m    return [x, z];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: 1, b: 20, c: 300}],[22m
[2m    sequentialRenders: [[22m
[2m      {a: 2, b: 20, c: 300},[22m
[2m      {a: 3, b: 20, c: 300},[22m
[2m      {a: 3, b: 21, c: 300},[22m
[2m      {a: 3, b: 22, c: 300},[22m
[2m      {a: 3, b: 22, c: 301},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b, c } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a || $[1] !== b || $[2] !== c) {[22m
[2m      const x = [a];[22m
[2m      let t2;[22m
[2m      if ($[4] !== b) {[22m
[2m        t2 = [null, b];[22m
[2m        $[4] = b;[22m
[2m        $[5] = t2;[22m
[2m      } else {[22m
[2m        t2 = $[5];[22m
[2m      }[22m
[2m      const y = t2;[22m
[2m      const z = [[], [], [c]];[22m
[2m      x[0] = y[1];[22m
[2m      z[0][0] = x[0];[22m
[2m      t1 = [x, z];[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = c;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: 1, b: 20, c: 300 }],[22m
[2m    sequentialRenders: [[22m
[2m      { a: 2, b: 20, c: 300 },[22m
[2m      { a: 3, b: 20, c: 300 },[22m
[2m      { a: 3, b: 21, c: 300 },[22m
[2m      { a: 3, b: 22, c: 300 },[22m
[2m      { a: 3, b: 22, c: 301 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[20],[[20],[],[300]]][22m
[2m  [[20],[[20],[],[300]]][22m
[2m  [[21],[[21],[],[300]]][22m
[2m  [[22],[[22],[],[300]]][22m
[2m  [[22],[[22],[],[301]]][22m

[31m[1mFAIL:[22m[39m allow-ref-access-in-unused-callback-nested
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender[22m
[2m  import {useEffect, useRef, useState} from 'react';[22m

[2m  function Component() {[22m
[2m    const ref = useRef(null);[22m
[2m    const [state, setState] = useState(false);[22m
[2m    useEffect(() => {[22m
[2m      const callback = () => {[22m
[2m        ref.current = 'Ok';[22m
[2m      };[22m
[2m    }, []);[22m

[2m    useEffect(() => {[22m
[2m      setState(true);[22m
[2m    }, []);[22m

[2m    // We use state to force a re-render and observe whether the[22m
[2m    // ref updated. This lets us check that the effect actually ran[22m
[2m    // and wasn't DCE'd[22m
[2m    return <Child key={String(state)} ref={ref} />;[22m
[2m  }[22m

[2m  function Child({ref}) {[22m
[2m    // This violates the rules of React, so we access the ref in a child[22m
[2m    // component[22m
[2m    return ref.current;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender[22m
[2m  import { useEffect, useRef, useState } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(7);[22m
[32m-   const ref = useRef(null);[39m
[32m-   const [state, setState] = useState(false);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(false));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {};[22m

[2m      t1 = [];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[32m-   useEffect(t0, t1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t0), Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    let t3;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = () => {[22m
[2m        setState(true);[22m
[2m      };[22m
[2m      t3 = [];[22m
[2m      $[2] = t2;[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[32m-   useEffect(t2, t3);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t2), Object.freeze(t3));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const t4 = String(state);[22m
[2m    let t5;[22m
[2m    if ($[4] !== t4 || $[5] !== ref) {[22m
[32m-     t5 = <Child key={t4} ref={ref} />;[39m
[31m+     t5 = ([39m
[31m+       <Child[39m
[31m+         key={function () {[39m
[31m+           const $res$ = t4;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = t4;[22m
[2m      $[5] = ref;[22m
[2m      $[6] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[6];[22m
[2m    }[22m
[2m    return t5;[22m
[2m  }[22m

[2m  function Child(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { ref } = t0;[22m
[2m    return ref.current;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m allow-ref-access-in-effect
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) Ok
Forget:
(kind: exception) Cannot assign to read only property 'current' of object '#<Object>'

[31m[1mFAIL:[22m[39m allow-ref-access-in-effect-indirect
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) Ok
Forget:
(kind: exception) Cannot assign to read only property 'current' of object '#<Object>'

[31m[1mFAIL:[22m[39m allow-reassignment-to-global-function-jsx-prop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component() {[22m
[2m    const onClick = () => {[22m
[2m      // Cannot assign to globals[22m
[2m      someUnknownGlobal = true;[22m
[2m      moduleLocal = true;[22m
[2m    };[22m
[2m    // It's possible that this could be an event handler / effect function,[22m
[2m    // but we don't know that and optimistically assume it will only be[22m
[2m    // called by an event handler or effect, where it is allowed to modify globals[22m
[2m    return <div onClick={onClick} />;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component() {[22m
[2m    const $ = _c(1);[22m
[2m    const onClick = _temp;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[32m-     t0 = <div onClick={onClick} />;[39m
[31m+     t0 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    someUnknownGlobal = true;[22m
[2m    moduleLocal = true;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div></div>[22m

[31m[1mFAIL:[22m[39m allow-passing-refs-as-props
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const ref = useRef(null);[22m
[2m    return <Foo ref={ref} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[32m-   const ref = useRef(null);[39m
[31m+   Object.freeze(props);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== ref) {[22m
[32m-     t0 = <Foo ref={ref} />;[39m
[31m+     t0 = ([39m
[31m+       <Foo[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = ref;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m allow-mutating-ref-property-in-callback-passed-to-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender[22m
[2m  import {useRef} from 'react';[22m

[2m  function Component() {[22m
[2m    const ref = useRef(null);[22m

[2m    const onClick = () => {[22m
[2m      if (ref.current !== null) {[22m
[2m        ref.current.value = '';[22m
[2m      }[22m
[2m    };[22m

[2m    return ([22m
[2m      <>[22m
[2m        <input ref={ref} />[22m
[2m        <button onClick={onClick} />[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender[22m
[2m  import { useRef } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(8);[22m
[32m-   const ref = useRef(null);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        if (ref.current !== null) {[22m
[2m          ref.current.value = "";[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== ref) {[22m
[32m-     t1 = <input ref={ref} />;[39m
[31m+     t1 = ([39m
[31m+       <input[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = ref;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== onClick) {[22m
[32m-     t2 = <button onClick={onClick} />;[39m
[31m+     t2 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = onClick;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== t1 || $[6] !== t2) {[22m
[2m      t3 = ([22m
[2m        <>[22m
[2m          {t1}[22m
[2m          {t2}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[5] = t1;[22m
[2m      $[6] = t2;[22m
[2m      $[7] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[7];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input><button></button>[22m

[31m[1mFAIL:[22m[39m allow-mutating-ref-property-in-callback-passed-to-jsx-indirect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender[22m
[2m  import {useRef} from 'react';[22m

[2m  function Component() {[22m
[2m    const ref = useRef(null);[22m

[2m    const setRef = () => {[22m
[2m      if (ref.current !== null) {[22m
[2m        ref.current.value = '';[22m
[2m      }[22m
[2m    };[22m

[2m    const onClick = () => {[22m
[2m      setRef();[22m
[2m    };[22m

[2m    return ([22m
[2m      <>[22m
[2m        <input ref={ref} />[22m
[2m        <button onClick={onClick} />[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender[22m
[2m  import { useRef } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(10);[22m
[32m-   const ref = useRef(null);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        if (ref.current !== null) {[22m
[2m          ref.current.value = "";[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const setRef = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== setRef) {[22m
[2m      t1 = () => {[22m
[2m        setRef();[22m
[2m      };[22m
[2m      $[1] = setRef;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const onClick = t1;[22m
[2m    let t2;[22m
[2m    if ($[3] !== ref) {[22m
[32m-     t2 = <input ref={ref} />;[39m
[31m+     t2 = ([39m
[31m+       <input[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = ref;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== onClick) {[22m
[32m-     t3 = <button onClick={onClick} />;[39m
[31m+     t3 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[5] = onClick;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[7] !== t2 || $[8] !== t3) {[22m
[2m      t4 = ([22m
[2m        <>[22m
[2m          {t2}[22m
[2m          {t3}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[7] = t2;[22m
[2m      $[8] = t3;[22m
[2m      $[9] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[9];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input><button></button>[22m

[31m[1mFAIL:[22m[39m allow-mutating-ref-in-callback-passed-to-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender[22m
[2m  import {useRef} from 'react';[22m

[2m  function Component() {[22m
[2m    const ref = useRef(null);[22m

[2m    const onClick = () => {[22m
[2m      if (ref.current !== null) {[22m
[2m        ref.current = '';[22m
[2m      }[22m
[2m    };[22m

[2m    return ([22m
[2m      <>[22m
[2m        <input ref={ref} />[22m
[2m        <button onClick={onClick} />[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender[22m
[2m  import { useRef } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(8);[22m
[32m-   const ref = useRef(null);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        if (ref.current !== null) {[22m
[2m          ref.current = "";[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const onClick = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== ref) {[22m
[32m-     t1 = <input ref={ref} />;[39m
[31m+     t1 = ([39m
[31m+       <input[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[1] = ref;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[3] !== onClick) {[22m
[32m-     t2 = <button onClick={onClick} />;[39m
[31m+     t2 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = onClick;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== t1 || $[6] !== t2) {[22m
[2m      t3 = ([22m
[2m        <>[22m
[2m          {t1}[22m
[2m          {t2}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[5] = t1;[22m
[2m      $[6] = t2;[22m
[2m      $[7] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[7];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input><button></button>[22m

[31m[1mFAIL:[22m[39m allow-mutating-ref-in-callback-passed-to-jsx-indirect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validateRefAccessDuringRender[22m
[2m  import {useRef} from 'react';[22m

[2m  function Component() {[22m
[2m    const ref = useRef(null);[22m

[2m    const setRef = () => {[22m
[2m      if (ref.current !== null) {[22m
[2m        ref.current = '';[22m
[2m      }[22m
[2m    };[22m

[2m    const onClick = () => {[22m
[2m      setRef();[22m
[2m    };[22m

[2m    return ([22m
[2m      <>[22m
[2m        <input ref={ref} />[22m
[2m        <button onClick={onClick} />[22m
[2m      </>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validateRefAccessDuringRender[22m
[2m  import { useRef } from "react";[22m

[2m  function Component() {[22m
[2m    const $ = _c(10);[22m
[32m-   const ref = useRef(null);[39m
[31m+   const ref = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        if (ref.current !== null) {[22m
[2m          ref.current = "";[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    const setRef = t0;[22m
[2m    let t1;[22m
[2m    if ($[1] !== setRef) {[22m
[2m      t1 = () => {[22m
[2m        setRef();[22m
[2m      };[22m
[2m      $[1] = setRef;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const onClick = t1;[22m
[2m    let t2;[22m
[2m    if ($[3] !== ref) {[22m
[32m-     t2 = <input ref={ref} />;[39m
[31m+     t2 = ([39m
[31m+       <input[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[3] = ref;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    let t3;[22m
[2m    if ($[5] !== onClick) {[22m
[32m-     t3 = <button onClick={onClick} />;[39m
[31m+     t3 = ([39m
[31m+       <button[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[5] = onClick;[22m
[2m      $[6] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[6];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[7] !== t2 || $[8] !== t3) {[22m
[2m      t4 = ([22m
[2m        <>[22m
[2m          {t2}[22m
[2m          {t3}[22m
[2m        </>[22m
[2m      );[22m
[2m      $[7] = t2;[22m
[2m      $[8] = t3;[22m
[2m      $[9] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[9];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <input><button></button>[22m

[31m[1mFAIL:[22m[39m allow-mutate-global-in-effect-fixpoint
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>hello</div>
Forget:
(kind: exception) Cannot assign to read only property 'value' of object '#<Object>'

[31m[1mFAIL:[22m[39m allow-modify-global-in-callback-jsx
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useMemo} from 'react';[22m

[2m  const someGlobal = {value: 0};[22m

[2m  function Component({value}) {[22m
[2m    const onClick = () => {[22m
[2m      someGlobal.value = value;[22m
[2m    };[22m
[2m    return useMemo(() => {[22m
[2m      return <div onClick={onClick}>{someGlobal.value}</div>;[22m
[2m    }, []);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 0}],[22m
[2m    sequentialRenders: [[22m
[2m      {value: 1},[22m
[2m      {value: 1},[22m
[2m      {value: 42},[22m
[2m      {value: 42},[22m
[2m      {value: 0},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useMemo } from "react";[22m

[2m  const someGlobal = { value: 0 };[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = () => {[22m
[2m        someGlobal.value = value;[22m
[2m      };[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const onClick = t1;[22m
[2m    let t2;[22m
[2m    let t3;[22m
[2m    if ($[2] !== onClick) {[22m
[32m-     t3 = <div onClick={onClick}>{someGlobal.value}</div>;[39m
[31m+     t3 = ([39m
[31m+       <div[39m
[31m+         onClick={function () {[39m
[31m+           const $res$ = onClick;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[31m+         {someGlobal.value}[39m
[31m+       </div>[39m
[31m+     );[39m
[2m      $[2] = onClick;[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[2m    t2 = t3;[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: 0 }],[22m
[2m    sequentialRenders: [[22m
[2m      { value: 1 },[22m
[2m      { value: 1 },[22m
[2m      { value: 42 },[22m
[2m      { value: 42 },[22m
[2m      { value: 0 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>0</div>[22m
[2m  <div>0</div>[22m
[2m  <div>0</div>[22m
[2m  <div>0</div>[22m
[2m  <div>0</div>[22m

[31m[1mFAIL:[22m[39m allow-global-reassignment-in-effect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect, useState} from 'react';[22m

[2m  let someGlobal = false;[22m

[2m  function Component() {[22m
[2m    const [state, setState] = useState(someGlobal);[22m

[2m    useEffect(() => {[22m
[2m      someGlobal = true;[22m
[2m    }, []);[22m

[2m    useEffect(() => {[22m
[2m      setState(someGlobal);[22m
[2m    }, [someGlobal]);[22m

[2m    return <div>{String(state)}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect, useState } from "react";[22m

[2m  let someGlobal = false;[22m

[2m  function Component() {[22m
[2m    const $ = _c(5);[22m
[32m-   const [state, setState] = useState(someGlobal);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(someGlobal));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = [];[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[32m-   useEffect(_temp, t0);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(_temp), Object.freeze(t0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = () => {[22m
[2m        setState(someGlobal);[22m
[2m      };[22m
[2m      t2 = [someGlobal];[22m
[2m      $[1] = t1;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[32m-   useEffect(t1, t2);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t1), Object.freeze(t2));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const t3 = String(state);[22m
[2m    let t4;[22m
[2m    if ($[3] !== t3) {[22m
[2m      t4 = <div>{t3}</div>;[22m
[2m      $[3] = t3;[22m
[2m      $[4] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[4];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    someGlobal = true;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>true</div>[22m

[31m[1mFAIL:[22m[39m allow-global-reassignment-in-effect-indirect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useEffect, useState} from 'react';[22m

[2m  let someGlobal = false;[22m

[2m  function Component() {[22m
[2m    const [state, setState] = useState(someGlobal);[22m

[2m    const setGlobal = () => {[22m
[2m      someGlobal = true;[22m
[2m    };[22m
[2m    useEffect(() => {[22m
[2m      setGlobal();[22m
[2m    }, []);[22m

[2m    useEffect(() => {[22m
[2m      setState(someGlobal);[22m
[2m    }, [someGlobal]);[22m

[2m    return <div>{String(state)}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useEffect, useState } from "react";[22m

[2m  let someGlobal = false;[22m

[2m  function Component() {[22m
[2m    const $ = _c(6);[22m
[32m-   const [state, setState] = useState(someGlobal);[39m
[31m+   const [state, setState] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(someGlobal));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const setGlobal = _temp;[22m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = () => {[22m
[2m        setGlobal();[22m
[2m      };[22m
[2m      t1 = [];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[32m-   useEffect(t0, t1);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t0), Object.freeze(t1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t2;[22m
[2m    let t3;[22m
[2m    if ($[2] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t2 = () => {[22m
[2m        setState(someGlobal);[22m
[2m      };[22m
[2m      t3 = [someGlobal];[22m
[2m      $[2] = t2;[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[32m-   useEffect(t2, t3);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useEffect(Object.freeze(t2), Object.freeze(t3));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const t4 = String(state);[22m
[2m    let t5;[22m
[2m    if ($[4] !== t4) {[22m
[2m      t5 = <div>{t4}</div>;[22m
[2m      $[4] = t4;[22m
[2m      $[5] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[5];[22m
[2m    }[22m
[2m    return t5;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    someGlobal = true;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>true</div>[22m

[31m[1mFAIL:[22m[39m allow-global-mutation-in-effect-indirect
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>true</div>
Forget:
(kind: exception) Cannot add property value, object is not extensible

[31m[1mFAIL:[22m[39m allow-global-mutation-in-effect-indirect-usecallback
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>true</div>
Forget:
(kind: exception) Cannot add property value, object is not extensible

[31m[1mFAIL:[22m[39m allocating-primitive-as-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // bar(props.b) is an allocating expression that produces a primitive, which means[22m
[2m  // that Forget should memoize it.[22m
[2m  // Correctness:[22m
[2m  //   - y depends on either bar(props.b) or bar(props.b) + 1[22m
[2m  function AllocatingPrimitiveAsDep(props) {[22m
[2m    let y = foo(bar(props).b + 1);[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // bar(props.b) is an allocating expression that produces a primitive, which means[22m
[2m  // that Forget should memoize it.[22m
[2m  // Correctness:[22m
[2m  //   - y depends on either bar(props.b) or bar(props.b) + 1[22m
[2m  function AllocatingPrimitiveAsDep(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const t0 = bar(props).b + 1;[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = foo(t0);[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m allocating-primitive-as-dep-nested-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // bar(props.b) is an allocating expression that produces a primitive, which means[22m
[2m  // that Forget should memoize it.[22m
[2m  // Correctness:[22m

[2m  import {identity, mutate, setProperty} from 'shared-runtime';[22m

[2m  //   - y depends on either bar(props.b) or bar(props.b) + 1[22m
[2m  function AllocatingPrimitiveAsDepNested(props) {[22m
[2m    let x = {};[22m
[2m    mutate(x);[22m
[2m    let y = identity(identity(props.b) + 1);[22m
[2m    setProperty(x, props.a);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: AllocatingPrimitiveAsDepNested,[22m
[2m    params: [{a: 1, b: 2}],[22m
[2m    sequentialRenders: [[22m
[2m      // change b[22m
[2m      {a: 1, b: 3},[22m
[2m      // change b[22m
[2m      {a: 1, b: 4},[22m
[2m      // change a[22m
[2m      {a: 2, b: 4},[22m
[2m      // change a[22m
[2m      {a: 3, b: 4},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // bar(props.b) is an allocating expression that produces a primitive, which means[22m
[2m  // that Forget should memoize it.[22m
[2m  // Correctness:[22m

[2m  import { identity, mutate, setProperty } from "shared-runtime";[22m

[2m  //   - y depends on either bar(props.b) or bar(props.b) + 1[22m
[2m  function AllocatingPrimitiveAsDepNested(props) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.b || $[1] !== props.a) {[22m
[2m      const x = {};[22m
[2m      mutate(x);[22m
[2m      const t1 = identity(props.b) + 1;[22m
[2m      let t2;[22m
[2m      if ($[3] !== t1) {[22m
[2m        t2 = identity(t1);[22m
[2m        $[3] = t1;[22m
[2m        $[4] = t2;[22m
[2m      } else {[22m
[2m        t2 = $[4];[22m
[2m      }[22m
[2m      const y = t2;[22m
[2m      setProperty(x, props.a);[22m
[2m      t0 = [x, y];[22m
[2m      $[0] = props.b;[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: AllocatingPrimitiveAsDepNested,[22m
[2m    params: [{ a: 1, b: 2 }],[22m
[2m    sequentialRenders: [[22m
[2m      // change b[22m
[2m      { a: 1, b: 3 },[22m
[2m      // change b[22m
[2m      { a: 1, b: 4 },[22m
[2m      // change a[22m
[2m      { a: 2, b: 4 },[22m
[2m      // change a[22m
[2m      { a: 3, b: 4 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"wat0":"joe","wat1":1},4][22m
[2m  [{"wat0":"joe","wat1":1},5][22m
[2m  [{"wat0":"joe","wat1":2},5][22m
[2m  [{"wat0":"joe","wat1":3},5][22m

[31m[1mFAIL:[22m[39m allocating-logical-expression-instruction-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  /**[22m
[2m   * This is a weird case as data has type `BuiltInMixedReadonly`.[22m
[2m   * The only scoped value we currently infer in this program is the[22m
[2m   * PropertyLoad `data?.toString`.[22m
[2m   */[22m
[2m  import {useFragment} from 'shared-runtime';[22m

[2m  function Foo() {[22m
[2m    const data = useFragment();[22m
[2m    return [data?.toString() || ''];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; /**[22m
[2m   * This is a weird case as data has type `BuiltInMixedReadonly`.[22m
[2m   * The only scoped value we currently infer in this program is the[22m
[2m   * PropertyLoad `data?.toString`.[22m
[2m   */[22m
[2m  import { useFragment } from "shared-runtime";[22m

[2m  function Foo() {[22m
[2m    const $ = _c(4);[22m
[32m-   const data = useFragment();[39m
[31m+   const data = (function () {[39m
[31m+     const $res$ = useFragment();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== data) {[22m
[2m      t0 = data?.toString() || "";[22m
[2m      $[0] = data;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["[object Object]"][22m

[31m[1mFAIL:[22m[39m align-scopes-within-nested-valueblock-in-array
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>foo</div><div>{"value":[null,null,null]}</div>
Forget:
(kind: ok) <div>foo</div><div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m align-scopes-reactive-scope-overlaps-try
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {arrayPush, mutate} from 'shared-runtime';[22m

[2m  function useFoo({value}) {[22m
[2m    let items = null;[22m
[2m    try {[22m
[2m      // Mutable range of `items` begins here, but its reactive scope block[22m
[2m      // should be aligned to above the try-block[22m
[2m      items = [];[22m
[2m      arrayPush(items, value);[22m
[2m    } catch {[22m
[2m      // ignore[22m
[2m    }[22m
[2m    mutate(items);[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{value: 2}],[22m
[2m    sequentialRenders: [{value: 2}, {value: 2}, {value: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { arrayPush, mutate } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let items;[22m
[2m    if ($[0] !== value) {[22m
[2m      try {[22m
[2m        items = [];[22m
[2m        arrayPush(items, value);[22m
[2m      } catch {}[22m

[2m      mutate(items);[22m
[2m      $[0] = value;[22m
[2m      $[1] = items;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ value: 2 }],[22m
[2m    sequentialRenders: [{ value: 2 }, { value: 2 }, { value: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [2][22m
[2m  [3][22m

[31m[1mFAIL:[22m[39m align-scopes-reactive-scope-overlaps-label
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {arrayPush} from 'shared-runtime';[22m

[2m  function useFoo({cond, value}) {[22m
[2m    let items;[22m
[2m    label: {[22m
[2m      items = [];[22m
[2m      // Mutable range of `items` begins here, but its reactive scope block[22m
[2m      // should be aligned to above the label-block[22m
[2m      if (cond) break label;[22m
[2m      arrayPush(items, value);[22m
[2m    }[22m
[2m    arrayPush(items, value);[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{cond: true, value: 2}],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true, value: 2},[22m
[2m      {cond: true, value: 2},[22m
[2m      {cond: true, value: 3},[22m
[2m      {cond: false, value: 3},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { arrayPush } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond, value } = t0;[22m
[2m    let items;[22m
[2m    if ($[0] !== cond || $[1] !== value) {[22m
[2m      bb0: {[22m
[2m        items = [];[22m
[2m        if (cond) {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        arrayPush(items, value);[22m
[2m      }[22m

[2m      arrayPush(items, value);[22m
[2m      $[0] = cond;[22m
[2m      $[1] = value;[22m
[2m      $[2] = items;[22m
[2m    } else {[22m
[2m      items = $[2];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ cond: true, value: 2 }],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true, value: 2 },[22m
[2m      { cond: true, value: 2 },[22m
[2m      { cond: true, value: 3 },[22m
[2m      { cond: false, value: 3 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [2][22m
[2m  [3][22m
[2m  [3,3][22m

[31m[1mFAIL:[22m[39m align-scopes-reactive-scope-overlaps-if
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({cond}) {[22m
[2m    let items: any = {};[22m
[2m    b0: {[22m
[2m      if (cond) {[22m
[2m        // Mutable range of `items` begins here, but its reactive scope block[22m
[2m        // should be aligned to above the if-branch[22m
[2m        items = [];[22m
[2m      } else {[22m
[2m        break b0;[22m
[2m      }[22m
[2m      items.push(2);[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{cond: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {cond: true},[22m
[2m      {cond: true},[22m
[2m      {cond: false},[22m
[2m      {cond: false},[22m
[2m      {cond: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = {};[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    let items = t1;[22m
[2m    bb0: if ($[1] !== cond) {[22m
[2m      if (cond) {[22m
[2m        items = [];[22m
[2m      } else {[22m
[2m        break bb0;[22m
[2m      }[22m

[2m      items.push(2);[22m
[2m      $[1] = cond;[22m
[2m      $[2] = items;[22m
[2m    } else {[22m
[2m      items = $[2];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ cond: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { cond: true },[22m
[2m      { cond: true },[22m
[2m      { cond: false },[22m
[2m      { cond: false },[22m
[2m      { cond: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [2][22m
[2m  {}[22m
[2m  {}[22m
[2m  [2][22m

[31m[1mFAIL:[22m[39m align-scopes-nested-block-structure
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate} from 'shared-runtime';[22m
[2m  /**[22m
[2m   * Fixture showing that it's not sufficient to only align direct scoped[22m
[2m   * accesses of a block-fallthrough pair.[22m
[2m   * Below is a simplified view of HIR blocks in this fixture.[22m
[2m   * Note that here, s is mutated in both bb1 and bb4. However, neither[22m
[2m   * bb1 nor bb4 have terminal fallthroughs or are fallthroughs themselves.[22m
[2m   *[22m
[2m   * This means that we need to recursively visit all scopes accessed between[22m
[2m   * a block and its fallthrough and extend the range of those scopes which overlap[22m
[2m   * with an active block/fallthrough pair,[22m
[2m   *[22m
[2m   *  bb0[22m
[2m   *  ┌──────────────┐[22m
[2m   *  │let s = null  │[22m
[2m   *  │test cond1    │[22m
[2m   *  │ <fallthr=bb3>│[22m
[2m   *  └┬─────────────┘[22m
[2m   *   │  bb1[22m
[2m   *   ├─►┌───────┐[22m
[2m   *   │  │s = {} ├────┐[22m
[2m   *   │  └───────┘    │[22m
[2m   *   │  bb2          │[22m
[2m   *   └─►┌───────┐    │[22m
[2m   *      │return;│    │[22m
[2m   *      └───────┘    │[22m
[2m   *  bb3              │[22m
[2m   *  ┌──────────────┐◄┘[22m
[2m   *  │test cond2    │[22m
[2m   *  │ <fallthr=bb5>│[22m
[2m   *  └┬─────────────┘[22m
[2m   *   │  bb4[22m
[2m   *   ├─►┌─────────┐[22m
[2m   *   │  │mutate(s)├─┐[22m
[2m   *   ▼  └─────────┘ │[22m
[2m   *  bb5             │[22m
[2m   *  ┌───────────┐   │[22m
[2m   *  │return s;  │◄──┘[22m
[2m   *  └───────────┘[22m
[2m   */[22m
[2m  function useFoo({cond1, cond2}) {[22m
[2m    let s = null;[22m
[2m    if (cond1) {[22m
[2m      s = {};[22m
[2m    } else {[22m
[2m      return null;[22m
[2m    }[22m

[2m    if (cond2) {[22m
[2m      mutate(s);[22m
[2m    }[22m

[2m    return s;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{cond1: true, cond2: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {cond1: true, cond2: false},[22m
[2m      {cond1: true, cond2: false},[22m
[2m      {cond1: true, cond2: true},[22m
[2m      {cond1: true, cond2: true},[22m
[2m      {cond1: false, cond2: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate } from "shared-runtime";[22m
[2m  /**[22m
[2m   * Fixture showing that it's not sufficient to only align direct scoped[22m
[2m   * accesses of a block-fallthrough pair.[22m
[2m   * Below is a simplified view of HIR blocks in this fixture.[22m
[2m   * Note that here, s is mutated in both bb1 and bb4. However, neither[22m
[2m   * bb1 nor bb4 have terminal fallthroughs or are fallthroughs themselves.[22m
[2m   *[22m
[2m   * This means that we need to recursively visit all scopes accessed between[22m
[2m   * a block and its fallthrough and extend the range of those scopes which overlap[22m
[2m   * with an active block/fallthrough pair,[22m
[2m   *[22m
[2m   *  bb0[22m
[2m   *  ┌──────────────┐[22m
[2m   *  │let s = null  │[22m
[2m   *  │test cond1    │[22m
[2m   *  │ <fallthr=bb3>│[22m
[2m   *  └┬─────────────┘[22m
[2m   *   │  bb1[22m
[2m   *   ├─►┌───────┐[22m
[2m   *   │  │s = {} ├────┐[22m
[2m   *   │  └───────┘    │[22m
[2m   *   │  bb2          │[22m
[2m   *   └─►┌───────┐    │[22m
[2m   *      │return;│    │[22m
[2m   *      └───────┘    │[22m
[2m   *  bb3              │[22m
[2m   *  ┌──────────────┐◄┘[22m
[2m   *  │test cond2    │[22m
[2m   *  │ <fallthr=bb5>│[22m
[2m   *  └┬─────────────┘[22m
[2m   *   │  bb4[22m
[2m   *   ├─►┌─────────┐[22m
[2m   *   │  │mutate(s)├─┐[22m
[2m   *   ▼  └─────────┘ │[22m
[2m   *  bb5             │[22m
[2m   *  ┌───────────┐   │[22m
[2m   *  │return s;  │◄──┘[22m
[2m   *  └───────────┘[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond1, cond2 } = t0;[22m
[2m    let s;[22m
[2m    let t1;[22m
[2m    if ($[0] !== cond1 || $[1] !== cond2) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        if (cond1) {[22m
[2m          s = {};[22m
[2m        } else {[22m
[2m          t1 = null;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        if (cond2) {[22m
[2m          mutate(s);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond1;[22m
[2m      $[1] = cond2;[22m
[2m      $[2] = t1;[22m
[2m      $[3] = s;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m      s = $[3];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return s;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ cond1: true, cond2: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { cond1: true, cond2: false },[22m
[2m      { cond1: true, cond2: false },[22m
[2m      { cond1: true, cond2: true },[22m
[2m      { cond1: true, cond2: true },[22m
[2m      { cond1: false, cond2: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m
[2m  {}[22m
[2m  {"wat0":"joe"}[22m
[2m  {"wat0":"joe"}[22m
[2m  null[22m

[31m[1mFAIL:[22m[39m align-scopes-iife-return-modified-later-logical
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {getNull} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const items = (() => {[22m
[2m      return getNull() ?? [];[22m
[2m    })();[22m
[2m    items.push(props.a);[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: {}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { getNull } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    let items;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      t0 = getNull() ?? [];[22m
[2m      items = t0;[22m

[2m      items.push(props.a);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = items;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      items = $[1];[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return items;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: {} }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{}][22m

[31m[1mFAIL:[22m[39m align-scope-starts-within-cond
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * Similar fixture to `align-scopes-nested-block-structure`, but[22m
[2m   * a simpler case.[22m
[2m   */[22m
[2m  function useFoo(cond) {[22m
[2m    let s = null;[22m
[2m    if (cond) {[22m
[2m      s = {};[22m
[2m    } else {[22m
[2m      return null;[22m
[2m    }[22m
[2m    mutate(s);[22m
[2m    return s;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  /**[22m
[2m   * Similar fixture to `align-scopes-nested-block-structure`, but[22m
[2m   * a simpler case.[22m
[2m   */[22m
[2m  function useFoo(cond) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(cond);[39m
[2m    let s;[22m
[2m    let t0;[22m
[2m    if ($[0] !== cond) {[22m
[2m      t0 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        if (cond) {[22m
[2m          s = {};[22m
[2m        } else {[22m
[2m          t0 = null;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        mutate(s);[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = t0;[22m
[2m      $[2] = s;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m      s = $[2];[22m
[2m    }[22m
[2m    if (t0 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t0;[22m
[2m    }[22m
[2m    return s;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"wat0":"joe"}[22m

[31m[1mFAIL:[22m[39m alias-while
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function foo(cond) {[22m
[2m    let a = {};[22m
[2m    let b = {};[22m
[2m    let c = {};[22m
[2m    while (cond) {[22m
[2m      let z = a;[22m
[2m      a = b;[22m
[2m      b = c;[22m
[2m      c = z;[22m
[2m      mutate(a, b);[22m
[2m    }[22m
[2m    a;[22m
[2m    b;[22m
[2m    c;[22m
[2m    return a;[22m
[2m  }[22m

[2m  function mutate(x, y) {}[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function foo(cond) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(cond);[39m
[2m    let a;[22m
[2m    if ($[0] !== cond) {[22m
[2m      a = {};[22m
[2m      let b = {};[22m
[2m      let c = {};[22m
[2m      while (cond) {[22m
[2m        const z = a;[22m
[2m        a = b;[22m
[2m        b = c;[22m
[2m        c = z;[22m
[2m        mutate(a, b);[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = a;[22m
[2m    } else {[22m
[2m      a = $[1];[22m
[2m    }[22m
[2m    return a;[22m
[2m  }[22m

[32m- function mutate(x, y) {}[39m
[31m+ function mutate(x, y) {[39m
[31m+   Object.freeze(x);[39m
[31m+   Object.freeze(y);[39m
[31m+ }[39m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m alias-computed-load
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function component(a) {[22m
[2m    let x = {a};[22m
[2m    let y = {};[22m

[2m    y.x = x['a'];[22m
[2m    mutate(y);[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function component(a) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[2m    let x;[22m
[2m    if ($[0] !== a) {[22m
[2m      x = { a };[22m
[2m      const y = {};[22m

[2m      y.x = x.a;[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m type-annotations/type-annotation-var-array_.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @enableUseTypeAnnotations[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props: {id: number}) {[22m
[2m    const x: Array<number> = makeArray(props.id);[22m
[2m    const y = x.at(0);[22m
[2m    return y;[22m
[2m  }[22m

[2m  function makeArray<T>(x: T): Array<T> {[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.id) {[22m
[2m      t0 = makeArray(props.id);[22m
[2m      $[0] = props.id;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== x) {[22m
[2m      t1 = x.at(0);[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  function makeArray(x) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(x);[39m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m type-annotations/type-annotation-var-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableUseTypeAnnotations[22m
[2m  function Component(props: {id: number}) {[22m
[2m    const x: number[] = makeArray(props.id);[22m
[2m    const y = x.at(0);[22m
[2m    return y;[22m
[2m  }[22m

[2m  function makeArray<T>(x: T): Array<T> {[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableUseTypeAnnotations[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.id) {[22m
[2m      t0 = makeArray(props.id);[22m
[2m      $[0] = props.id;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== x) {[22m
[2m      t1 = x.at(0);[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  function makeArray(x) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(x);[39m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m type-annotations/type-annotation-as-number_.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @enableUseTypeAnnotations[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props: {id: number}) {[22m
[2m    const x = identity(props.id);[22m
[2m    const y = (x: number);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = identity(props.id);[22m
[2m    const y = (x: number);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m type-annotations/type-annotation-as-number
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableUseTypeAnnotations[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props: {id: number}) {[22m
[2m    const x = identity(props.id);[22m
[2m    const y = x as number;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @enableUseTypeAnnotations[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = identity(props.id);[22m
[2m    const y = x as number;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m type-annotations/type-annotation-as-array_.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @enableUseTypeAnnotations[22m
[2m  import {identity, makeArray} from 'shared-runtime';[22m

[2m  function Component(props: {id: number}) {[22m
[2m    const x = (makeArray(props.id): Array<number>);[22m
[2m    const y = x.at(0);[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity, makeArray } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.id) {[22m
[2m      t0 = makeArray(props.id);[22m
[2m      $[0] = props.id;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = (t0: Array<number>);[22m
[2m    let t1;[22m
[2m    if ($[2] !== x) {[22m
[2m      t1 = x.at(0);[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m type-annotations/type-annotation-as-array
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableUseTypeAnnotations[22m
[2m  function Component(props: {id: number}) {[22m
[2m    const x = makeArray(props.id) as number[];[22m
[2m    const y = x.at(0);[22m
[2m    return y;[22m
[2m  }[22m

[2m  function makeArray<T>(x: T): Array<T> {[22m
[2m    return [x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{id: 42}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableUseTypeAnnotations[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.id) {[22m
[2m      t0 = makeArray(props.id);[22m
[2m      $[0] = props.id;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const x = t0 as number[];[22m
[2m    let t1;[22m
[2m    if ($[2] !== x) {[22m
[2m      t1 = x.at(0);[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    const y = t1;[22m
[2m    return y;[22m
[2m  }[22m

[2m  function makeArray(x) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(x);[39m
[2m    let t0;[22m
[2m    if ($[0] !== x) {[22m
[2m      t0 = [x];[22m
[2m      $[0] = x;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ id: 42 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 42[22m

[31m[1mFAIL:[22m[39m type-annotations/todo_type-annotations-props
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableUseTypeAnnotations[22m
[2m  function useArray(items: Array<number>) {[22m
[2m    // With type information we know that the callback cannot escape[22m
[2m    // and does not need to be memoized, only the result needs to be[22m
[2m    // memoized:[22m
[2m    return items.filter(x => x !== 0);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useArray,[22m
[2m    params: [[1, 0, 2, 0, 3, 0, 42]],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableUseTypeAnnotations[22m
[2m  function useArray(items) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(items);[39m
[2m    let t0;[22m
[2m    if ($[0] !== items) {[22m
[2m      t0 = items.filter(_temp);[22m
[2m      $[0] = items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp(x) {[22m
[2m    return x !== 0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useArray,[22m
[2m    params: [[1, 0, 2, 0, 3, 0, 42]],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1,2,3,42][22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.invalid.invalid-rules-of-hooks-e675f0a672d8
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // Invalid because it's dangerous and might not warn otherwise.[22m
[2m  // This *must* be invalid.[22m
[2m  function renderItem() {[22m
[2m    useState();[22m
[2m  }[22m

[2m  function List(props) {[22m
[2m    return props.items.map(renderItem);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // Invalid because it's dangerous and might not warn otherwise.[22m
[2m  // This *must* be invalid.[22m
[2m  function renderItem() {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  function List(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.items) {[22m
[2m      t0 = props.items.map(renderItem);[22m
[2m      $[0] = props.items;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.invalid.invalid-rules-of-hooks-c59788ef5676
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // Currently invalid because it violates the convention and removes the "taint"[22m
[2m  // from a hook. We *could* make it valid to avoid some false positives but let's[22m
[2m  // ensure that we don't break the "renderItem" and "normalFunctionWithConditionalHook"[22m
[2m  // cases which must remain invalid.[22m
[2m  function normalFunctionWithHook() {[22m
[2m    useHookInsideNormalFunction();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // Currently invalid because it violates the convention and removes the "taint"[22m
[2m  // from a hook. We *could* make it valid to avoid some false positives but let's[22m
[2m  // ensure that we don't break the "renderItem" and "normalFunctionWithConditionalHook"[22m
[2m  // cases which must remain invalid.[22m
[2m  function normalFunctionWithHook() {[22m
[32m-   useHookInsideNormalFunction();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHookInsideNormalFunction();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.invalid.invalid-rules-of-hooks-a63fd4f9dcc0
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // This is invalid because "use"-prefixed functions used in named[22m
[2m  // functions are assumed to be hooks.[22m
[2m  React.unknownFunction(function notAComponent(foo, bar) {[22m
[2m    useProbablyAHook(bar);[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // This is invalid because "use"-prefixed functions used in named[22m
[2m  // functions are assumed to be hooks.[22m
[2m  React.unknownFunction(function notAComponent(foo, bar) {[22m
[32m-   useProbablyAHook(bar);[39m
[31m+   Object.freeze(foo);[39m
[31m+   Object.freeze(bar);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useProbablyAHook(Object.freeze(bar));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.invalid.invalid-rules-of-hooks-5a7ac9a6e8fa
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // These are neither functions nor hooks.[22m
[2m  function _normalFunctionWithHook() {[22m
[2m    useHookInsideNormalFunction();[22m
[2m  }[22m
[2m  function _useNotAHook() {[22m
[2m    useHookInsideNormalFunction();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Passed but should have failed[22m

[2m  // These are neither functions nor hooks.[22m
[2m  function _normalFunctionWithHook() {[22m
[32m-   useHookInsideNormalFunction();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHookInsideNormalFunction();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  function _useNotAHook() {[22m
[32m-   useHookInsideNormalFunction();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHookInsideNormalFunction();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.bail.rules-of-hooks-fadd52c1e460
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Currently invalid.[22m
[2m  // These are variations capturing the current heuristic--[22m
[2m  // we only allow hooks in PascalCase or useFoo functions.[22m
[2m  // We *could* make some of these valid. But before doing it,[22m
[2m  // consider specific cases documented above that contain reasoning.[22m
[2m  function a() {[22m
[2m    useState();[22m
[2m  }[22m
[2m  const whatever = function b() {[22m
[2m    useState();[22m
[2m  };[22m
[2m  const c = () => {[22m
[2m    useState();[22m
[2m  };[22m
[2m  let d = () => useState();[22m
[2m  e = () => {[22m
[2m    useState();[22m
[2m  };[22m
[2m  ({[22m
[2m    f: () => {[22m
[2m      useState();[22m
[2m    },[22m
[2m  });[22m
[2m  ({[22m
[2m    g() {[22m
[2m      useState();[22m
[2m    },[22m
[2m  });[22m
[2m  const {[22m
[2m    j = () => {[22m
[2m      useState();[22m
[2m    },[22m
[2m  } = {};[22m
[2m  ({[22m
[2m    k = () => {[22m
[2m      useState();[22m
[2m    },[22m
[2m  } = {});[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Currently invalid.[22m
[2m  // These are variations capturing the current heuristic--[22m
[2m  // we only allow hooks in PascalCase or useFoo functions.[22m
[2m  // We *could* make some of these valid. But before doing it,[22m
[2m  // consider specific cases documented above that contain reasoning.[22m
[2m  function a() {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  const whatever = function b() {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  const c = () => {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  let d = () => {[22m
[32m-   return useState();[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m
[2m  e = () => {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  ({[22m
[2m    f: () => {[22m
[32m-     useState();[39m
[31m+     (function () {[39m
[31m+       const $res$ = useState();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })();[39m
[2m    },[22m
[2m  });[22m
[2m  ({[22m
[2m    g() {[22m
[2m      useState();[22m
[2m    },[22m
[2m  });[22m
[2m  const {[22m
[2m    j = () => {[22m
[32m-     useState();[39m
[31m+     (function () {[39m
[31m+       const $res$ = useState();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })();[39m
[2m    },[22m
[2m  } = {};[22m
[2m  ({[22m
[2m    k = () => {[22m
[32m-     useState();[39m
[31m+     (function () {[39m
[31m+       const $res$ = useState();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })();[39m
[2m    },[22m
[2m  } = {});[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.bail.rules-of-hooks-e9f9bac89f8f
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because hooks can be used in anonymous arrow-function arguments[22m
[2m  // to forwardRef.[22m
[2m  const FancyButton = React.forwardRef((props, ref) => {[22m
[2m    useHook();[22m
[2m    return <button {...props} ref={ref} />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because hooks can be used in anonymous arrow-function arguments[22m
[2m  // to forwardRef.[22m
[2m  const FancyButton = React.forwardRef((props, ref) => {[22m
[2m    const $ = _c(3);[22m
[32m-   useHook();[39m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(ref);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== props || $[1] !== ref) {[22m
[32m-     t0 = <button {...props} ref={ref} />;[39m
[31m+     t0 = ([39m
[31m+       <button[39m
[31m+         {...props}[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = ref;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.bail.rules-of-hooks-e0a5db3ae21e
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[2m    useState();[22m
[2m  }[22m
[2m  const whatever = function useHook() {[22m
[2m    useState();[22m
[2m  };[22m
[2m  const useHook1 = () => {[22m
[2m    useState();[22m
[2m  };[22m
[2m  let useHook2 = () => useState();[22m
[2m  useHook2 = () => {[22m
[2m    useState();[22m
[2m  };[22m
[2m  ({[22m
[2m    useHook: () => {[22m
[2m      useState();[22m
[2m    },[22m
[2m  });[22m
[2m  ({[22m
[2m    useHook() {[22m
[2m      useState();[22m
[2m    },[22m
[2m  });[22m
[2m  const {[22m
[2m    useHook3 = () => {[22m
[2m      useState();[22m
[2m    },[22m
[2m  } = {};[22m
[2m  ({[22m
[2m    useHook = () => {[22m
[2m      useState();[22m
[2m    },[22m
[2m  } = {});[22m
[2m  Namespace.useHook = () => {[22m
[2m    useState();[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  const whatever = function useHook() {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  const useHook1 = () => {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  let useHook2 = () => {[22m
[32m-   return useState();[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m
[2m  useHook2 = () => {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  ({[22m
[2m    useHook: () => {[22m
[32m-     useState();[39m
[31m+     (function () {[39m
[31m+       const $res$ = useState();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })();[39m
[2m    },[22m
[2m  });[22m
[2m  ({[22m
[2m    useHook() {[22m
[2m      useState();[22m
[2m    },[22m
[2m  });[22m
[2m  const {[22m
[2m    useHook3 = () => {[22m
[32m-     useState();[39m
[31m+     (function () {[39m
[31m+       const $res$ = useState();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })();[39m
[2m    },[22m
[2m  } = {};[22m
[2m  ({[22m
[2m    useHook = () => {[22m
[32m-     useState();[39m
[31m+     (function () {[39m
[31m+       const $res$ = useState();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })();[39m
[2m    },[22m
[2m  } = {});[22m
[2m  Namespace.useHook = () => {[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.bail.rules-of-hooks-6949b255e7eb
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because the neither the conditions before or after the hook affect the hook call[22m
[2m  // Failed prior to implementing BigInt because pathsFromStartToEnd and allPathsFromStartToEnd were too big and had rounding errors[22m
[2m  const useSomeHook = () => {};[22m

[2m  const SomeName = () => {[22m
[2m    const filler = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler2 = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler3 = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler4 = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler5 = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler6 = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler7 = FILLER ?? FILLER ?? FILLER;[22m
[2m    const filler8 = FILLER ?? FILLER ?? FILLER;[22m

[2m    useSomeHook();[22m

[2m    if (anyConditionCanEvenBeFalse) {[22m
[2m      return null;[22m
[2m    }[22m

[2m    return ([22m
[2m      <React.Fragment>[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m        {FILLER ? FILLER : FILLER}[22m
[2m      </React.Fragment>[22m
[2m    );[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because the neither the conditions before or after the hook affect the hook call[22m
[2m  // Failed prior to implementing BigInt because pathsFromStartToEnd and allPathsFromStartToEnd were too big and had rounding errors[22m
[2m  const useSomeHook = () => {};[22m

[2m  const SomeName = () => {[22m
[2m    const $ = _c(1);[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[2m    (FILLER ?? FILLER, FILLER) ?? FILLER;[22m
[32m-[39m
[32m-   useSomeHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useSomeHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    if (anyConditionCanEvenBeFalse) {[22m
[2m      return null;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[2m        <React.Fragment>[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m          {FILLER ? FILLER : FILLER}[22m
[2m        </React.Fragment>[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.bail.rules-of-hooks-28a78701970c
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // React.memo.[22m
[2m  const MemoizedFunction = React.memo(props => {[22m
[2m    useHook();[22m
[2m    return <button {...props} />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // React.memo.[22m
[2m  const MemoizedFunction = React.memo((props) => {[22m
[2m    const $ = _c(2);[22m
[32m-   useHook();[39m
[31m+   Object.freeze(props);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = <button {...props} />;[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/todo.bail.rules-of-hooks-279ac76f53af
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid -- this is a regression test.[22m
[2m  jest.useFakeTimers();[22m
[2m  beforeEach(() => {[22m
[2m    jest.useRealTimers();[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @skip[22m
[2m  // Unsupported input[22m

[2m  // Valid -- this is a regression test.[22m
[2m  jest.useFakeTimers();[22m
[2m  beforeEach(() => {[22m
[32m-   jest.useRealTimers();[39m
[31m+   (function () {[39m
[31m+     const $res$ = jest.useRealTimers();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-eacfcaa6ef89
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // memo.[22m
[2m  const MemoizedFunction = memo(function (props) {[22m
[2m    useHook();[22m
[2m    return <button {...props} />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // memo.[22m
[2m  const MemoizedFunction = memo(function (props) {[22m
[2m    const $ = _c(2);[22m
[32m-   useHook();[39m
[31m+   Object.freeze(props);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== props) {[22m
[2m      t0 = <button {...props} />;[22m
[2m      $[0] = props;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-e66a744cffbe
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // forwardRef.[22m
[2m  const FancyButton = forwardRef(function (props, ref) {[22m
[2m    useHook();[22m
[2m    return <button {...props} ref={ref} />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // forwardRef.[22m
[2m  const FancyButton = forwardRef(function (props, ref) {[22m
[2m    const $ = _c(3);[22m
[32m-   useHook();[39m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(ref);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== props || $[1] !== ref) {[22m
[32m-     t0 = <button {...props} ref={ref} />;[39m
[31m+     t0 = ([39m
[31m+       <button[39m
[31m+         {...props}[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = ref;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-cfdfe5572fc7
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[2m    useHook1();[22m
[2m    useHook2();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[32m-   useHook1();[39m
[32m-   useHook2();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook1();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook2();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-c5d1f3143c4c
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Regression test for incorrectly flagged valid code.[22m
[2m  function RegressionTest() {[22m
[2m    const foo = cond ? a : b;[22m
[2m    useState();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Regression test for incorrectly flagged valid code.[22m
[2m  function RegressionTest() {[22m
[2m    cond ? a : b;[22m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-c1e8c7f4c191
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Is valid but hard to compute by brute-forcing[22m
[2m  function MyComponent() {[22m
[2m    // 40 conditions[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    } else {[22m
[2m    }[22m

[2m    // 10 hooks[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m    useHook();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Is valid but hard to compute by brute-forcing[22m
[2m  function MyComponent() {[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[2m    if (c) {[22m
[2m    }[22m
[32m-[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-9d7879272ff6
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[2m    return useHook1(useHook2());[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[32m-   return useHook1(useHook2());[39m
[31m+   return (function () {[39m
[31m+     const $res$ = useHook1([39m
[31m+       Object.freeze([39m
[31m+         (function () {[39m
[31m+           const $res$ = useHook2();[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         })(),[39m
[31m+       ),[39m
[31m+     );[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-9a47e97b5d13
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // forwardRef.[22m
[2m  const FancyButton = React.forwardRef(function (props, ref) {[22m
[2m    useHook();[22m
[2m    return <button {...props} ref={ref} />;[22m
[2m  });[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Valid because hooks can be used in anonymous function arguments to[22m
[2m  // forwardRef.[22m
[2m  const FancyButton = React.forwardRef(function (props, ref) {[22m
[2m    const $ = _c(3);[22m
[32m-   useHook();[39m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(ref);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== props || $[1] !== ref) {[22m
[32m-     t0 = <button {...props} ref={ref} />;[39m
[31m+     t0 = ([39m
[31m+       <button[39m
[31m+         {...props}[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = ref;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = props;[22m
[2m      $[1] = ref;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  });[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-93dc5d5e538a
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because the loop doesn't change the order of hooks calls.[22m
[2m  function RegressionTest() {[22m
[2m    const res = [];[22m
[2m    const additionalCond = true;[22m
[2m    for (let i = 0; i !== 10 && additionalCond; ++i) {[22m
[2m      res.push(i);[22m
[2m    }[22m
[2m    React.useLayoutEffect(() => {});[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because the loop doesn't change the order of hooks calls.[22m
[2m  function RegressionTest() {[22m
[2m    const res = [];[22m
[2m    for (let i = 0; i !== 10 && true; ++i) {[22m
[2m      res.push(i);[22m
[2m    }[22m
[32m-[39m
[32m-   React.useLayoutEffect(_temp);[39m
[31m+   (function () {[39m
[31m+     const $res$ = React.useLayoutEffect(Object.freeze(_temp));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m
[2m  function _temp() {}[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-844a496db20b
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can use hooks.[22m
[2m  function useHookWithHook() {[22m
[2m    useHook();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can use hooks.[22m
[2m  function useHookWithHook() {[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-69521d94fa03
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because the neither the condition nor the loop affect the hook call.[22m
[2m  function App(props) {[22m
[2m    const someObject = {propA: true};[22m
[2m    for (const propName in someObject) {[22m
[2m      if (propName === true) {[22m
[2m      } else {[22m
[2m      }[22m
[2m    }[22m
[2m    const [myState, setMyState] = useState(null);[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because the neither the condition nor the loop affect the hook call.[22m
[2m  function App(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const someObject = { propA: true };[22m
[2m    for (const propName in someObject) {[22m
[2m      if (propName === true) {[22m
[2m      }[22m
[2m    }[22m
[32m-[39m
[32m-   useState(null);[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState(Object.freeze(null));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-2e405c78cb80
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[2m    useState() && a;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[32m-   useState() && a;[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })() && a;[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-23dc7fffde57
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[2m    return useHook1() + useHook2();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because hooks can call hooks.[22m
[2m  function useHook() {[22m
[32m-   return useHook1() + useHook2();[39m
[31m+   return ([39m
[31m+     (function () {[39m
[31m+       const $res$ = useHook1();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })() +[39m
[31m+     (function () {[39m
[31m+       const $res$ = useHook2();[39m
[31m+       Object.freeze($res$);[39m
[31m+       return $res$;[39m
[31m+     })()[39m
[31m+   );[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-1ff6c3fbbc94
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because components can use hooks.[22m
[2m  function ComponentWithHook() {[22m
[2m    useHook();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because components can use hooks.[22m
[2m  function ComponentWithHook() {[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/rules-of-hooks-0e2214abc294
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Valid because exceptions abort rendering[22m
[2m  function RegressionTest() {[22m
[2m    if (page == null) {[22m
[2m      throw new Error('oh no!');[22m
[2m    }[22m
[2m    useState();[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // Valid because exceptions abort rendering[22m
[2m  function RegressionTest() {[22m
[2m    if (page == null) {[22m
[2m      throw new Error("oh no!");[22m
[2m    }[22m
[32m-[39m
[32m-   useState();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useState();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m rules-of-hooks/allow-props-named-like-hooks
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"val":{"useProperty":true},"children":[2,"[[ cyclic ref *1 ]]",true]}</div>
Forget:
(kind: ok) <div>{"val":"[[ function params=0 ]]","children":[2,{"useProperty":true},true]}</div>

[31m[1mFAIL:[22m[39m rules-of-hooks/allow-locals-named-like-hooks
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {makeObject_Primitives} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    let useFeature = makeObject_Primitives();[22m
[2m    let x;[22m
[2m    if (useFeature) {[22m
[2m      x = [useFeature + useFeature].push(-useFeature);[22m
[2m    }[22m
[2m    let y = useFeature;[22m
[2m    let z = useFeature.useProperty;[22m
[2m    return ([22m
[2m      <Stringify val={useFeature}>[22m
[2m        {x}[22m
[2m        {y}[22m
[2m        {z}[22m
[2m      </Stringify>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { makeObject_Primitives } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    const useFeature = makeObject_Primitives();[22m
[2m    let x;[22m
[2m    if (useFeature) {[22m
[2m      let t0;[22m
[2m      if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t0 = [useFeature + useFeature].push(-useFeature);[22m
[2m        $[0] = t0;[22m
[2m      } else {[22m
[2m        t0 = $[0];[22m
[2m      }[22m
[2m      x = t0;[22m
[2m    }[22m

[2m    const y = useFeature;[22m
[2m    const z = useFeature.useProperty;[22m
[2m    let t0;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[32m-       <Stringify val={useFeature}>[39m
[31m+       <Stringify[39m
[31m+         val={function () {[39m
[31m+           const $res$ = useFeature;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       >[39m
[2m          {x}[22m
[2m          {y}[22m
[2m          {z}[22m
[2m        </Stringify>[22m
[2m      );[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) Stringify is not defined[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-subpath-order3
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Determine that we only need to track p.a here[22m
[2m  // Ordering of access should not matter[22m
[2m  function TestDepsSubpathOrder3(props) {[22m
[2m    let x = {};[22m
[2m    x.c = props.a.b.c;[22m
[2m    x.a = props.a;[22m
[2m    x.b = props.a.b;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestDepsSubpathOrder3,[22m
[2m    params: [{a: {b: {c: 2}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Determine that we only need to track p.a here[22m
[2m  // Ordering of access should not matter[22m
[2m  function TestDepsSubpathOrder3(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = {};[22m
[2m      x.c = props.a.b.c;[22m
[2m      x.a = props.a;[22m
[2m      x.b = props.a.b;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestDepsSubpathOrder3,[22m
[2m    params: [{ a: { b: { c: 2 } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"c":2,"a":{"b":{"c":2}},"b":"[[ cyclic ref *2 ]]"}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-subpath-order2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Determine that we only need to track p.a here[22m
[2m  // Ordering of access should not matter[22m
[2m  function TestDepsSubpathOrder2(props) {[22m
[2m    let x = {};[22m
[2m    x.a = props.a;[22m
[2m    x.b = props.a.b;[22m
[2m    x.c = props.a.b.c;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestDepsSubpathOrder2,[22m
[2m    params: [{a: {b: {c: 2}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Determine that we only need to track p.a here[22m
[2m  // Ordering of access should not matter[22m
[2m  function TestDepsSubpathOrder2(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = {};[22m
[2m      x.a = props.a;[22m
[2m      x.b = props.a.b;[22m
[2m      x.c = props.a.b.c;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestDepsSubpathOrder2,[22m
[2m    params: [{ a: { b: { c: 2 } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":{"b":{"c":2}},"b":"[[ cyclic ref *2 ]]","c":2}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-subpath-order1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Determine that we only need to track p.a here[22m
[2m  // Ordering of access should not matter[22m
[2m  function TestDepsSubpathOrder1(props) {[22m
[2m    let x = {};[22m
[2m    x.b = props.a.b;[22m
[2m    x.a = props.a;[22m
[2m    x.c = props.a.b.c;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestDepsSubpathOrder1,[22m
[2m    params: [{a: {b: {c: 2}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Determine that we only need to track p.a here[22m
[2m  // Ordering of access should not matter[22m
[2m  function TestDepsSubpathOrder1(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = {};[22m
[2m      x.b = props.a.b;[22m
[2m      x.a = props.a;[22m
[2m      x.c = props.a.b.c;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestDepsSubpathOrder1,[22m
[2m    params: [{ a: { b: { c: 2 } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":{"c":2},"a":{"b":"[[ cyclic ref *1 ]]"},"c":2}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-overlap-direct
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Test that we correctly track a subpath if the subpath itself is accessed as[22m
[2m  // a dependency[22m
[2m  function TestOverlappingTracked(props) {[22m
[2m    let x = {};[22m
[2m    x.b = props.a.b;[22m
[2m    x.c = props.a.c;[22m
[2m    x.a = props.a;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestOverlappingTracked,[22m
[2m    params: [{a: {c: 2}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Test that we correctly track a subpath if the subpath itself is accessed as[22m
[2m  // a dependency[22m
[2m  function TestOverlappingTracked(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = {};[22m
[2m      x.b = props.a.b;[22m
[2m      x.c = props.a.c;[22m
[2m      x.a = props.a;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestOverlappingTracked,[22m
[2m    params: [{ a: { c: 2 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"c":2,"a":{"c":2}}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-overlap-descendant
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Test that we correctly track a subpath if the subpath itself is accessed as[22m
[2m  // a dependency[22m
[2m  function TestOverlappingDescendantTracked(props) {[22m
[2m    let x = {};[22m
[2m    x.b = props.a.b.c;[22m
[2m    x.c = props.a.b.c.x.y;[22m
[2m    x.a = props.a;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestOverlappingDescendantTracked,[22m
[2m    params: [{a: {b: {c: {x: {y: 5}}}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Test that we correctly track a subpath if the subpath itself is accessed as[22m
[2m  // a dependency[22m
[2m  function TestOverlappingDescendantTracked(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = {};[22m
[2m      x.b = props.a.b.c;[22m
[2m      x.c = props.a.b.c.x.y;[22m
[2m      x.a = props.a;[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestOverlappingDescendantTracked,[22m
[2m    params: [{ a: { b: { c: { x: { y: 5 } } } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":{"x":{"y":5}},"c":5,"a":{"b":{"c":"[[ cyclic ref *1 ]]"}}}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-nonoverlap-direct
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Test that we can track non-overlapping dependencies separately.[22m
[2m  // (not needed for correctness but for dependency granularity)[22m
[2m  function TestNonOverlappingTracked(props) {[22m
[2m    let x = {};[22m
[2m    x.b = props.a.b;[22m
[2m    x.c = props.a.c;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestNonOverlappingTracked,[22m
[2m    params: [{a: {b: 2, c: 3}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Test that we can track non-overlapping dependencies separately.[22m
[2m  // (not needed for correctness but for dependency granularity)[22m
[2m  function TestNonOverlappingTracked(props) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a.b || $[1] !== props.a.c) {[22m
[2m      x = {};[22m
[2m      x.b = props.a.b;[22m
[2m      x.c = props.a.c;[22m
[2m      $[0] = props.a.b;[22m
[2m      $[1] = props.a.c;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestNonOverlappingTracked,[22m
[2m    params: [{ a: { b: 2, c: 3 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":2,"c":3}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/uncond-nonoverlap-descendant
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Test that we can track non-overlapping dependencies separately.[22m
[2m  // (not needed for correctness but for dependency granularity)[22m
[2m  function TestNonOverlappingDescendantTracked(props) {[22m
[2m    let x = {};[22m
[2m    x.a = props.a.x.y;[22m
[2m    x.b = props.b;[22m
[2m    x.c = props.a.c.x.y.z;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestNonOverlappingDescendantTracked,[22m
[2m    params: [{a: {x: {}, c: {x: {y: {z: 3}}}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Test that we can track non-overlapping dependencies separately.[22m
[2m  // (not needed for correctness but for dependency granularity)[22m
[2m  function TestNonOverlappingDescendantTracked(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a.x.y || $[1] !== props.a.c.x.y.z || $[2] !== props.b) {[22m
[2m      x = {};[22m
[2m      x.a = props.a.x.y;[22m
[2m      x.b = props.b;[22m
[2m      x.c = props.a.c.x.y.z;[22m
[2m      $[0] = props.a.x.y;[22m
[2m      $[1] = props.a.c.x.y.z;[22m
[2m      $[2] = props.b;[22m
[2m      $[3] = x;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: TestNonOverlappingDescendantTracked,[22m
[2m    params: [{ a: { x: {}, c: { x: { y: { z: 3 } } } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"c":3}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/superpath-order2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // When an unconditional dependency `props.a` is the subpath of a conditional[22m
[2m  // dependency `props.a.b`, we can safely overestimate and only track `props.a`[22m
[2m  // as a dependency[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSuperpath2({props, cond}) {[22m
[2m    const x = {};[22m
[2m    if (identity(cond)) {[22m
[2m      x.b = props.a.b;[22m
[2m    }[22m
[2m    x.a = props.a;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSuperpath2,[22m
[2m    params: [{props: {a: null}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {props: {a: null}, cond: false},[22m
[2m      {props: {a: {}}, cond: true},[22m
[2m      {props: {a: {b: 3}}, cond: true},[22m
[2m      {props: {}, cond: false},[22m
[2m      // test that we preserve nullthrows[22m
[2m      {props: {a: {b: undefined}}, cond: true},[22m
[2m      {props: {a: undefined}, cond: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // When an unconditional dependency `props.a` is the subpath of a conditional[22m
[2m  // dependency `props.a.b`, we can safely overestimate and only track `props.a`[22m
[2m  // as a dependency[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSuperpath2(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { props, cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== props.a) {[22m
[2m      x = {};[22m
[2m      if (identity(cond)) {[22m
[2m        x.b = props.a.b;[22m
[2m      }[22m

[2m      x.a = props.a;[22m
[2m      $[0] = cond;[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSuperpath2,[22m
[2m    params: [{ props: { a: null }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { props: { a: null }, cond: false },[22m
[2m      { props: { a: {} }, cond: true },[22m
[2m      { props: { a: { b: 3 } }, cond: true },[22m
[2m      { props: {}, cond: false },[22m
[2m      // test that we preserve nullthrows[22m
[2m      { props: { a: { b: undefined } }, cond: true },[22m
[2m      { props: { a: undefined }, cond: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":null}[22m
[2m  {"a":{}}[22m
[2m  {"b":3,"a":{"b":3}}[22m
[2m  {}[22m
[2m  {"a":{}}[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/superpath-order1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // When an unconditional dependency `props.a` is the subpath of a conditional[22m
[2m  // dependency `props.a.b`, we can safely overestimate and only track `props.a`[22m
[2m  // as a dependency[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSuperpath1({props, cond}) {[22m
[2m    const x = {};[22m
[2m    x.a = props.a;[22m
[2m    if (identity(cond)) {[22m
[2m      x.b = props.a.b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSuperpath1,[22m
[2m    params: [{props: {a: null}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {props: {a: null}, cond: false},[22m
[2m      {props: {a: {}}, cond: true},[22m
[2m      {props: {a: {b: 3}}, cond: true},[22m
[2m      {props: {}, cond: false},[22m
[2m      // test that we preserve nullthrows[22m
[2m      {props: {a: {b: undefined}}, cond: true},[22m
[2m      {props: {a: undefined}, cond: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // When an unconditional dependency `props.a` is the subpath of a conditional[22m
[2m  // dependency `props.a.b`, we can safely overestimate and only track `props.a`[22m
[2m  // as a dependency[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSuperpath1(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { props, cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== props.a || $[1] !== cond) {[22m
[2m      x = {};[22m
[2m      x.a = props.a;[22m
[2m      if (identity(cond)) {[22m
[2m        x.b = props.a.b;[22m
[2m      }[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = cond;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSuperpath1,[22m
[2m    params: [{ props: { a: null }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { props: { a: null }, cond: false },[22m
[2m      { props: { a: {} }, cond: true },[22m
[2m      { props: { a: { b: 3 } }, cond: true },[22m
[2m      { props: {}, cond: false },[22m
[2m      // test that we preserve nullthrows[22m
[2m      { props: { a: { b: undefined } }, cond: true },[22m
[2m      { props: { a: undefined }, cond: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":null}[22m
[2m  {"a":{}}[22m
[2m  {"a":{"b":3},"b":3}[22m
[2m  {}[22m
[2m  {"a":{}}[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/subpath-order2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // When a conditional dependency `props.a` is a subpath of an unconditional[22m
[2m  // dependency `props.a.b`, we can access `props.a` while preserving program[22m
[2m  // semantics (with respect to nullthrows).[22m
[2m  // deps: {`props.a`, `props.a.b`} can further reduce to just `props.a`[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSubpath2(props, other) {[22m
[2m    const x = {};[22m
[2m    if (identity(other)) {[22m
[2m      x.a = props.a;[22m
[2m    }[22m
[2m    x.b = props.a.b;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSubpath2,[22m
[2m    params: [{a: {b: 3}}, false],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // When a conditional dependency `props.a` is a subpath of an unconditional[22m
[2m  // dependency `props.a.b`, we can access `props.a` while preserving program[22m
[2m  // semantics (with respect to nullthrows).[22m
[2m  // deps: {`props.a`, `props.a.b`} can further reduce to just `props.a`[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSubpath2(props, other) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(other);[39m
[2m    let x;[22m
[2m    if ($[0] !== other || $[1] !== props.a) {[22m
[2m      x = {};[22m
[2m      if (identity(other)) {[22m
[2m        x.a = props.a;[22m
[2m      }[22m

[2m      x.b = props.a.b;[22m
[2m      $[0] = other;[22m
[2m      $[1] = props.a;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSubpath2,[22m
[2m    params: [{ a: { b: 3 } }, false],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":3}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/subpath-order1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // When a conditional dependency `props.a` is a subpath of an unconditional[22m
[2m  // dependency `props.a.b`, we can access `props.a` while preserving program[22m
[2m  // semantics (with respect to nullthrows).[22m
[2m  // deps: {`props.a`, `props.a.b`} can further reduce to just `props.a`[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSubpath1(props, cond) {[22m
[2m    const x = {};[22m
[2m    x.b = props.a.b;[22m
[2m    if (identity(cond)) {[22m
[2m      x.a = props.a;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSubpath1,[22m
[2m    params: [{a: {b: 3}}, false],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // When a conditional dependency `props.a` is a subpath of an unconditional[22m
[2m  // dependency `props.a.b`, we can access `props.a` while preserving program[22m
[2m  // semantics (with respect to nullthrows).[22m
[2m  // deps: {`props.a`, `props.a.b`} can further reduce to just `props.a`[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  // ordering of accesses should not matter[22m
[2m  function useConditionalSubpath1(props, cond) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(cond);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a || $[1] !== cond) {[22m
[2m      x = {};[22m
[2m      x.b = props.a.b;[22m
[2m      if (identity(cond)) {[22m
[2m        x.a = props.a;[22m
[2m      }[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = cond;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useConditionalSubpath1,[22m
[2m    params: [{ a: { b: 3 } }, false],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":3}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/reduce-if-exhaustive-poisoned-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, inputHasAB, inputHasABC}) {[22m
[2m    const x = [];[22m
[2m    if (!inputHasABC) {[22m
[2m      x.push(identity(input.a));[22m
[2m      if (!inputHasAB) {[22m
[2m        return null;[22m
[2m      }[22m
[2m      x.push(identity(input.a.b));[22m
[2m    } else {[22m
[2m      x.push(identity(input.a.b.c));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {b: 1}, inputHasAB: false, inputHasABC: false}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, inputHasAB, inputHasABC } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== inputHasABC || $[1] !== input.a || $[2] !== inputHasAB) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (!inputHasABC) {[22m
[2m          let t2;[22m
[2m          if ($[5] !== input.a) {[22m
[2m            t2 = identity(input.a);[22m
[2m            $[5] = input.a;[22m
[2m            $[6] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[6];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m          if (!inputHasAB) {[22m
[2m            t1 = null;[22m
[2m            break bb0;[22m
[2m          }[22m
[2m          let t3;[22m
[2m          if ($[7] !== input.a.b) {[22m
[2m            t3 = identity(input.a.b);[22m
[2m            $[7] = input.a.b;[22m
[2m            $[8] = t3;[22m
[2m          } else {[22m
[2m            t3 = $[8];[22m
[2m          }[22m
[2m          x.push(t3);[22m
[2m        } else {[22m
[2m          let t2;[22m
[2m          if ($[9] !== input.a.b.c) {[22m
[2m            t2 = identity(input.a.b.c);[22m
[2m            $[9] = input.a.b.c;[22m
[2m            $[10] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[10];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = inputHasABC;[22m
[2m      $[1] = input.a;[22m
[2m      $[2] = inputHasAB;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { b: 1 }, inputHasAB: false, inputHasABC: false }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/promote-uncond
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // When a conditional dependency `props.a.b.c` has no unconditional dependency[22m
[2m  // in its subpath or superpath, we should find the nearest unconditional access[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  // and promote it to an unconditional dependency.[22m
[2m  function usePromoteUnconditionalAccessToDependency(props, other) {[22m
[2m    const x = {};[22m
[2m    x.a = props.a.a.a;[22m
[2m    if (identity(other)) {[22m
[2m      x.c = props.a.b.c;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: usePromoteUnconditionalAccessToDependency,[22m
[2m    params: [{a: {a: {a: 3}}}, false],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // When a conditional dependency `props.a.b.c` has no unconditional dependency[22m
[2m  // in its subpath or superpath, we should find the nearest unconditional access[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  // and promote it to an unconditional dependency.[22m
[2m  function usePromoteUnconditionalAccessToDependency(props, other) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(other);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a || $[1] !== other) {[22m
[2m      x = {};[22m
[2m      x.a = props.a.a.a;[22m
[2m      if (identity(other)) {[22m
[2m        x.c = props.a.b.c;[22m
[2m      }[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = other;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: usePromoteUnconditionalAccessToDependency,[22m
[2m    params: [{ a: { a: { a: 3 } } }, false],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"a":3}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/no-uncond
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // When an object's properties are only read conditionally, we should[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  // track the base object as a dependency.[22m
[2m  function useOnlyConditionalDependencies({props, cond}) {[22m
[2m    const x = {};[22m
[2m    if (identity(cond)) {[22m
[2m      x.b = props.a.b;[22m
[2m      x.c = props.a.b.c;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useOnlyConditionalDependencies,[22m
[2m    params: [{props: {a: {b: 2}}, cond: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {props: {a: {b: 2}}, cond: true},[22m
[2m      {props: null, cond: false},[22m
[2m      // check we preserve nullthrows[22m
[2m      {props: {a: {b: {c: undefined}}}, cond: true},[22m
[2m      {props: {a: {b: undefined}}, cond: true},[22m
[2m      {props: {a: {b: {c: undefined}}}, cond: true},[22m
[2m      {props: undefined, cond: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // When an object's properties are only read conditionally, we should[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  // track the base object as a dependency.[22m
[2m  function useOnlyConditionalDependencies(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { props, cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== props) {[22m
[2m      x = {};[22m
[2m      if (identity(cond)) {[22m
[2m        x.b = props.a.b;[22m
[2m        x.c = props.a.b.c;[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = props;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useOnlyConditionalDependencies,[22m
[2m    params: [{ props: { a: { b: 2 } }, cond: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { props: { a: { b: 2 } }, cond: true },[22m
[2m      { props: null, cond: false },[22m
[2m      // check we preserve nullthrows[22m
[2m      { props: { a: { b: { c: undefined } } }, cond: true },[22m
[2m      { props: { a: { b: undefined } }, cond: true },[22m
[2m      { props: { a: { b: { c: undefined } } }, cond: true },[22m
[2m      { props: undefined, cond: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":2}[22m
[2m  {}[22m
[2m  {"b":{}}[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'c') ]][22m
[2m  {"b":{}}[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'a') ]][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/memberexpr-join-optional-chain2
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function Component(props) {[22m
[2m    const x = [];[22m
[2m    x.push(props.items?.length);[22m
[2m    x.push(props.items?.edges?.map?.(render)?.filter?.(Boolean) ?? []);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{items: {edges: null, length: 0}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.items) {[22m
[2m      x = [];[22m
[2m      x.push(props.items?.length);[22m
[2m      x.push(props.items?.edges?.map?.(render)?.filter?.(Boolean) ?? []);[22m
[2m      $[0] = props.items;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ items: { edges: null, length: 0 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [0,[]][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/memberexpr-join-optional-chain
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // To preserve the nullthrows behavior and reactive deps of this code,[22m
[2m  // Forget needs to add `props.a.b` or a subpath as a dependency.[22m
[2m  //[22m
[2m  // (1) Since the reactive block producing x unconditionally read props.a.<...>,[22m
[2m  //     reading `props.a.b` outside of the block would still preserve nullthrows[22m
[2m  //     semantics of source code[22m
[2m  // (2) Technically, props.a, props.a.b, and props.a.b.c are all reactive deps.[22m
[2m  //     However, `props.a?.b` is only dependent on whether `props.a` is nullish,[22m
[2m  //     not its actual value. Since we already preserve nullthrows on `props.a`,[22m
[2m  //     we technically do not need to add `props.a` as a dependency.[22m

[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.a?.b);[22m
[2m    x.push(props.a.b.c);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: {b: {c: 1}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // To preserve the nullthrows behavior and reactive deps of this code,[22m
[2m  // Forget needs to add `props.a.b` or a subpath as a dependency.[22m
[2m  //[22m
[2m  // (1) Since the reactive block producing x unconditionally read props.a.<...>,[22m
[2m  //     reading `props.a.b` outside of the block would still preserve nullthrows[22m
[2m  //     semantics of source code[22m
[2m  // (2) Technically, props.a, props.a.b, and props.a.b.c are all reactive deps.[22m
[2m  //     However, `props.a?.b` is only dependent on whether `props.a` is nullish,[22m
[2m  //     not its actual value. Since we already preserve nullthrows on `props.a`,[22m
[2m  //     we technically do not need to add `props.a` as a dependency.[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = [];[22m
[2m      x.push(props.a?.b);[22m
[2m      x.push(props.a.b.c);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: { b: { c: 1 } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"c":1},1][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/join-uncond-scopes-cond-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // This tests an optimization, NOT a correctness property.[22m
[2m  // When propagating reactive dependencies of an inner scope up to its parent,[22m
[2m  // we prefer to retain granularity.[22m
[2m  //[22m
[2m  // In this test, we check that Forget propagates the inner scope's conditional[22m
[2m  // dependencies (e.g. props.a.b) instead of only its derived minimal[22m
[2m  // unconditional dependencies (e.g. props).[22m
[2m  // ```javascript[22m
[2m  //  scope @0 (deps=[???] decls=[x, y]) {[22m
[2m  //    let y = {};[22m
[2m  //    scope @1 (deps=[props] decls=[x]) {[22m
[2m  //      let x = {};[22m
[2m  //      if (foo) mutate1(x, props.a.b);[22m
[2m  //    }[22m
[2m  //    mutate2(y, props.a.b);[22m
[2m  //  }[22m

[2m  import {CONST_TRUE, setProperty} from 'shared-runtime';[22m

[2m  function useJoinCondDepsInUncondScopes(props) {[22m
[2m    let y = {};[22m
[2m    let x = {};[22m
[2m    if (CONST_TRUE) {[22m
[2m      setProperty(x, props.a.b);[22m
[2m    }[22m
[2m    setProperty(y, props.a.b);[22m
[2m    return [x, y];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useJoinCondDepsInUncondScopes,[22m
[2m    params: [{a: {b: 3}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // This tests an optimization, NOT a correctness property.[22m
[2m  // When propagating reactive dependencies of an inner scope up to its parent,[22m
[2m  // we prefer to retain granularity.[22m
[2m  //[22m
[2m  // In this test, we check that Forget propagates the inner scope's conditional[22m
[2m  // dependencies (e.g. props.a.b) instead of only its derived minimal[22m
[2m  // unconditional dependencies (e.g. props).[22m
[2m  // ```javascript[22m
[2m  //  scope @0 (deps=[???] decls=[x, y]) {[22m
[2m  //    let y = {};[22m
[2m  //    scope @1 (deps=[props] decls=[x]) {[22m
[2m  //      let x = {};[22m
[2m  //      if (foo) mutate1(x, props.a.b);[22m
[2m  //    }[22m
[2m  //    mutate2(y, props.a.b);[22m
[2m  //  }[22m

[2m  import { CONST_TRUE, setProperty } from "shared-runtime";[22m

[2m  function useJoinCondDepsInUncondScopes(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.a.b) {[22m
[2m      const y = {};[22m
[2m      let x;[22m
[2m      if ($[2] !== props) {[22m
[2m        x = {};[22m
[2m        if (CONST_TRUE) {[22m
[2m          setProperty(x, props.a.b);[22m
[2m        }[22m
[2m        $[2] = props;[22m
[2m        $[3] = x;[22m
[2m      } else {[22m
[2m        x = $[3];[22m
[2m      }[22m

[2m      setProperty(y, props.a.b);[22m
[2m      t0 = [x, y];[22m
[2m      $[0] = props.a.b;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useJoinCondDepsInUncondScopes,[22m
[2m    params: [{ a: { b: 3 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"wat0":3},{"wat0":3}][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/conditional-member-expr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // To preserve the nullthrows behavior and reactive deps of this code,[22m
[2m  // Forget needs to add `props.a` as a dependency (since `props.a.b` is[22m
[2m  // a conditional dependency, i.e. gated behind control flow)[22m

[2m  function Component(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props.a?.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{a: null}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // To preserve the nullthrows behavior and reactive deps of this code,[22m
[2m  // Forget needs to add `props.a` as a dependency (since `props.a.b` is[22m
[2m  // a conditional dependency, i.e. gated behind control flow)[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props.a) {[22m
[2m      x = [];[22m
[2m      x.push(props.a?.b);[22m
[2m      $[0] = props.a;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ a: null }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cond-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // Some reactive scopes are created within a conditional. If a child scope[22m
[2m  // is within a conditional, its reactive dependencies should be propagated[22m
[2m  // as conditionals[22m
[2m  //[22m
[2m  // In this test:[22m
[2m  // ```javascript[22m
[2m  // scope @0 (deps=[???] decls=[x]) {[22m
[2m  //   const x = {};[22m
[2m  //   if (foo) {[22m
[2m  //     scope @1 (deps=[props.a.b] decls=[tmp]) {[22m
[2m  //       const tmp = bar(props.a.b);[22m
[2m  //     }[22m
[2m  //     x.a = tmp;[22m
[2m  //   }[22m
[2m  // }[22m
[2m  // return x;[22m
[2m  // ```[22m

[2m  import {CONST_FALSE, identity} from 'shared-runtime';[22m

[2m  function useReactiveDepsInCondScope(props) {[22m
[2m    let x = {};[22m
[2m    if (CONST_FALSE) {[22m
[2m      let tmp = identity(props.a.b);[22m
[2m      x.a = tmp;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useReactiveDepsInCondScope,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // Some reactive scopes are created within a conditional. If a child scope[22m
[2m  // is within a conditional, its reactive dependencies should be propagated[22m
[2m  // as conditionals[22m
[2m  //[22m
[2m  // In this test:[22m
[2m  // ```javascript[22m
[2m  // scope @0 (deps=[???] decls=[x]) {[22m
[2m  //   const x = {};[22m
[2m  //   if (foo) {[22m
[2m  //     scope @1 (deps=[props.a.b] decls=[tmp]) {[22m
[2m  //       const tmp = bar(props.a.b);[22m
[2m  //     }[22m
[2m  //     x.a = tmp;[22m
[2m  //   }[22m
[2m  // }[22m
[2m  // return x;[22m
[2m  // ```[22m

[2m  import { CONST_FALSE, identity } from "shared-runtime";[22m

[2m  function useReactiveDepsInCondScope(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = {};[22m
[2m      if (CONST_FALSE) {[22m
[2m        let t0;[22m
[2m        if ($[2] !== props.a.b) {[22m
[2m          t0 = identity(props.a.b);[22m
[2m          $[2] = props.a.b;[22m
[2m          $[3] = t0;[22m
[2m        } else {[22m
[2m          t0 = $[3];[22m
[2m        }[22m
[2m        const tmp = t0;[22m
[2m        x.a = tmp;[22m
[2m      }[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useReactiveDepsInCondScope,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-switch-missing-default
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should NOT be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x if it is not accessed in the default case.[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  function useCondDepInSwitchMissingDefault(props, other) {[22m
[2m    const x = {};[22m
[2m    switch (identity(other)) {[22m
[2m      case 1:[22m
[2m        x.a = props.a.b;[22m
[2m        break;[22m
[2m      case 2:[22m
[2m        x.b = props.a.b;[22m
[2m        break;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInSwitchMissingDefault,[22m
[2m    params: [{a: {b: 2}}, 3],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should NOT be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x if it is not accessed in the default case.[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  function useCondDepInSwitchMissingDefault(props, other) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(other);[39m
[2m    let x;[22m
[2m    if ($[0] !== other || $[1] !== props) {[22m
[2m      x = {};[22m
[2m      bb0: switch (identity(other)) {[22m
[2m        case 1: {[22m
[2m          x.a = props.a.b;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case 2: {[22m
[2m          x.b = props.a.b;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = other;[22m
[2m      $[1] = props;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInSwitchMissingDefault,[22m
[2m    params: [{ a: { b: 2 } }, 3],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-switch-missing-case
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should NOT be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x if it is not accessed in every path[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  function useCondDepInSwitchMissingCase(props, other) {[22m
[2m    const x = {};[22m
[2m    switch (identity(other)) {[22m
[2m      case 1:[22m
[2m        x.a = props.a.b;[22m
[2m        break;[22m
[2m      case 2:[22m
[2m        x.b = 42;[22m
[2m        break;[22m
[2m      default:[22m
[2m        x.c = props.a.b;[22m
[2m        break;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInSwitchMissingCase,[22m
[2m    params: [{a: {b: 2}}, 2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should NOT be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x if it is not accessed in every path[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  function useCondDepInSwitchMissingCase(props, other) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(other);[39m
[2m    let x;[22m
[2m    if ($[0] !== other || $[1] !== props) {[22m
[2m      x = {};[22m
[2m      bb0: switch (identity(other)) {[22m
[2m        case 1: {[22m
[2m          x.a = props.a.b;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case 2: {[22m
[2m          x.b = 42;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        default: {[22m
[2m          x.c = props.a.b;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = other;[22m
[2m      $[1] = props;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInSwitchMissingCase,[22m
[2m    params: [{ a: { b: 2 } }, 2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":42}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-switch-exhaustive
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  function useCondDepInSwitch(props, other) {[22m
[2m    const x = {};[22m
[2m    switch (identity(other)) {[22m
[2m      case 1:[22m
[2m        x.a = props.a.b;[22m
[2m        break;[22m
[2m      case 2:[22m
[2m        x.b = props.a.b;[22m
[2m        break;[22m
[2m      default:[22m
[2m        x.c = props.a.b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInSwitch,[22m
[2m    params: [{a: {b: 2}}, 2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  function useCondDepInSwitch(props, other) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(other);[39m
[2m    let x;[22m
[2m    if ($[0] !== other || $[1] !== props.a.b) {[22m
[2m      x = {};[22m
[2m      bb0: switch (identity(other)) {[22m
[2m        case 1: {[22m
[2m          x.a = props.a.b;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        case 2: {[22m
[2m          x.b = props.a.b;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        default: {[22m
[2m          x.c = props.a.b;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = other;[22m
[2m      $[1] = props.a.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInSwitch,[22m
[2m    params: [{ a: { b: 2 } }, 2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":2}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-nested-ifelse
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import {getNull, identity} from 'shared-runtime';[22m

[2m  function useCondDepInNestedIfElse(props, cond) {[22m
[2m    const x = {};[22m
[2m    if (identity(cond)) {[22m
[2m      if (getNull()) {[22m
[2m        x.a = props.a.b;[22m
[2m      } else {[22m
[2m        x.b = props.a.b;[22m
[2m      }[22m
[2m    } else if (identity(cond)) {[22m
[2m      x.c = props.a.b;[22m
[2m    } else {[22m
[2m      x.d = props.a.b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInNestedIfElse,[22m
[2m    params: [{a: {b: 2}}, true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import { getNull, identity } from "shared-runtime";[22m

[2m  function useCondDepInNestedIfElse(props, cond) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(cond);[39m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== props.a.b) {[22m
[2m      x = {};[22m
[2m      if (identity(cond)) {[22m
[2m        if (getNull()) {[22m
[2m          x.a = props.a.b;[22m
[2m        } else {[22m
[2m          x.b = props.a.b;[22m
[2m        }[22m
[2m      } else {[22m
[2m        if (identity(cond)) {[22m
[2m          x.c = props.a.b;[22m
[2m        } else {[22m
[2m          x.d = props.a.b;[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = props.a.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInNestedIfElse,[22m
[2m    params: [{ a: { b: 2 } }, true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":2}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-nested-ifelse-missing
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should NOT be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x if it is not accessed in every path[22m

[2m  import {identity, getNull} from 'shared-runtime';[22m

[2m  function useCondDepInNestedIfElse(props, cond) {[22m
[2m    const x = {};[22m
[2m    if (identity(cond)) {[22m
[2m      if (getNull()) {[22m
[2m        x.a = props.a.b;[22m
[2m      }[22m
[2m    } else {[22m
[2m      x.d = props.a.b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInNestedIfElse,[22m
[2m    params: [{a: {b: 2}}, true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should NOT be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x if it is not accessed in every path[22m

[2m  import { identity, getNull } from "shared-runtime";[22m

[2m  function useCondDepInNestedIfElse(props, cond) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(cond);[39m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== props) {[22m
[2m      x = {};[22m
[2m      if (identity(cond)) {[22m
[2m        if (getNull()) {[22m
[2m          x.a = props.a.b;[22m
[2m        }[22m
[2m      } else {[22m
[2m        x.d = props.a.b;[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = props;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInNestedIfElse,[22m
[2m    params: [{ a: { b: 2 } }, true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-ifelse
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import {identity} from 'shared-runtime';[22m

[2m  function useCondDepInDirectIfElse(props, cond) {[22m
[2m    const x = {};[22m
[2m    if (identity(cond)) {[22m
[2m      x.b = props.a.b;[22m
[2m    } else {[22m
[2m      x.c = props.a.b;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInDirectIfElse,[22m
[2m    params: [{a: {b: 2}}, true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import { identity } from "shared-runtime";[22m

[2m  function useCondDepInDirectIfElse(props, cond) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(cond);[39m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== props.a.b) {[22m
[2m      x = {};[22m
[2m      if (identity(cond)) {[22m
[2m        x.b = props.a.b;[22m
[2m      } else {[22m
[2m        x.c = props.a.b;[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = props.a.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInDirectIfElse,[22m
[2m    params: [{ a: { b: 2 } }, true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"b":2}[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/cfg-condexpr
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import {identity, addOne} from 'shared-runtime';[22m

[2m  function useCondDepInConditionalExpr(props, cond) {[22m
[2m    const x = identity(cond) ? addOne(props.a.b) : identity(props.a.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInConditionalExpr,[22m
[2m    params: [{a: {b: 2}}, true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // props.a.b should be added as a unconditional dependency to the reactive[22m
[2m  // scope that produces x, since it is accessed unconditionally in all cfg[22m
[2m  // paths[22m

[2m  import { identity, addOne } from "shared-runtime";[22m

[2m  function useCondDepInConditionalExpr(props, cond) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(props);[39m
[31m+   Object.freeze(cond);[39m
[2m    let t0;[22m
[2m    if ($[0] !== cond || $[1] !== props.a.b) {[22m
[2m      t0 = identity(cond) ? addOne(props.a.b) : identity(props.a.b);[22m
[2m      $[0] = cond;[22m
[2m      $[1] = props.a.b;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    const x = t0;[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useCondDepInConditionalExpr,[22m
[2m    params: [{ a: { b: 2 } }, true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 3[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/throw-before-scope-starts
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {arrayPush} from 'shared-runtime';[22m

[2m  function useFoo({input, cond}) {[22m
[2m    if (cond) {[22m
[2m      throw new Error('throw with error!');[22m
[2m    }[22m

[2m    // unconditional[22m
[2m    const x = [];[22m
[2m    arrayPush(x, input.a.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: null, cond: true},[22m
[2m      {input: {a: {b: 2}}, cond: false},[22m
[2m      {input: null, cond: true},[22m
[2m      // preserve nullthrows[22m
[2m      {input: {}, cond: false},[22m
[2m      {input: {a: {b: null}}, cond: false},[22m
[2m      {input: {a: null}, cond: false},[22m
[2m      {input: {a: {b: 3}}, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { arrayPush } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond } = t0;[22m
[2m    if (cond) {[22m
[2m      throw new Error("throw with error!");[22m
[2m    }[22m
[2m    let x;[22m
[2m    if ($[0] !== input.a.b) {[22m
[2m      x = [];[22m
[2m      arrayPush(x, input.a.b);[22m
[2m      $[0] = input.a.b;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: null, cond: true },[22m
[2m      { input: { a: { b: 2 } }, cond: false },[22m
[2m      { input: null, cond: true },[22m
[2m      // preserve nullthrows[22m
[2m      { input: {}, cond: false },[22m
[2m      { input: { a: { b: null } }, cond: false },[22m
[2m      { input: { a: null }, cond: false },[22m
[2m      { input: { a: { b: 3 } }, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[ (exception in render) Error: throw with error! ]][22m
[2m  [[ (exception in render) Error: throw with error! ]][22m
[2m  [[ (exception in render) Error: throw with error! ]][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [3][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/return-before-scope-starts
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {arrayPush} from 'shared-runtime';[22m

[2m  function useFoo({input, cond}) {[22m
[2m    if (cond) {[22m
[2m      return {result: 'early return'};[22m
[2m    }[22m

[2m    // unconditional[22m
[2m    const x = [];[22m
[2m    arrayPush(x, input.a.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: null, cond: true},[22m
[2m      {input: {a: {b: 2}}, cond: false},[22m
[2m      {input: null, cond: true},[22m
[2m      // preserve nullthrows[22m
[2m      {input: {}, cond: false},[22m
[2m      {input: {a: {b: null}}, cond: false},[22m
[2m      {input: {a: null}, cond: false},[22m
[2m      {input: {a: {b: 3}}, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { arrayPush } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond } = t0;[22m
[2m    if (cond) {[22m
[2m      let t1;[22m
[2m      if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m        t1 = { result: "early return" };[22m
[2m        $[0] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[0];[22m
[2m      }[22m
[2m      return t1;[22m
[2m    }[22m
[2m    let x;[22m
[2m    if ($[1] !== input.a.b) {[22m
[2m      x = [];[22m
[2m      arrayPush(x, input.a.b);[22m
[2m      $[1] = input.a.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: null, cond: true },[22m
[2m      { input: { a: { b: 2 } }, cond: false },[22m
[2m      { input: null, cond: true },[22m
[2m      // preserve nullthrows[22m
[2m      { input: {}, cond: false },[22m
[2m      { input: { a: { b: null } }, cond: false },[22m
[2m      { input: { a: null }, cond: false },[22m
[2m      { input: { a: { b: 3 } }, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"result":"early return"}[22m
[2m  [2][22m
[2m  {"result":"early return"}[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [3][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/reduce-if-exhaustive-nonpoisoned-deps1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, cond2, cond1}) {[22m
[2m    const x = [];[22m
[2m    if (cond1) {[22m
[2m      if (!cond2) {[22m
[2m        x.push(identity(input.a.b));[22m
[2m        return null;[22m
[2m      } else {[22m
[2m        x.push(identity(input.a.b));[22m
[2m      }[22m
[2m    } else {[22m
[2m      x.push(identity(input.a.b));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {b: 1}, cond1: true, cond2: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 1}}, cond1: true, cond2: true},[22m
[2m      {input: null, cond1: true, cond2: false},[22m
[2m      // preserve nullthrows[22m
[2m      {input: {a: {b: undefined}}, cond1: true, cond2: true},[22m
[2m      {input: {a: null}, cond1: true, cond2: true},[22m
[2m      {input: {a: {b: undefined}}, cond1: true, cond2: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond2, cond1 } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== cond1 || $[1] !== cond2 || $[2] !== input.a.b) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (cond1) {[22m
[2m          if (!cond2) {[22m
[2m            let t2;[22m
[2m            if ($[5] !== input.a.b) {[22m
[2m              t2 = identity(input.a.b);[22m
[2m              $[5] = input.a.b;[22m
[2m              $[6] = t2;[22m
[2m            } else {[22m
[2m              t2 = $[6];[22m
[2m            }[22m
[2m            x.push(t2);[22m
[2m            t1 = null;[22m
[2m            break bb0;[22m
[2m          } else {[22m
[2m            let t2;[22m
[2m            if ($[7] !== input.a.b) {[22m
[2m              t2 = identity(input.a.b);[22m
[2m              $[7] = input.a.b;[22m
[2m              $[8] = t2;[22m
[2m            } else {[22m
[2m              t2 = $[8];[22m
[2m            }[22m
[2m            x.push(t2);[22m
[2m          }[22m
[2m        } else {[22m
[2m          let t2;[22m
[2m          if ($[9] !== input.a.b) {[22m
[2m            t2 = identity(input.a.b);[22m
[2m            $[9] = input.a.b;[22m
[2m            $[10] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[10];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond1;[22m
[2m      $[1] = cond2;[22m
[2m      $[2] = input.a.b;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { b: 1 }, cond1: true, cond2: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 1 } }, cond1: true, cond2: true },[22m
[2m      { input: null, cond1: true, cond2: false },[22m
[2m      // preserve nullthrows[22m
[2m      { input: { a: { b: undefined } }, cond1: true, cond2: true },[22m
[2m      { input: { a: null }, cond1: true, cond2: true },[22m
[2m      { input: { a: { b: undefined } }, cond1: true, cond2: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'a') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [null][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/reduce-if-exhaustive-nonpoisoned-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, hasAB, returnNull}) {[22m
[2m    const x = [];[22m
[2m    if (!hasAB) {[22m
[2m      x.push(identity(input.a));[22m
[2m      if (!returnNull) {[22m
[2m        return null;[22m
[2m      }[22m
[2m    } else {[22m
[2m      x.push(identity(input.a.b));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {b: 1}, hasAB: false, returnNull: false}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, hasAB, returnNull } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== hasAB || $[1] !== input.a || $[2] !== returnNull) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (!hasAB) {[22m
[2m          let t2;[22m
[2m          if ($[5] !== input.a) {[22m
[2m            t2 = identity(input.a);[22m
[2m            $[5] = input.a;[22m
[2m            $[6] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[6];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m          if (!returnNull) {[22m
[2m            t1 = null;[22m
[2m            break bb0;[22m
[2m          }[22m
[2m        } else {[22m
[2m          let t2;[22m
[2m          if ($[7] !== input.a.b) {[22m
[2m            t2 = identity(input.a.b);[22m
[2m            $[7] = input.a.b;[22m
[2m            $[8] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[8];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = hasAB;[22m
[2m      $[1] = input.a;[22m
[2m      $[2] = returnNull;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { b: 1 }, hasAB: false, returnNull: false }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) null[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/jump-target-within-scope-loop-break
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({input, max}) {[22m
[2m    const x = [];[22m
[2m    let i = 0;[22m
[2m    while (true) {[22m
[2m      i += 1;[22m
[2m      if (i > max) {[22m
[2m        break;[22m
[2m      }[22m
[2m    }[22m
[2m    x.push(i);[22m
[2m    x.push(input.a.b); // unconditional[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, max: 8}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 2}}, max: 8},[22m
[2m      // preserve nullthrows[22m
[2m      {input: null, max: 8},[22m
[2m      {input: {}, max: 8},[22m
[2m      {input: {a: {b: null}}, max: 8},[22m
[2m      {input: {a: null}, max: 8},[22m
[2m      {input: {a: {b: 3}}, max: 8},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, max } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== max || $[1] !== input.a.b) {[22m
[2m      x = [];[22m
[2m      let i = 0;[22m
[2m      while (true) {[22m
[2m        i = i + 1;[22m
[2m        if (i > max) {[22m
[2m          break;[22m
[2m        }[22m
[2m      }[22m

[2m      x.push(i);[22m
[2m      x.push(input.a.b);[22m
[2m      $[0] = max;[22m
[2m      $[1] = input.a.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, max: 8 }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 2 } }, max: 8 },[22m
[2m      // preserve nullthrows[22m
[2m      { input: null, max: 8 },[22m
[2m      { input: {}, max: 8 },[22m
[2m      { input: { a: { b: null } }, max: 8 },[22m
[2m      { input: { a: null }, max: 8 },[22m
[2m      { input: { a: { b: 3 } }, max: 8 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [9,2][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'a') ]][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [9,null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [9,3][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/jump-target-within-scope-label
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({input, cond}) {[22m
[2m    const x = [];[22m
[2m    label: {[22m
[2m      if (cond) {[22m
[2m        break label;[22m
[2m      }[22m
[2m    }[22m
[2m    x.push(input.a.b); // unconditional[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 2}}, cond: false},[22m
[2m      // preserve nullthrows[22m
[2m      {input: null, cond: false},[22m
[2m      {input: null, cond: true},[22m
[2m      {input: {}, cond: false},[22m
[2m      {input: {a: {b: null}}, cond: false},[22m
[2m      {input: {a: null}, cond: false},[22m
[2m      {input: {a: {b: 3}}, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== input.a.b) {[22m
[2m      x = [];[22m
[2m      bb0: if (cond) {[22m
[2m        break bb0;[22m
[2m      }[22m

[2m      x.push(input.a.b);[22m
[2m      $[0] = cond;[22m
[2m      $[1] = input.a.b;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 2 } }, cond: false },[22m
[2m      // preserve nullthrows[22m
[2m      { input: null, cond: false },[22m
[2m      { input: null, cond: true },[22m
[2m      { input: {}, cond: false },[22m
[2m      { input: { a: { b: null } }, cond: false },[22m
[2m      { input: { a: null }, cond: false },[22m
[2m      { input: { a: { b: 3 } }, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'a') ]][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'a') ]][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [3][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-unpoisoned/else-branch-scope-unpoisoned
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, cond}) {[22m
[2m    const x = [];[22m
[2m    label: {[22m
[2m      if (cond) {[22m
[2m        break label;[22m
[2m      } else {[22m
[2m        x.push(identity(input.a.b));[22m
[2m      }[22m
[2m    }[22m
[2m    return x[0];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: null, cond: true},[22m
[2m      {input: {a: {b: 2}}, cond: false},[22m
[2m      {input: null, cond: true},[22m
[2m      // preserve nullthrows[22m
[2m      {input: {}, cond: false},[22m
[2m      {input: {a: {b: null}}, cond: false},[22m
[2m      {input: {a: null}, cond: false},[22m
[2m      {input: {a: {b: 3}}, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== input) {[22m
[2m      x = [];[22m
[2m      bb0: if (cond) {[22m
[2m        break bb0;[22m
[2m      } else {[22m
[2m        let t1;[22m
[2m        if ($[3] !== input.a.b) {[22m
[2m          t1 = identity(input.a.b);[22m
[2m          $[3] = input.a.b;[22m
[2m          $[4] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[4];[22m
[2m        }[22m
[2m        x.push(t1);[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = input;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x[0];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: null, cond: true },[22m
[2m      { input: { a: { b: 2 } }, cond: false },[22m
[2m      { input: null, cond: true },[22m
[2m      // preserve nullthrows[22m
[2m      { input: {}, cond: false },[22m
[2m      { input: { a: { b: null } }, cond: false },[22m
[2m      { input: { a: null }, cond: false },[22m
[2m      { input: { a: { b: 3 } }, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m
[2m  2[22m

[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  null[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  3[22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/return-poisons-outer-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, cond}) {[22m
[2m    const x = [];[22m
[2m    if (cond) {[22m
[2m      return null;[22m
[2m    }[22m
[2m    x.push(identity(input.a.b));[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 2}}, cond: false},[22m
[2m      // preserve nullthrows[22m
[2m      {input: null, cond: false},[22m
[2m      {input: null, cond: true},[22m
[2m      {input: {}, cond: false},[22m
[2m      {input: {a: {b: null}}, cond: false},[22m
[2m      {input: {a: null}, cond: false},[22m
[2m      {input: {a: {b: 3}}, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== cond || $[1] !== input) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (cond) {[22m
[2m          t1 = null;[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        let t2;[22m
[2m        if ($[4] !== input.a.b) {[22m
[2m          t2 = identity(input.a.b);[22m
[2m          $[4] = input.a.b;[22m
[2m          $[5] = t2;[22m
[2m        } else {[22m
[2m          t2 = $[5];[22m
[2m        }[22m
[2m        x.push(t2);[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = input;[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 2 } }, cond: false },[22m
[2m      // preserve nullthrows[22m
[2m      { input: null, cond: false },[22m
[2m      { input: null, cond: true },[22m
[2m      { input: {}, cond: false },[22m
[2m      { input: { a: { b: null } }, cond: false },[22m
[2m      { input: { a: null }, cond: false },[22m
[2m      { input: { a: { b: 3 } }, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'a') ]][22m
[2m  null[22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [3][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/return-in-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({obj, objIsNull}) {[22m
[2m    const x = [];[22m
[2m    if (objIsNull) {[22m
[2m      return;[22m
[2m    }[22m
[2m    x.push(obj.b);[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{obj: null, objIsNull: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {obj: null, objIsNull: true},[22m
[2m      {obj: {a: 2}, objIsNull: false},[22m
[2m      // check we preserve nullthrows[22m
[2m      {obj: {a: undefined}, objIsNull: false},[22m
[2m      {obj: undefined, objIsNull: false},[22m
[2m      {obj: {a: undefined}, objIsNull: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { obj, objIsNull } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== objIsNull || $[1] !== obj) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (objIsNull) {[22m
[2m          t1 = undefined;[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        x.push(obj.b);[22m
[2m      }[22m
[2m      $[0] = objIsNull;[22m
[2m      $[1] = obj;[22m
[2m      $[2] = x;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ obj: null, objIsNull: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { obj: null, objIsNull: true },[22m
[2m      { obj: { a: 2 }, objIsNull: false },[22m
[2m      // check we preserve nullthrows[22m
[2m      { obj: { a: undefined }, objIsNull: false },[22m
[2m      { obj: undefined, objIsNull: false },[22m
[2m      { obj: { a: undefined }, objIsNull: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m
[2m  [null][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/reduce-if-nonexhaustive-poisoned-deps1
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, cond, hasAB}) {[22m
[2m    const x = [];[22m
[2m    if (cond) {[22m
[2m      if (!hasAB) {[22m
[2m        return null;[22m
[2m      } else {[22m
[2m        x.push(identity(input.a.b));[22m
[2m      }[22m
[2m      x.push(identity(input.a.b));[22m
[2m    } else {[22m
[2m      x.push(identity(input.a.b));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {b: 1}, cond: true, hasAB: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 1}}, cond: true, hasAB: true},[22m
[2m      {input: null, cond: true, hasAB: false},[22m
[2m      // preserve nullthrows[22m
[2m      {input: {a: {b: undefined}}, cond: true, hasAB: true},[22m
[2m      {input: {a: null}, cond: true, hasAB: true},[22m
[2m      {input: {a: {b: undefined}}, cond: true, hasAB: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond, hasAB } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== cond || $[1] !== hasAB || $[2] !== input) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (cond) {[22m
[2m          if (!hasAB) {[22m
[2m            t1 = null;[22m
[2m            break bb0;[22m
[2m          } else {[22m
[2m            let t2;[22m
[2m            if ($[5] !== input.a.b) {[22m
[2m              t2 = identity(input.a.b);[22m
[2m              $[5] = input.a.b;[22m
[2m              $[6] = t2;[22m
[2m            } else {[22m
[2m              t2 = $[6];[22m
[2m            }[22m
[2m            x.push(t2);[22m
[2m          }[22m
[2m          let t2;[22m
[2m          if ($[7] !== input.a.b) {[22m
[2m            t2 = identity(input.a.b);[22m
[2m            $[7] = input.a.b;[22m
[2m            $[8] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[8];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        } else {[22m
[2m          let t2;[22m
[2m          if ($[9] !== input.a.b) {[22m
[2m            t2 = identity(input.a.b);[22m
[2m            $[9] = input.a.b;[22m
[2m            $[10] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[10];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = hasAB;[22m
[2m      $[2] = input;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { b: 1 }, cond: true, hasAB: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 1 } }, cond: true, hasAB: true },[22m
[2m      { input: null, cond: true, hasAB: false },[22m
[2m      // preserve nullthrows[22m
[2m      { input: { a: { b: undefined } }, cond: true, hasAB: true },[22m
[2m      { input: { a: null }, cond: true, hasAB: true },[22m
[2m      { input: { a: { b: undefined } }, cond: true, hasAB: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1,1][22m
[2m  null[22m
[2m  [null,null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [null,null][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/reduce-if-nonexhaustive-poisoned-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, cond, hasAB}) {[22m
[2m    const x = [];[22m
[2m    if (cond) {[22m
[2m      if (!hasAB) {[22m
[2m        return null;[22m
[2m      }[22m
[2m      x.push(identity(input.a.b));[22m
[2m    } else {[22m
[2m      x.push(identity(input.a.b));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {b: 1}, cond: true, hasAB: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 1}}, cond: true, hasAB: true},[22m
[2m      {input: null, cond: true, hasAB: false},[22m
[2m      // preserve nullthrows[22m
[2m      {input: {a: {b: undefined}}, cond: true, hasAB: true},[22m
[2m      {input: {a: undefined}, cond: true, hasAB: true},[22m
[2m      {input: {a: {b: undefined}}, cond: true, hasAB: true},[22m
[2m      {input: undefined, cond: true, hasAB: true},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(9);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond, hasAB } = t0;[22m
[2m    let x;[22m
[2m    let t1;[22m
[2m    if ($[0] !== cond || $[1] !== hasAB || $[2] !== input) {[22m
[2m      t1 = Symbol.for("react.early_return_sentinel");[22m
[2m      bb0: {[22m
[2m        x = [];[22m
[2m        if (cond) {[22m
[2m          if (!hasAB) {[22m
[2m            t1 = null;[22m
[2m            break bb0;[22m
[2m          }[22m
[2m          let t2;[22m
[2m          if ($[5] !== input.a.b) {[22m
[2m            t2 = identity(input.a.b);[22m
[2m            $[5] = input.a.b;[22m
[2m            $[6] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[6];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        } else {[22m
[2m          let t2;[22m
[2m          if ($[7] !== input.a.b) {[22m
[2m            t2 = identity(input.a.b);[22m
[2m            $[7] = input.a.b;[22m
[2m            $[8] = t2;[22m
[2m          } else {[22m
[2m            t2 = $[8];[22m
[2m          }[22m
[2m          x.push(t2);[22m
[2m        }[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = hasAB;[22m
[2m      $[2] = input;[22m
[2m      $[3] = x;[22m
[2m      $[4] = t1;[22m
[2m    } else {[22m
[2m      x = $[3];[22m
[2m      t1 = $[4];[22m
[2m    }[22m
[2m    if (t1 !== Symbol.for("react.early_return_sentinel")) {[22m
[2m      return t1;[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { b: 1 }, cond: true, hasAB: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 1 } }, cond: true, hasAB: true },[22m
[2m      { input: null, cond: true, hasAB: false },[22m
[2m      // preserve nullthrows[22m
[2m      { input: { a: { b: undefined } }, cond: true, hasAB: true },[22m
[2m      { input: { a: undefined }, cond: true, hasAB: true },[22m
[2m      { input: { a: { b: undefined } }, cond: true, hasAB: true },[22m
[2m      { input: undefined, cond: true, hasAB: true },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m
[2m  null[22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'a') ]][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/loop-break-in-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({obj, objIsNull}) {[22m
[2m    const x = [];[22m
[2m    for (let i = 0; i < 5; i++) {[22m
[2m      if (objIsNull) {[22m
[2m        continue;[22m
[2m      }[22m
[2m      x.push(obj.a);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{obj: null, objIsNull: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {obj: null, objIsNull: true},[22m
[2m      {obj: {a: 2}, objIsNull: false},[22m
[2m      // check we preserve nullthrows[22m
[2m      {obj: {a: undefined}, objIsNull: false},[22m
[2m      {obj: undefined, objIsNull: false},[22m
[2m      {obj: {a: undefined}, objIsNull: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { obj, objIsNull } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== objIsNull || $[1] !== obj) {[22m
[2m      x = [];[22m
[2m      for (let i = 0; i < 5; i++) {[22m
[2m        if (objIsNull) {[22m
[2m          continue;[22m
[2m        }[22m

[2m        x.push(obj.a);[22m
[2m      }[22m
[2m      $[0] = objIsNull;[22m
[2m      $[1] = obj;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ obj: null, objIsNull: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { obj: null, objIsNull: true },[22m
[2m      { obj: { a: 2 }, objIsNull: false },[22m
[2m      // check we preserve nullthrows[22m
[2m      { obj: { a: undefined }, objIsNull: false },[22m
[2m      { obj: undefined, objIsNull: false },[22m
[2m      { obj: { a: undefined }, objIsNull: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m
[2m  [2,2,2,2,2][22m
[2m  [null,null,null,null,null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'a') ]][22m
[2m  [null,null,null,null,null][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/break-poisons-outer-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo({input, cond}) {[22m
[2m    const x = [];[22m
[2m    label: {[22m
[2m      if (cond) {[22m
[2m        break label;[22m
[2m      }[22m
[2m      x.push(identity(input.a.b));[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: {a: {b: 2}}, cond: false}],[22m
[2m    sequentialRenders: [[22m
[2m      {input: {a: {b: 2}}, cond: false},[22m
[2m      // preserve nullthrows[22m
[2m      {input: null, cond: false},[22m
[2m      {input: null, cond: true},[22m
[2m      {input: {}, cond: false},[22m
[2m      {input: {a: {b: null}}, cond: false},[22m
[2m      {input: {a: null}, cond: false},[22m
[2m      {input: {a: {b: 3}}, cond: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input, cond } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== cond || $[1] !== input) {[22m
[2m      x = [];[22m
[2m      bb0: {[22m
[2m        if (cond) {[22m
[2m          break bb0;[22m
[2m        }[22m
[2m        let t1;[22m
[2m        if ($[3] !== input.a.b) {[22m
[2m          t1 = identity(input.a.b);[22m
[2m          $[3] = input.a.b;[22m
[2m          $[4] = t1;[22m
[2m        } else {[22m
[2m          t1 = $[4];[22m
[2m        }[22m
[2m        x.push(t1);[22m
[2m      }[22m
[2m      $[0] = cond;[22m
[2m      $[1] = input;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: { a: { b: 2 } }, cond: false }],[22m
[2m    sequentialRenders: [[22m
[2m      { input: { a: { b: 2 } }, cond: false },[22m
[2m      // preserve nullthrows[22m
[2m      { input: null, cond: false },[22m
[2m      { input: null, cond: true },[22m
[2m      { input: {}, cond: false },[22m
[2m      { input: { a: { b: null } }, cond: false },[22m
[2m      { input: { a: null }, cond: false },[22m
[2m      { input: { a: { b: 3 } }, cond: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'a') ]][22m
[2m  [][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'b') ]][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of null (reading 'b') ]][22m
[2m  [3][22m

[31m[1mFAIL:[22m[39m reduce-reactive-deps/jump-poisoned/break-in-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  function useFoo({obj, objIsNull}) {[22m
[2m    const x = [];[22m
[2m    b0: {[22m
[2m      if (objIsNull) {[22m
[2m        break b0;[22m
[2m      }[22m
[2m      x.push(obj.a);[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{obj: null, objIsNull: true}],[22m
[2m    sequentialRenders: [[22m
[2m      {obj: null, objIsNull: true},[22m
[2m      {obj: {a: 2}, objIsNull: false},[22m
[2m      // check we preserve nullthrows[22m
[2m      {obj: {a: undefined}, objIsNull: false},[22m
[2m      {obj: undefined, objIsNull: false},[22m
[2m      {obj: {a: undefined}, objIsNull: false},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { obj, objIsNull } = t0;[22m
[2m    let x;[22m
[2m    if ($[0] !== objIsNull || $[1] !== obj) {[22m
[2m      x = [];[22m
[2m      bb0: {[22m
[2m        if (objIsNull) {[22m
[2m          break bb0;[22m
[2m        }[22m

[2m        x.push(obj.a);[22m
[2m      }[22m
[2m      $[0] = objIsNull;[22m
[2m      $[1] = obj;[22m
[2m      $[2] = x;[22m
[2m    } else {[22m
[2m      x = $[2];[22m
[2m    }[22m
[2m    return x;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ obj: null, objIsNull: true }],[22m
[2m    sequentialRenders: [[22m
[2m      { obj: null, objIsNull: true },[22m
[2m      { obj: { a: 2 }, objIsNull: false },[22m
[2m      // check we preserve nullthrows[22m
[2m      { obj: { a: undefined }, objIsNull: false },[22m
[2m      { obj: undefined, objIsNull: false },[22m
[2m      { obj: { a: undefined }, objIsNull: false },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [][22m
[2m  [2][22m
[2m  [null][22m
[2m  [[ (exception in render) TypeError: Cannot read properties of undefined (reading 'a') ]][22m
[2m  [null][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-with-refs.flow
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @flow @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  component Component(disableLocalRef, ref) {[22m
[2m    const localRef = useFooRef();[22m
[2m    const mergedRef = useMemo(() => {[22m
[2m      return disableLocalRef ? ref : identity(ref, localRef);[22m
[2m    }, [disableLocalRef, ref, localRef]);[22m
[2m    return <div ref={mergedRef} />;[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const Component = React.forwardRef(Component_withRef);[22m
[2m  function Component_withRef(t0, ref) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[31m+   Object.freeze(ref);[39m
[2m    const { disableLocalRef } = t0;[22m
[32m-   const localRef = useFooRef();[39m
[31m+   const localRef = (function () {[39m
[31m+     const $res$ = useFooRef();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== disableLocalRef || $[1] !== ref || $[2] !== localRef) {[22m
[2m      t2 = disableLocalRef ? ref : identity(ref, localRef);[22m
[2m      $[0] = disableLocalRef;[22m
[2m      $[1] = ref;[22m
[2m      $[2] = localRef;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    t1 = t2;[22m
[2m    const mergedRef = t1;[22m
[2m    let t3;[22m
[2m    if ($[4] !== mergedRef) {[22m
[32m-     t3 = <div ref={mergedRef} />;[39m
[31m+     t3 = ([39m
[31m+       <div[39m
[31m+         ref={function () {[39m
[31m+           const $res$ = mergedRef;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[4] = mergedRef;[22m
[2m      $[5] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[5];[22m
[2m    }[22m
[2m    return t3;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-with-no-depslist
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m

[2m  // Compiler can produce any memoization it finds valid if the[22m
[2m  // source listed no memo deps[22m
[2m  function Component({propA}) {[22m
[2m    // @ts-ignore[22m
[2m    return useMemo(() => {[22m
[2m      return [propA];[22m
[2m    });[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m

[2m  // Compiler can produce any memoization it finds valid if the[22m
[2m  // source listed no memo deps[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA } = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== propA) {[22m
[2m      t2 = [propA];[22m
[2m      $[0] = propA;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[2m    t1 = t2;[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-reordering-depslist-controlflow
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"val1":{"x":2},"val2":[[[1,2],3,4]]}</div>
<div>{"val1":{"x":2},"val2":[[]]}</div>
Forget:
(kind: ok) <div>{"val1":"[[ function params=0 ]]","val2":"[[ function params=0 ]]"}</div>
<div>{"val1":"[[ function params=0 ]]","val2":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-reordering-depslist-assignment
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {useMemo} from 'react';[22m

[2m  function useFoo(arr1, arr2) {[22m
[2m    const x = [arr1];[22m

[2m    let y;[22m
[2m    return useMemo(() => {[22m
[2m      return {y};[22m
[2m    }, [((y = x.concat(arr2)), y)]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [[22m
[2m      [1, 2],[22m
[2m      [3, 4],[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { useMemo } from "react";[22m

[2m  function useFoo(arr1, arr2) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(arr1);[39m
[31m+   Object.freeze(arr2);[39m
[2m    let y;[22m
[2m    if ($[0] !== arr1 || $[1] !== arr2) {[22m
[2m      const x = [arr1];[22m

[2m      y;[22m
[2m      (y = x.concat(arr2)), y;[22m
[2m      $[0] = arr1;[22m
[2m      $[1] = arr2;[22m
[2m      $[2] = y;[22m
[2m    } else {[22m
[2m      y = $[2];[22m
[2m    }[22m
[2m    let t0;[22m
[2m    const t1 = y;[22m
[2m    let t2;[22m
[2m    if ($[3] !== t1) {[22m
[2m      t2 = { y: t1 };[22m
[2m      $[3] = t1;[22m
[2m      $[4] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[4];[22m
[2m    }[22m
[2m    t0 = t2;[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [[22m
[2m      [1, 2],[22m
[2m      [3, 4],[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"y":[[1,2],3,4]}[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-invoke-prop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useMemo} from 'react';[22m

[2m  function useFoo({callback}) {[22m
[2m    return useMemo(() => new Array(callback()), [callback]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [[22m
[2m      {[22m
[2m        callback: () => {[22m
[2m          'use no forget';[22m
[2m          return [1, 2, 3];[22m
[2m        },[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useMemo } from "react";[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { callback } = t0;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== callback) {[22m
[2m      t2 = new Array(callback());[22m
[2m      $[0] = callback;[22m
[2m      $[1] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[1];[22m
[2m    }[22m
[2m    t1 = t2;[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [[22m
[2m      {[22m
[2m        callback: () => {[22m
[2m          "use no forget";[22m
[2m          return [1, 2, 3];[22m
[2m        },[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[1,2,3]][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-inner-decl
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo(data) {[22m
[2m    return useMemo(() => {[22m
[2m      const temp = identity(data.a);[22m
[2m      return {temp};[22m
[2m    }, [data.a]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{a: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(data) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(data);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== data.a) {[22m
[2m      t1 = identity(data.a);[22m
[2m      $[0] = data.a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const temp = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== temp) {[22m
[2m      t2 = { temp };[22m
[2m      $[2] = temp;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    t0 = t2;[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ a: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"temp":2}[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-infer-nonallocating
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useMemo} from 'react';[22m

[2m  // It's correct to infer a useMemo value is non-allocating[22m
[2m  // and not provide it with a reactive scope[22m
[2m  function useFoo(num1, num2) {[22m
[2m    return useMemo(() => Math.min(num1, num2), [num1, num2]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [2, 3],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useMemo } from "react";[22m

[2m  // It's correct to infer a useMemo value is non-allocating[22m
[2m  // and not provide it with a reactive scope[22m
[2m  function useFoo(num1, num2) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(num1);[39m
[31m+   Object.freeze(num2);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== num1 || $[1] !== num2) {[22m
[2m      t1 = Math.min(num1, num2);[22m
[2m      $[0] = num1;[22m
[2m      $[1] = num2;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [2, 3],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 2[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-infer-more-specific
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useMemo} from 'react';[22m

[2m  // More specific memoization always results in fewer memo block[22m
[2m  // executions.[22m
[2m  // Precisely:[22m
[2m  //  x_new != x_prev does NOT imply x.y.z_new != x.y.z_prev[22m
[2m  //  x.y.z_new != x.y.z_prev does imply x_new != x_prev[22m
[2m  function useHook(x) {[22m
[2m    return useMemo(() => [x.y.z], [x]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{y: {z: 2}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useMemo } from "react";[22m

[2m  // More specific memoization always results in fewer memo block[22m
[2m  // executions.[22m
[2m  // Precisely:[22m
[2m  //  x_new != x_prev does NOT imply x.y.z_new != x.y.z_prev[22m
[2m  //  x.y.z_new != x.y.z_prev does imply x_new != x_prev[22m
[2m  function useHook(x) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(x);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== x.y.z) {[22m
[2m      t1 = [x.y.z];[22m
[2m      $[0] = x.y.z;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{ y: { z: 2 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [2][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-infer-fewer-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useMemo} from 'react';[22m

[2m  // It's correct to produce memo blocks with fewer deps than source[22m
[2m  function useFoo(a, b) {[22m
[2m    return useMemo(() => [a], [a, b]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [1, 2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useMemo } from "react";[22m

[2m  // It's correct to produce memo blocks with fewer deps than source[22m
[2m  function useFoo(a, b) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== a) {[22m
[2m      t1 = [a];[22m
[2m      $[0] = a;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [1, 2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [1][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-in-other-reactive-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo, useState} from 'react';[22m
[2m  import {arrayPush} from 'shared-runtime';[22m

[2m  // useMemo-produced values can exist in nested reactive blocks, as long[22m
[2m  // as their reactive dependencies are a subset of depslist from source[22m
[2m  function useFoo(minWidth, otherProp) {[22m
[2m    const [width, setWidth] = useState(1);[22m
[2m    const x = [];[22m
[2m    const style = useMemo(() => {[22m
[2m      return {[22m
[2m        width: Math.max(minWidth, width),[22m
[2m      };[22m
[2m    }, [width, minWidth]);[22m
[2m    arrayPush(x, otherProp);[22m
[2m    return [style, x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [2, 'other'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo, useState } from "react";[22m
[2m  import { arrayPush } from "shared-runtime";[22m

[2m  // useMemo-produced values can exist in nested reactive blocks, as long[22m
[2m  // as their reactive dependencies are a subset of depslist from source[22m
[2m  function useFoo(minWidth, otherProp) {[22m
[2m    const $ = _c(6);[22m
[32m-   const [width] = useState(1);[39m
[31m+   Object.freeze(minWidth);[39m
[31m+   Object.freeze(otherProp);[39m
[31m+   const [width] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== width || $[1] !== minWidth || $[2] !== otherProp) {[22m
[2m      const x = [];[22m
[2m      let t1;[22m

[2m      const t2 = Math.max(minWidth, width);[22m
[2m      let t3;[22m
[2m      if ($[4] !== t2) {[22m
[2m        t3 = { width: t2 };[22m
[2m        $[4] = t2;[22m
[2m        $[5] = t3;[22m
[2m      } else {[22m
[2m        t3 = $[5];[22m
[2m      }[22m
[2m      t1 = t3;[22m
[2m      const style = t1;[22m

[2m      arrayPush(x, otherProp);[22m
[2m      t0 = [style, x];[22m
[2m      $[0] = width;[22m
[2m      $[1] = minWidth;[22m
[2m      $[2] = otherProp;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [2, "other"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"width":2},["other"]][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-dropped-infer-always-invalidating
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useMemo} from 'react';[22m
[2m  import {useHook} from 'shared-runtime';[22m

[2m  // useMemo values may not be memoized in Forget output if we[22m
[2m  // infer that their deps always invalidate.[22m
[2m  // This is still correct as the useMemo in source was effectively[22m
[2m  // a no-op already.[22m
[2m  function useFoo(props) {[22m
[2m    const x = [];[22m
[2m    useHook();[22m
[2m    x.push(props);[22m

[2m    return useMemo(() => [x], [x]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useMemo } from "react";[22m
[2m  import { useHook } from "shared-runtime";[22m

[2m  // useMemo values may not be memoized in Forget output if we[22m
[2m  // infer that their deps always invalidate.[22m
[2m  // This is still correct as the useMemo in source was effectively[22m
[2m  // a no-op already.[22m
[2m  function useFoo(props) {[22m
[31m+   Object.freeze(props);[39m
[2m    const x = [];[22m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    x.push(props);[22m
[2m    let t0;[22m
[2m    t0 = [x];[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [[{}]][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-constant-prop
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function useFoo(cond) {[22m
[2m    const sourceDep = 0;[22m
[2m    const derived1 = useMemo(() => {[22m
[2m      return identity(sourceDep);[22m
[2m    }, [sourceDep]);[22m
[2m    const derived2 = (cond ?? Math.min(sourceDep, 1)) ? 1 : 2;[22m
[2m    const derived3 = useMemo(() => {[22m
[2m      return identity(sourceDep);[22m
[2m    }, [sourceDep]);[22m
[2m    const derived4 = (Math.min(sourceDep, -1) ?? cond) ? 1 : 2;[22m
[2m    return [derived1, derived2, derived3, derived4];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function useFoo(cond) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(cond);[39m
[2m    const sourceDep = 0;[22m
[2m    let t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = identity(0);[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    t0 = t1;[22m
[2m    const derived1 = t0;[22m

[2m    const derived2 = (cond ?? Math.min(0, 1)) ? 1 : 2;[22m
[2m    let t2;[22m
[2m    let t3;[22m
[2m    if ($[1] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t3 = identity(0);[22m
[2m      $[1] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[1];[22m
[2m    }[22m
[2m    t2 = t3;[22m
[2m    const derived3 = t2;[22m

[2m    const derived4 = (Math.min(0, -1) ?? cond) ? 1 : 2;[22m
[2m    let t4;[22m
[2m    if ($[2] !== derived2 || $[3] !== derived4) {[22m
[2m      t4 = [derived1, derived2, derived3, derived4];[22m
[2m      $[2] = derived2;[22m
[2m      $[3] = derived4;[22m
[2m      $[4] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[4];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [true],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [0,1,0,1][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-conditional-access-own-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m

[2m  function Component({propA, propB}) {[22m
[2m    return useMemo(() => {[22m
[2m      if (propA) {[22m
[2m        return {[22m
[2m          value: propB.x.y,[22m
[2m        };[22m
[2m      }[22m
[2m    }, [propA, propB.x.y]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: 1, propB: {x: {y: []}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA, propB } = t0;[22m
[2m    let t1;[22m
[2m    bb0: {[22m
[2m      if (propA) {[22m
[2m        let t2;[22m
[2m        if ($[0] !== propB.x.y) {[22m
[2m          t2 = { value: propB.x.y };[22m
[2m          $[0] = propB.x.y;[22m
[2m          $[1] = t2;[22m
[2m        } else {[22m
[2m          t2 = $[1];[22m
[2m        }[22m
[2m        t1 = t2;[22m
[2m        break bb0;[22m
[2m      }[22m
[2m      t1 = undefined;[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: 1, propB: { x: { y: [] } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"value":[]}[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-conditional-access-noAlloc
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m

[2m  function Component({propA, propB}) {[22m
[2m    return useMemo(() => {[22m
[2m      return {[22m
[2m        value: propB?.x.y,[22m
[2m        other: propA,[22m
[2m      };[22m
[2m    }, [propA, propB.x.y]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: 2, propB: {x: {y: []}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA, propB } = t0;[22m
[2m    let t1;[22m

[2m    const t2 = propB?.x.y;[22m
[2m    let t3;[22m
[2m    if ($[0] !== t2 || $[1] !== propA) {[22m
[2m      t3 = { value: t2, other: propA };[22m
[2m      $[0] = t2;[22m
[2m      $[1] = propA;[22m
[2m      $[2] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[2];[22m
[2m    }[22m
[2m    t1 = t3;[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: 2, propB: { x: { y: [] } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"value":[],"other":2}[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-conditional-access-alloc
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component({propA, propB}) {[22m
[2m    return useMemo(() => {[22m
[2m      return {[22m
[2m        value: identity(propB?.x.y),[22m
[2m        other: propA,[22m
[2m      };[22m
[2m    }, [propA, propB.x.y]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: 2, propB: {x: {y: []}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA, propB } = t0;[22m
[2m    let t1;[22m

[2m    const t2 = propB?.x.y;[22m
[2m    let t3;[22m
[2m    if ($[0] !== t2) {[22m
[2m      t3 = identity(t2);[22m
[2m      $[0] = t2;[22m
[2m      $[1] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[1];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[2] !== t3 || $[3] !== propA) {[22m
[2m      t4 = { value: t3, other: propA };[22m
[2m      $[2] = t3;[22m
[2m      $[3] = propA;[22m
[2m      $[4] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[4];[22m
[2m    }[22m
[2m    t1 = t4;[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: 2, propB: { x: { y: [] } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) {"value":[],"other":2}[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useMemo-alias-property-load-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useMemo} from 'react';[22m
[2m  import {sum} from 'shared-runtime';[22m

[2m  function Component({propA, propB}) {[22m
[2m    const x = propB.x.y;[22m
[2m    return useMemo(() => {[22m
[2m      return sum(propA.x, x);[22m
[2m    }, [propA.x, x]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: {x: 2}, propB: {x: {y: 3}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useMemo } from "react";[22m
[2m  import { sum } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA, propB } = t0;[22m
[2m    const x = propB.x.y;[22m
[2m    let t1;[22m
[2m    let t2;[22m
[2m    if ($[0] !== propA.x || $[1] !== x) {[22m
[2m      t2 = sum(propA.x, x);[22m
[2m      $[0] = propA.x;[22m
[2m      $[1] = x;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    t1 = t2;[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: { x: 2 }, propB: { x: { y: 3 } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) 5[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-with-no-depslist
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback} from 'react';[22m

[2m  // Compiler can produce any memoization it finds valid if the[22m
[2m  // source listed no memo deps[22m
[2m  function Component({propA}) {[22m
[2m    // @ts-ignore[22m
[2m    return useCallback(() => {[22m
[2m      return [propA];[22m
[2m    });[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback } from "react";[22m

[2m  // Compiler can produce any memoization it finds valid if the[22m
[2m  // source listed no memo deps[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== propA) {[22m
[2m      t1 = () => [propA];[22m
[2m      $[0] = propA;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-reordering-depslist-assignment
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"getVal":{"kind":"Function","result":{"y":[[1,2],3,4]}},"shouldInvokeFns":true}</div>
Forget:
(kind: ok) <div>{"getVal":{"kind":"Function","result":{"kind":"Function","result":{"y":[[1,2],3,4]}}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-reordering-deplist-controlflow
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"val1":{"kind":"Function","result":{"x":2}},"val2":{"kind":"Function","result":[[[1,2],3,4]]},"shouldInvokeFns":true}</div>
<div>{"val1":{"kind":"Function","result":{"x":2}},"val2":{"kind":"Function","result":[[]]},"shouldInvokeFns":true}</div>
Forget:
(kind: ok) <div>{"val1":{"kind":"Function","result":{"kind":"Function","result":{"x":2}}},"val2":{"kind":"Function","result":{"kind":"Function","result":[[[1,2],3,4]]}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>
<div>{"val1":{"kind":"Function","result":{"kind":"Function","result":{"x":2}}},"val2":{"kind":"Function","result":{"kind":"Function","result":[[]]}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-nonescaping
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  import {useCallback} from 'react';[22m

[2m  function Component({entity, children}) {[22m
[2m    // showMessage doesn't escape so we don't memoize it.[22m
[2m    // However, validatePreserveExistingMemoizationGuarantees only sees that the scope[22m
[2m    // doesn't exist, and thinks the memoization was missed instead of being intentionally dropped.[22m
[2m    const showMessage = useCallback(() => entity != null, [entity]);[22m

[2m    if (!showMessage()) {[22m
[2m      return children;[22m
[2m    }[22m

[2m    return <div>{children}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        entity: {name: 'Sathya'},[22m
[2m        children: [<div key="gsathya">Hi Sathya!</div>],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  import { useCallback } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { entity, children } = t0;[22m

[2m    const showMessage = () => entity != null;[22m
[2m    if (!showMessage()) {[22m
[2m      return children;[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[0] !== children) {[22m
[2m      t1 = <div>{children}</div>;[22m
[2m      $[0] = children;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        entity: { name: "Sathya" },[22m
[2m        children: [<div key="gsathya">Hi Sathya!</div>],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div>Hi Sathya!</div></div>[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-nonescaping-invoked-callback-escaping-return
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  import {useCallback} from 'react';[22m

[2m  function Component({entity, children}) {[22m
[2m    const showMessage = useCallback(() => entity != null);[22m

[2m    // We currently model functions as if they could escape intor their return value[22m
[2m    // but if we ever changed that (or did optimization to figure out cases where they[22m
[2m    // are known not to) we could get a false positive validation error here, since[22m
[2m    // showMessage doesn't need to be memoized since it doesn't escape in this instance.[22m
[2m    const shouldShowMessage = showMessage();[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <div>{shouldShowMessage}</div>[22m
[2m        <div>{children}</div>[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        entity: {name: 'Sathya'},[22m
[2m        children: [<div key="gsathya">Hi Sathya!</div>],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees @enableAssumeHooksFollowRulesOfReact @enableTransitivelyFreezeFunctionExpressions[22m
[2m  import { useCallback } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(11);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { entity, children } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== entity) {[22m
[2m      t1 = () => entity != null;[22m
[2m      $[0] = entity;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const showMessage = t1;[22m
[2m    let t2;[22m
[2m    if ($[2] !== showMessage) {[22m
[2m      t2 = showMessage();[22m
[2m      $[2] = showMessage;[22m
[2m      $[3] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[3];[22m
[2m    }[22m
[2m    const shouldShowMessage = t2;[22m
[2m    let t3;[22m
[2m    if ($[4] !== shouldShowMessage) {[22m
[2m      t3 = <div>{shouldShowMessage}</div>;[22m
[2m      $[4] = shouldShowMessage;[22m
[2m      $[5] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[5];[22m
[2m    }[22m
[2m    let t4;[22m
[2m    if ($[6] !== children) {[22m
[2m      t4 = <div>{children}</div>;[22m
[2m      $[6] = children;[22m
[2m      $[7] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[7];[22m
[2m    }[22m
[2m    let t5;[22m
[2m    if ($[8] !== t3 || $[9] !== t4) {[22m
[2m      t5 = ([22m
[2m        <div>[22m
[2m          {t3}[22m
[2m          {t4}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[8] = t3;[22m
[2m      $[9] = t4;[22m
[2m      $[10] = t5;[22m
[2m    } else {[22m
[2m      t5 = $[10];[22m
[2m    }[22m
[2m    return t5;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [[22m
[2m      {[22m
[2m        entity: { name: "Sathya" },[22m
[2m        children: [<div key="gsathya">Hi Sathya!</div>],[22m
[2m      },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div><div></div><div><div>Hi Sathya!</div></div></div>[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-infer-more-specific
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useCallback} from 'react';[22m

[2m  // More specific memoization always results in fewer memo block[22m
[2m  // executions.[22m
[2m  // Precisely:[22m
[2m  //  x_new != x_prev does NOT imply x.y.z_new != x.y.z_prev[22m
[2m  //  x.y.z_new != x.y.z_prev does imply x_new != x_prev[22m
[2m  function useHook(x) {[22m
[2m    return useCallback(() => [x.y.z], [x]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{y: {z: 2}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useCallback } from "react";[22m

[2m  // More specific memoization always results in fewer memo block[22m
[2m  // executions.[22m
[2m  // Precisely:[22m
[2m  //  x_new != x_prev does NOT imply x.y.z_new != x.y.z_prev[22m
[2m  //  x.y.z_new != x.y.z_prev does imply x_new != x_prev[22m
[2m  function useHook(x) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(x);[39m
[2m    let t0;[22m
[2m    if ($[0] !== x.y.z) {[22m
[2m      t0 = () => [x.y.z];[22m
[2m      $[0] = x.y.z;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{ y: { z: 2 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-infer-fewer-deps
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useCallback} from 'react';[22m

[2m  // It's correct to produce memo blocks with fewer deps than source[22m
[2m  function useFoo(a, b) {[22m
[2m    return useCallback(() => [a], [a, b]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [1, 2],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useCallback } from "react";[22m

[2m  // It's correct to produce memo blocks with fewer deps than source[22m
[2m  function useFoo(a, b) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(a);[39m
[31m+   Object.freeze(b);[39m
[2m    let t0;[22m
[2m    if ($[0] !== a) {[22m
[2m      t0 = () => [a];[22m
[2m      $[0] = a;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [1, 2],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-infer-conditional-value-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback} from 'react';[22m
[2m  import {identity, mutate} from 'shared-runtime';[22m

[2m  function useHook(propA, propB) {[22m
[2m    return useCallback(() => {[22m
[2m      const x = {};[22m
[2m      if (identity(null) ?? propA.a) {[22m
[2m        mutate(x);[22m
[2m        return {[22m
[2m          value: propB.x.y,[22m
[2m        };[22m
[2m      }[22m
[2m    }, [propA.a, propB.x.y]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{a: 1}, {x: {y: 3}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback } from "react";[22m
[2m  import { identity, mutate } from "shared-runtime";[22m

[2m  function useHook(propA, propB) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(propA);[39m
[31m+   Object.freeze(propB);[39m
[2m    let t0;[22m
[2m    if ($[0] !== propA.a || $[1] !== propB.x.y) {[22m
[2m      t0 = () => {[22m
[2m        const x = {};[22m
[2m        if (identity(null) ?? propA.a) {[22m
[2m          mutate(x);[22m
[2m          return { value: propB.x.y };[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = propA.a;[22m
[2m      $[1] = propB.x.y;[22m
[2m      $[2] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[2];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useHook,[22m
[2m    params: [{ a: 1 }, { x: { y: 3 } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-in-other-reactive-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback, useState} from 'react';[22m
[2m  import {arrayPush} from 'shared-runtime';[22m

[2m  // useCallback-produced values can exist in nested reactive blocks, as long[22m
[2m  // as their reactive dependencies are a subset of depslist from source[22m
[2m  function useFoo(minWidth, otherProp) {[22m
[2m    const [width, setWidth] = useState(1);[22m
[2m    const x = [];[22m
[2m    const style = useCallback(() => {[22m
[2m      return {[22m
[2m        width: Math.max(minWidth, width),[22m
[2m      };[22m
[2m    }, [width, minWidth]);[22m
[2m    arrayPush(x, otherProp);[22m
[2m    return [style, x];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [2, 'other'],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback, useState } from "react";[22m
[2m  import { arrayPush } from "shared-runtime";[22m

[2m  // useCallback-produced values can exist in nested reactive blocks, as long[22m
[2m  // as their reactive dependencies are a subset of depslist from source[22m
[2m  function useFoo(minWidth, otherProp) {[22m
[2m    const $ = _c(7);[22m
[32m-   const [width] = useState(1);[39m
[31m+   Object.freeze(minWidth);[39m
[31m+   Object.freeze(otherProp);[39m
[31m+   const [width] = (function () {[39m
[31m+     const $res$ = useState(Object.freeze(1));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    let t0;[22m
[2m    if ($[0] !== width || $[1] !== minWidth || $[2] !== otherProp) {[22m
[2m      const x = [];[22m
[2m      let t1;[22m
[2m      if ($[4] !== minWidth || $[5] !== width) {[22m
[2m        t1 = () => ({ width: Math.max(minWidth, width) });[22m
[2m        $[4] = minWidth;[22m
[2m        $[5] = width;[22m
[2m        $[6] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[6];[22m
[2m      }[22m
[2m      const style = t1;[22m

[2m      arrayPush(x, otherProp);[22m
[2m      t0 = [style, x];[22m
[2m      $[0] = width;[22m
[2m      $[1] = minWidth;[22m
[2m      $[2] = otherProp;[22m
[2m      $[3] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[3];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [2, "other"],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["[[ function params=0 ]]",["other"]][22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-conditional-access-own-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback} from 'react';[22m

[2m  function Component({propA, propB}) {[22m
[2m    return useCallback(() => {[22m
[2m      if (propA) {[22m
[2m        return {[22m
[2m          value: propB.x.y,[22m
[2m        };[22m
[2m      }[22m
[2m    }, [propA, propB.x.y]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: 1, propB: {x: {y: []}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback } from "react";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA, propB } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== propA || $[1] !== propB.x.y) {[22m
[2m      t1 = () => {[22m
[2m        if (propA) {[22m
[2m          return { value: propB.x.y };[22m
[2m        }[22m
[2m      };[22m
[2m      $[0] = propA;[22m
[2m      $[1] = propB.x.y;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: 1, propB: { x: { y: [] } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-captures-reassigned-context
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useCallback} from 'react';[22m
[2m  import {makeArray} from 'shared-runtime';[22m

[2m  // This case is fine, as all reassignments happen before the useCallback[22m
[2m  function Foo(props) {[22m
[2m    let x = [];[22m
[2m    x.push(props);[22m
[2m    x = makeArray();[22m

[2m    const cb = useCallback(() => [x], [x]);[22m

[2m    return cb;[22m
[2m  }[22m
[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useCallback } from "react";[22m
[2m  import { makeArray } from "shared-runtime";[22m

[2m  // This case is fine, as all reassignments happen before the useCallback[22m
[2m  function Foo(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let x;[22m
[2m    if ($[0] !== props) {[22m
[2m      x = [];[22m
[2m      x.push(props);[22m
[2m      x = makeArray();[22m
[2m      $[0] = props;[22m
[2m      $[1] = x;[22m
[2m    } else {[22m
[2m      x = $[1];[22m
[2m    }[22m

[2m    const t0 = x;[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = () => [x];[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    x;[22m
[2m    const cb = t1;[22m
[2m    return cb;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-captures-reassigned-context-property
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"cb":{"kind":"Function","result":[2]},"shouldInvokeFns":true}</div>
Forget:
(kind: ok) <div>{"cb":{"kind":"Function","result":{"kind":"Function","result":[2]}},"shouldInvokeFns":{"kind":"Function","result":true}}</div>

[31m[1mFAIL:[22m[39m preserve-memo-validation/useCallback-alias-property-load-dep
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import {useCallback} from 'react';[22m
[2m  import {sum} from 'shared-runtime';[22m

[2m  function Component({propA, propB}) {[22m
[2m    const x = propB.x.y;[22m
[2m    return useCallback(() => {[22m
[2m      return sum(propA.x, x);[22m
[2m    }, [propA.x, x]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{propA: {x: 2}, propB: {x: {y: 3}}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @validatePreserveExistingMemoizationGuarantees[22m
[2m  import { useCallback } from "react";[22m
[2m  import { sum } from "shared-runtime";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { propA, propB } = t0;[22m
[2m    const x = propB.x.y;[22m
[2m    let t1;[22m
[2m    if ($[0] !== propA.x || $[1] !== x) {[22m
[2m      t1 = () => sum(propA.x, x);[22m
[2m      $[0] = propA.x;[22m
[2m      $[1] = x;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ propA: { x: 2 }, propB: { x: { y: 3 } } }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "[[ function params=0 ]]"[22m

[31m[1mFAIL:[22m[39m preserve-memo-validation/maybe-invalid-useMemo-no-memoblock-sideeffect
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import {useMemo} from 'react';[22m

[2m  // This is currently considered valid because we don't ensure that every[22m
[2m  // instruction within manual memoization gets assigned to a reactive scope[22m
[2m  // (i.e. inferred non-mutable or non-escaping values don't get memoized)[22m
[2m  function useFoo({minWidth, styles, setStyles}) {[22m
[2m    useMemo(() => {[22m
[2m      if (styles.width > minWidth) {[22m
[2m        setStyles(styles);[22m
[2m      }[22m
[2m    }, [styles, minWidth, setStyles]);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{minWidth: 2, styles: {width: 1}, setStyles: () => {}}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  // @validatePreserveExistingMemoizationGuarantees[22m

[2m  import { useMemo } from "react";[22m

[2m  // This is currently considered valid because we don't ensure that every[22m
[2m  // instruction within manual memoization gets assigned to a reactive scope[22m
[2m  // (i.e. inferred non-mutable or non-escaping values don't get memoized)[22m
[2m  function useFoo(t0) {[22m
[31m+   Object.freeze(t0);[39m
[2m    const { minWidth, styles, setStyles } = t0;[22m
[2m    let t1;[22m
[2m    if (styles.width > minWidth) {[22m
[2m      setStyles(styles);[22m
[2m    }[22m
[2m    t1 = undefined;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ minWidth: 2, styles: { width: 1 }, setStyles: () => {} }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/repro-allocating-ternary-test-instruction-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m
[2m  import {identity, makeObject_Primitives} from 'shared-runtime';[22m

[2m  function useTest({cond}) {[22m
[2m    const val = makeObject_Primitives();[22m

[2m    useHook();[22m
[2m    /**[22m
[2m     * We don't technically need a reactive scope for this ternary as[22m
[2m     * it cannot produce newly allocated values.[22m
[2m     * While identity(...) may allocate, we can teach the compiler that[22m
[2m     * its result is only used as as a test condition[22m
[2m     */[22m
[2m    const result = identity(cond) ? val : null;[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useTest,[22m
[2m    params: [{cond: true}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m
[2m  import { identity, makeObject_Primitives } from "shared-runtime";[22m

[2m  function useTest(t0) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { cond } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = makeObject_Primitives();[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    const val = t1;[22m
[32m-[39m
[32m-   useHook();[39m
[31m+   (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const result = identity(cond) ? val : null;[22m
[2m    return result;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useTest,[22m
[2m    params: [{ cond: true }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) useHook is not defined[22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/mutation-within-jsx
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
<div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>
<div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/mutation-within-jsx-and-break
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
<div>{"value":{"a":0,"b":"value1","c":true,"wat0":"joe"}}</div>
Forget:
(kind: ok) <div>{"value":"[[ function params=0 ]]"}</div>
<div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/mutation-within-capture-and-mutablerange
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m
[2m  import {mutate} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * This test fixture is similar to mutation-within-jsx. The only difference[22m
[2m   * is that there is no `freeze` effect here, which means that `z` may be[22m
[2m   * mutated after its memo block through mutating `y`.[22m
[2m   *[22m
[2m   * While this is technically correct (as `z` is a nested memo block), it[22m
[2m   * is an edge case as we believe that values are not mutated after their[22m
[2m   * memo blocks (which may lead to 'tearing', i.e. mutating one render's[22m
[2m   * values in a subsequent render.[22m
[2m   */[22m
[2m  function useFoo({a, b}) {[22m
[2m    // x and y's scopes start here[22m
[2m    const x = {a};[22m
[2m    const y = [b];[22m
[2m    mutate(x);[22m
[2m    // z captures the result of `mutate(y)`, which may be aliased to `y`.[22m
[2m    const z = [mutate(y)];[22m
[2m    // the following line may also mutate z[22m
[2m    mutate(y);[22m
[2m    // and end here[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{a: 2, b: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m
[2m  import { mutate } from "shared-runtime";[22m

[2m  /**[22m
[2m   * This test fixture is similar to mutation-within-jsx. The only difference[22m
[2m   * is that there is no `freeze` effect here, which means that `z` may be[22m
[2m   * mutated after its memo block through mutating `y`.[22m
[2m   *[22m
[2m   * While this is technically correct (as `z` is a nested memo block), it[22m
[2m   * is an edge case as we believe that values are not mutated after their[22m
[2m   * memo blocks (which may lead to 'tearing', i.e. mutating one render's[22m
[2m   * values in a subsequent render.[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(5);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let z;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const x = { a };[22m
[2m      const y = [b];[22m
[2m      mutate(x);[22m

[2m      const t1 = mutate(y);[22m
[2m      let t2;[22m
[2m      if ($[3] !== t1) {[22m
[2m        t2 = [t1];[22m
[2m        $[3] = t1;[22m
[2m        $[4] = t2;[22m
[2m      } else {[22m
[2m        t2 = $[4];[22m
[2m      }[22m
[2m      z = t2;[22m

[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = z;[22m
[2m    } else {[22m
[2m      z = $[2];[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ a: 2, b: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [null][22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/mutate-outer-scope-within-value-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m
[2m  import {CONST_TRUE, identity, shallowCopy} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * There are three values with their own scopes in this fixture.[22m
[2m   * - arr, whose mutable range extends to the `mutate(...)` call[22m
[2m   * - cond, which has a mutable range of exactly 1 (e.g. created but not[22m
[2m   *   mutated)[22m
[2m   * - { val: CONST_TRUE }, which is also not mutated after creation. However,[22m
[2m   *   its scope range becomes extended to the value block.[22m
[2m   *[22m
[2m   * After AlignScopesToBlockScopes, our scopes look roughly like this[22m
[2m   * ```js[22m
[2m   *  [1] arr = shallowCopy()            ⌝@0[22m
[2m   *  [2] cond = identity()        <- @1 |[22m
[2m   *  [3] $0 = Ternary test=cond     ⌝@2 |[22m
[2m   *  [4]        {val : CONST_TRUE}  |   |[22m
[2m   *  [5]        mutate(arr)         |   |[22m
[2m   *  [6] return $0                  ⌟   ⌟[22m
[2m   * ```[22m
[2m   *[22m
[2m   * Observe that instruction 5 mutates scope 0, which means that scopes 0 and 2[22m
[2m   * should be merged.[22m
[2m   */[22m
[2m  function useFoo({input}) {[22m
[2m    const arr = shallowCopy(input);[22m

[2m    const cond = identity(false);[22m
[2m    return cond ? {val: CONST_TRUE} : mutate(arr);[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{input: 3}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m
[2m  import { CONST_TRUE, identity, shallowCopy } from "shared-runtime";[22m

[2m  /**[22m
[2m   * There are three values with their own scopes in this fixture.[22m
[2m   * - arr, whose mutable range extends to the `mutate(...)` call[22m
[2m   * - cond, which has a mutable range of exactly 1 (e.g. created but not[22m
[2m   *   mutated)[22m
[2m   * - { val: CONST_TRUE }, which is also not mutated after creation. However,[22m
[2m   *   its scope range becomes extended to the value block.[22m
[2m   *[22m
[2m   * After AlignScopesToBlockScopes, our scopes look roughly like this[22m
[2m   * ```js[22m
[2m   *  [1] arr = shallowCopy()            ⌝@0[22m
[2m   *  [2] cond = identity()        <- @1 |[22m
[2m   *  [3] $0 = Ternary test=cond     ⌝@2 |[22m
[2m   *  [4]        {val : CONST_TRUE}  |   |[22m
[2m   *  [5]        mutate(arr)         |   |[22m
[2m   *  [6] return $0                  ⌟   ⌟[22m
[2m   * ```[22m
[2m   *[22m
[2m   * Observe that instruction 5 mutates scope 0, which means that scopes 0 and 2[22m
[2m   * should be merged.[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { input } = t0;[22m
[2m    const arr = shallowCopy(input);[22m
[2m    let t1;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t1 = identity(false);[22m
[2m      $[0] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[0];[22m
[2m    }[22m
[2m    const cond = t1;[22m
[2m    let t2;[22m
[2m    if ($[1] !== arr) {[22m
[2m      t2 = cond ? { val: CONST_TRUE } : mutate(arr);[22m
[2m      $[1] = arr;[22m
[2m      $[2] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[2];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ input: 3 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) mutate is not defined[22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/invalid-align-scopes-within-nested-valueblock-in-array
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div>foo</div><div>{"value":[null,null,null]}</div>
Forget:
(kind: ok) <div>foo</div><div>{"value":"[[ function params=0 ]]"}</div>

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/capture-ref-for-later-mutation
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m
[2m  import {useRef} from 'react';[22m
[2m  import {addOne} from 'shared-runtime';[22m

[2m  function useKeyCommand() {[22m
[2m    const currentPosition = useRef(0);[22m
[2m    const handleKey = direction => () => {[22m
[2m      const position = currentPosition.current;[22m
[2m      const nextPosition = direction === 'left' ? addOne(position) : position;[22m
[2m      currentPosition.current = nextPosition;[22m
[2m    };[22m
[2m    const moveLeft = {[22m
[2m      handler: handleKey('left'),[22m
[2m    };[22m
[2m    const moveRight = {[22m
[2m      handler: handleKey('right'),[22m
[2m    };[22m
[2m    return [moveLeft, moveRight];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useKeyCommand,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m
[2m  import { useRef } from "react";[22m
[2m  import { addOne } from "shared-runtime";[22m

[2m  function useKeyCommand() {[22m
[2m    const $ = _c(7);[22m
[32m-   const currentPosition = useRef(0);[39m
[31m+   const currentPosition = (function () {[39m
[31m+     const $res$ = useRef(Object.freeze(0));[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const handleKey = (direction) => () => {[22m
[2m      const position = currentPosition.current;[22m
[2m      const nextPosition = direction === "left" ? addOne(position) : position;[22m
[2m      currentPosition.current = nextPosition;[22m
[2m    };[22m

[2m    const t0 = handleKey("left");[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = { handler: t0 };[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    const moveLeft = t1;[22m

[2m    const t2 = handleKey("right");[22m
[2m    let t3;[22m
[2m    if ($[2] !== t2) {[22m
[2m      t3 = { handler: t2 };[22m
[2m      $[2] = t2;[22m
[2m      $[3] = t3;[22m
[2m    } else {[22m
[2m      t3 = $[3];[22m
[2m    }[22m
[2m    const moveRight = t3;[22m
[2m    let t4;[22m
[2m    if ($[4] !== moveLeft || $[5] !== moveRight) {[22m
[2m      t4 = [moveLeft, moveRight];[22m
[2m      $[4] = moveLeft;[22m
[2m      $[5] = moveRight;[22m
[2m      $[6] = t4;[22m
[2m    } else {[22m
[2m      t4 = $[6];[22m
[2m    }[22m
[2m    return t4;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useKeyCommand,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) [{"handler":"[[ function params=0 ]]"},{"handler":"[[ function params=0 ]]"}][22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/bug-nonmutating-capture-in-unsplittable-memo-block
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m
[2m  import {identity, mutate} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * The root cause of this bug is in `InferReactiveScopeVariables`. Currently,[22m
[2m   * InferReactiveScopeVariables do not ensure that maybe-aliased values get[22m
[2m   * assigned the same reactive scope. This is safe only when an already-[22m
[2m   * constructed value is captured, e.g.[22m
[2m   * ```js[22m
[2m   * const x = makeObj();  ⌝ mutable range of x[22m
[2m   * mutate(x);            ⌟[22m
[2m   *                       <-- after this point, we can produce a canonical version[22m
[2m   *                           of x for all following aliases[22m
[2m   * const y = [];[22m
[2m   * y.push(x);            <-- y captures x[22m
[2m   * ```[22m
[2m   *[22m
[2m   * However, if a value is captured/aliased during its mutable range and the[22m
[2m   * capturing container is separately memoized, it becomes difficult to guarantee[22m
[2m   * that all aliases refer to the same value.[22m
[2m   *[22m
[2m   * Sprout error:[22m
[2m   * Found differences in evaluator results[22m
[2m   * Non-forget (expected):[22m
[2m   * (kind: ok) [{"wat0":"joe"},3][22m
[2m   * [{"wat0":"joe"},3][22m
[2m   * Forget:[22m
[2m   * (kind: ok) [{"wat0":"joe"},3][22m
[2m   * [[ (exception in render) Error: oh no! ]][22m
[2m   *[22m
[2m   */[22m
[2m  function useFoo({a, b}) {[22m
[2m    const x = {a};[22m
[2m    const y = {};[22m
[2m    mutate(x);[22m
[2m    const z = [identity(y), b];[22m
[2m    mutate(y);[22m

[2m    if (z[0] !== y) {[22m
[2m      throw new Error('oh no!');[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{a: 2, b: 3}],[22m
[2m    sequentialRenders: [[22m
[2m      {a: 2, b: 3},[22m
[2m      {a: 4, b: 3},[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m
[2m  import { identity, mutate } from "shared-runtime";[22m

[2m  /**[22m
[2m   * The root cause of this bug is in `InferReactiveScopeVariables`. Currently,[22m
[2m   * InferReactiveScopeVariables do not ensure that maybe-aliased values get[22m
[2m   * assigned the same reactive scope. This is safe only when an already-[22m
[2m   * constructed value is captured, e.g.[22m
[2m   * ```js[22m
[2m   * const x = makeObj();  ⌝ mutable range of x[22m
[2m   * mutate(x);            ⌟[22m
[2m   *                       <-- after this point, we can produce a canonical version[22m
[2m   *                           of x for all following aliases[22m
[2m   * const y = [];[22m
[2m   * y.push(x);            <-- y captures x[22m
[2m   * ```[22m
[2m   *[22m
[2m   * However, if a value is captured/aliased during its mutable range and the[22m
[2m   * capturing container is separately memoized, it becomes difficult to guarantee[22m
[2m   * that all aliases refer to the same value.[22m
[2m   *[22m
[2m   * Sprout error:[22m
[2m   * Found differences in evaluator results[22m
[2m   * Non-forget (expected):[22m
[2m   * (kind: ok) [{"wat0":"joe"},3][22m
[2m   * [{"wat0":"joe"},3][22m
[2m   * Forget:[22m
[2m   * (kind: ok) [{"wat0":"joe"},3][22m
[2m   * [[ (exception in render) Error: oh no! ]][22m
[2m   *[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(6);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { a, b } = t0;[22m
[2m    let z;[22m
[2m    let y;[22m
[2m    if ($[0] !== a || $[1] !== b) {[22m
[2m      const x = { a };[22m
[2m      y = {};[22m
[2m      mutate(x);[22m
[2m      let t1;[22m
[2m      if ($[4] !== b) {[22m
[2m        t1 = [identity(y), b];[22m
[2m        $[4] = b;[22m
[2m        $[5] = t1;[22m
[2m      } else {[22m
[2m        t1 = $[5];[22m
[2m      }[22m
[2m      z = t1;[22m
[2m      mutate(y);[22m
[2m      $[0] = a;[22m
[2m      $[1] = b;[22m
[2m      $[2] = z;[22m
[2m      $[3] = y;[22m
[2m    } else {[22m
[2m      z = $[2];[22m
[2m      y = $[3];[22m
[2m    }[22m
[2m    if (z[0] !== y) {[22m
[2m      throw new Error("oh no!");[22m
[2m    }[22m
[2m    return z;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ a: 2, b: 3 }],[22m
[2m    sequentialRenders: [[22m
[2m      { a: 2, b: 3 },[22m
[2m      { a: 4, b: 3 },[22m
[2m    ],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/bug-hoisted-declaration-with-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m
[2m  import {StaticText1, Stringify, identity, useHook} from 'shared-runtime';[22m
[2m  /**[22m
[2m   * `button` and `dispatcher` must end up in the same memo block. It would be[22m
[2m   * invalid for `button` to take a dependency on `dispatcher` as dispatcher[22m
[2m   * is created later.[22m
[2m   *[22m
[2m   * Sprout error:[22m
[2m   * Found differences in evaluator results[22m
[2m   * Non-forget (expected):[22m
[2m   * (kind: ok) "[[ function params=1 ]]"[22m
[2m   * Forget:[22m
[2m   * (kind: exception) Cannot access 'dispatcher' before initialization[22m
[2m   */[22m
[2m  function useFoo({onClose}) {[22m
[2m    const button = StaticText1 ?? ([22m
[2m      <Stringify[22m
[2m        primary={{[22m
[2m          label: identity('label'),[22m
[2m          onPress: onClose,[22m
[2m        }}[22m
[2m        secondary={{[22m
[2m          onPress: () => {[22m
[2m            dispatcher.go('route2');[22m
[2m          },[22m
[2m        }}[22m
[2m      />[22m
[2m    );[22m

[2m    const dispatcher = useHook();[22m

[2m    return button;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{onClose: identity()}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m
[2m  import { StaticText1, Stringify, identity, useHook } from "shared-runtime";[22m
[2m  /**[22m
[2m   * `button` and `dispatcher` must end up in the same memo block. It would be[22m
[2m   * invalid for `button` to take a dependency on `dispatcher` as dispatcher[22m
[2m   * is created later.[22m
[2m   *[22m
[2m   * Sprout error:[22m
[2m   * Found differences in evaluator results[22m
[2m   * Non-forget (expected):[22m
[2m   * (kind: ok) "[[ function params=1 ]]"[22m
[2m   * Forget:[22m
[2m   * (kind: exception) Cannot access 'dispatcher' before initialization[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { onClose } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== onClose || $[1] !== dispatcher) {[22m
[2m      t1 = StaticText1 ?? ([22m
[2m        <Stringify[22m
[32m-         primary={{ label: identity("label"), onPress: onClose }}[39m
[32m-         secondary={{[39m
[32m-           onPress: () => {[39m
[32m-             dispatcher.go("route2");[39m
[32m-           },[39m
[31m+         primary={function () {[39m
[31m+           const $res$ = { label: identity("label"), onPress: onClose };[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+         secondary={function () {[39m
[31m+           const $res$ = {[39m
[31m+             onPress: () => {[39m
[31m+               dispatcher.go("route2");[39m
[31m+             },[39m
[31m+           };[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[2m          }}[22m
[2m        />[22m
[2m      );[22m
[2m      $[0] = onClose;[22m
[2m      $[1] = dispatcher;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    const button = t1;[22m

[32m-   const dispatcher = useHook();[39m
[31m+   const dispatcher = (function () {[39m
[31m+     const $res$ = useHook();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    return button;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ onClose: identity() }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m original-reactive-scopes-fork/allocating-logical-expression-instruction-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @enableReactiveScopesInHIR:false[22m

[2m  /**[22m
[2m   * This is a weird case as data has type `BuiltInMixedReadonly`.[22m
[2m   * The only scoped value we currently infer in this program is the[22m
[2m   * PropertyLoad `data?.toString`.[22m
[2m   */[22m
[2m  import {useFragment} from 'shared-runtime';[22m

[2m  function Foo() {[22m
[2m    const data = useFragment();[22m
[2m    return [data?.toString() || ''];[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @enableReactiveScopesInHIR:false[22m

[2m  /**[22m
[2m   * This is a weird case as data has type `BuiltInMixedReadonly`.[22m
[2m   * The only scoped value we currently infer in this program is the[22m
[2m   * PropertyLoad `data?.toString`.[22m
[2m   */[22m
[2m  import { useFragment } from "shared-runtime";[22m

[2m  function Foo() {[22m
[2m    const $ = _c(2);[22m
[32m-   const data = useFragment();[39m
[31m+   const data = (function () {[39m
[31m+     const $res$ = useFragment();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m
[2m    const t0 = data?.toString() || "";[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[2m      t1 = [t0];[22m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) ["[object Object]"][22m

[31m[1mFAIL:[22m[39m meta-isms/repro-cx-namespace-nesting
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div class="foo bar baz merp">Ok</div>
Forget:
(kind: ok) <div>Ok</div>
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`className`','div','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m meta-isms/repro-cx-namespace-assigned-to-temporary
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  // @compilationMode(infer) @enableAssumeHooksFollowRulesOfReact:false @customMacros(cx)[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  const DARK = 'dark';[22m

[2m  function Component() {[22m
[2m    const theme = useTheme();[22m
[2m    return ([22m
[2m      <div[22m
[2m        className={cx.foo({[22m
[2m          'styles/light': true,[22m
[2m          'styles/dark': identity([theme.getTheme()]),[22m
[2m        })}[22m
[2m      />[22m
[2m    );[22m
[2m  }[22m

[2m  function cx(obj) {[22m
[2m    const classes = [];[22m
[2m    for (const [key, value] of Object.entries(obj)) {[22m
[2m      if (value) {[22m
[2m        classes.push(key);[22m
[2m      }[22m
[2m    }[22m
[2m    return classes.join(' ');[22m
[2m  }[22m

[2m  function useTheme() {[22m
[2m    return {[22m
[2m      getTheme() {[22m
[2m        return DARK;[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime"; // @compilationMode(infer) @enableAssumeHooksFollowRulesOfReact:false @customMacros(cx)[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  const DARK = "dark";[22m

[2m  function Component() {[22m
[2m    const $ = _c(2);[22m
[32m-   const theme = useTheme();[39m
[31m+   const theme = (function () {[39m
[31m+     const $res$ = useTheme();[39m
[31m+     Object.freeze($res$);[39m
[31m+     return $res$;[39m
[31m+   })();[39m

[2m    const t0 = cx.foo({[22m
[2m      "styles/light": true,[22m
[2m      "styles/dark": identity([theme.getTheme()]),[22m
[2m    });[22m
[2m    let t1;[22m
[2m    if ($[0] !== t0) {[22m
[32m-     t1 = <div className={t0} />;[39m
[31m+     t1 = ([39m
[31m+       <div[39m
[31m+         className={function () {[39m
[31m+           const $res$ = t0;[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[31m+       />[39m
[31m+     );[39m
[2m      $[0] = t0;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  function cx(obj) {[22m
[2m    const classes = [];[22m
[2m    for (const [key, value] of Object.entries(obj)) {[22m
[2m      if (value) {[22m
[2m        classes.push(key);[22m
[2m      }[22m
[2m    }[22m
[2m    return classes.join(" ");[22m
[2m  }[22m

[2m  function useTheme() {[22m
[2m    return {[22m
[2m      getTheme() {[22m
[2m        return DARK;[22m
[2m      },[22m
[2m    };[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{}],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: exception) cx.foo is not a function[22m

[31m[1mFAIL:[22m[39m meta-isms/repro-cx-assigned-to-temporary
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div class="styles/light styles/dark"></div>
Forget:
(kind: ok) <div></div>

[31m[1mFAIL:[22m[39m fbt/repro-macro-property-not-handled
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m
[2m  import {useIdentity} from 'shared-runtime';[22m

[2m  /**[22m
[2m   * MemoizeFbtAndMacroOperandsInSameScope should also track PropertyLoads (e.g. fbt.plural).[22m
[2m   * This doesn't seem to be an issue for fbt, but affects other internal macros invoked as[22m
[2m   * `importSpecifier.funcName` (see https://fburl.com/code/72icxwmn)[22m
[2m   */[22m
[2m  function useFoo({items}: {items: Array<number>}) {[22m
[2m    return fbt([22m
[2m      'There ' +[22m
[2m        fbt.plural('is', useIdentity([...items]).length, {many: 'are'}) +[22m
[2m        ' ' +[22m
[2m        fbt.param('number of items', items.length) +[22m
[2m        ' items',[22m
[2m      'Error content when there are unsupported locales.',[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{items: [2, 3]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m
[2m  import { useIdentity } from "shared-runtime";[22m

[2m  /**[22m
[2m   * MemoizeFbtAndMacroOperandsInSameScope should also track PropertyLoads (e.g. fbt.plural).[22m
[2m   * This doesn't seem to be an issue for fbt, but affects other internal macros invoked as[22m
[2m   * `importSpecifier.funcName` (see https://fburl.com/code/72icxwmn)[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { items } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== items) {[22m
[2m      t1 = [...items];[22m
[2m      $[0] = items;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return fbt._([22m
[2m      {[22m
[2m        "*": "There are {number of items} items",[22m
[2m        _1: "There is {number of items} items",[22m
[2m      },[22m
[2m      [[22m
[32m-       fbt._plural(useIdentity(t1).length),[39m
[31m+       fbt._plural([39m
[31m+         (function () {[39m
[31m+           const $res$ = useIdentity(Object.freeze(t1));[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         })().length,[39m
[31m+       ),[39m
[2m        fbt._param([22m
[2m          "number of items",[22m

[2m          items.length,[22m
[2m        ),[22m
[2m      ],[22m
[2m      { hk: "xsa7w" },[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ items: [2, 3] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) There are 2 items[22m

[31m[1mFAIL:[22m[39m fbt/lambda-with-fbt
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import {fbt} from 'fbt';[22m

[2m  function Component() {[22m
[2m    const buttonLabel = () => {[22m
[2m      if (!someCondition) {[22m
[2m        return <fbt desc="My label">{'Purchase as a gift'}</fbt>;[22m
[2m      } else if ([22m
[2m        !iconOnly &&[22m
[2m        showPrice &&[22m
[2m        item?.current_gift_offer?.price?.formatted != null[22m
[2m      ) {[22m
[2m        return ([22m
[2m          <fbt desc="Gift button's label">[22m
[2m            {'Gift | '}[22m
[2m            <fbt:param name="price">[22m
[2m              {item?.current_gift_offer?.price?.formatted}[22m
[2m            </fbt:param>[22m
[2m          </fbt>[22m
[2m        );[22m
[2m      } else if (!iconOnly && !showPrice) {[22m
[2m        return <fbt desc="Gift button's label">{'Gift'}</fbt>;[22m
[2m      }[22m
[2m    };[22m

[2m    return ([22m
[2m      <View>[22m
[2m        <Button text={buttonLabel()} />[22m
[2m      </View>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import { fbt } from "fbt";[22m

[2m  function Component() {[22m
[2m    const $ = _c(1);[22m
[2m    const buttonLabel = _temp;[22m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[2m        <View>[22m
[32m-         <Button text={buttonLabel()} />[39m
[31m+         <Button[39m
[31m+           text={function () {[39m
[31m+             const $res$ = buttonLabel();[39m
[31m+             Object.freeze($res$);[39m
[31m+             return $res$;[39m
[31m+           }}[39m
[31m+         />[39m
[2m        </View>[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m
[2m  function _temp() {[22m
[2m    if (!someCondition) {[22m
[2m      return fbt._("Purchase as a gift", null, { hk: "1gHj4g" });[22m
[2m    } else {[22m
[2m      if ([22m
[2m        !iconOnly &&[22m
[2m        showPrice &&[22m
[2m        item?.current_gift_offer?.price?.formatted != null[22m
[2m      ) {[22m
[2m        return fbt._([22m
[2m          "Gift | {price}",[22m
[2m          [fbt._param("price", item?.current_gift_offer?.price?.formatted)],[22m
[2m          { hk: "3GTnGE" },[22m
[2m        );[22m
[2m      } else {[22m
[2m        if (!iconOnly && !showPrice) {[22m
[2m          return fbt._("Gift", null, { hk: "3fqfrk" });[22m
[2m        }[22m
[2m      }[22m
[2m    }[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/fbtparam-with-jsx-fragment-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    return ([22m
[2m      <Foo[22m
[2m        value={[22m
[2m          <fbt desc="Description of the parameter">[22m
[2m            <fbt:param name="value">{<>{identity(props.text)}</>}</fbt:param>%[22m
[2m          </fbt>[22m
[2m        }[22m
[2m      />[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.text) {[22m
[2m      t0 = ([22m
[2m        <Foo[22m
[32m-         value={fbt._([39m
[32m-           "{value}%",[39m
[32m-           [fbt._param("value", <>{identity(props.text)}</>)],[39m
[32m-           { hk: "10F5Cc" },[39m
[32m-         )}[39m
[31m+         value={function () {[39m
[31m+           const $res$ = fbt._([39m
[31m+             "{value}%",[39m
[31m+             [fbt._param("value", <>{identity(props.text)}</>)],[39m
[31m+             { hk: "10F5Cc" },[39m
[31m+           );[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[2m        />[22m
[2m      );[22m
[2m      $[0] = props.text;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/fbtparam-with-jsx-element-content
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component({name, data, icon}) {[22m
[2m    return ([22m
[2m      <Text type="body4">[22m
[2m        <fbt desc="Lorem ipsum">[22m
[2m          <fbt:param name="item author">[22m
[2m            <Text type="h4">{name}</Text>[22m
[2m          </fbt:param>[22m
[2m          <fbt:param name="icon">{icon}</fbt:param>[22m
[2m          <Text type="h4">[22m
[2m            <fbt:param name="item details">{data}</fbt:param>[22m
[2m          </Text>[22m
[2m        </fbt>[22m
[2m      </Text>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(t0) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { name, data, icon } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== name || $[1] !== icon || $[2] !== data) {[22m
[2m      t1 = ([22m
[2m        <Text type="body4">[22m
[2m          {fbt._([22m
[2m            "{item author}{icon}{=m2}",[22m
[2m            [[22m
[2m              fbt._param([22m
[2m                "item author",[22m

[2m                <Text type="h4">{name}</Text>,[22m
[2m              ),[22m
[2m              fbt._param([22m
[2m                "icon",[22m

[2m                icon,[22m
[2m              ),[22m
[2m              fbt._implicitParam([22m
[2m                "=m2",[22m
[2m                <Text type="h4">[22m
[2m                  {fbt._("{item details}", [fbt._param("item details", data)], {[22m
[2m                    hk: "4jLfVq",[22m
[2m                  })}[22m
[2m                </Text>,[22m
[2m              ),[22m
[2m            ],[22m
[2m            { hk: "2HLm2j" },[22m
[2m          )}[22m
[2m        </Text>[22m
[2m      );[22m
[2m      $[0] = name;[22m
[2m      $[1] = icon;[22m
[2m      $[2] = data;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/fbtparam-text-must-use-expression-container
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    return ([22m
[2m      <Foo[22m
[2m        value={[22m
[2m          <fbt desc="Description of the parameter">[22m
[2m            <fbt:param name="value">{'0'}</fbt:param>%[22m
[2m          </fbt>[22m
[2m        }[22m
[2m      />[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(1);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] === Symbol.for("react.memo_cache_sentinel")) {[22m
[2m      t0 = ([22m
[2m        <Foo[22m
[32m-         value={fbt._("{value}%", [fbt._param("value", "0")], { hk: "10F5Cc" })}[39m
[31m+         value={function () {[39m
[31m+           const $res$ = fbt._("{value}%", [fbt._param("value", "0")], {[39m
[31m+             hk: "10F5Cc",[39m
[31m+           });[39m
[31m+           Object.freeze($res$);[39m
[31m+           return $res$;[39m
[31m+         }}[39m
[2m        />[22m
[2m      );[22m
[2m      $[0] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[0];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/fbt-whitespace-within-text
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  const _ = fbt;[22m
[2m  function Component({value}: {value: string}) {[22m
[2m    return ([22m
[2m      <fbt desc="descdesc">[22m
[2m        Before text <fbt:param name="paramName">{value}</fbt:param> after text[22m
[2m        more text and more and more and more and more and more and more and more[22m
[2m        and more and blah blah blah blah[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'hello world'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  const _ = fbt;[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = fbt._([22m
[2m        "Before text {paramName} after text more text and more and more and more and more and more and more and more and more and blah blah blah blah",[22m
[2m        [fbt._param("paramName", value)],[22m
[2m        { hk: "24ZPpO" },[22m
[2m      );[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "hello world" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Before text hello world after text more text and more and more and more and more and more and more and more and more and blah blah blah blah[22m

[31m[1mFAIL:[22m[39m fbt/fbt-whitespace-around-param-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  const _ = fbt;[22m
[2m  function Component({value}: {value: string}) {[22m
[2m    return ([22m
[2m      <fbt desc="descdesc">[22m
[2m        Before text <fbt:param name="paramName"> {value} </fbt:param> after text[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'hello world'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  const _ = fbt;[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = fbt._([22m
[2m        "Before text {paramName} after text",[22m
[2m        [fbt._param("paramName", value)],[22m
[2m        { hk: "26pxNm" },[22m
[2m      );[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "hello world" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Before text hello world after text[22m

[31m[1mFAIL:[22m[39m fbt/fbt-to-string
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    const element = ([22m
[2m      <fbt desc={'Dialog to show to user'}>[22m
[2m        Hello <fbt:param name="user name">{props.name}</fbt:param>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m    return element.toString();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Jason'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._("Hello {user name}", [fbt._param("user name", props.name)], {[22m
[2m        hk: "2zEDKF",[22m
[2m      });[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const element = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== element) {[22m
[2m      t1 = element.toString();[22m
[2m      $[2] = element;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Jason" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "Hello Jason"[22m

[31m[1mFAIL:[22m[39m fbt/fbt-template-string-same-scope
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m
[2m  import {Stringify} from 'shared-runtime';[22m

[2m  export function Component(props) {[22m
[2m    let count = 0;[22m
[2m    if (props.items) {[22m
[2m      count = props.items.length;[22m
[2m    }[22m
[2m    return ([22m
[2m      <Stringify>[22m
[2m        {fbt([22m
[2m          `for ${fbt.param('count', count)} experiences`,[22m
[2m          `Label for the number of items`,[22m
[2m          {project: 'public'}[22m
[2m        )}[22m
[2m      </Stringify>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{items: [1, 2, 3]}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m
[2m  import { Stringify } from "shared-runtime";[22m

[2m  export function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let count = 0;[22m
[2m    if (props.items) {[22m
[2m      count = props.items.length;[22m
[2m    }[22m
[2m    let t0;[22m
[2m    if ($[0] !== count) {[22m
[2m      t0 = fbt._("for {count} experiences", [fbt._param("count", count)], {[22m
[2m        hk: "nmYpm",[22m
[2m      });[22m
[2m      $[0] = count;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== t0) {[22m
[2m      t1 = <Stringify>{t0}</Stringify>;[22m
[2m      $[2] = t0;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ items: [1, 2, 3] }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>{"children":"for 3 experiences"}</div>[22m

[31m[1mFAIL:[22m[39m fbt/fbt-single-space-btw-param-and-text
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  const _ = fbt;[22m
[2m  function Component({value}: {value: string}) {[22m
[2m    return ([22m
[2m      <fbt desc="descdesc">[22m
[2m        Before text <fbt:param name="paramName">{value}</fbt:param> after text[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'hello world'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  const _ = fbt;[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = fbt._([22m
[2m        "Before text {paramName} after text",[22m
[2m        [fbt._param("paramName", value)],[22m
[2m        { hk: "26pxNm" },[22m
[2m      );[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "hello world" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Before text hello world after text[22m

[31m[1mFAIL:[22m[39m fbt/fbt-preserve-whitespace
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  const _ = fbt;[22m
[2m  function Component({value}: {value: string}) {[22m
[2m    return ([22m
[2m      <fbt desc="descdesc">[22m
[2m        Before text[22m
[2m        <fbt:param name="paramName">{value}</fbt:param>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'hello world'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  const _ = fbt;[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = fbt._([22m
[2m        "Before text {paramName}",[22m
[2m        [[22m
[2m          fbt._param([22m
[2m            "paramName",[22m

[2m            value,[22m
[2m          ),[22m
[2m        ],[22m
[2m        { hk: "3z5SVE" },[22m
[2m      );[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "hello world" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Before text hello world[22m

[31m[1mFAIL:[22m[39m fbt/fbt-preserve-whitespace-two-subtrees
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Foo({name1, name2}) {[22m
[2m    return ([22m
[2m      <fbt desc="Text that is displayed when two people accepts the user's pull request.">[22m
[2m        <fbt:param name="user1">[22m
[2m          <span>[22m
[2m            <b>{name1}</b>[22m
[2m          </span>[22m
[2m        </fbt:param>[22m
[2m        and[22m
[2m        <fbt:param name="user2">[22m
[2m          <span>[22m
[2m            <b>{name2}</b>[22m
[2m          </span>[22m
[2m        </fbt:param>[22m
[2m        accepted your PR![22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{name1: 'Mike', name2: 'Jan'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Foo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { name1, name2 } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== name1 || $[1] !== name2) {[22m
[2m      t1 = fbt._([22m
[2m        "{user1} and {user2} accepted your PR!",[22m
[2m        [[22m
[2m          fbt._param([22m
[2m            "user1",[22m

[2m            <span>[22m
[2m              <b>{name1}</b>[22m
[2m            </span>,[22m
[2m          ),[22m
[2m          fbt._param([22m
[2m            "user2",[22m

[2m            <span>[22m
[2m              <b>{name2}</b>[22m
[2m            </span>,[22m
[2m          ),[22m
[2m        ],[22m
[2m        { hk: "2PxMie" },[22m
[2m      );[22m
[2m      $[0] = name1;[22m
[2m      $[1] = name2;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ name1: "Mike", name2: "Jan" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <span><b>Mike</b></span> and <span><b>Jan</b></span> accepted your PR![22m

[31m[1mFAIL:[22m[39m fbt/fbt-preserve-whitespace-subtree
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  /**[22m
[2m   * Note that fbt whitespace rules apply to the entire fbt subtree,[22m
[2m   * not just direct children of fbt elements.[22m
[2m   * (e.g. here, the JSXText children of the span element also use[22m
[2m   * fbt whitespace rules)[22m
[2m   */[22m

[2m  function Foo(props) {[22m
[2m    return ([22m
[2m      <fbt desc={'Dialog to show to user'}>[22m
[2m        <span>[22m
[2m          <fbt:param name="user name really long description for prettier">[22m
[2m            {props.name}[22m
[2m          </fbt:param>[22m
[2m          ![22m
[2m        </span>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{name: 'Jason'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  /**[22m
[2m   * Note that fbt whitespace rules apply to the entire fbt subtree,[22m
[2m   * not just direct children of fbt elements.[22m
[2m   * (e.g. here, the JSXText children of the span element also use[22m
[2m   * fbt whitespace rules)[22m
[2m   */[22m

[2m  function Foo(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._([22m
[2m        "{=m0}",[22m
[2m        [[22m
[2m          fbt._implicitParam([22m
[2m            "=m0",[22m
[2m            <span>[22m
[2m              {fbt._([22m
[2m                "{user name really long description for prettier} !",[22m
[2m                [[22m
[2m                  fbt._param([22m
[2m                    "user name really long description for prettier",[22m

[2m                    props.name,[22m
[2m                  ),[22m
[2m                ],[22m
[2m                { hk: "rdgIJ" },[22m
[2m              )}[22m
[2m            </span>,[22m
[2m          ),[22m
[2m        ],[22m
[2m        { hk: "32Ufy5" },[22m
[2m      );[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Foo,[22m
[2m    params: [{ name: "Jason" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <span>Jason !</span>[22m

[31m[1mFAIL:[22m[39m fbt/fbt-preserve-jsxtext
 >> Unexpected error during test:
Expected fixture `fbt-preserve-jsxtext` to succeed but it failed with error:

/fbt-preserve-jsxtext.ts: Expected enum range (second argument) to be an array, object or a variable referring to an fbt enum
---
fbt.enum(function () {
  const $res$ = props.value ? "0" : "1";
  Object.freeze($res$);
  return $res$;
}, function () {
  const $res$ = {
    "0": "hello",
    "1": "goodbye"
  };
  Object.freeze($res$);
  return $res$;
})
---
[31m[1mFAIL:[22m[39m fbt/fbt-params
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <fbt desc={'Dialog to show to user'}>[22m
[2m          Hello <fbt:param name="user name">{props.name}</fbt:param>[22m
[2m        </fbt>[22m
[2m        <fbt desc={'Available actions|response'}>[22m
[2m          <fbt:param name="actions|response">{props.actions}</fbt:param>[22m
[2m        </fbt>[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ['TodoAdd'],[22m
[2m    isComponent: 'TodoAdd',[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(7);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._("Hello {user name}", [fbt._param("user name", props.name)], {[22m
[2m        hk: "2zEDKF",[22m
[2m      });[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    let t1;[22m
[2m    if ($[2] !== props.actions) {[22m
[2m      t1 = fbt._([22m
[2m        "{actions|response}",[22m
[2m        [fbt._param("actions|response", props.actions)],[22m
[2m        { hk: "1cjfbg" },[22m
[2m      );[22m
[2m      $[2] = props.actions;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    let t2;[22m
[2m    if ($[4] !== t0 || $[5] !== t1) {[22m
[2m      t2 = ([22m
[2m        <div>[22m
[2m          {t0}[22m
[2m          {t1}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[4] = t0;[22m
[2m      $[5] = t1;[22m
[2m      $[6] = t2;[22m
[2m    } else {[22m
[2m      t2 = $[6];[22m
[2m    }[22m
[2m    return t2;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: ["TodoAdd"],[22m
[2m    isComponent: "TodoAdd",[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/fbt-params-complex-param-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    return ([22m
[2m      <fbt desc={'Dialog to show to user'}>[22m
[2m        Hello <fbt:param name="user name">{capitalize(props.name)}</fbt:param>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._([22m
[2m        "Hello {user name}",[22m
[2m        [fbt._param("user name", capitalize(props.name))],[22m
[2m        { hk: "2zEDKF" },[22m
[2m      );[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    return t0;[22m
[2m  }[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/fbt-param-with-unicode
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    const element = ([22m
[2m      <fbt desc={'Dialog to show to user'}>[22m
[2m        Hello <fbt:param name="user name ☺">{props.name}</fbt:param>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m    return element.toString();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Jason'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._([22m
[2m        "Hello {user name ☺}",[22m
[2m        [fbt._param("user name \u263A", props.name)],[22m
[2m        { hk: "1En1lp" },[22m
[2m      );[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const element = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== element) {[22m
[2m      t1 = element.toString();[22m
[2m      $[2] = element;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Jason" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "Hello Jason"[22m

[31m[1mFAIL:[22m[39m fbt/fbt-param-with-trailing-whitespace
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <span>42 votes for thing!</span>
<span>42 votes for thing!</span>
<span>1 vote for other!</span>
<span>1 vote for other!</span>
<span>42 votes for thing!</span>
<span>1 vote for other!</span>
<span>42 votes for thing!</span>
<span>1 vote for other!</span>
Forget:
(kind: ok) <span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>

[31m[1mFAIL:[22m[39m fbt/fbt-param-with-quotes
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    const element = ([22m
[2m      <fbt desc={'Dialog to show to user'}>[22m
[2m        Hello <fbt:param name='"user" name'>{props.name}</fbt:param>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m    return element.toString();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Jason'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._('Hello {"user" name}', [fbt._param('"user" name', props.name)], {[22m
[2m        hk: "S0vMe",[22m
[2m      });[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const element = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== element) {[22m
[2m      t1 = element.toString();[22m
[2m      $[2] = element;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Jason" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "Hello Jason"[22m

[31m[1mFAIL:[22m[39m fbt/fbt-param-with-newline
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    const element = ([22m
[2m      <fbt desc={'Dialog to show to user'}>[22m
[2m        Hello{' '}[22m
[2m        <fbt:param[22m
[2m          name="a really long description[22m
[2m        that got split into multiple lines">[22m
[2m          {props.name}[22m
[2m        </fbt:param>[22m
[2m      </fbt>[22m
[2m    );[22m
[2m    return element.toString();[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Jason'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._([22m
[2m        "Hello {a really long description that got split into multiple lines}",[22m
[2m        [[22m
[2m          fbt._param([22m
[2m            "a really long description that got split into multiple lines",[22m

[2m            props.name,[22m
[2m          ),[22m
[2m        ],[22m
[2m        { hk: "1euPUp" },[22m
[2m      );[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const element = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== element) {[22m
[2m      t1 = element.toString();[22m
[2m      $[2] = element;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Jason" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) "Hello Jason"[22m

[31m[1mFAIL:[22m[39m fbt/fbt-param-with-leading-whitespace
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <span>42 votes for thing!</span>
<span>42 votes for thing!</span>
<span>1 vote for other!</span>
<span>1 vote for other!</span>
<span>42 votes for thing!</span>
<span>1 vote for other!</span>
<span>42 votes for thing!</span>
<span>1 vote for other!</span>
Forget:
(kind: ok) <span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for thing!</span>
<span>function () {
      const $res$ = (0, _sharedRuntime.identity)(props votes for other!</span>

[31m[1mFAIL:[22m[39m fbt/fbt-no-whitespace-btw-text-and-param
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  const _ = fbt;[22m
[2m  function Component({value}: {value: string}) {[22m
[2m    return ([22m
[2m      <fbt desc="descdesc">[22m
[2m        Before text<fbt:param name="paramName">{value}</fbt:param>After text[22m
[2m      </fbt>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{value: 'hello world'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  const _ = fbt;[22m
[2m  function Component(t0) {[22m
[2m    const $ = _c(2);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { value } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== value) {[22m
[2m      t1 = fbt._([22m
[2m        "Before text{paramName}After text",[22m
[2m        [fbt._param("paramName", value)],[22m
[2m        { hk: "aKEGX" },[22m
[2m      );[22m
[2m      $[0] = value;[22m
[2m      $[1] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[1];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ value: "hello world" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) Before texthello worldAfter text[22m

[31m[1mFAIL:[22m[39m fbt/fbt-call
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  function Component(props) {[22m
[2m    const text = fbt([22m
[2m      `${fbt.param('(key) count', props.count)} items`,[22m
[2m      '(description) Number of items'[22m
[2m    );[22m
[2m    return <div>{text}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{count: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.count) {[22m
[2m      t0 = fbt._([22m
[2m        "{(key) count} items",[22m
[2m        [fbt._param("(key) count", props.count)],[22m
[2m        { hk: "3yW91j" },[22m
[2m      );[22m
[2m      $[0] = props.count;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const text = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== text) {[22m
[2m      t1 = <div>{text}</div>;[22m
[2m      $[2] = text;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ count: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>2 items</div>[22m

[31m[1mFAIL:[22m[39m fbt/fbt-call-complex-param-value
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m
[2m  import {identity} from 'shared-runtime';[22m

[2m  function Component(props) {[22m
[2m    const text = fbt([22m
[2m      `Hello, ${fbt.param('(key) name', identity(props.name))}!`,[22m
[2m      '(description) Greeting'[22m
[2m    );[22m
[2m    return <div>{text}</div>;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{name: 'Sathya'}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m
[2m  import { identity } from "shared-runtime";[22m

[2m  function Component(props) {[22m
[2m    const $ = _c(4);[22m
[31m+   Object.freeze(props);[39m
[2m    let t0;[22m
[2m    if ($[0] !== props.name) {[22m
[2m      t0 = fbt._([22m
[2m        "Hello, {(key) name}!",[22m
[2m        [fbt._param("(key) name", identity(props.name))],[22m
[2m        { hk: "2sOsn5" },[22m
[2m      );[22m
[2m      $[0] = props.name;[22m
[2m      $[1] = t0;[22m
[2m    } else {[22m
[2m      t0 = $[1];[22m
[2m    }[22m
[2m    const text = t0;[22m
[2m    let t1;[22m
[2m    if ($[2] !== text) {[22m
[2m      t1 = <div>{text}</div>;[22m
[2m      $[2] = text;[22m
[2m      $[3] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[3];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: Component,[22m
[2m    params: [{ name: "Sathya" }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m
[2m  ### Eval output[22m
[2m  (kind: ok) <div>Hello, Sathya!</div>[22m

[31m[1mFAIL:[22m[39m fbt/fbs-params
 >> Unexpected error during test:


Found differences in evaluator results
Non-forget (expected):
(kind: ok) <div title="Hello Sathya">Hover me</div>
Forget:
(kind: ok) <div>Hover me</div>
logs: ['Warning: Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://react.dev/link/attribute-behavior %s','`title`','div','\n' +
  '    at div\n' +
  '    at WrapperTestComponent (/Users/mvitousek/react/compiler/packages/snap/dist/sprout/evaluator.js:89:26)']

[31m[1mFAIL:[22m[39m fbt/bug-fbt-plural-multiple-mixed-call-tag
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  /**[22m
[2m   * Similar to error.todo-multiple-fbt-plural, but note that we must[22m
[2m   * count fbt plurals across both <fbt:plural /> namespaced jsx tags[22m
[2m   * and fbt.plural(...) call expressions.[22m
[2m   *[22m
[2m   * Evaluator error:[22m
[2m   *   Found differences in evaluator results[22m
[2m   *   Non-forget (expected):[22m
[2m   *   (kind: ok) <div>1 apple and 2 bananas</div>[22m
[2m   *   Forget:[22m
[2m   *   (kind: ok) <div>1 apples and 2 bananas</div>[22m
[2m   */[22m
[2m  function useFoo({apples, bananas}) {[22m
[2m    return ([22m
[2m      <div>[22m
[2m        <fbt desc="Test Description">[22m
[2m          {fbt.param('number of apples', apples)}[22m
[2m          {'  '}[22m
[2m          {fbt.plural('apple', apples)} and[22m
[2m          {'  '}[22m
[2m          <fbt:plural name={'number of bananas'} count={bananas} showCount="yes">[22m
[2m            banana[22m
[2m          </fbt:plural>[22m
[2m        </fbt>[22m
[2m      </div>[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{apples: 1, bananas: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  /**[22m
[2m   * Similar to error.todo-multiple-fbt-plural, but note that we must[22m
[2m   * count fbt plurals across both <fbt:plural /> namespaced jsx tags[22m
[2m   * and fbt.plural(...) call expressions.[22m
[2m   *[22m
[2m   * Evaluator error:[22m
[2m   *   Found differences in evaluator results[22m
[2m   *   Non-forget (expected):[22m
[2m   *   (kind: ok) <div>1 apple and 2 bananas</div>[22m
[2m   *   Forget:[22m
[2m   *   (kind: ok) <div>1 apples and 2 bananas</div>[22m
[2m   */[22m
[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { apples, bananas } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== apples || $[1] !== bananas) {[22m
[2m      t1 = ([22m
[2m        <div>[22m
[2m          {fbt._([22m
[2m            {[22m
[2m              "*": {[22m
[2m                "*": "{number of apples} apples and {number of bananas} bananas",[22m
[2m              },[22m
[2m              _1: { _1: "{number of apples} apple and 1 banana" },[22m
[2m            },[22m
[2m            [[22m
[2m              fbt._plural(apples),[22m
[32m-             fbt._plural(bananas, "number of bananas"),[39m
[31m+             fbt._plural(function () {[39m
[31m+               const $res$ = bananas;[39m
[31m+               Object.freeze($res$);[39m
[31m+               return $res$;[39m
[31m+             }, "number of bananas"),[39m
[2m              fbt._param("number of apples", apples),[22m
[2m            ],[22m
[2m            { hk: "2xXrUW" },[22m
[2m          )}[22m
[2m        </div>[22m
[2m      );[22m
[2m      $[0] = apples;[22m
[2m      $[1] = bananas;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ apples: 1, bananas: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

[31m[1mFAIL:[22m[39m fbt/bug-fbt-plural-multiple-function-calls
[32m- Expected[39m
[31m+ Received[39m


[2m  ## Input[22m

[2m  ```javascript[22m
[2m  import fbt from 'fbt';[22m

[2m  /**[22m
[2m   * Similar to error.todo-multiple-fbt-plural[22m
[2m   *[22m
[2m   * Evaluator error:[22m
[2m   *   Found differences in evaluator results[22m
[2m   *   Non-forget (expected):[22m
[2m   *   (kind: ok) <div>1 apple and 2 bananas</div>[22m
[2m   *   Forget:[22m
[2m   *   (kind: ok) <div>1 apples and 2 bananas</div>[22m
[2m   */[22m

[2m  function useFoo({apples, bananas}) {[22m
[2m    return fbt([22m
[2m      `${fbt.param('number of apples', apples)} ` +[22m
[2m        fbt.plural('apple', apples) +[22m
[2m        ` and ${fbt.param('number of bananas', bananas)} ` +[22m
[2m        fbt.plural('banana', bananas),[22m
[2m      'TestDescription',[22m
[2m    );[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{apples: 1, bananas: 2}],[22m
[2m  };[22m

[2m  ```[22m

[2m  ## Code[22m

[2m  ```javascript[22m
[2m  import { c as _c } from "react/compiler-runtime";[22m
[2m  import fbt from "fbt";[22m

[2m  /**[22m
[2m   * Similar to error.todo-multiple-fbt-plural[22m
[2m   *[22m
[2m   * Evaluator error:[22m
[2m   *   Found differences in evaluator results[22m
[2m   *   Non-forget (expected):[22m
[2m   *   (kind: ok) <div>1 apple and 2 bananas</div>[22m
[2m   *   Forget:[22m
[2m   *   (kind: ok) <div>1 apples and 2 bananas</div>[22m
[2m   */[22m

[2m  function useFoo(t0) {[22m
[2m    const $ = _c(3);[22m
[31m+   Object.freeze(t0);[39m
[2m    const { apples, bananas } = t0;[22m
[2m    let t1;[22m
[2m    if ($[0] !== apples || $[1] !== bananas) {[22m
[2m      t1 = fbt._([22m
[2m        {[22m
[2m          "*": {[22m
[2m            "*": "{number of apples} apples and {number of bananas} bananas",[22m
[2m          },[22m
[2m          _1: { _1: "{number of apples} apple and {number of bananas} banana" },[22m
[2m        },[22m
[2m        [[22m
[2m          fbt._plural(apples),[22m
[2m          fbt._plural(bananas),[22m
[2m          fbt._param("number of apples", apples),[22m
[2m          fbt._param("number of bananas", bananas),[22m
[2m        ],[22m
[2m        { hk: "3vKunl" },[22m
[2m      );[22m
[2m      $[0] = apples;[22m
[2m      $[1] = bananas;[22m
[2m      $[2] = t1;[22m
[2m    } else {[22m
[2m      t1 = $[2];[22m
[2m    }[22m
[2m    return t1;[22m
[2m  }[22m

[2m  export const FIXTURE_ENTRYPOINT = {[22m
[2m    fn: useFoo,[22m
[2m    params: [{ apples: 1, bananas: 2 }],[22m
[2m  };[22m

[2m  ```[22m
[2m        [22m

1252 Tests, 367 Passed, 885 Failed
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
error Command failed.
Exit code: 1
Command: /opt/homebrew/Cellar/node/22.3.0/bin/node
Arguments: /opt/homebrew/lib/node_modules/yarn/lib/cli.js run snap
Directory: /Users/mvitousek/react/compiler/packages/babel-plugin-react-compiler
Output:

info Visit https://yarnpkg.com/en/docs/cli/workspace for documentation about this command.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
